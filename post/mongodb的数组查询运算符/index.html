<!DOCTYPE html>
<html lang="zh-cn" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>MongoDB的数组查询运算符 | Forz Blog</title>
<meta name="keywords" content="MongoDB" />
<meta name="description" content="$all 在$all选择的文件，其中一个字段的值是包含所有指定元素的数组。要指定$all表达式，请使用以下原型： 1 { &lt;field&gt;: { $all: [ &lt;value1&gt; , &lt;value2&gt; ... ] } } 特性 等效于">
<meta name="author" content="">
<link rel="canonical" href="/post/mongodb%E7%9A%84%E6%95%B0%E7%BB%84%E6%9F%A5%E8%AF%A2%E8%BF%90%E7%AE%97%E7%AC%A6/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.00d5d4fc479b1575183ee8d86b4fb372ba9d9b1904e96fa8e4c40ff7debe2b94.css" integrity="sha256-ANXU/EebFXUYPujYa0&#43;zcrqdmxkE6W&#43;o5MQP996&#43;K5Q=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.87.0" />
<meta property="og:title" content="MongoDB的数组查询运算符" />
<meta property="og:description" content="$all 在$all选择的文件，其中一个字段的值是包含所有指定元素的数组。要指定$all表达式，请使用以下原型： 1 { &lt;field&gt;: { $all: [ &lt;value1&gt; , &lt;value2&gt; ... ] } } 特性 等效于" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/mongodb%E7%9A%84%E6%95%B0%E7%BB%84%E6%9F%A5%E8%AF%A2%E8%BF%90%E7%AE%97%E7%AC%A6/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-05-13T15:45:43&#43;00:00" />
<meta property="article:modified_time" content="2020-05-13T15:45:43&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MongoDB的数组查询运算符"/>
<meta name="twitter:description" content="$all 在$all选择的文件，其中一个字段的值是包含所有指定元素的数组。要指定$all表达式，请使用以下原型： 1 { &lt;field&gt;: { $all: [ &lt;value1&gt; , &lt;value2&gt; ... ] } } 特性 等效于"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "/post/"
    }
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "MongoDB的数组查询运算符",
      "item": "/post/mongodb%E7%9A%84%E6%95%B0%E7%BB%84%E6%9F%A5%E8%AF%A2%E8%BF%90%E7%AE%97%E7%AC%A6/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "MongoDB的数组查询运算符",
  "name": "MongoDB的数组查询运算符",
  "description": "$all 在$all选择的文件，其中一个字段的值是包含所有指定元素的数组。要指定$all表达式，请使用以下原型： 1 { \u0026lt;field\u0026gt;: { $all: [ \u0026lt;value1\u0026gt; , \u0026lt;value2\u0026gt; ... ] } } 特性 等效于",
  "keywords": [
    "MongoDB"
  ],
  "articleBody": "$all 在$all选择的文件，其中一个字段的值是包含所有指定元素的数组。要指定$all表达式，请使用以下原型：\n1  { field: { $all: [ value1 , value2 ... ] } }   特性 等效于$and操作 $all相当于一个$and指定的值的操作; 即以下语句：\n1  { tags: { $all: [ \"ssl\" , \"security\" ] } }   等效于：\n1  { $and: [ { tags: \"ssl\" }, { tags: \"security\" } ] }   嵌套数组 当传递嵌套数组（例如 [ [ \"A\" ] ]）的数组时， 匹配文档，其中该字段包含嵌套数组作为元素（例如field: [ [ \"A\" ], ... ]），或者该字段等于嵌套数组（例如field: [ \"A\" ]）。\n例如，考虑以下查询：\n1  db.articles.find( { tags: { $all: [ [ \"ssl\", \"security\" ] ] } } )   该查询等效于：\n1  db.articles.find( { $and: [ { tags: [ \"ssl\", \"security\" ] } ] } )   等效于：\n1  db.articles.find( { tags: [ \"ssl\", \"security\" ] } )   因此，$all表达式匹配文档，其中tags字段是包含嵌套数组[ \"ssl\", \"security\" ]的数组或等于嵌套数组的数组：\n1 2  tags: [ [ \"ssl\", \"security\" ], ... ] tags: [ \"ssl\", \"security\" ]   在$all用表达单个元件是用于说明性的目的，因为$all如果匹配仅单个元件的表达是不必要的。相反，当匹配单个元素时，“contains”表达式（即arrayField: element）更合适。\n例子 以下示例使用inventory包含文档的集合：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41  { _id: ObjectId(\"5234cc89687ea597eabee675\"), code: \"xyz\", tags: [ \"school\", \"book\", \"bag\", \"headphone\", \"appliance\" ], qty: [ { size: \"S\", num: 10, color: \"blue\" }, { size: \"M\", num: 45, color: \"blue\" }, { size: \"L\", num: 100, color: \"green\" } ] } { _id: ObjectId(\"5234cc8a687ea597eabee676\"), code: \"abc\", tags: [ \"appliance\", \"school\", \"book\" ], qty: [ { size: \"6\", num: 100, color: \"green\" }, { size: \"6\", num: 50, color: \"blue\" }, { size: \"8\", num: 100, color: \"brown\" } ] } { _id: ObjectId(\"5234ccb7687ea597eabee677\"), code: \"efg\", tags: [ \"school\", \"book\" ], qty: [ { size: \"S\", num: 10, color: \"blue\" }, { size: \"M\", num: 100, color: \"blue\" }, { size: \"L\", num: 100, color: \"green\" } ] } { _id: ObjectId(\"52350353b2eff1353b349de9\"), code: \"ijk\", tags: [ \"electronics\", \"school\" ], qty: [ { size: \"M\", num: 100, color: \"green\" } ] }   使用$all以匹配值 以下操作使用$all操作者查询 inventory的文档集合，其中的值tags 字段是数组，其元素包括appliance，school，和 book：\n1  db.inventory.find( { tags: { $all: [ \"appliance\", \"school\", \"book\" ] } } )   上面的查询返回以下文档：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  { _id: ObjectId(\"5234cc89687ea597eabee675\"), code: \"xyz\", tags: [ \"school\", \"book\", \"bag\", \"headphone\", \"appliance\" ], qty: [ { size: \"S\", num: 10, color: \"blue\" }, { size: \"M\", num: 45, color: \"blue\" }, { size: \"L\", num: 100, color: \"green\" } ] } { _id: ObjectId(\"5234cc8a687ea597eabee676\"), code: \"abc\", tags: [ \"appliance\", \"school\", \"book\" ], qty: [ { size: \"6\", num: 100, color: \"green\" }, { size: \"6\", num: 50, color: \"blue\" }, { size: \"8\", num: 100, color: \"brown\" } ] }   $all与使用`$elemMatch 如果该字段包含文件的数组，你可以使用 $all与$elemMatch操作。\n以下操作在inventory集合中查询文档，其中qty字段的值是一个数组，其元素与$elemMatch条件匹配：\n1 2 3 4 5 6  db.inventory.find( { qty: { $all: [ { \"$elemMatch\" : { size: \"M\", num: { $gt: 50} } }, { \"$elemMatch\" : { num : 100, color: \"green\" } } ] } } )   该查询返回以下文档：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  { \"_id\" : ObjectId(\"5234ccb7687ea597eabee677\"), \"code\" : \"efg\", \"tags\" : [ \"school\", \"book\"], \"qty\" : [ { \"size\" : \"S\", \"num\" : 10, \"color\" : \"blue\" }, { \"size\" : \"M\", \"num\" : 100, \"color\" : \"blue\" }, { \"size\" : \"L\", \"num\" : 100, \"color\" : \"green\" } ] } { \"_id\" : ObjectId(\"52350353b2eff1353b349de9\"), \"code\" : \"ijk\", \"tags\" : [ \"electronics\", \"school\" ], \"qty\" : [ { \"size\" : \"M\", \"num\" : 100, \"color\" : \"green\" } ] }   存在该运算符$all以支持对数组的查询。但是您可以使用$all运算符来针对非数组进行选择 field，如以下示例所示：\n1  db.inventory.find( { \"qty.num\": { $all: [ 50 ] } } )   但是，请使用以下形式表示相同的查询：\n1  db.inventory.find( { \"qty.num\" : 50 } )   这两个查询都将选择inventory 集合中num字段值等于50的所有文档。\n注意\n在大多数情况下，MongoDB不会将数组视为集合。该运算符对此方法提供了明显的例外。\n$elemMatch $elemMatch匹配包含与匹配的所有指定的查询标准中的至少一个元素的数组字段的文档。\n1  { field: { $elemMatch: { query1, query2, ... } } }   如果仅在$elemMatch表达式中指定一个条件，则 无需使用 $elemMatch。\n特性  您不能在中指定$where表达式 $elemMatch。 您不能在中指定$text查询表达式 $elemMatch。  例子 匹配元素 给定scores集合中的以下文件：\n1 2  { _id: 1, results: [ 82, 85, 88 ] } { _id: 2, results: [ 75, 88, 89 ] }   以下查询仅匹配results 数组包含至少一个大于或等于80且小于85的元素的那些文档。\n1 2 3  db.scores.find( { results: { $elemMatch: { $gte: 80, $lt: 85 } } } )   该查询返回以下文档，因为该元素82大于或等于80且小于85\n1  { \"_id\" : 1, \"results\" : [ 82, 85, 88 ] }   嵌入式文档数组 给定survey集合中的以下文件：\n1 2 3  { _id: 1, results: [ { product: \"abc\", score: 10 }, { product: \"xyz\", score: 5 } ] } { _id: 2, results: [ { product: \"abc\", score: 8 }, { product: \"xyz\", score: 7 } ] } { _id: 3, results: [ { product: \"abc\", score: 7 }, { product: \"xyz\", score: 8 } ] }   下面的查询仅那些文档，其中匹配results 数组包含与两个的至少一种元素product等于 “xyz\"和score大于或等于8。\n1 2 3  db.survey.find( { results: { $elemMatch: { product: \"xyz\", score: { $gte: 8 } } } } )   具体来说，查询与以下文档匹配：\n1  { \"_id\" : 3, \"results\" : [ { \"product\" : \"abc\", \"score\" : 7 }, { \"product\" : \"xyz\", \"score\" : 8 } ] }   单查询条件 如果在$elemMatch 表达式中指定单个查询谓词，$elemMatch则没有必要。\n例如，考虑以下示例，其中$elemMatch 仅指定一个查询谓词：{ product: “xyz” }\n1 2 3  db.survey.find( { results: { $elemMatch: { product: \"xyz\" } } } )   由于$elemMatch仅指定一个条件，因此该 $elemMatch表达式不是必需的，而是可以使用以下查询：\n1 2 3  db.survey.find( { \"results.product\": \"xyz\" } )   $size $size匹配与由参数指定的元素数的任何数组。例如：\n1  db.collection.find( { field: { $size: 2 } } );   返回collection其中where field是具有2个元素的数组的所有文档。例如，上面的表达式将返回{ field: [ red, green ] }和{ field: [ apple, lime ] }，但不会返回{ field: fruit } 或{ field: [ orange, lemon, grapefruit ] }。要匹配数组中只有一个元素的字段，请使用值1，如下所示：\n1  db.collection.find( { field: { $size: 1 } } );   $size不接受值的范围。要基于元素数量不同的字段选择文档，请创建一个计数器字段，当您将元素添加到字段时该计数器字段会增加。\n查询不能使用索引作为$size查询的一部分，尽管查询的其他部分可以使用索引（如果适用）。\n",
  "wordCount" : "2250",
  "inLanguage": "zh-cn",
  "datePublished": "2020-05-13T15:45:43Z",
  "dateModified": "2020-05-13T15:45:43Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/mongodb%E7%9A%84%E6%95%B0%E7%BB%84%E6%9F%A5%E8%AF%A2%E8%BF%90%E7%AE%97%E7%AC%A6/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Forz Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="Forz Blog (Alt + H)">Forz Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="/post/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      MongoDB的数组查询运算符
    </h1>
    <div class="post-meta">May 13, 2020
</div>
  </header> 
  <div class="post-content"><h1 id="all">$all<a hidden class="anchor" aria-hidden="true" href="#all">#</a></h1>
<p>在<code>$all</code>选择的文件，其中一个字段的值是包含所有指定元素的数组。要指定$all表达式，请使用以下原型：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">{</span> <span class="o">&lt;</span><span class="n">field</span><span class="o">&gt;:</span> <span class="p">{</span> <span class="o">$</span><span class="n">all</span><span class="o">:</span> <span class="n">[</span> <span class="o">&lt;</span><span class="n">value1</span><span class="o">&gt;</span> <span class="p">,</span> <span class="o">&lt;</span><span class="n">value2</span><span class="o">&gt;</span> <span class="kc">...</span> <span class="n">]</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="特性">特性<a hidden class="anchor" aria-hidden="true" href="#特性">#</a></h2>
<h3 id="等效于and操作">等效于$and操作<a hidden class="anchor" aria-hidden="true" href="#等效于and操作">#</a></h3>
<p><code>$all</code>相当于一个<code>$and</code>指定的值的操作; 即以下语句：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">{ tags: { $all: [ &#34;ssl&#34; , &#34;security&#34; ] } }
</code></pre></td></tr></table>
</div>
</div><p>等效于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">{ $and: [ { tags: &#34;ssl&#34; }, { tags: &#34;security&#34; } ] }
</code></pre></td></tr></table>
</div>
</div><h3 id="嵌套数组">嵌套数组<a hidden class="anchor" aria-hidden="true" href="#嵌套数组">#</a></h3>
<p>当传递嵌套数组（例如 <code>[ [ &quot;A&quot; ] ]</code>）的数组时， 匹配文档，其中该字段包含嵌套数组作为元素（例如<code>field: [ [ &quot;A&quot; ], ... ]</code>），或者该字段等于嵌套数组（例如<code>field: [ &quot;A&quot; ]</code>）。</p>
<p>例如，考虑以下查询：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.articles.find</span><span class="p">(</span> <span class="p">{</span> <span class="n">tags</span><span class="o">:</span> <span class="p">{</span> <span class="o">$</span><span class="n">all</span><span class="o">:</span> <span class="n">[</span> <span class="n">[</span> <span class="s">&#34;ssl&#34;</span><span class="p">,</span> <span class="s">&#34;security&#34;</span> <span class="n">]</span> <span class="n">]</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>该查询等效于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.articles.find</span><span class="p">(</span> <span class="p">{</span> <span class="o">$</span><span class="n">and</span><span class="o">:</span> <span class="n">[</span> <span class="p">{</span> <span class="n">tags</span><span class="o">:</span> <span class="n">[</span> <span class="s">&#34;ssl&#34;</span><span class="p">,</span> <span class="s">&#34;security&#34;</span> <span class="n">]</span> <span class="p">}</span> <span class="n">]</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>等效于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.articles.find</span><span class="p">(</span> <span class="p">{</span> <span class="n">tags</span><span class="o">:</span> <span class="n">[</span> <span class="s">&#34;ssl&#34;</span><span class="p">,</span> <span class="s">&#34;security&#34;</span> <span class="n">]</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>因此，$all表达式匹配文档，其中tags字段是包含嵌套数组<code>[ &quot;ssl&quot;, &quot;security&quot; ]</code>的数组或等于嵌套数组的数组：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="n">tags</span><span class="o">:</span> <span class="n">[</span> <span class="n">[</span> <span class="s">&#34;ssl&#34;</span><span class="p">,</span> <span class="s">&#34;security&#34;</span> <span class="n">]</span><span class="p">,</span> <span class="kc">...</span> <span class="n">]</span>
<span class="n">tags</span><span class="o">:</span> <span class="n">[</span> <span class="s">&#34;ssl&#34;</span><span class="p">,</span> <span class="s">&#34;security&#34;</span> <span class="n">]</span>
</code></pre></td></tr></table>
</div>
</div><p>在<code>$all</code>用表达单个元件是用于说明性的目的，因为<code>$all</code>如果匹配仅单个元件的表达是不必要的。相反，当匹配单个元素时，“contains”表达式（即arrayField: element）更合适。</p>
<h2 id="例子">例子<a hidden class="anchor" aria-hidden="true" href="#例子">#</a></h2>
<p>以下示例使用inventory包含文档的集合：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
   <span class="err">_id:</span> <span class="err">ObjectId(</span><span class="nt">&#34;5234cc89687ea597eabee675&#34;</span><span class="err">)</span><span class="p">,</span>
   <span class="err">code:</span> <span class="nt">&#34;xyz&#34;</span><span class="p">,</span>
   <span class="err">tags:</span> <span class="err">[</span> <span class="nt">&#34;school&#34;</span><span class="p">,</span> <span class="nt">&#34;book&#34;</span><span class="p">,</span> <span class="nt">&#34;bag&#34;</span><span class="p">,</span> <span class="nt">&#34;headphone&#34;</span><span class="p">,</span> <span class="nt">&#34;appliance&#34;</span> <span class="err">]</span><span class="p">,</span>
   <span class="err">qty:</span> <span class="err">[</span>
          <span class="err">{</span> <span class="err">size:</span> <span class="nt">&#34;S&#34;</span><span class="p">,</span> <span class="err">num:</span> <span class="err">10,</span> <span class="err">color:</span> <span class="nt">&#34;blue&#34;</span> <span class="p">}</span><span class="err">,</span>
          <span class="p">{</span> <span class="err">size:</span> <span class="nt">&#34;M&#34;</span><span class="p">,</span> <span class="err">num:</span> <span class="err">45,</span> <span class="err">color:</span> <span class="nt">&#34;blue&#34;</span> <span class="p">}</span><span class="err">,</span>
          <span class="p">{</span> <span class="err">size:</span> <span class="nt">&#34;L&#34;</span><span class="p">,</span> <span class="err">num:</span> <span class="err">100,</span> <span class="err">color:</span> <span class="nt">&#34;green&#34;</span> <span class="p">}</span>
        <span class="err">]</span>
<span class="err">}</span>

<span class="p">{</span>
   <span class="err">_id:</span> <span class="err">ObjectId(</span><span class="nt">&#34;5234cc8a687ea597eabee676&#34;</span><span class="err">)</span><span class="p">,</span>
   <span class="err">code:</span> <span class="nt">&#34;abc&#34;</span><span class="p">,</span>
   <span class="err">tags:</span> <span class="err">[</span> <span class="nt">&#34;appliance&#34;</span><span class="p">,</span> <span class="nt">&#34;school&#34;</span><span class="p">,</span> <span class="nt">&#34;book&#34;</span> <span class="err">]</span><span class="p">,</span>
   <span class="err">qty:</span> <span class="err">[</span>
          <span class="err">{</span> <span class="err">size:</span> <span class="nt">&#34;6&#34;</span><span class="p">,</span> <span class="err">num:</span> <span class="err">100,</span> <span class="err">color:</span> <span class="nt">&#34;green&#34;</span> <span class="p">}</span><span class="err">,</span>
          <span class="p">{</span> <span class="err">size:</span> <span class="nt">&#34;6&#34;</span><span class="p">,</span> <span class="err">num:</span> <span class="err">50,</span> <span class="err">color:</span> <span class="nt">&#34;blue&#34;</span> <span class="p">}</span><span class="err">,</span>
          <span class="p">{</span> <span class="err">size:</span> <span class="nt">&#34;8&#34;</span><span class="p">,</span> <span class="err">num:</span> <span class="err">100,</span> <span class="err">color:</span> <span class="nt">&#34;brown&#34;</span> <span class="p">}</span>
        <span class="err">]</span>
<span class="err">}</span>

<span class="p">{</span>
   <span class="err">_id:</span> <span class="err">ObjectId(</span><span class="nt">&#34;5234ccb7687ea597eabee677&#34;</span><span class="err">)</span><span class="p">,</span>
   <span class="err">code:</span> <span class="nt">&#34;efg&#34;</span><span class="p">,</span>
   <span class="err">tags:</span> <span class="err">[</span> <span class="nt">&#34;school&#34;</span><span class="p">,</span> <span class="nt">&#34;book&#34;</span> <span class="err">]</span><span class="p">,</span>
   <span class="err">qty:</span> <span class="err">[</span>
          <span class="err">{</span> <span class="err">size:</span> <span class="nt">&#34;S&#34;</span><span class="p">,</span> <span class="err">num:</span> <span class="err">10,</span> <span class="err">color:</span> <span class="nt">&#34;blue&#34;</span> <span class="p">}</span><span class="err">,</span>
          <span class="p">{</span> <span class="err">size:</span> <span class="nt">&#34;M&#34;</span><span class="p">,</span> <span class="err">num:</span> <span class="err">100,</span> <span class="err">color:</span> <span class="nt">&#34;blue&#34;</span> <span class="p">}</span><span class="err">,</span>
          <span class="p">{</span> <span class="err">size:</span> <span class="nt">&#34;L&#34;</span><span class="p">,</span> <span class="err">num:</span> <span class="err">100,</span> <span class="err">color:</span> <span class="nt">&#34;green&#34;</span> <span class="p">}</span>
        <span class="err">]</span>
<span class="err">}</span>

<span class="p">{</span>
   <span class="err">_id:</span> <span class="err">ObjectId(</span><span class="nt">&#34;52350353b2eff1353b349de9&#34;</span><span class="err">)</span><span class="p">,</span>
   <span class="err">code:</span> <span class="nt">&#34;ijk&#34;</span><span class="p">,</span>
   <span class="err">tags:</span> <span class="err">[</span> <span class="nt">&#34;electronics&#34;</span><span class="p">,</span> <span class="nt">&#34;school&#34;</span> <span class="err">]</span><span class="p">,</span>
   <span class="err">qty:</span> <span class="err">[</span>
          <span class="err">{</span> <span class="err">size:</span> <span class="nt">&#34;M&#34;</span><span class="p">,</span> <span class="err">num:</span> <span class="err">100,</span> <span class="err">color:</span> <span class="nt">&#34;green&#34;</span> <span class="p">}</span>
        <span class="err">]</span>
<span class="err">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="使用all以匹配值">使用$all以匹配值<a hidden class="anchor" aria-hidden="true" href="#使用all以匹配值">#</a></h3>
<p>以下操作使用$all操作者查询 inventory的文档集合，其中的值tags 字段是数组，其元素包括appliance，school，和 book：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.inventory.find</span><span class="p">(</span> <span class="p">{</span> <span class="n">tags</span><span class="o">:</span> <span class="p">{</span> <span class="o">$</span><span class="n">all</span><span class="o">:</span> <span class="n">[</span> <span class="s">&#34;appliance&#34;</span><span class="p">,</span> <span class="s">&#34;school&#34;</span><span class="p">,</span> <span class="s">&#34;book&#34;</span> <span class="n">]</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>上面的查询返回以下文档：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
   <span class="err">_id:</span> <span class="err">ObjectId(</span><span class="nt">&#34;5234cc89687ea597eabee675&#34;</span><span class="err">)</span><span class="p">,</span>
   <span class="err">code:</span> <span class="nt">&#34;xyz&#34;</span><span class="p">,</span>
   <span class="err">tags:</span> <span class="err">[</span> <span class="nt">&#34;school&#34;</span><span class="p">,</span> <span class="nt">&#34;book&#34;</span><span class="p">,</span> <span class="nt">&#34;bag&#34;</span><span class="p">,</span> <span class="nt">&#34;headphone&#34;</span><span class="p">,</span> <span class="nt">&#34;appliance&#34;</span> <span class="err">]</span><span class="p">,</span>
   <span class="err">qty:</span> <span class="err">[</span>
          <span class="err">{</span> <span class="err">size:</span> <span class="nt">&#34;S&#34;</span><span class="p">,</span> <span class="err">num:</span> <span class="err">10,</span> <span class="err">color:</span> <span class="nt">&#34;blue&#34;</span> <span class="p">}</span><span class="err">,</span>
          <span class="p">{</span> <span class="err">size:</span> <span class="nt">&#34;M&#34;</span><span class="p">,</span> <span class="err">num:</span> <span class="err">45,</span> <span class="err">color:</span> <span class="nt">&#34;blue&#34;</span> <span class="p">}</span><span class="err">,</span>
          <span class="p">{</span> <span class="err">size:</span> <span class="nt">&#34;L&#34;</span><span class="p">,</span> <span class="err">num:</span> <span class="err">100,</span> <span class="err">color:</span> <span class="nt">&#34;green&#34;</span> <span class="p">}</span>
        <span class="err">]</span>
<span class="err">}</span>

<span class="p">{</span>
   <span class="err">_id:</span> <span class="err">ObjectId(</span><span class="nt">&#34;5234cc8a687ea597eabee676&#34;</span><span class="err">)</span><span class="p">,</span>
   <span class="err">code:</span> <span class="nt">&#34;abc&#34;</span><span class="p">,</span>
   <span class="err">tags:</span> <span class="err">[</span> <span class="nt">&#34;appliance&#34;</span><span class="p">,</span> <span class="nt">&#34;school&#34;</span><span class="p">,</span> <span class="nt">&#34;book&#34;</span> <span class="err">]</span><span class="p">,</span>
   <span class="err">qty:</span> <span class="err">[</span>
          <span class="err">{</span> <span class="err">size:</span> <span class="nt">&#34;6&#34;</span><span class="p">,</span> <span class="err">num:</span> <span class="err">100,</span> <span class="err">color:</span> <span class="nt">&#34;green&#34;</span> <span class="p">}</span><span class="err">,</span>
          <span class="p">{</span> <span class="err">size:</span> <span class="nt">&#34;6&#34;</span><span class="p">,</span> <span class="err">num:</span> <span class="err">50,</span> <span class="err">color:</span> <span class="nt">&#34;blue&#34;</span> <span class="p">}</span><span class="err">,</span>
          <span class="p">{</span> <span class="err">size:</span> <span class="nt">&#34;8&#34;</span><span class="p">,</span> <span class="err">num:</span> <span class="err">100,</span> <span class="err">color:</span> <span class="nt">&#34;brown&#34;</span> <span class="p">}</span>
        <span class="err">]</span>
<span class="err">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="all与使用elemmatch"><code>$all</code>与使用`$elemMatch<a hidden class="anchor" aria-hidden="true" href="#all与使用elemmatch">#</a></h3>
<p>如果该字段包含文件的数组，你可以使用 <code>$all</code>与<code>$elemMatch</code>操作。</p>
<p>以下操作在inventory集合中查询文档，其中qty字段的值是一个数组，其元素与$elemMatch条件匹配：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.inventory.find</span><span class="p">(</span> <span class="p">{</span>
                     <span class="n">qty</span><span class="o">:</span> <span class="p">{</span> <span class="o">$</span><span class="n">all</span><span class="o">:</span> <span class="n">[</span>
                                    <span class="p">{</span> <span class="s">&#34;$elemMatch&#34;</span> <span class="o">:</span> <span class="p">{</span> <span class="n">size</span><span class="o">:</span> <span class="s">&#34;M&#34;</span><span class="p">,</span> <span class="n">num</span><span class="o">:</span> <span class="p">{</span> <span class="o">$</span><span class="n">gt</span><span class="o">:</span> <span class="m">50</span><span class="p">}</span> <span class="p">}</span> <span class="p">},</span>
                                    <span class="p">{</span> <span class="s">&#34;$elemMatch&#34;</span> <span class="o">:</span> <span class="p">{</span> <span class="n">num</span> <span class="o">:</span> <span class="m">100</span><span class="p">,</span> <span class="n">color</span><span class="o">:</span> <span class="s">&#34;green&#34;</span> <span class="p">}</span> <span class="p">}</span>
                                  <span class="n">]</span> <span class="p">}</span>
                   <span class="p">}</span> <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>该查询返回以下文档：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
   <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5234ccb7687ea597eabee677&#34;</span><span class="err">)</span><span class="p">,</span>
   <span class="nt">&#34;code&#34;</span> <span class="p">:</span> <span class="s2">&#34;efg&#34;</span><span class="p">,</span>
   <span class="nt">&#34;tags&#34;</span> <span class="p">:</span> <span class="p">[</span> <span class="s2">&#34;school&#34;</span><span class="p">,</span> <span class="s2">&#34;book&#34;</span><span class="p">],</span>
   <span class="nt">&#34;qty&#34;</span> <span class="p">:</span> <span class="p">[</span>
             <span class="p">{</span> <span class="nt">&#34;size&#34;</span> <span class="p">:</span> <span class="s2">&#34;S&#34;</span><span class="p">,</span> <span class="nt">&#34;num&#34;</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="nt">&#34;color&#34;</span> <span class="p">:</span> <span class="s2">&#34;blue&#34;</span> <span class="p">},</span>
             <span class="p">{</span> <span class="nt">&#34;size&#34;</span> <span class="p">:</span> <span class="s2">&#34;M&#34;</span><span class="p">,</span> <span class="nt">&#34;num&#34;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nt">&#34;color&#34;</span> <span class="p">:</span> <span class="s2">&#34;blue&#34;</span> <span class="p">},</span>
             <span class="p">{</span> <span class="nt">&#34;size&#34;</span> <span class="p">:</span> <span class="s2">&#34;L&#34;</span><span class="p">,</span> <span class="nt">&#34;num&#34;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nt">&#34;color&#34;</span> <span class="p">:</span> <span class="s2">&#34;green&#34;</span> <span class="p">}</span>
           <span class="p">]</span>
<span class="p">}</span>

<span class="p">{</span>
   <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;52350353b2eff1353b349de9&#34;</span><span class="err">)</span><span class="p">,</span>
   <span class="nt">&#34;code&#34;</span> <span class="p">:</span> <span class="s2">&#34;ijk&#34;</span><span class="p">,</span>
   <span class="nt">&#34;tags&#34;</span> <span class="p">:</span> <span class="p">[</span> <span class="s2">&#34;electronics&#34;</span><span class="p">,</span> <span class="s2">&#34;school&#34;</span> <span class="p">],</span>
   <span class="nt">&#34;qty&#34;</span> <span class="p">:</span> <span class="p">[</span>
             <span class="p">{</span> <span class="nt">&#34;size&#34;</span> <span class="p">:</span> <span class="s2">&#34;M&#34;</span><span class="p">,</span> <span class="nt">&#34;num&#34;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nt">&#34;color&#34;</span> <span class="p">:</span> <span class="s2">&#34;green&#34;</span> <span class="p">}</span>
           <span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>存在该运算符<code>$all</code>以支持对数组的查询。但是您可以使用<code>$all</code>运算符来针对非数组进行选择 field，如以下示例所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.inventory.find</span><span class="p">(</span> <span class="p">{</span> <span class="s">&#34;qty.num&#34;</span><span class="o">:</span> <span class="p">{</span> <span class="o">$</span><span class="n">all</span><span class="o">:</span> <span class="n">[</span> <span class="m">50</span> <span class="n">]</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>但是，请使用以下形式表示相同的查询：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.inventory.find</span><span class="p">(</span> <span class="p">{</span> <span class="s">&#34;qty.num&#34;</span> <span class="o">:</span> <span class="m">50</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>这两个查询都将选择inventory 集合中num字段值等于50的所有文档。</p>
<p>注意</p>
<p>在大多数情况下，MongoDB不会将数组视为集合。该运算符对此方法提供了明显的例外。</p>
<h1 id="elemmatch">$elemMatch<a hidden class="anchor" aria-hidden="true" href="#elemmatch">#</a></h1>
<p>$elemMatch匹配包含与匹配的所有指定的查询标准中的至少一个元素的数组字段的文档。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">{</span> <span class="o">&lt;</span><span class="n">field</span><span class="o">&gt;:</span> <span class="p">{</span> <span class="o">$</span><span class="n">elemMatch</span><span class="o">:</span> <span class="p">{</span> <span class="o">&lt;</span><span class="n">query1</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">query2</span><span class="o">&gt;</span><span class="p">,</span> <span class="kc">...</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>如果仅在$elemMatch表达式中指定一个<code>&lt;query&gt;</code>条件，则 无需使用 $elemMatch。</p>
<h2 id="特性-1">特性<a hidden class="anchor" aria-hidden="true" href="#特性-1">#</a></h2>
<ul>
<li>您不能在中指定$where表达式 $elemMatch。</li>
<li>您不能在中指定$text查询表达式 $elemMatch。</li>
</ul>
<h2 id="例子-1">例子<a hidden class="anchor" aria-hidden="true" href="#例子-1">#</a></h2>
<h3 id="匹配元素">匹配元素<a hidden class="anchor" aria-hidden="true" href="#匹配元素">#</a></h3>
<p>给定scores集合中的以下文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span> <span class="err">_id:</span> <span class="err">1,</span> <span class="err">results:</span> <span class="err">[</span> <span class="err">82,</span> <span class="err">85,</span> <span class="err">88</span> <span class="err">]</span> <span class="p">}</span>
<span class="p">{</span> <span class="err">_id:</span> <span class="err">2,</span> <span class="err">results:</span> <span class="err">[</span> <span class="err">75,</span> <span class="err">88,</span> <span class="err">89</span> <span class="err">]</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以下查询仅匹配results 数组包含至少一个大于或等于80且小于85的元素的那些文档。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.scores.find</span><span class="p">(</span>
   <span class="p">{</span> <span class="n">results</span><span class="o">:</span> <span class="p">{</span> <span class="o">$</span><span class="n">elemMatch</span><span class="o">:</span> <span class="p">{</span> <span class="o">$</span><span class="n">gte</span><span class="o">:</span> <span class="m">80</span><span class="p">,</span> <span class="o">$</span><span class="n">lt</span><span class="o">:</span> <span class="m">85</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>该查询返回以下文档，因为该元素82大于或等于80且小于85</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span> <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nt">&#34;results&#34;</span> <span class="p">:</span> <span class="p">[</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">88</span> <span class="p">]</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="嵌入式文档数组">嵌入式文档数组<a hidden class="anchor" aria-hidden="true" href="#嵌入式文档数组">#</a></h3>
<p>给定survey集合中的以下文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span> <span class="err">_id:</span> <span class="err">1,</span> <span class="err">results:</span> <span class="err">[</span> <span class="err">{</span> <span class="err">product:</span> <span class="nt">&#34;abc&#34;</span><span class="p">,</span> <span class="err">score:</span> <span class="err">10</span> <span class="p">}</span><span class="err">,</span> <span class="p">{</span> <span class="err">product:</span> <span class="nt">&#34;xyz&#34;</span><span class="p">,</span> <span class="err">score:</span> <span class="err">5</span> <span class="p">}</span> <span class="err">]</span> <span class="err">}</span>
<span class="p">{</span> <span class="err">_id:</span> <span class="err">2,</span> <span class="err">results:</span> <span class="err">[</span> <span class="err">{</span> <span class="err">product:</span> <span class="nt">&#34;abc&#34;</span><span class="p">,</span> <span class="err">score:</span> <span class="err">8</span> <span class="p">}</span><span class="err">,</span> <span class="p">{</span> <span class="err">product:</span> <span class="nt">&#34;xyz&#34;</span><span class="p">,</span> <span class="err">score:</span> <span class="err">7</span> <span class="p">}</span> <span class="err">]</span> <span class="err">}</span>
<span class="p">{</span> <span class="err">_id:</span> <span class="err">3,</span> <span class="err">results:</span> <span class="err">[</span> <span class="err">{</span> <span class="err">product:</span> <span class="nt">&#34;abc&#34;</span><span class="p">,</span> <span class="err">score:</span> <span class="err">7</span> <span class="p">}</span><span class="err">,</span> <span class="p">{</span> <span class="err">product:</span> <span class="nt">&#34;xyz&#34;</span><span class="p">,</span> <span class="err">score:</span> <span class="err">8</span> <span class="p">}</span> <span class="err">]</span> <span class="err">}</span>
</code></pre></td></tr></table>
</div>
</div><p>下面的查询仅那些文档，其中匹配results 数组包含与两个的至少一种元素product等于 &ldquo;xyz&quot;和score大于或等于8。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.survey.find</span><span class="p">(</span>
   <span class="p">{</span> <span class="n">results</span><span class="o">:</span> <span class="p">{</span> <span class="o">$</span><span class="n">elemMatch</span><span class="o">:</span> <span class="p">{</span> <span class="n">product</span><span class="o">:</span> <span class="s">&#34;xyz&#34;</span><span class="p">,</span> <span class="n">score</span><span class="o">:</span> <span class="p">{</span> <span class="o">$</span><span class="n">gte</span><span class="o">:</span> <span class="m">8</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>具体来说，查询与以下文档匹配：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span> <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nt">&#34;results&#34;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">{</span> <span class="nt">&#34;product&#34;</span> <span class="p">:</span> <span class="s2">&#34;abc&#34;</span><span class="p">,</span> <span class="nt">&#34;score&#34;</span> <span class="p">:</span> <span class="mi">7</span> <span class="p">},</span> <span class="p">{</span> <span class="nt">&#34;product&#34;</span> <span class="p">:</span> <span class="s2">&#34;xyz&#34;</span><span class="p">,</span> <span class="nt">&#34;score&#34;</span> <span class="p">:</span> <span class="mi">8</span> <span class="p">}</span> <span class="p">]</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="单查询条件">单查询条件<a hidden class="anchor" aria-hidden="true" href="#单查询条件">#</a></h3>
<p>如果在<code>$elemMatch</code> 表达式中指定单个查询谓词，<code>$elemMatch</code>则没有必要。</p>
<p>例如，考虑以下示例，其中$elemMatch 仅指定一个查询谓词：{ product: &ldquo;xyz&rdquo; }</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.survey.find</span><span class="p">(</span>
   <span class="p">{</span> <span class="n">results</span><span class="o">:</span> <span class="p">{</span> <span class="o">$</span><span class="n">elemMatch</span><span class="o">:</span> <span class="p">{</span> <span class="n">product</span><span class="o">:</span> <span class="s">&#34;xyz&#34;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>由于$elemMatch仅指定一个条件，因此该 $elemMatch表达式不是必需的，而是可以使用以下查询：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.survey.find</span><span class="p">(</span>
   <span class="p">{</span> <span class="s">&#34;results.product&#34;</span><span class="o">:</span> <span class="s">&#34;xyz&#34;</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="size">$size<a hidden class="anchor" aria-hidden="true" href="#size">#</a></h1>
<p><code>$size</code>匹配与由参数指定的元素数的任何数组。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.collection.find</span><span class="p">(</span> <span class="p">{</span> <span class="n">field</span><span class="o">:</span> <span class="p">{</span> <span class="o">$</span><span class="n">size</span><span class="o">:</span> <span class="m">2</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>返回collection其中where field是具有2个元素的数组的所有文档。例如，上面的表达式将返回<code>{ field: [ red, green ] }</code>和<code>{ field: [ apple, lime ] }</code>，但不会返回<code>{ field: fruit } </code>或<code>{ field: [ orange, lemon, grapefruit ] }</code>。要匹配数组中只有一个元素的字段，请使用值1，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.collection.find</span><span class="p">(</span> <span class="p">{</span> <span class="n">field</span><span class="o">:</span> <span class="p">{</span> <span class="o">$</span><span class="n">size</span><span class="o">:</span> <span class="m">1</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p><code>$size</code>不接受值的范围。要基于元素数量不同的字段选择文档，请创建一个计数器字段，当您将元素添加到字段时该计数器字段会增加。</p>
<p>查询不能使用索引作为<code>$size</code>查询的一部分，尽管查询的其他部分可以使用索引（如果适用）。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="/tags/mongodb/">MongoDB</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2021 <a href="/">Forz Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
