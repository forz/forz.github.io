<!DOCTYPE html>
<html lang="zh-cn" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>如何优雅地比较两个未知结构的JSON | Forz Blog</title>
<meta name="keywords" content="" />
<meta name="description" content="这是之前遇到的一道面试题，后来也确实在工作中实际遇到了。于是记录一下，如何（优雅的）比较两个未知结构的json。 假设，现在有两个简单的jso">
<meta name="author" content="">
<link rel="canonical" href="/post/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E5%9C%B0%E6%AF%94%E8%BE%83%E4%B8%A4%E4%B8%AA%E6%9C%AA%E7%9F%A5%E7%BB%93%E6%9E%84%E7%9A%84json/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.00d5d4fc479b1575183ee8d86b4fb372ba9d9b1904e96fa8e4c40ff7debe2b94.css" integrity="sha256-ANXU/EebFXUYPujYa0&#43;zcrqdmxkE6W&#43;o5MQP996&#43;K5Q=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.87.0" />
<meta property="og:title" content="如何优雅地比较两个未知结构的JSON" />
<meta property="og:description" content="这是之前遇到的一道面试题，后来也确实在工作中实际遇到了。于是记录一下，如何（优雅的）比较两个未知结构的json。 假设，现在有两个简单的jso" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E5%9C%B0%E6%AF%94%E8%BE%83%E4%B8%A4%E4%B8%AA%E6%9C%AA%E7%9F%A5%E7%BB%93%E6%9E%84%E7%9A%84json/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2019-08-27T10:53:46&#43;00:00" />
<meta property="article:modified_time" content="2019-08-27T10:53:46&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="如何优雅地比较两个未知结构的JSON"/>
<meta name="twitter:description" content="这是之前遇到的一道面试题，后来也确实在工作中实际遇到了。于是记录一下，如何（优雅的）比较两个未知结构的json。 假设，现在有两个简单的jso"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "/post/"
    }
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "如何优雅地比较两个未知结构的JSON",
      "item": "/post/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E5%9C%B0%E6%AF%94%E8%BE%83%E4%B8%A4%E4%B8%AA%E6%9C%AA%E7%9F%A5%E7%BB%93%E6%9E%84%E7%9A%84json/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "如何优雅地比较两个未知结构的JSON",
  "name": "如何优雅地比较两个未知结构的JSON",
  "description": "这是之前遇到的一道面试题，后来也确实在工作中实际遇到了。于是记录一下，如何（优雅的）比较两个未知结构的json。 假设，现在有两个简单的jso",
  "keywords": [
    
  ],
  "articleBody": "这是之前遇到的一道面试题，后来也确实在工作中实际遇到了。于是记录一下，如何（优雅的）比较两个未知结构的json。\n假设，现在有两个简单的json文件。\n1 2 3 4 5 6 7 8 9 10  { \"id\":1, \"name\":\"testjson01\", \"isadmin\":true } { \"isadmin\":true, \"name\":\"testjson01\", \"id\":1 }   那么，如何比较这两个json的内容是否相同呢？\n首先，最基本的方法就是利用golang的反射提供的DeepEqual()\n假设我们有一个读取json文件的函数如下：\n1 2 3 4 5 6 7  func LoadJson(path string, dist interface{}) (err error) { var content []byte if content, err = ioutil.ReadFile(path); err == nil { err = json.Unmarshal(content, dist) } return err }   那么，我们可以调用该函数来读取json文件。由于json的结构是未知的，所以我们需要声明一个map[string]interface{}来存放对json文件的解析结果。\n1 2 3 4 5 6 7 8 9 10 11 12 13  func main() { var ( json1 map[string]interface{} json2 map[string]interface{} ) if err := service.LoadJson(\"./etc/json/json01.json\", \u0026json1); err != nil { fmt.Println(err) } if err := service.LoadJson(\"./etc/json/json02.json\", \u0026json2); err != nil { fmt.Println(err) } fmt.Println(reflect.DeepEqual(json1, json2)) }   这会在终端中输出一个比较的结果：\n1  true   如果我们只需要知道两个json是否相同，那么这样一段简单的代码就可以实现这个要求。\n接下来，我们要解决“优雅的”这个定语。\n大多数情况下，我们比较两个json，不止需要知道他们是否相同。在他们结构不同的时候，我们还会很自然的关心，他们的区别在哪里。\n下面就来解决这个问题。\n首先，我们来分析一下json的结构。json作为一个类map的结构体，他的value可能分为3类：\n  json。json的值可能还是json。这就意味着，遇到了值为json的情况，我们需要进行嵌套的比较。另外一点需要注意的，是json结构体本身是无序的，所以比较过程中，要处理好这一点。\n  jsonArray。json的值也有可能是jsonArray。这不仅带来了嵌套比较，还要注意，jsonArray跟json相比，它是有序的。\n  简单值。这里的简单值包括字符串，实数和布尔值。简单值只需要比较类型和值是否相同即可，也不存在嵌套的情况。\n  那么思路就清晰了，对于两个json结构体json1和json2，我们首先要遍历json1的键值对，检查json2是否存在对应的键值对，然后根据值的类型分别进行处理。\n这里，我们利用golang的反射value.(type)。需要注意的是，value.(type)只能用在switch-case结构中，当我们通过switch判断了value的类型之后，就可以利用断言对其进行类型转换。\n在简单值的比较中，因为其不存在结构嵌套的情况，值不同即说明该处存在不同，这样我们就可以用DeepEqual()来简化比较过程。\n最后再检查json2中是否存在json1不存在的键值对。\n这样，比较是否相同这一目的就达到了。但是目前，这与DeepEqual()并没有不同。所以，我们还需要把整个比较的过程记录下来。对于相同的部分，我们记录json的内容；对于不同的部分，我们分别记录下两者的区别。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125  type JsonDiff struct { HasDiff bool Result string } func marshal(j interface{}) string { value, _ := json.Marshal(j) return string(value) } //比较json func jsonDiffDict(json1, json2 map[string]interface{}, depth int, diff *JsonDiff) { blank := strings.Repeat(\" \", (2 * (depth - 1))) longBlank := strings.Repeat(\" \", (2 * (depth))) diff.Result = diff.Result + \"\\n\" + blank + \"{\" //遍历json1  for key, value := range json1 { quotedKey := fmt.Sprintf(\"\\\"%s\\\"\", key) //如果json2存在json1相同的key  if _, ok := json2[key]; ok { switch value.(type) { //json1的value的类型为json  case map[string]interface{}: //如果json2的value的类型不同  if _, ok2 := json2[key].(map[string]interface{}); !ok2 { diff.HasDiff = true diff.Result = diff.Result + \"\\n-\" + blank + quotedKey + \": \" + marshal(value) + \",\" diff.Result = diff.Result + \"\\n+\" + blank + quotedKey + \": \" + marshal(json2[key]) } else { //如果json2的value的类型相同  diff.Result = diff.Result + \"\\n\" + longBlank + quotedKey + \": \" //递归比较json  jsonDiffDict(value.(map[string]interface{}), json2[key].(map[string]interface{}), depth+1, diff) } //json1的value的类型为jsonarray  case []interface{}: diff.Result = diff.Result + \"\\n\" + longBlank + quotedKey + \": \" if _, ok2 := json2[key].([]interface{}); !ok2 { //如果json2的value的类型不同  diff.HasDiff = true diff.Result = diff.Result + \"\\n-\" + blank + quotedKey + \": \" + marshal(value) + \",\" diff.Result = diff.Result + \"\\n+\" + blank + quotedKey + \": \" + marshal(json2[key]) } else { //如果json2的value的类型相同  jsonDiffList(value.([]interface{}), json2[key].([]interface{}), depth+1, diff) } //json1的value的类型为简单值  default: //简单值,直接用DeepEqual比较interface{}值  if !reflect.DeepEqual(value, json2[key]) { diff.HasDiff = true diff.Result = diff.Result + \"\\n-\" + blank + quotedKey + \": \" + marshal(value) + \",\" diff.Result = diff.Result + \"\\n+\" + blank + quotedKey + \": \" + marshal(json2[key]) } else { diff.Result = diff.Result + \"\\n\" + longBlank + quotedKey + \": \" + marshal(value) } } } else { //如果json2不存在json1相同的key  diff.HasDiff = true diff.Result = diff.Result + \"\\n-\" + blank + quotedKey + \": \" + marshal(value) } diff.Result = diff.Result + \",\" } //遍历json2,目的是为了找到json2-json1的差集  for key, value := range json2 { //如果json1不存在json2相同的key  if _, ok := json1[key]; !ok { diff.HasDiff = true diff.Result = diff.Result + \"\\n+\" + blank + \"\\\"\" + key + \"\\\"\" + \": \" + marshal(value) + \",\" } } diff.Result = diff.Result + \"\\n\" + blank + \"}\" } //比较jsonList func jsonDiffList(json1, json2 []interface{}, depth int, diff *JsonDiff) { blank := strings.Repeat(\" \", (2 * (depth - 1))) longBlank := strings.Repeat(\" \", (2 * (depth))) diff.Result = diff.Result + \"\\n\" + blank + \"[\" size := len(json1) if size  len(json2) { size = len(json2) } for i := 0; i  size; i++ { switch json1[i].(type) { case map[string]interface{}: if _, ok := json2[i].(map[string]interface{}); ok { jsonDiffDict(json1[i].(map[string]interface{}), json2[i].(map[string]interface{}), depth+1, diff) } else { diff.HasDiff = true diff.Result = diff.Result + \"\\n-\" + blank + marshal(json1[i]) + \",\" diff.Result = diff.Result + \"\\n+\" + blank + marshal(json2[i]) } case []interface{}: if _, ok2 := json2[i].([]interface{}); !ok2 { diff.HasDiff = true diff.Result = diff.Result + \"\\n-\" + blank + marshal(json1[i]) + \",\" diff.Result = diff.Result + \"\\n+\" + blank + marshal(json2[i]) } else { jsonDiffList(json1[i].([]interface{}), json2[i].([]interface{}), depth+1, diff) } default: if !reflect.DeepEqual(json1[i], json2[i]) { diff.HasDiff = true diff.Result = diff.Result + \"\\n-\" + blank + marshal(json1[i]) + \",\" diff.Result = diff.Result + \"\\n+\" + blank + marshal(json2[i]) } else { diff.Result = diff.Result + \"\\n\" + longBlank + marshal(json1[i]) } } diff.Result = diff.Result + \",\" } for i := size; i  len(json1); i++ { diff.HasDiff = true diff.Result = diff.Result + \"\\n-\" + blank + marshal(json1[i]) diff.Result = diff.Result + \",\" } for i := size; i  len(json2); i++ { diff.HasDiff = true diff.Result = diff.Result + \"\\n+\" + blank + marshal(json2[i]) diff.Result = diff.Result + \",\" } diff.Result = diff.Result + \"\\n\" + blank + \"]\" }   因为可能会出现，json很长，但是区别只有一两行这种情况，所以我们还需要设定一个输出范围宽度的设定。\n当宽度=0时，将输出区别范围结果向上下各扩展宽度行的结果。\n那么，完整代码如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192  package service import ( \"encoding/json\" \"fmt\" \"io/ioutil\" \"reflect\" \"strings\" ) type JsonDiff struct { HasDiff bool Result string } func JsonCompare(left, right map[string]interface{}, n int) (string, bool) { diff := \u0026JsonDiff{HasDiff: false, Result: \"\"} jsonDiffDict(left, right, 1, diff) if diff.HasDiff { if n  0 { return diff.Result, diff.HasDiff } else { return processContext(diff.Result, n), diff.HasDiff } } return \"\", diff.HasDiff } func marshal(j interface{}) string { value, _ := json.Marshal(j) return string(value) } func jsonDiffDict(json1, json2 map[string]interface{}, depth int, diff *JsonDiff) { blank := strings.Repeat(\" \", (2 * (depth - 1))) longBlank := strings.Repeat(\" \", (2 * (depth))) diff.Result = diff.Result + \"\\n\" + blank + \"{\" for key, value := range json1 { quotedKey := fmt.Sprintf(\"\\\"%s\\\"\", key) if _, ok := json2[key]; ok { switch value.(type) { case map[string]interface{}: if _, ok2 := json2[key].(map[string]interface{}); !ok2 { diff.HasDiff = true diff.Result = diff.Result + \"\\n-\" + blank + quotedKey + \": \" + marshal(value) + \",\" diff.Result = diff.Result + \"\\n+\" + blank + quotedKey + \": \" + marshal(json2[key]) } else { diff.Result = diff.Result + \"\\n\" + longBlank + quotedKey + \": \" jsonDiffDict(value.(map[string]interface{}), json2[key].(map[string]interface{}), depth+1, diff) } case []interface{}: diff.Result = diff.Result + \"\\n\" + longBlank + quotedKey + \": \" if _, ok2 := json2[key].([]interface{}); !ok2 { diff.HasDiff = true diff.Result = diff.Result + \"\\n-\" + blank + quotedKey + \": \" + marshal(value) + \",\" diff.Result = diff.Result + \"\\n+\" + blank + quotedKey + \": \" + marshal(json2[key]) } else { jsonDiffList(value.([]interface{}), json2[key].([]interface{}), depth+1, diff) } default: if !reflect.DeepEqual(value, json2[key]) { diff.HasDiff = true diff.Result = diff.Result + \"\\n-\" + blank + quotedKey + \": \" + marshal(value) + \",\" diff.Result = diff.Result + \"\\n+\" + blank + quotedKey + \": \" + marshal(json2[key]) } else { diff.Result = diff.Result + \"\\n\" + longBlank + quotedKey + \": \" + marshal(value) } } } else { diff.HasDiff = true diff.Result = diff.Result + \"\\n-\" + blank + quotedKey + \": \" + marshal(value) } diff.Result = diff.Result + \",\" } for key, value := range json2 { if _, ok := json1[key]; !ok { diff.HasDiff = true diff.Result = diff.Result + \"\\n+\" + blank + \"\\\"\" + key + \"\\\"\" + \": \" + marshal(value) + \",\" } } diff.Result = diff.Result + \"\\n\" + blank + \"}\" } func jsonDiffList(json1, json2 []interface{}, depth int, diff *JsonDiff) { blank := strings.Repeat(\" \", (2 * (depth - 1))) longBlank := strings.Repeat(\" \", (2 * (depth))) diff.Result = diff.Result + \"\\n\" + blank + \"[\" size := len(json1) if size  len(json2) { size = len(json2) } for i := 0; i  size; i++ { switch json1[i].(type) { case map[string]interface{}: if _, ok := json2[i].(map[string]interface{}); ok { jsonDiffDict(json1[i].(map[string]interface{}), json2[i].(map[string]interface{}), depth+1, diff) } else { diff.HasDiff = true diff.Result = diff.Result + \"\\n-\" + blank + marshal(json1[i]) + \",\" diff.Result = diff.Result + \"\\n+\" + blank + marshal(json2[i]) } case []interface{}: if _, ok2 := json2[i].([]interface{}); !ok2 { diff.HasDiff = true diff.Result = diff.Result + \"\\n-\" + blank + marshal(json1[i]) + \",\" diff.Result = diff.Result + \"\\n+\" + blank + marshal(json2[i]) } else { jsonDiffList(json1[i].([]interface{}), json2[i].([]interface{}), depth+1, diff) } default: if !reflect.DeepEqual(json1[i], json2[i]) { diff.HasDiff = true diff.Result = diff.Result + \"\\n-\" + blank + marshal(json1[i]) + \",\" diff.Result = diff.Result + \"\\n+\" + blank + marshal(json2[i]) } else { diff.Result = diff.Result + \"\\n\" + longBlank + marshal(json1[i]) } } diff.Result = diff.Result + \",\" } for i := size; i  len(json1); i++ { diff.HasDiff = true diff.Result = diff.Result + \"\\n-\" + blank + marshal(json1[i]) diff.Result = diff.Result + \",\" } for i := size; i  len(json2); i++ { diff.HasDiff = true diff.Result = diff.Result + \"\\n+\" + blank + marshal(json2[i]) diff.Result = diff.Result + \",\" } diff.Result = diff.Result + \"\\n\" + blank + \"]\" } func processContext(diff string, n int) string { index1 := strings.Index(diff, \"\\n-\") index2 := strings.Index(diff, \"\\n+\") begin := 0 end := 0 if index1 = 0 \u0026\u0026 index2 = 0 { if index1  index2 { begin = index1 } else { begin = index2 } } else if index1 = 0 { begin = index1 } else if index2 = 0 { begin = index2 } index1 = strings.LastIndex(diff, \"\\n-\") index2 = strings.LastIndex(diff, \"\\n+\") if index1 = 0 \u0026\u0026 index2 = 0 { if index1  index2 { end = index2 } else { end = index1 } } else if index1 = 0 { end = index1 } else if index2 = 0 { end = index2 } pre := diff[0:begin] post := diff[end:] i := 0 l := begin for i  n \u0026\u0026 l = 0 { i++ l = strings.LastIndex(pre[0:l], \"\\n\") } r := 0 j := 0 for j  n \u0026\u0026 r = 0 { j++ t := strings.Index(post[r:], \"\\n\") if t = 0 { r = r + t + 1 } } if r  0 { r = len(post) } return pre[l+1:] + diff[begin:end] + post[0:r+1] } func LoadJson(path string, dist interface{}) (err error) { var content []byte if content, err = ioutil.ReadFile(path); err == nil { err = json.Unmarshal(content, dist) } return err }   转载:https://www.cnblogs.com/wangzhao765/p/9662331.html\n",
  "wordCount" : "3387",
  "inLanguage": "zh-cn",
  "datePublished": "2019-08-27T10:53:46Z",
  "dateModified": "2019-08-27T10:53:46Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E5%9C%B0%E6%AF%94%E8%BE%83%E4%B8%A4%E4%B8%AA%E6%9C%AA%E7%9F%A5%E7%BB%93%E6%9E%84%E7%9A%84json/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Forz Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="Forz Blog (Alt + H)">Forz Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="/post/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      如何优雅地比较两个未知结构的JSON
    </h1>
    <div class="post-meta">August 27, 2019
</div>
  </header> 
  <div class="post-content"><p>这是之前遇到的一道面试题，后来也确实在工作中实际遇到了。于是记录一下，如何（优雅的）比较两个未知结构的json。</p>
<p>假设，现在有两个简单的json文件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;id&#34;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;testjson01&#34;</span><span class="p">,</span>
    <span class="nt">&#34;isadmin&#34;</span><span class="p">:</span><span class="kc">true</span>
<span class="p">}</span>
<span class="p">{</span>
    <span class="nt">&#34;isadmin&#34;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;testjson01&#34;</span><span class="p">,</span>
    <span class="nt">&#34;id&#34;</span><span class="p">:</span><span class="mi">1</span>    
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>那么，如何比较这两个json的内容是否相同呢？</p>
<p>首先，最基本的方法就是利用golang的反射提供的DeepEqual()</p>
<p>假设我们有一个读取json文件的函数如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">LoadJson</span><span class="p">(</span><span class="nx">path</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">dist</span> <span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">content</span> <span class="p">[]</span><span class="kt">byte</span>
    <span class="k">if</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">ReadFile</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">err</span> <span class="p">=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">dist</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>那么，我们可以调用该函数来读取json文件。由于json的结构是未知的，所以我们需要声明一个map[string]interface{}来存放对json文件的解析结果。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="p">(</span>
        <span class="nx">json1</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>
        <span class="nx">json2</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">service</span><span class="p">.</span><span class="nf">LoadJson</span><span class="p">(</span><span class="s">&#34;./etc/json/json01.json&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">json1</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">service</span><span class="p">.</span><span class="nf">LoadJson</span><span class="p">(</span><span class="s">&#34;./etc/json/json02.json&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">json2</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">json1</span><span class="p">,</span> <span class="nx">json2</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这会在终端中输出一个比较的结果：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">true
</code></pre></td></tr></table>
</div>
</div><p>如果我们只需要知道两个json是否相同，那么这样一段简单的代码就可以实现这个要求。</p>
<p>接下来，我们要解决“优雅的”这个定语。</p>
<p>大多数情况下，我们比较两个json，不止需要知道他们是否相同。在他们结构不同的时候，我们还会很自然的关心，他们的区别在哪里。</p>
<p>下面就来解决这个问题。</p>
<p>首先，我们来分析一下json的结构。json作为一个类map的结构体，他的value可能分为3类：</p>
<ol>
<li>
<p>json。json的值可能还是json。这就意味着，遇到了值为json的情况，我们需要进行嵌套的比较。另外一点需要注意的，是json结构体本身是无序的，所以比较过程中，要处理好这一点。</p>
</li>
<li>
<p>jsonArray。json的值也有可能是jsonArray。这不仅带来了嵌套比较，还要注意，jsonArray跟json相比，它是有序的。</p>
</li>
<li>
<p>简单值。这里的简单值包括字符串，实数和布尔值。简单值只需要比较类型和值是否相同即可，也不存在嵌套的情况。</p>
</li>
</ol>
<p>那么思路就清晰了，对于两个json结构体json1和json2，我们首先要遍历json1的键值对，检查json2是否存在对应的键值对，然后根据值的类型分别进行处理。</p>
<p>这里，我们利用golang的反射value.(type)。需要注意的是，value.(type)只能用在switch-case结构中，当我们通过switch判断了value的类型之后，就可以利用断言对其进行类型转换。</p>
<p>在简单值的比较中，因为其不存在结构嵌套的情况，值不同即说明该处存在不同，这样我们就可以用DeepEqual()来简化比较过程。</p>
<p>最后再检查json2中是否存在json1不存在的键值对。</p>
<p>这样，比较是否相同这一目的就达到了。但是目前，这与DeepEqual()并没有不同。所以，我们还需要把整个比较的过程记录下来。对于相同的部分，我们记录json的内容；对于不同的部分，我们分别记录下两者的区别。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">JsonDiff</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">HasDiff</span> <span class="kt">bool</span>
    <span class="nx">Result</span>  <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">j</span> <span class="kd">interface</span><span class="p">{})</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="nx">value</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">string</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">//比较json
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">jsonDiffDict</span><span class="p">(</span><span class="nx">json1</span><span class="p">,</span> <span class="nx">json2</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{},</span> <span class="nx">depth</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">diff</span> <span class="o">*</span><span class="nx">JsonDiff</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">blank</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Repeat</span><span class="p">(</span><span class="s">&#34; &#34;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="nx">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="nx">longBlank</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Repeat</span><span class="p">(</span><span class="s">&#34; &#34;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="nx">depth</span><span class="p">)))</span>
    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="s">&#34;{&#34;</span>
    <span class="c1">//遍历json1
</span><span class="c1"></span>    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">json1</span> <span class="p">{</span>
        <span class="nx">quotedKey</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;\&#34;%s\&#34;&#34;</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span>
        <span class="c1">//如果json2存在json1相同的key
</span><span class="c1"></span>        <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="nx">value</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">//json1的value的类型为json
</span><span class="c1"></span>            <span class="k">case</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}:</span>
                <span class="c1">//如果json2的value的类型不同
</span><span class="c1"></span>                <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok2</span> <span class="o">:=</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">].(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{});</span> <span class="p">!</span><span class="nx">ok2</span> <span class="p">{</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n-&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n+&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="c1">//如果json2的value的类型相同
</span><span class="c1"></span>                    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span> <span class="o">+</span> <span class="nx">longBlank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span>
                    <span class="c1">//递归比较json
</span><span class="c1"></span>                    <span class="nf">jsonDiffDict</span><span class="p">(</span><span class="nx">value</span><span class="p">.(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}),</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">].(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}),</span> <span class="nx">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">diff</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="c1">//json1的value的类型为jsonarray
</span><span class="c1"></span>            <span class="k">case</span> <span class="p">[]</span><span class="kd">interface</span><span class="p">{}:</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span> <span class="o">+</span> <span class="nx">longBlank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span>
                <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok2</span> <span class="o">:=</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">].([]</span><span class="kd">interface</span><span class="p">{});</span> <span class="p">!</span><span class="nx">ok2</span> <span class="p">{</span>
                    <span class="c1">//如果json2的value的类型不同
</span><span class="c1"></span>                    <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n-&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n+&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="c1">//如果json2的value的类型相同
</span><span class="c1"></span>                    <span class="nf">jsonDiffList</span><span class="p">(</span><span class="nx">value</span><span class="p">.([]</span><span class="kd">interface</span><span class="p">{}),</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">].([]</span><span class="kd">interface</span><span class="p">{}),</span> <span class="nx">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">diff</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="c1">//json1的value的类型为简单值
</span><span class="c1"></span>            <span class="k">default</span><span class="p">:</span>
                <span class="c1">//简单值,直接用DeepEqual比较interface{}值
</span><span class="c1"></span>                <span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n-&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n+&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span> <span class="o">+</span> <span class="nx">longBlank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">//如果json2不存在json1相同的key
</span><span class="c1"></span>            <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
            <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n-&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
    <span class="p">}</span>
    <span class="c1">//遍历json2,目的是为了找到json2-json1的差集
</span><span class="c1"></span>    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">json2</span> <span class="p">{</span>
        <span class="c1">//如果json1不存在json2相同的key
</span><span class="c1"></span>        <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">json1</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
            <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
            <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n+&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="s">&#34;\&#34;&#34;</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="s">&#34;\&#34;&#34;</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="s">&#34;}&#34;</span>
<span class="p">}</span>

<span class="c1">//比较jsonList
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">jsonDiffList</span><span class="p">(</span><span class="nx">json1</span><span class="p">,</span> <span class="nx">json2</span> <span class="p">[]</span><span class="kd">interface</span><span class="p">{},</span> <span class="nx">depth</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">diff</span> <span class="o">*</span><span class="nx">JsonDiff</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">blank</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Repeat</span><span class="p">(</span><span class="s">&#34; &#34;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="nx">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="nx">longBlank</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Repeat</span><span class="p">(</span><span class="s">&#34; &#34;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="nx">depth</span><span class="p">)))</span>
    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="s">&#34;[&#34;</span>
    <span class="nx">size</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">json1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">size</span> <span class="p">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">json2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">size</span> <span class="p">=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">json2</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">size</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">].(</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}:</span>
            <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">].(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{});</span> <span class="nx">ok</span> <span class="p">{</span>
                <span class="nf">jsonDiffDict</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">].(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}),</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">].(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}),</span> <span class="nx">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">diff</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n-&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n+&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
            <span class="p">}</span>
        <span class="k">case</span> <span class="p">[]</span><span class="kd">interface</span><span class="p">{}:</span>
            <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok2</span> <span class="o">:=</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">].([]</span><span class="kd">interface</span><span class="p">{});</span> <span class="p">!</span><span class="nx">ok2</span> <span class="p">{</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n-&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n+&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nf">jsonDiffList</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">].([]</span><span class="kd">interface</span><span class="p">{}),</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">].([]</span><span class="kd">interface</span><span class="p">{}),</span> <span class="nx">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">diff</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n-&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n+&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span> <span class="o">+</span> <span class="nx">longBlank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">size</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">json1</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
        <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n-&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
        <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">size</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">json2</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
        <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n+&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
        <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
    <span class="p">}</span>
    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>因为可能会出现，json很长，但是区别只有一两行这种情况，所以我们还需要设定一个输出范围宽度的设定。</p>
<p>当宽度&lt;0时，输出完整的json比较结果。当宽度&gt;=0时，将输出区别范围结果向上下各扩展宽度行的结果。</p>
<p>那么，完整代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">service</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;encoding/json&#34;</span>
    <span class="s">&#34;fmt&#34;</span>
    <span class="s">&#34;io/ioutil&#34;</span>
    <span class="s">&#34;reflect&#34;</span>
    <span class="s">&#34;strings&#34;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">JsonDiff</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">HasDiff</span> <span class="kt">bool</span>
    <span class="nx">Result</span>  <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">JsonCompare</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">right</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{},</span> <span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">diff</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">JsonDiff</span><span class="p">{</span><span class="nx">HasDiff</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">Result</span><span class="p">:</span> <span class="s">&#34;&#34;</span><span class="p">}</span>
    <span class="nf">jsonDiffDict</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">diff</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">n</span> <span class="p">&lt;</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span><span class="p">,</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nf">processContext</span><span class="p">(</span><span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span><span class="p">,</span> <span class="nx">n</span><span class="p">),</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">j</span> <span class="kd">interface</span><span class="p">{})</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="nx">value</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">string</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">jsonDiffDict</span><span class="p">(</span><span class="nx">json1</span><span class="p">,</span> <span class="nx">json2</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{},</span> <span class="nx">depth</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">diff</span> <span class="o">*</span><span class="nx">JsonDiff</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">blank</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Repeat</span><span class="p">(</span><span class="s">&#34; &#34;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="nx">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="nx">longBlank</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Repeat</span><span class="p">(</span><span class="s">&#34; &#34;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="nx">depth</span><span class="p">)))</span>
    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="s">&#34;{&#34;</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">json1</span> <span class="p">{</span>
        <span class="nx">quotedKey</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;\&#34;%s\&#34;&#34;</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="nx">value</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}:</span>
                <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok2</span> <span class="o">:=</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">].(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{});</span> <span class="p">!</span><span class="nx">ok2</span> <span class="p">{</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n-&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n+&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span> <span class="o">+</span> <span class="nx">longBlank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span>
                    <span class="nf">jsonDiffDict</span><span class="p">(</span><span class="nx">value</span><span class="p">.(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}),</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">].(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}),</span> <span class="nx">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">diff</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="k">case</span> <span class="p">[]</span><span class="kd">interface</span><span class="p">{}:</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span> <span class="o">+</span> <span class="nx">longBlank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span>
                <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok2</span> <span class="o">:=</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">].([]</span><span class="kd">interface</span><span class="p">{});</span> <span class="p">!</span><span class="nx">ok2</span> <span class="p">{</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n-&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n+&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nf">jsonDiffList</span><span class="p">(</span><span class="nx">value</span><span class="p">.([]</span><span class="kd">interface</span><span class="p">{}),</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">].([]</span><span class="kd">interface</span><span class="p">{}),</span> <span class="nx">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">diff</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n-&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n+&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json2</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span> <span class="o">+</span> <span class="nx">longBlank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
            <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n-&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nx">quotedKey</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">json2</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">json1</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
            <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
            <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n+&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="s">&#34;\&#34;&#34;</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="s">&#34;\&#34;&#34;</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="s">&#34;}&#34;</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">jsonDiffList</span><span class="p">(</span><span class="nx">json1</span><span class="p">,</span> <span class="nx">json2</span> <span class="p">[]</span><span class="kd">interface</span><span class="p">{},</span> <span class="nx">depth</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">diff</span> <span class="o">*</span><span class="nx">JsonDiff</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">blank</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Repeat</span><span class="p">(</span><span class="s">&#34; &#34;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="nx">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="nx">longBlank</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Repeat</span><span class="p">(</span><span class="s">&#34; &#34;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="nx">depth</span><span class="p">)))</span>
    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="s">&#34;[&#34;</span>
    <span class="nx">size</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">json1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">size</span> <span class="p">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">json2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">size</span> <span class="p">=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">json2</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">size</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">].(</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}:</span>
            <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">].(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{});</span> <span class="nx">ok</span> <span class="p">{</span>
                <span class="nf">jsonDiffDict</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">].(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}),</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">].(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}),</span> <span class="nx">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">diff</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n-&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n+&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
            <span class="p">}</span>
        <span class="k">case</span> <span class="p">[]</span><span class="kd">interface</span><span class="p">{}:</span>
            <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok2</span> <span class="o">:=</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">].([]</span><span class="kd">interface</span><span class="p">{});</span> <span class="p">!</span><span class="nx">ok2</span> <span class="p">{</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n-&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n+&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nf">jsonDiffList</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">].([]</span><span class="kd">interface</span><span class="p">{}),</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">].([]</span><span class="kd">interface</span><span class="p">{}),</span> <span class="nx">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">diff</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n-&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n+&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span> <span class="o">+</span> <span class="nx">longBlank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">size</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">json1</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
        <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n-&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
        <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">size</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">json2</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">diff</span><span class="p">.</span><span class="nx">HasDiff</span> <span class="p">=</span> <span class="kc">true</span>
        <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n+&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="nf">marshal</span><span class="p">(</span><span class="nx">json2</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
        <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;,&#34;</span>
    <span class="p">}</span>
    <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="p">=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">Result</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span> <span class="o">+</span> <span class="nx">blank</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">processContext</span><span class="p">(</span><span class="nx">diff</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="nx">index1</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Index</span><span class="p">(</span><span class="nx">diff</span><span class="p">,</span> <span class="s">&#34;\n-&#34;</span><span class="p">)</span>
    <span class="nx">index2</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Index</span><span class="p">(</span><span class="nx">diff</span><span class="p">,</span> <span class="s">&#34;\n+&#34;</span><span class="p">)</span>
    <span class="nx">begin</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="nx">end</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="nx">index1</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">index2</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">index1</span> <span class="o">&lt;=</span> <span class="nx">index2</span> <span class="p">{</span>
            <span class="nx">begin</span> <span class="p">=</span> <span class="nx">index1</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">begin</span> <span class="p">=</span> <span class="nx">index2</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">index1</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nx">begin</span> <span class="p">=</span> <span class="nx">index1</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">index2</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nx">begin</span> <span class="p">=</span> <span class="nx">index2</span>
    <span class="p">}</span>
    <span class="nx">index1</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">LastIndex</span><span class="p">(</span><span class="nx">diff</span><span class="p">,</span> <span class="s">&#34;\n-&#34;</span><span class="p">)</span>
    <span class="nx">index2</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">LastIndex</span><span class="p">(</span><span class="nx">diff</span><span class="p">,</span> <span class="s">&#34;\n+&#34;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">index1</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">index2</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">index1</span> <span class="o">&lt;=</span> <span class="nx">index2</span> <span class="p">{</span>
            <span class="nx">end</span> <span class="p">=</span> <span class="nx">index2</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">end</span> <span class="p">=</span> <span class="nx">index1</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">index1</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nx">end</span> <span class="p">=</span> <span class="nx">index1</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">index2</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nx">end</span> <span class="p">=</span> <span class="nx">index2</span>
    <span class="p">}</span>
    <span class="nx">pre</span> <span class="o">:=</span> <span class="nx">diff</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nx">begin</span><span class="p">]</span>
    <span class="nx">post</span> <span class="o">:=</span> <span class="nx">diff</span><span class="p">[</span><span class="nx">end</span><span class="p">:]</span>
    <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="nx">l</span> <span class="o">:=</span> <span class="nx">begin</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">n</span> <span class="o">&amp;&amp;</span> <span class="nx">l</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nx">i</span><span class="o">++</span>
        <span class="nx">l</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">LastIndex</span><span class="p">(</span><span class="nx">pre</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nx">l</span><span class="p">],</span> <span class="s">&#34;\n&#34;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">r</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="nx">j</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="nx">n</span> <span class="o">&amp;&amp;</span> <span class="nx">r</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nx">j</span><span class="o">++</span>
        <span class="nx">t</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Index</span><span class="p">(</span><span class="nx">post</span><span class="p">[</span><span class="nx">r</span><span class="p">:],</span> <span class="s">&#34;\n&#34;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">t</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="nx">r</span> <span class="p">=</span> <span class="nx">r</span> <span class="o">+</span> <span class="nx">t</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">r</span> <span class="p">&lt;</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nx">r</span> <span class="p">=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">post</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">pre</span><span class="p">[</span><span class="nx">l</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="nx">diff</span><span class="p">[</span><span class="nx">begin</span><span class="p">:</span><span class="nx">end</span><span class="p">]</span> <span class="o">+</span> <span class="nx">post</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nx">r</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">LoadJson</span><span class="p">(</span><span class="nx">path</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">dist</span> <span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">content</span> <span class="p">[]</span><span class="kt">byte</span>
    <span class="k">if</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">ReadFile</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">err</span> <span class="p">=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">dist</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>转载:<a href="https://www.cnblogs.com/wangzhao765/p/9662331.html">https://www.cnblogs.com/wangzhao765/p/9662331.html</a></p>


  </div>

  <footer class="post-footer">
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2021 <a href="/">Forz Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
