<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>使用Delve工具调试Go程序 - Forz Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Forz" /><meta name="description" content="前言 Delve 是一个 go 语言的第三方调试器，github 地址是： https://github.com/go-delve/delve 。 Delve 是 GDB 调试器的有效替代品。与 GDB 相比，它能更高的理解 Go 的运行时，数据结构以及表达式。" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="/post/%E4%BD%BF%E7%94%A8delve%E5%B7%A5%E5%85%B7%E8%B0%83%E8%AF%95go%E7%A8%8B%E5%BA%8F/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.98f8e47918247c097fa26317cbb567fe9f05503485bf08d8547f5579543303b1.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="使用Delve工具调试Go程序" />
<meta property="og:description" content="前言 Delve 是一个 go 语言的第三方调试器，github 地址是： https://github.com/go-delve/delve 。 Delve 是 GDB 调试器的有效替代品。与 GDB 相比，它能更高的理解 Go 的运行时，数据结构以及表达式。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/%E4%BD%BF%E7%94%A8delve%E5%B7%A5%E5%85%B7%E8%B0%83%E8%AF%95go%E7%A8%8B%E5%BA%8F/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-05-22T22:55:01+00:00" />
<meta property="article:modified_time" content="2021-05-22T22:55:01+00:00" />

<meta itemprop="name" content="使用Delve工具调试Go程序">
<meta itemprop="description" content="前言 Delve 是一个 go 语言的第三方调试器，github 地址是： https://github.com/go-delve/delve 。 Delve 是 GDB 调试器的有效替代品。与 GDB 相比，它能更高的理解 Go 的运行时，数据结构以及表达式。"><meta itemprop="datePublished" content="2021-05-22T22:55:01+00:00" />
<meta itemprop="dateModified" content="2021-05-22T22:55:01+00:00" />
<meta itemprop="wordCount" content="5095">
<meta itemprop="keywords" content="Delve," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="使用Delve工具调试Go程序"/>
<meta name="twitter:description" content="前言 Delve 是一个 go 语言的第三方调试器，github 地址是： https://github.com/go-delve/delve 。 Delve 是 GDB 调试器的有效替代品。与 GDB 相比，它能更高的理解 Go 的运行时，数据结构以及表达式。"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Forz Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Forz Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
      <a class="menu-item-link" href="/">Home</a>
    </li><li class="menu-item">
      <a class="menu-item-link" href="/post/">Archives</a>
    </li><li class="menu-item">
      <a class="menu-item-link" href="/tags/">Tags</a>
    </li><li class="menu-item">
      <a class="menu-item-link" href="/categories/">Categories</a>
    </li>
  </ul>
</nav><div class="docsearch-input__container">
  <input type="search" class="docsearch-input" placeholder="Search" />
</div>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">使用Delve工具调试Go程序</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-05-22 </span>
        <div class="post-category">
            <a href="/categories/go/"> Go </a>
            </div>
          <span class="more-meta"> 约 5095 字 </span>
          <span class="more-meta"> 预计阅读 11 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#下载并安装-go-delve">下载并安装 Go Delve</a></li>
    <li><a href="#加载程序">加载程序</a></li>
    <li><a href="#delve-客户端">Delve 客户端</a></li>
    <li><a href="#查看源码命令组">查看源码命令组</a>
      <ul>
        <li><a href="#list">List</a></li>
        <li><a href="#funcs">Funcs</a></li>
        <li><a href="#exit">Exit</a></li>
      </ul>
    </li>
    <li><a href="#添加及管理断点命令组">添加及管理断点命令组</a>
      <ul>
        <li><a href="#break">break</a></li>
        <li><a href="#breakpoints">breakpoints</a></li>
        <li><a href="#clear">clear</a></li>
        <li><a href="#clearall">clearall</a></li>
      </ul>
    </li>
    <li><a href="#控制程序的执行流程命令组">控制程序的执行流程命令组</a>
      <ul>
        <li><a href="#continue">continue</a></li>
        <li><a href="#next">next</a></li>
        <li><a href="#step">step</a></li>
        <li><a href="#stepout">stepout</a></li>
        <li><a href="#restart">restart</a></li>
      </ul>
    </li>
    <li><a href="#查看当前状态的变量及表达式的值命令组">查看当前状态的变量及表达式的值命令组</a>
      <ul>
        <li><a href="#print">print</a></li>
        <li><a href="#locals">locals</a></li>
        <li><a href="#stack">stack</a></li>
        <li><a href="#frame">frame</a></li>
        <li><a href="#args">args</a></li>
        <li><a href="#disassemble">disassemble</a></li>
      </ul>
    </li>
    <li><a href="#结论">结论</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="前言">前言</h2>
<p>Delve 是一个 go 语言的第三方调试器，github 地址是： <a href="https://github.com/go-delve/delve">https://github.com/go-delve/delve</a> 。 Delve 是 GDB 调试器的有效替代品。与 GDB 相比，它能更高的理解 Go 的运行时，数据结构以及表达式。Delve 目前支持 Linux，OSX 以及 Windows 的 amd64 平台。</p>
<p>本文主要介绍使用 delve 调试器如何调试 Go 程序。内容包含如下：</p>
<ul>
<li>下载安装 Delve</li>
<li>查看源码命令组，</li>
<li>添加及管理断点命令组（添加断点、查看断点、清除断点等）</li>
<li>控制程序的执行流程命令组</li>
<li>查看当前状态的变量及表达式的值命令组。
阅读完本文后，你将能够使用 Delve 工具很容易的调试你的 go 程序。</li>
</ul>
<h2 id="下载并安装-go-delve">下载并安装 Go Delve</h2>
<p>安装方式一：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="n">git</span> <span class="n">clone</span> <span class="o">&lt;</span><span class="n">https</span><span class="o">://</span><span class="n">github.com</span><span class="o">/</span><span class="n">go</span><span class="o">-</span><span class="n">delve</span><span class="o">/</span><span class="n">delve</span><span class="o">&gt;</span> <span class="o">$</span> <span class="n">cd</span> <span class="n">delve</span> <span class="o">$</span> <span class="n">go</span> <span class="n">install</span> <span class="n">github.com</span><span class="o">/</span><span class="n">go</span><span class="o">-</span><span class="n">delve</span><span class="o">/</span><span class="n">delve</span><span class="o">/</span><span class="n">cmd</span><span class="o">/</span><span class="n">dlv</span>
</code></pre></td></tr></table>
</div>
</div><p>安装方式二：（适用于 Go 1.16 及以后版本）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="n">go</span> <span class="n">install</span> <span class="n">github.com</span><span class="o">/</span><span class="n">go</span><span class="o">-</span><span class="n">delve</span><span class="o">/</span><span class="n">delve</span><span class="o">/</span><span class="n">cmd</span><span class="o">/</span><span class="n">dlv</span><span class="o">@</span><span class="n">latest</span>
</code></pre></td></tr></table>
</div>
</div><p>执行完命令后，dlv 命令被安装在 $GOPATH/bin 目录下。如果没有设置 $GOPATH，则被默认安装在 $HOME/go/bin 目录下。</p>
<p>输入 dlv 命令检查是否安装成功：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="o">$</span> <span class="n">dlv</span> <span class="n">version</span>
<span class="n">Delve</span> <span class="n">Debugger</span>
<span class="n">Version</span><span class="o">:</span> <span class="m">1.6.0</span>
<span class="n">Build</span> <span class="o">$</span><span class="n">Id</span><span class="o">:</span> <span class="m">8</span><span class="n">cc9751909843dd55a46e8ea2a561544f70db34d</span> <span class="o">$</span>
</code></pre></td></tr></table>
</div>
</div><p>如果在终端输入 dlv 命令提示找不到该命令，则将 $GOPATH/bin 下的 dlv 命令软链接到/usr/local/bin 目录。即保证 dlv 命令在 $PATH 环境变量下。</p>
<h2 id="加载程序">加载程序</h2>
<p>有两种方法可以将程序加载到 Delve 调试器中。</p>
<p>当源代码尚未编译为二进制时，请使用 debug 参数。</p>
<p>第一种方法是仅在需要源文件时使用 debug 命令。 Delve 会为您编译一个名为 __debug_bin 的二进制文件，并将其加载到调试器中。</p>
<p>在此示例中，切换到 hello.go 所在的目录并运行 dlv debug 命令。如果目录中有多个 Go 源文件，并且每个文件都有其自己的主要功能，则 Delve 可能会抛出错误，期望使用单个程序或单个项目来构建二进制文件。如果发生这种情况，最好使用下面显示的第二个选项。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="o">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span>
<span class="n">total</span> <span class="m">4</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="m">-.</span> <span class="m">1</span> <span class="n">user</span> <span class="n">user</span> <span class="m">74</span> <span class="n">Jun</span>  <span class="m">4</span> <span class="m">11</span><span class="o">:</span><span class="m">48</span> <span class="n">hello.go</span>
<span class="o">$</span>
<span class="o">$</span> <span class="n">dlv</span> <span class="n">debug</span>
<span class="n">Type</span> <span class="s">&#39;help&#39;</span> <span class="n">for</span> <span class="n">list</span> <span class="n">of</span> <span class="nf">commands.
</span><span class="nf"></span><span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>现在打开另一个终端并列出同一目录的内容。 您会看到一个附加的__debug_bin 二进制文件，该二进制文件是从源代码编译并加载到调试器中的。 现在，您可以移至 dlv 提示符，以继续使用 Delve。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="o">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span>
<span class="n">total</span> <span class="m">2036</span>
<span class="o">-</span><span class="n">rwxrwxr</span><span class="o">-</span><span class="n">x.</span> <span class="m">1</span> <span class="n">user</span> <span class="n">user</span> <span class="m">2077085</span> <span class="n">Jun</span>  <span class="m">4</span> <span class="m">11</span><span class="o">:</span><span class="m">48</span> <span class="n">__debug_bin</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="m">-.</span> <span class="m">1</span> <span class="n">user</span> <span class="n">user</span>      <span class="m">74</span> <span class="n">Jun</span>  <span class="m">4</span> <span class="m">11</span><span class="o">:</span><span class="m">48</span> <span class="n">hello.go</span>
<span class="o">$</span>
</code></pre></td></tr></table>
</div>
</div><p>使用 EXEC 参数。</p>
<p>第二种将程序加载到 Delve 中的方法在以下情况下非常有用：您有预编译的 GO 二进制文件，或者已经使用 GO BUILD 命令编译的程序，并且不希望 Delve 将其编译为 __DEBUG_BIN 二进制文件。在这种情况下，使用 exec 参数将二进制目录加载到 Delve 调试器中。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="o">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span>
<span class="n">total</span> <span class="m">4</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="m">-.</span> <span class="m">1</span> <span class="n">user</span> <span class="n">user</span> <span class="m">74</span> <span class="n">Jun</span>  <span class="m">4</span> <span class="m">11</span><span class="o">:</span><span class="m">48</span> <span class="n">hello.go</span>
<span class="o">$</span>
<span class="o">$</span> <span class="n">go</span> <span class="n">build</span> <span class="n">hello.go</span>
<span class="o">$</span>
<span class="o">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span>
<span class="n">total</span> <span class="m">1956</span>
<span class="o">-</span><span class="n">rwxrwxr</span><span class="o">-</span><span class="n">x.</span> <span class="m">1</span> <span class="n">user</span> <span class="n">user</span> <span class="m">1997284</span> <span class="n">Jun</span>  <span class="m">4</span> <span class="m">11</span><span class="o">:</span><span class="m">54</span> <span class="n">hello</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="m">-.</span> <span class="m">1</span> <span class="n">user</span> <span class="n">user</span>      <span class="m">74</span> <span class="n">Jun</span>  <span class="m">4</span> <span class="m">11</span><span class="o">:</span><span class="m">48</span> <span class="n">hello.go</span>
<span class="o">$</span>
<span class="o">$</span> <span class="n">dlv</span> <span class="n">exec</span> <span class="n">./hello</span>
<span class="n">Type</span> <span class="s">&#39;help&#39;</span> <span class="n">for</span> <span class="n">list</span> <span class="n">of</span> <span class="nf">commands.
</span><span class="nf"></span><span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>首先我们通过下面的斐波那契数列函数代码作为示例讲解。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>

<span class="kd">var</span> <span class="nx">m</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">n</span> <span class="o">:=</span> <span class="k">range</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">6</span><span class="p">}</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="o">:=</span> <span class="nf">fib</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="s">&#34;fib&#34;</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">fib</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">n</span> <span class="p">&lt;</span> <span class="mi">2</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">n</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">f</span> <span class="kt">int</span>

    <span class="k">if</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">[</span><span class="nx">n</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
        <span class="nx">f</span> <span class="p">=</span> <span class="nx">v</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">f</span> <span class="p">=</span> <span class="nf">fib</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nf">fib</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="nx">m</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="p">=</span> <span class="nx">f</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">f</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在当前目录下输入 dlv debug 命令，编译并启动一个调试会话。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="o">$</span> <span class="n">dlv</span> <span class="n">debug</span> <span class="n">main.go</span>
<span class="n">Type</span> <span class="s">&#39;help&#39;</span> <span class="n">for</span> <span class="n">list</span> <span class="n">of</span> <span class="nf">commands.
</span><span class="nf"></span><span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="delve-客户端">Delve 客户端</h2>
<p>通过执行 dlv debug 即开启了一个调试的会话。dlv 编译程序并附加到二进制中，接下来我们可以开始调试我们的程序了。通过 dlv debug 命令，我们即开启了一个 delve 的解释器，我们可以称它为 Delve 客户端，由这个客户端发送调试的命令到 delve 的服务端。</p>
<p>在开启的 delve 客户端下，我们输入 help 命令，可以查看所有可用的子命令。如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s">  <span class="n">Type</span> <span class="s">&#39;help&#39;</span> <span class="n">for</span> <span class="n">list</span> <span class="n">of</span> <span class="nf">commands.
</span><span class="nf">  </span><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">help</span>
  <span class="n">The</span> <span class="n">following</span> <span class="n">commands</span> <span class="n">are</span> <span class="n">available</span><span class="o">:</span>

  <span class="n">Running</span> <span class="n">the</span> <span class="n">program</span><span class="o">:</span> <span class="o">//</span>执行程序的命令
<span class="n">call</span> <span class="o">------------------------</span> <span class="n">Resumes</span> <span class="n">process</span><span class="p">,</span> <span class="n">injecting</span> <span class="n">a</span> <span class="n">function</span> <span class="nf">call </span><span class="p">(</span><span class="n">EXPERIMENTAL</span><span class="o">!!!</span><span class="p">)</span> <span class="o">//</span>重新使用程序，注入一个函数调用
<span class="nf">continue </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">c</span><span class="p">)</span> <span class="o">---------</span> <span class="n">Run</span> <span class="n">until</span> <span class="n">breakpoint</span> <span class="n">or</span> <span class="n">program</span> <span class="n">termination.</span> <span class="o">//</span>运行程序直到程序结束或遇到下一个端点
<span class="nf">next </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">n</span><span class="p">)</span> <span class="o">-------------</span> <span class="n">Step</span> <span class="n">over</span> <span class="n">to</span> <span class="n">next</span> <span class="n">source</span> <span class="n">line.</span> <span class="o">//</span>执行源文件的下一行
<span class="n">rebuild</span> <span class="o">---------------------</span> <span class="n">Rebuild</span> <span class="n">the</span> <span class="n">target</span> <span class="n">executable</span> <span class="n">and</span> <span class="n">restarts</span> <span class="n">it.</span> <span class="n">It</span> <span class="n">does</span> <span class="n">not</span> <span class="n">work</span> <span class="n">if</span> <span class="n">the</span> <span class="n">executable</span> <span class="n">was</span> <span class="n">not</span> <span class="n">built</span> <span class="n">by</span> <span class="n">delve.</span> <span class="o">//</span>重新编译源文件并重启动该调试会话。该过程会保留之前设置的所有断点。
<span class="nf">restart </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">r</span><span class="p">)</span> <span class="o">----------</span> <span class="n">Restart</span> <span class="n">process.</span> <span class="o">//</span>重启动该调试进程，会保留之前设置的所有断点。和<span class="n">rebuild的区别是</span>，<span class="n">restart命令不会重新编译源文件</span>，即在调试过程中，如果源文件有变更，<span class="n">restart命令后不会体现</span>。
<span class="nf">step </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">s</span><span class="p">)</span> <span class="o">-------------</span> <span class="n">Single</span> <span class="n">step</span> <span class="n">through</span> <span class="n">program.</span> <span class="o">//</span> 单步执行。如果遇到函数调用，则进入到被调用的函数中。和<span class="n">next的区别是</span>，当<span class="n">next遇到函数调用时</span>，不进入函数内部，仍留在主函数中。具体例子中会讲解。
<span class="n">step</span><span class="o">-</span><span class="nf">instruction </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">si</span><span class="p">)</span>  <span class="n">Single</span> <span class="n">step</span> <span class="n">a</span> <span class="n">single</span> <span class="n">cpu</span> <span class="n">instruction.</span> <span class="o">//</span>单步执行<span class="n">cpu指令</span>。
<span class="nf">stepout </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">so</span><span class="p">)</span> <span class="o">---------</span> <span class="n">Step</span> <span class="n">out</span> <span class="n">of</span> <span class="n">the</span> <span class="n">current</span> <span class="n">function.</span> <span class="o">//</span>单步跳出函数，返回到调用函数的那一行。具体例子中会讲解

<span class="n">Manipulating</span> <span class="n">breakpoints</span><span class="o">:</span> <span class="o">//</span>管理断点的命令
<span class="nf">break </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">b</span><span class="p">)</span> <span class="o">-------</span> <span class="n">Sets</span> <span class="n">a</span> <span class="n">breakpoint.</span> <span class="o">//</span>设置一个端点
<span class="nf">breakpoints </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">bp</span><span class="p">)</span>  <span class="n">Print</span> <span class="n">out</span> <span class="n">info</span> <span class="n">for</span> <span class="n">active</span> <span class="n">breakpoints.</span> <span class="o">//</span>打印出当前所有的断点
<span class="n">clear</span> <span class="o">------------------</span> <span class="n">Deletes</span> <span class="n">breakpoint.</span> <span class="o">//</span>删除一个断点
<span class="n">clearall</span> <span class="o">---------------</span> <span class="n">Deletes</span> <span class="n">multiple</span> <span class="n">breakpoints.</span> <span class="o">//</span>删除所有的断点。
<span class="nf">condition </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">cond</span><span class="p">)</span>  <span class="n">Set</span> <span class="n">breakpoint</span> <span class="n">condition.</span> <span class="o">//</span>设置断点条件
<span class="n">on</span> <span class="o">---------------------</span> <span class="n">Executes</span> <span class="n">a</span> <span class="n">command</span> <span class="n">when</span> <span class="n">a</span> <span class="n">breakpoint</span> <span class="n">is</span> <span class="n">hit.</span> <span class="o">//</span>当遇到断点时，执行一个命令
<span class="nf">trace </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">t</span><span class="p">)</span> <span class="o">-------</span> <span class="n">Set</span> <span class="n">tracepoint.</span> <span class="o">//</span>设置<span class="n">trace断点</span>

<span class="n">Viewing</span> <span class="n">program</span> <span class="n">variables</span> <span class="n">and</span> <span class="n">memory</span><span class="o">:</span> <span class="o">//</span>查看变量和内存的命令
<span class="n">args</span> <span class="o">-----------------</span> <span class="n">Print</span> <span class="n">function</span> <span class="n">arguments.</span>
<span class="n">display</span> <span class="o">--------------</span> <span class="n">Print</span> <span class="n">value</span> <span class="n">of</span> <span class="n">an</span> <span class="n">expression</span> <span class="n">every</span> <span class="n">time</span> <span class="n">the</span> <span class="n">program</span> <span class="n">stops.</span>
<span class="nf">examinemem </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">x</span><span class="p">)</span>  <span class="n">Examine</span> <span class="n">memory</span><span class="o">:</span>
<span class="n">locals</span> <span class="o">---------------</span> <span class="n">Print</span> <span class="n">local</span> <span class="n">variables.</span>
<span class="nf">print </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">p</span><span class="p">)</span> <span class="o">-----</span> <span class="n">Evaluate</span> <span class="n">an</span> <span class="n">expression.</span>
<span class="n">regs</span> <span class="o">-----------------</span> <span class="n">Print</span> <span class="n">contents</span> <span class="n">of</span> <span class="n">CPU</span> <span class="n">registers.</span>
<span class="n">set</span> <span class="o">------------------</span> <span class="n">Changes</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">a</span> <span class="n">variable.</span>
<span class="n">vars</span> <span class="o">-----------------</span> <span class="n">Print</span> <span class="n">package</span> <span class="n">variables.</span>
<span class="n">whatis</span> <span class="o">---------------</span> <span class="n">Prints</span> <span class="n">type</span> <span class="n">of</span> <span class="n">an</span> <span class="n">expression.</span>

<span class="n">Listing</span> <span class="n">and</span> <span class="n">switching</span> <span class="n">between</span> <span class="n">threads</span> <span class="n">and</span> <span class="n">goroutines</span><span class="o">:</span> <span class="o">//</span>在线程和协程间切换的命令
<span class="nf">goroutine </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">gr</span><span class="p">)</span> <span class="o">--</span> <span class="n">Shows</span> <span class="n">or</span> <span class="n">changes</span> <span class="n">current</span> <span class="n">goroutine</span>
<span class="nf">goroutines </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">grs</span><span class="p">)</span>  <span class="n">List</span> <span class="n">program</span> <span class="n">goroutines.</span>
<span class="nf">thread </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">tr</span><span class="p">)</span> <span class="o">-----</span> <span class="n">Switch</span> <span class="n">to</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">thread.</span>
<span class="n">threads</span> <span class="o">----------------</span> <span class="n">Print</span> <span class="n">out</span> <span class="n">info</span> <span class="n">for</span> <span class="n">every</span> <span class="n">traced</span> <span class="n">thread.</span>

<span class="n">Viewing</span> <span class="n">the</span> <span class="n">call</span> <span class="n">stack</span> <span class="n">and</span> <span class="n">selecting</span> <span class="n">frames</span><span class="o">:</span> <span class="o">//</span>查看调用栈以及选择栈帧的命令
<span class="n">deferred</span> <span class="o">---------</span> <span class="n">Executes</span> <span class="n">command</span> <span class="n">in</span> <span class="n">the</span> <span class="n">context</span> <span class="n">of</span> <span class="n">a</span> <span class="n">deferred</span> <span class="n">call.</span>
<span class="n">down</span> <span class="o">-------------</span> <span class="n">Move</span> <span class="n">the</span> <span class="n">current</span> <span class="n">frame</span> <span class="n">down.</span>
<span class="n">frame</span> <span class="o">------------</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">current</span> <span class="n">frame</span><span class="p">,</span> <span class="n">or</span> <span class="n">execute</span> <span class="n">command</span> <span class="n">on</span> <span class="n">a</span> <span class="n">different</span> <span class="n">frame.</span>
<span class="nf">stack </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">bt</span><span class="p">)</span>  <span class="n">Print</span> <span class="n">stack</span> <span class="n">trace.</span>
<span class="n">up</span> <span class="o">---------------</span> <span class="n">Move</span> <span class="n">the</span> <span class="n">current</span> <span class="n">frame</span> <span class="n">up.</span>

<span class="n">Other</span> <span class="n">commands</span><span class="o">:</span> <span class="o">//</span>其他命令
<span class="n">config</span> <span class="o">---------------------</span> <span class="n">Changes</span> <span class="n">configuration</span> <span class="n">parameters.</span>
<span class="nf">disassemble </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">disass</span><span class="p">)</span>  <span class="n">Disassembler.</span>
<span class="nf">edit </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">ed</span><span class="p">)</span> <span class="o">-----------</span> <span class="n">Open</span> <span class="n">where</span> <span class="n">you</span> <span class="n">are</span> <span class="n">in</span> <span class="o">$</span><span class="n">DELVE_EDITOR</span> <span class="n">or</span> <span class="o">$</span><span class="n">EDITOR</span>
<span class="nf">exit </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">quit</span> <span class="o">|</span> <span class="n">q</span><span class="p">)</span> <span class="o">-----</span> <span class="n">Exit</span> <span class="n">the</span> <span class="n">debugger.</span>
<span class="n">funcs</span> <span class="o">----------------------</span> <span class="n">Print</span> <span class="n">list</span> <span class="n">of</span> <span class="n">functions.</span>
<span class="nf">help </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">h</span><span class="p">)</span> <span class="o">------------</span> <span class="n">Prints</span> <span class="n">the</span> <span class="n">help</span> <span class="n">message.</span>
<span class="n">libraries</span> <span class="o">------------------</span> <span class="n">List</span> <span class="n">loaded</span> <span class="n">dynamic</span> <span class="n">libraries</span>
<span class="nf">list </span><span class="p">(</span><span class="n">alias</span><span class="o">:</span> <span class="n">ls</span> <span class="o">|</span> <span class="n">l</span><span class="p">)</span> <span class="o">-------</span> <span class="n">Show</span> <span class="n">source</span> <span class="n">code.</span> <span class="o">//</span>查看源代码
<span class="n">source</span> <span class="o">---------------------</span> <span class="n">Executes</span> <span class="n">a</span> <span class="n">file</span> <span class="n">containing</span> <span class="n">a</span> <span class="n">list</span> <span class="n">of</span> <span class="n">delve</span> <span class="n">commands</span>
<span class="n">sources</span> <span class="o">--------------------</span> <span class="n">Print</span> <span class="n">list</span> <span class="n">of</span> <span class="n">source</span> <span class="n">files.</span>
<span class="n">types</span> <span class="o">----------------------</span> <span class="n">Print</span> <span class="n">list</span> <span class="n">of</span> <span class="n">types</span>

<span class="n">Type</span> <span class="n">help</span> <span class="n">followed</span> <span class="n">by</span> <span class="n">a</span> <span class="n">command</span> <span class="n">for</span> <span class="n">full</span> <span class="n">documentation.</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="查看源码命令组">查看源码命令组</h2>
<h3 id="list">List</h3>
<p>我们要介绍的第一个命令是 list，该命令允许我们查看给定行的源代码。我们可以通过包名 + 函数名、文件名 + 行数方式指定要查看的源文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="n">[goroutine</span> <span class="o">&lt;</span><span class="n">n</span><span class="o">&gt;</span><span class="n">]</span> <span class="n">[frame</span> <span class="o">&lt;</span><span class="n">m</span><span class="o">&gt;</span><span class="n">]</span> <span class="n">list</span> <span class="n">[</span><span class="o">&lt;</span><span class="n">linespec</span><span class="o">&gt;</span><span class="n">]</span>
</code></pre></td></tr></table>
</div>
</div><p>如下所示，通过包名 + 函数名的方式查看源代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">list</span> <span class="n">main.main</span>
<span class="n">Show</span> <span class="o">/</span><span class="n">workspace</span><span class="o">/</span><span class="n">tutorials</span><span class="o">/</span><span class="n">delve</span><span class="o">/</span><span class="n">main.go</span><span class="o">:</span><span class="m">7</span><span class="p">(</span><span class="n">PC</span><span class="o">:</span><span class="mh">0x10d145b</span><span class="p">)</span>
<span class="m">2</span><span class="o">:</span>
<span class="m">3</span><span class="o">:</span> <span class="n">import</span> <span class="s">&#34;fmt&#34;</span>
<span class="m">4</span><span class="o">:</span>
<span class="m">5</span><span class="o">:</span> <span class="n">var</span> <span class="n">m</span> <span class="o">=</span> <span class="nf">make</span><span class="p">(</span><span class="n">map[int]int</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
<span class="m">6</span><span class="o">:</span>
<span class="m">7</span><span class="o">:</span> <span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="m">8</span><span class="o">:</span>  <span class="n">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">range</span> <span class="n">[]int</span><span class="p">{</span><span class="m">5</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">98</span><span class="p">,</span> <span class="m">6</span><span class="p">}</span> <span class="p">{</span>
<span class="m">9</span><span class="o">:</span>      <span class="n">x</span> <span class="o">:=</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="m">10</span><span class="o">:</span>     <span class="nf">fmt.Println</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s">&#34;fib&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="m">11</span><span class="o">:</span> <span class="p">}</span>
<span class="m">12</span><span class="o">:</span><span class="p">}</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
通过文件名 <span class="o">+</span> 行号查看源代码

<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">list</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">14</span>
<span class="n">Show</span> <span class="o">/</span><span class="n">workspace</span><span class="o">/</span><span class="n">tutorials</span><span class="o">/</span><span class="n">delve</span><span class="o">/</span><span class="n">main.go</span><span class="o">:</span><span class="m">7</span><span class="p">(</span><span class="n">PC</span><span class="o">:</span><span class="mh">0x10d145b</span><span class="p">)</span>
<span class="m">9</span><span class="o">:</span>      <span class="n">x</span> <span class="o">:=</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="m">10</span><span class="o">:</span>     <span class="nf">fmt.Println</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s">&#34;fib&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="m">11</span><span class="o">:</span>   <span class="p">}</span>
<span class="m">12</span><span class="o">:</span> <span class="p">}</span>
<span class="m">13</span><span class="o">:</span>
<span class="m">14</span><span class="o">:</span> <span class="n">func</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span> <span class="n">int</span><span class="p">)</span> <span class="n">int</span> <span class="p">{</span>
<span class="m">15</span><span class="o">:</span>   <span class="n">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="m">2</span> <span class="p">{</span>
<span class="m">16</span><span class="o">:</span>     <span class="n">return</span> <span class="n">n</span>
<span class="m">17</span><span class="o">:</span>   <span class="p">}</span>
<span class="m">18</span><span class="o">:</span>
<span class="m">19</span><span class="o">:</span>   <span class="n">var</span> <span class="n">f</span> <span class="nf">int
</span><span class="nf"></span><span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="funcs">Funcs</h3>
<p>根据正则匹配对应的函数列表。一般用于搜索函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="n">funcs</span> <span class="n">[</span><span class="o">&lt;</span><span class="n">regex\</span><span class="o">&gt;</span><span class="n">]</span>
</code></pre></td></tr></table>
</div>
</div><p>例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">funcs</span> <span class="n">fib</span>
<span class="n">main.fib</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="exit">Exit</h3>
<p>退出当前调试会话命令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">exit</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="添加及管理断点命令组">添加及管理断点命令组</h2>
<p>一旦你知道用 list 命令如何显示源代码片段后，你就可以开始在程序的相应位置增加断点来调试程序了。</p>
<p>假设，我们想在 main.go 文件中的第 10 行增加一个端点，那么，我们就可以使用 break 命令来达到设置断点的目的。</p>
<h3 id="break">break</h3>
<p>设置一个端点。其中 name 指的是给断点起一个名称，linespec 用来指定在设置断点的具体位置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="n">break</span> <span class="n">[name]</span> <span class="o">&lt;</span><span class="n">linespec\</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>例如，我们在 main.go 文件的第 10 行增加一个断点</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">break</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">10</span>
<span class="n">Breakpoint</span> <span class="m">1</span> <span class="n">set</span> <span class="n">at</span> <span class="mh">0x10d155d</span> <span class="n">for</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">10</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">list</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">10</span>
<span class="n">Showing</span> <span class="o">/</span><span class="n">workspace</span><span class="o">/</span><span class="n">tutorials</span><span class="o">/</span><span class="n">delve</span><span class="o">/</span><span class="n">main.go</span><span class="o">:</span><span class="m">10</span> <span class="p">(</span><span class="n">PC</span><span class="o">:</span> <span class="mh">0x10d155d</span><span class="p">)</span>
<span class="m">5</span><span class="o">:</span> <span class="n">var</span> <span class="n">m</span> <span class="o">=</span> <span class="nf">make</span><span class="p">(</span><span class="n">map[int]int</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
<span class="m">6</span><span class="o">:</span>
<span class="m">7</span><span class="o">:</span> <span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="m">8</span><span class="o">:</span>   <span class="n">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">range</span> <span class="n">[]int</span><span class="p">{</span><span class="m">5</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">98</span><span class="p">,</span> <span class="m">6</span><span class="p">}</span> <span class="p">{</span>
<span class="m">9</span><span class="o">:</span>     <span class="n">x</span> <span class="o">:=</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="m">10</span><span class="o">:</span>    <span class="nf">fmt.Println</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s">&#34;fib&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="m">11</span><span class="o">:</span>  <span class="p">}</span>
<span class="m">12</span><span class="o">:</span> <span class="p">}</span>
<span class="m">13</span><span class="o">:</span>
<span class="m">14</span><span class="o">:</span> <span class="n">func</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span> <span class="n">int</span><span class="p">)</span> <span class="n">int</span> <span class="p">{</span>
<span class="m">15</span><span class="o">:</span>   <span class="n">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="m">2</span> <span class="p">{</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="breakpoints">breakpoints</h3>
<p>设置完断点后，接下来需要查看设置了哪些断点。则需要使用 breakpoints 命令可以列出当前所有的断点信息。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">breakpoints</span>
<span class="n">Breakpoint</span> <span class="n">runtime</span><span class="o">-</span><span class="n">fatal</span><span class="o">-</span><span class="n">throw</span> <span class="n">at</span> <span class="mh">0x10388c0</span> <span class="n">for</span> <span class="nf">runtime.fatalthrow</span><span class="p">()</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">go</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">panic.go</span><span class="o">:</span><span class="m">1162</span> <span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="n">Breakpoint</span> <span class="n">unrecovered</span><span class="o">-</span><span class="n">panic</span> <span class="n">at</span> <span class="mh">0x1038940</span> <span class="n">for</span> <span class="nf">runtime.fatalpanic</span><span class="p">()</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">go</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">panic.go</span><span class="o">:</span><span class="m">1189</span> <span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="n">print</span> <span class="n">runtime.curg._panic.arg</span>
<span class="n">Breakpoint</span> <span class="m">1</span> <span class="n">at</span> <span class="mh">0x10d155d</span> <span class="n">for</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">10</span> <span class="p">(</span><span class="m">0</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>该命令一共接触 3 个断点。其中，前两个断点是 dlv 自动加的，以便当遇到错误或 panics 时可以查看程序的状态以及变量的信息。</p>
<p>第 3 个断点就是我们刚才手动在第 10 行设置的断点。</p>
<h3 id="clear">clear</h3>
<p>删除特定的断点。指定断点名或断点标识 ID</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="n">clear</span> <span class="o">&lt;</span><span class="n">breakpoint</span> <span class="n">name</span> <span class="n">or</span> <span class="n">id\</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>该命令一般用于要移除错误设置的标识，或者想移除原有标识并设置新的标识时使用。</p>
<p>例如，下面的例子中，删除标识 ID 为 1 的断点。标识号是使用 breakpoints 命令显示出来的 ID。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">clear</span> <span class="m">1</span>
<span class="n">Breakpoint</span> <span class="m">1</span> <span class="n">cleared</span> <span class="n">at</span> <span class="mh">0x10d155d</span> <span class="n">for</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">10</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="clearall">clearall</h3>
<p>清除所有手动增加的断点</p>
<p>例如，在下面的例子中，我们在第 8、9、10 行设置 3 个断点。然后使用 clearall</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">break</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">8</span>
<span class="n">Breakpoint</span> <span class="m">1</span> <span class="n">set</span> <span class="n">at</span> <span class="mh">0x10d1472</span> <span class="n">for</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">8</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">break</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">9</span>
<span class="n">Breakpoint</span> <span class="m">2</span> <span class="n">set</span> <span class="n">at</span> <span class="mh">0x10d154a</span> <span class="n">for</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">9</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">break</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">10</span>
<span class="n">Breakpoint</span> <span class="m">3</span> <span class="n">set</span> <span class="n">at</span> <span class="mh">0x10d155d</span> <span class="n">for</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">10</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">breakpoints</span>
<span class="n">Breakpoint</span> <span class="n">runtime</span><span class="o">-</span><span class="n">fatal</span><span class="o">-</span><span class="n">throw</span> <span class="n">at</span> <span class="mh">0x10388c0</span> <span class="n">for</span> <span class="nf">runtime.fatalthrow</span><span class="p">()</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">go</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">panic.go</span><span class="o">:</span><span class="m">1162</span> <span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="n">Breakpoint</span> <span class="n">unrecovered</span><span class="o">-</span><span class="n">panic</span> <span class="n">at</span> <span class="mh">0x1038940</span> <span class="n">for</span> <span class="nf">runtime.fatalpanic</span><span class="p">()</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">go</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">panic.go</span><span class="o">:</span><span class="m">1189</span> <span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="n">print</span> <span class="n">runtime.curg._panic.arg</span>
<span class="n">Breakpoint</span> <span class="m">1</span> <span class="n">at</span> <span class="mh">0x10d1472</span> <span class="n">for</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">8</span> <span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="n">Breakpoint</span> <span class="m">2</span> <span class="n">at</span> <span class="mh">0x10d154a</span> <span class="n">for</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">9</span> <span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="n">Breakpoint</span> <span class="m">3</span> <span class="n">at</span> <span class="mh">0x10d155d</span> <span class="n">for</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">10</span> <span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">clearall</span>
<span class="n">Breakpoint</span> <span class="m">1</span> <span class="n">cleared</span> <span class="n">at</span> <span class="mh">0x10d1472</span> <span class="n">for</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">8</span>
<span class="n">Breakpoint</span> <span class="m">2</span> <span class="n">cleared</span> <span class="n">at</span> <span class="mh">0x10d154a</span> <span class="n">for</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">9</span>
<span class="n">Breakpoint</span> <span class="m">3</span> <span class="n">cleared</span> <span class="n">at</span> <span class="mh">0x10d155d</span> <span class="n">for</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">10</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="控制程序的执行流程命令组">控制程序的执行流程命令组</h2>
<p>一旦我们可以设置断点，并且能够通过 list 命令检查源代码，现在我们看下如何运行程序。</p>
<h3 id="continue">continue</h3>
<p>运行程序，直到遇到下一个断点或者直到程序结束。 例如下面例子，我们在 main.go 文件的第 10 行设置一个端点，然后使用 continue 命令，我们的调试器将会运行程序到该断点。在这个断点这里，我们可以做一些打印变量值，设置变量值等的一些事情。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">break</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">10</span>
<span class="n">Breakpoint</span> <span class="m">1</span> <span class="n">set</span> <span class="n">at</span> <span class="mh">0x10d155d</span> <span class="n">for</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">10</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">continue</span>
<span class="o">&gt;</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">10</span> <span class="p">(</span><span class="n">hits</span> <span class="nf">goroutine</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">:</span><span class="m">1</span> <span class="n">total</span><span class="o">:</span><span class="m">1</span><span class="p">)</span> <span class="p">(</span><span class="n">PC</span><span class="o">:</span> <span class="mh">0x10d155d</span><span class="p">)</span>
    <span class="m">5</span><span class="o">:</span> <span class="n">var</span> <span class="n">m</span> <span class="o">=</span> <span class="nf">make</span><span class="p">(</span><span class="n">map[int]int</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
    <span class="m">6</span><span class="o">:</span>
    <span class="m">7</span><span class="o">:</span> <span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="m">8</span><span class="o">:</span>   <span class="n">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">range</span> <span class="n">[]int</span><span class="p">{</span><span class="m">5</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">98</span><span class="p">,</span> <span class="m">6</span><span class="p">}</span> <span class="p">{</span>
    <span class="m">9</span><span class="o">:</span>     <span class="n">x</span> <span class="o">:=</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="m">10</span><span class="o">:</span>     <span class="nf">fmt.Println</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s">&#34;fib&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
   <span class="m">11</span><span class="o">:</span>   <span class="p">}</span>
   <span class="m">12</span><span class="o">:</span> <span class="p">}</span>
   <span class="m">13</span><span class="o">:</span>
   <span class="m">14</span><span class="o">:</span> <span class="n">func</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span> <span class="n">int</span><span class="p">)</span> <span class="n">int</span> <span class="p">{</span>
   <span class="m">15</span><span class="o">:</span>   <span class="n">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="m">2</span> <span class="p">{</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="next">next</h3>
<p>运行到源代码的下一行。该命令在我们想对程序一步一步调试的时候非常有用。 例如，下面程序就是从断点开始，每次往前执行一行，无论下面有没有断点，每次都只运行一行。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">next</span>
<span class="m">5</span> <span class="n">fib</span> <span class="m">5</span>
<span class="o">&gt;</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">8</span> <span class="p">(</span><span class="n">PC</span><span class="o">:</span> <span class="mh">0x10d1693</span><span class="p">)</span>
   <span class="m">3</span><span class="o">:</span> <span class="n">import</span> <span class="s">&#34;fmt&#34;</span>
   <span class="m">4</span><span class="o">:</span>
   <span class="m">5</span><span class="o">:</span> <span class="n">var</span> <span class="n">m</span> <span class="o">=</span> <span class="nf">make</span><span class="p">(</span><span class="n">map[int]int</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
   <span class="m">6</span><span class="o">:</span>
   <span class="m">7</span><span class="o">:</span> <span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="o">=&gt;</span> <span class="m">8</span><span class="o">:</span>   <span class="n">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">range</span> <span class="n">[]int</span><span class="p">{</span><span class="m">5</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">98</span><span class="p">,</span> <span class="m">6</span><span class="p">}</span> <span class="p">{</span>
   <span class="m">9</span><span class="o">:</span>     <span class="n">x</span> <span class="o">:=</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
  <span class="m">10</span><span class="o">:</span>     <span class="nf">fmt.Println</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s">&#34;fib&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
  <span class="m">11</span><span class="o">:</span>   <span class="p">}</span>
  <span class="m">12</span><span class="o">:</span> <span class="p">}</span>
  <span class="m">13</span><span class="o">:</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="step">step</h3>
<p>step 命令用于告诉调试器进入到函数调用的内部，和 next 类似，但是当遇到函数调用时，step 命令会进入到被调用函数的内部，而 next 则将函数调用看成是一个语句。 例如，下面示例中，当执行到底 9 行的时候，next 则会计算 fib 函数的值，并进入到第 10 行。但 step 则会从第 9 行，直接进入到第 14 行的函数定义，然后逐步执行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">next</span>
<span class="o">&gt;</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">9</span> <span class="p">(</span><span class="n">hits</span> <span class="nf">goroutine</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">:</span><span class="m">3</span> <span class="n">total</span><span class="o">:</span><span class="m">3</span><span class="p">)</span> <span class="p">(</span><span class="n">PC</span><span class="o">:</span> <span class="mh">0x10a3228</span><span class="p">)</span>
<span class="n">Warning</span><span class="o">:</span> <span class="n">debugging</span> <span class="n">optimized</span> <span class="n">function</span>
<span class="n">Warning</span><span class="o">:</span> <span class="n">listing</span> <span class="n">may</span> <span class="n">not</span> <span class="n">match</span> <span class="n">stale</span> <span class="n">executable</span>
     <span class="m">4</span><span class="o">:</span>
     <span class="m">5</span><span class="o">:</span> <span class="n">var</span> <span class="n">m</span> <span class="o">=</span> <span class="nf">make</span><span class="p">(</span><span class="n">map[int]int</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
     <span class="m">6</span><span class="o">:</span>
     <span class="m">7</span><span class="o">:</span> <span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="m">8</span><span class="o">:</span>         <span class="n">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">range</span> <span class="n">[]int</span><span class="p">{</span><span class="m">5</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">98</span><span class="p">,</span> <span class="m">6</span><span class="p">}</span> <span class="p">{</span>
<span class="o">=&gt;</span>   <span class="m">9</span><span class="o">:</span>                 <span class="n">x</span> <span class="o">:=</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="m">10</span><span class="o">:</span>                 <span class="nf">fmt.Println</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s">&#34;fib&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="m">11</span><span class="o">:</span>         <span class="p">}</span>
    <span class="m">12</span><span class="o">:</span> <span class="p">}</span>
    <span class="m">13</span><span class="o">:</span>
    <span class="m">14</span><span class="o">:</span> <span class="n">func</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span> <span class="n">int</span><span class="p">)</span> <span class="n">int</span> <span class="p">{</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="stepout">stepout</h3>
<p>和 step 相对应，是 step 的反向操作。从被调用函数中返回调用函数。 例如，如下示例中，会返回到第 9 行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">stepout</span>
<span class="o">&gt;</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">9</span> <span class="p">(</span><span class="n">PC</span><span class="o">:</span> <span class="mh">0x10d1553</span><span class="p">)</span>
<span class="n">Values</span> <span class="n">returned</span><span class="o">:</span>
<span class="o">~</span><span class="n">r1</span><span class="o">:</span> <span class="m">1</span>
   <span class="m">4</span><span class="o">:</span>
   <span class="m">5</span><span class="o">:</span> <span class="n">var</span> <span class="n">m</span> <span class="o">=</span> <span class="nf">make</span><span class="p">(</span><span class="n">map[int]int</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
   <span class="m">6</span><span class="o">:</span>
   <span class="m">7</span><span class="o">:</span> <span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="m">8</span><span class="o">:</span>   <span class="n">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">range</span> <span class="n">[]int</span><span class="p">{</span><span class="m">5</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">98</span><span class="p">,</span> <span class="m">6</span><span class="p">}</span> <span class="p">{</span>
<span class="o">=&gt;</span> <span class="m">9</span><span class="o">:</span>     <span class="n">x</span> <span class="o">:=</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
  <span class="m">10</span><span class="o">:</span>     <span class="nf">fmt.Println</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s">&#34;fib&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
  <span class="m">11</span><span class="o">:</span>   <span class="p">}</span>
  <span class="m">12</span><span class="o">:</span> <span class="p">}</span>
  <span class="m">13</span><span class="o">:</span>
  <span class="m">14</span><span class="o">:</span> <span class="n">func</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span> <span class="n">int</span><span class="p">)</span> <span class="n">int</span> <span class="p">{</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="restart">restart</h3>
<p>该命令允许我们在程序终止或重新开始调试程序的时候，重启该程序，同时保留住之前所有设置过的断点。即之前设置过的断点不会丢失。</p>
<h2 id="查看当前状态的变量及表达式的值命令组">查看当前状态的变量及表达式的值命令组</h2>
<p>到目前为止，我们已经知道了如何添加并管理断点，如何控制程序的执行流程。现在，我们介绍如何查看、编辑程序变量和内存数据，这也是调试中最基础的部分。</p>
<h3 id="print">print</h3>
<p>Print 是最简单的查看变量内容和表达式的命令。例如如下，我们在文件的第 10 行设置了断点，然后用 continue 执行到断点处，然后使用 print 命令打印 x 变量的值，如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">break</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">10</span>
<span class="n">Breakpoint</span> <span class="m">1</span> <span class="n">set</span> <span class="n">at</span> <span class="mh">0x10d155d</span> <span class="n">for</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">10</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">continue</span>
<span class="o">&gt;</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">10</span> <span class="p">(</span><span class="n">hits</span> <span class="nf">goroutine</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">:</span><span class="m">1</span> <span class="n">total</span><span class="o">:</span><span class="m">1</span><span class="p">)</span> <span class="p">(</span><span class="n">PC</span><span class="o">:</span> <span class="mh">0x10d155d</span><span class="p">)</span>
    <span class="m">5</span><span class="o">:</span> <span class="n">var</span> <span class="n">m</span> <span class="o">=</span> <span class="nf">make</span><span class="p">(</span><span class="n">map[int]int</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
    <span class="m">6</span><span class="o">:</span>
    <span class="m">7</span><span class="o">:</span> <span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="m">8</span><span class="o">:</span>   <span class="n">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">range</span> <span class="n">[]int</span><span class="p">{</span><span class="m">5</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">98</span><span class="p">,</span> <span class="m">6</span><span class="p">}</span> <span class="p">{</span>
    <span class="m">9</span><span class="o">:</span>     <span class="n">x</span> <span class="o">:=</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="m">10</span><span class="o">:</span>     <span class="nf">fmt.Println</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s">&#34;fib&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
   <span class="m">11</span><span class="o">:</span>   <span class="p">}</span>
   <span class="m">12</span><span class="o">:</span> <span class="p">}</span>
   <span class="m">13</span><span class="o">:</span>
   <span class="m">14</span><span class="o">:</span> <span class="n">func</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span> <span class="n">int</span><span class="p">)</span> <span class="n">int</span> <span class="p">{</span>
   <span class="m">15</span><span class="o">:</span>   <span class="n">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="m">2</span> <span class="p">{</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">print</span> <span class="n">x</span>
<span class="m">5</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="locals">locals</h3>
<p>locals 命令用于打印出所有的局部变量及其值。 如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">list</span>
<span class="o">&gt;</span> <span class="nf">main.main</span><span class="p">()</span> <span class="n">./main.go</span><span class="o">:</span><span class="m">10</span> <span class="p">(</span><span class="n">hits</span> <span class="nf">goroutine</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">:</span><span class="m">1</span> <span class="n">total</span><span class="o">:</span><span class="m">1</span><span class="p">)</span> <span class="p">(</span><span class="n">PC</span><span class="o">:</span> <span class="mh">0x10d155d</span><span class="p">)</span>
    <span class="m">5</span><span class="o">:</span> <span class="n">var</span> <span class="n">m</span> <span class="o">=</span> <span class="nf">make</span><span class="p">(</span><span class="n">map[int]int</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
    <span class="m">6</span><span class="o">:</span>
    <span class="m">7</span><span class="o">:</span> <span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="m">8</span><span class="o">:</span>   <span class="n">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">range</span> <span class="n">[]int</span><span class="p">{</span><span class="m">5</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">98</span><span class="p">,</span> <span class="m">6</span><span class="p">}</span> <span class="p">{</span>
    <span class="m">9</span><span class="o">:</span>     <span class="n">x</span> <span class="o">:=</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="m">10</span><span class="o">:</span>     <span class="nf">fmt.Println</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s">&#34;fib&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
   <span class="m">11</span><span class="o">:</span>   <span class="p">}</span>
   <span class="m">12</span><span class="o">:</span> <span class="p">}</span>
   <span class="m">13</span><span class="o">:</span>
   <span class="m">14</span><span class="o">:</span> <span class="n">func</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span> <span class="n">int</span><span class="p">)</span> <span class="n">int</span> <span class="p">{</span>
   <span class="m">15</span><span class="o">:</span>   <span class="n">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="m">2</span> <span class="p">{</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">locals</span>
<span class="n">n</span> <span class="o">=</span> <span class="m">5</span>
<span class="n">x</span> <span class="o">=</span> <span class="m">5</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="stack">stack</h3>
<p>现在我们在 add() 函数处，可以使用 Delve 中的 stack 命令查看堆栈的当前内容。这显示了最上面的函数 add()，在我们所在的位置 0，接下来在位置 1 的是调用了 add() 函数的 main.main。main.main 下面的函数属于 Go 运行时，它负责加载和执行程序。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">stack</span>
<span class="m">0</span>  <span class="mh">0x00000000004a2280</span> <span class="n">in</span> <span class="n">main.add</span>
   <span class="n">at</span> <span class="n">./functions.go</span><span class="o">:</span><span class="m">5</span>
<span class="m">1</span>  <span class="mh">0x00000000004a22d7</span> <span class="n">in</span> <span class="n">main.main</span>
   <span class="n">at</span> <span class="n">./functions.go</span><span class="o">:</span><span class="m">10</span>
<span class="m">2</span>  <span class="mh">0x000000000042dd1f</span> <span class="n">in</span> <span class="n">runtime.main</span>
   <span class="n">at</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">golang</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">proc.go</span><span class="o">:</span><span class="m">200</span>
<span class="m">3</span>  <span class="mh">0x0000000000458171</span> <span class="n">in</span> <span class="n">runtime.goexit</span>
   <span class="n">at</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">golang</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">asm_amd64.s</span><span class="o">:</span><span class="m">1337</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="frame">frame</h3>
<p>使用 Delve 中的 frame 命令，我们可以在上述帧之间自由切换。在下面的示例中，使用 frame 1 将会让我们从 add() 帧切换到 main.main 帧，依此类推。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">frame</span> <span class="m">0</span>
<span class="o">&gt;</span> <span class="nf">main.add</span><span class="p">()</span> <span class="n">./functions.go</span><span class="o">:</span><span class="m">5</span> <span class="p">(</span><span class="n">hits</span> <span class="nf">goroutine</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">:</span><span class="m">1</span> <span class="n">total</span><span class="o">:</span><span class="m">1</span><span class="p">)</span> <span class="p">(</span><span class="n">PC</span><span class="o">:</span> <span class="mh">0x4a2280</span><span class="p">)</span>
<span class="n">Frame</span> <span class="m">0</span><span class="o">:</span> <span class="n">./functions.go</span><span class="o">:</span><span class="m">5</span> <span class="p">(</span><span class="n">PC</span><span class="o">:</span> <span class="m">4</span><span class="n">a2280</span><span class="p">)</span>
     <span class="m">1</span><span class="o">:</span> <span class="n">package</span> <span class="n">main</span>
     <span class="m">2</span><span class="o">:</span>
     <span class="m">3</span><span class="o">:</span> <span class="n">import</span> <span class="s">&#34;fmt&#34;</span>
     <span class="m">4</span><span class="o">:</span>
<span class="o">=&gt;</span>   <span class="m">5</span><span class="o">:</span>      <span class="n">func</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span> <span class="n">int</span><span class="p">,</span> <span class="n">y</span> <span class="n">int</span><span class="p">)</span> <span class="n">int</span> <span class="p">{</span>
     <span class="m">6</span><span class="o">:</span>         <span class="n">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
     <span class="m">7</span><span class="o">:</span> <span class="p">}</span>
     <span class="m">8</span><span class="o">:</span>
     <span class="m">9</span><span class="o">:</span> <span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="m">10</span><span class="o">:</span>         <span class="nf">fmt.Println</span><span class="p">(</span><span class="nf">add</span><span class="p">(</span><span class="m">42</span><span class="p">,</span> <span class="m">13</span><span class="p">))</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">frame</span> <span class="m">1</span>
<span class="o">&gt;</span> <span class="nf">main.add</span><span class="p">()</span> <span class="n">./functions.go</span><span class="o">:</span><span class="m">5</span> <span class="p">(</span><span class="n">hits</span> <span class="nf">goroutine</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">:</span><span class="m">1</span> <span class="n">total</span><span class="o">:</span><span class="m">1</span><span class="p">)</span> <span class="p">(</span><span class="n">PC</span><span class="o">:</span> <span class="mh">0x4a2280</span><span class="p">)</span>
<span class="n">Frame</span> <span class="m">1</span><span class="o">:</span> <span class="n">./functions.go</span><span class="o">:</span><span class="m">10</span> <span class="p">(</span><span class="n">PC</span><span class="o">:</span> <span class="m">4</span><span class="n">a22d7</span><span class="p">)</span>
     <span class="m">5</span><span class="o">:</span> <span class="n">func</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span> <span class="n">int</span><span class="p">,</span> <span class="n">y</span> <span class="n">int</span><span class="p">)</span> <span class="n">int</span> <span class="p">{</span>
     <span class="m">6</span><span class="o">:</span>         <span class="n">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
     <span class="m">7</span><span class="o">:</span> <span class="p">}</span>
     <span class="m">8</span><span class="o">:</span>
     <span class="m">9</span><span class="o">:</span> <span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="o">=&gt;</span>  <span class="m">10</span><span class="o">:</span>              <span class="nf">fmt.Println</span><span class="p">(</span><span class="nf">add</span><span class="p">(</span><span class="m">42</span><span class="p">,</span> <span class="m">13</span><span class="p">))</span>
    <span class="m">11</span><span class="o">:</span> <span class="p">}</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="args">args</h3>
<p>函数通常接受多个参数来处理。对于 add() 函数，它接受两个整数。Delve 有一个名为 args 的便捷命令，它可以显示传递给函数的命令行参数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">args</span>
<span class="n">x</span> <span class="o">=</span> <span class="m">42</span>
<span class="n">y</span> <span class="o">=</span> <span class="m">13</span>
<span class="o">~</span><span class="n">r2</span> <span class="o">=</span> <span class="m">824633786832</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="disassemble">disassemble</h3>
<p>因为我们处理的是编译后的二进制文件，所以能够看到编译器生成的汇编语言指令是非常有帮助的。Delve 提供了一个 disassemble 命令来查看这些。在下面的示例中，我们使用它来查看 add() 函数的反汇编指令。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">step</span>
<span class="o">&gt;</span> <span class="nf">main.add</span><span class="p">()</span> <span class="n">./functions.go</span><span class="o">:</span><span class="m">5</span> <span class="p">(</span><span class="n">PC</span><span class="o">:</span> <span class="mh">0x4a2280</span><span class="p">)</span>
     <span class="m">1</span><span class="o">:</span> <span class="n">package</span> <span class="n">main</span>
     <span class="m">2</span><span class="o">:</span>
     <span class="m">3</span><span class="o">:</span> <span class="n">import</span> <span class="s">&#34;fmt&#34;</span>
     <span class="m">4</span><span class="o">:</span>
<span class="o">=&gt;</span>   <span class="m">5</span><span class="o">:</span>      <span class="n">func</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span> <span class="n">int</span><span class="p">,</span> <span class="n">y</span> <span class="n">int</span><span class="p">)</span> <span class="n">int</span> <span class="p">{</span>
     <span class="m">6</span><span class="o">:</span>         <span class="n">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
     <span class="m">7</span><span class="o">:</span> <span class="p">}</span>
     <span class="m">8</span><span class="o">:</span>
     <span class="m">9</span><span class="o">:</span> <span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="m">10</span><span class="o">:</span>         <span class="nf">fmt.Println</span><span class="p">(</span><span class="nf">add</span><span class="p">(</span><span class="m">42</span><span class="p">,</span> <span class="m">13</span><span class="p">))</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">disassemble</span>
<span class="n">TEXT</span> <span class="nf">main.add</span><span class="p">(</span><span class="n">SB</span><span class="p">)</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">go</span><span class="o">/</span><span class="n">gobin</span><span class="o">/</span><span class="n">functions.go</span>
<span class="o">=&gt;</span>   <span class="n">functions.go</span><span class="o">:</span><span class="m">5</span>  <span class="mh">0x4a2280</span>   <span class="m">48</span><span class="n">c744241800000000</span>   <span class="n">mov</span> <span class="n">qword</span> <span class="n">ptr</span> <span class="n">[rsp</span><span class="m">+0</span><span class="n">x18]</span><span class="p">,</span> <span class="mh">0x0</span>
        <span class="n">functions.go</span><span class="o">:</span><span class="m">6</span>  <span class="mh">0x4a2289</span>   <span class="m">488</span><span class="n">b442408</span>           <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="n">ptr</span> <span class="n">[rsp</span><span class="m">+0</span><span class="n">x8]</span>
        <span class="n">functions.go</span><span class="o">:</span><span class="m">6</span>  <span class="mh">0x4a228e</span>   <span class="m">4803442410</span>           <span class="n">add</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="n">ptr</span> <span class="n">[rsp</span><span class="m">+0</span><span class="n">x10]</span>
        <span class="n">functions.go</span><span class="o">:</span><span class="m">6</span>  <span class="mh">0x4a2293</span>   <span class="m">4889442418</span>           <span class="n">mov</span> <span class="n">qword</span> <span class="n">ptr</span> <span class="n">[rsp</span><span class="m">+0</span><span class="n">x18]</span><span class="p">,</span> <span class="n">rax</span>
        <span class="n">functions.go</span><span class="o">:</span><span class="m">6</span>  <span class="mh">0x4a2298</span>   <span class="n">c3</span>                   <span class="nf">ret
</span><span class="nf"></span><span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="结论">结论</h2>
<p>本文中，我们介绍了 4 组相关的命令：</p>
<ul>
<li>查看源代码命令：list、func 以及推出 exit</li>
<li>添加断点以及管理断点：break、breakpoints、clear、clearall</li>
<li>控制程序流程的命令：continue、next、step、stepout、restart</li>
<li>查看当前变量的命令：print、locals,args,stack,disassemble</li>
</ul>
<p>通过以上命令，通过查看源码，设置断点、执行到断点、输出当前的变量状态，满足了最基本的程序执行的需要。</p>
<h2 id="参考">参考</h2>
<p><a href="https://gocn.vip/topics/12090">使用 Delve 工具调试 Golang 程序</a></p>
<p><a href="https://learnku.com/go/t/47071">停止使用 Println 并改用 Delve 来调试 Go 代码</a></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Forz</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2021-05-22
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/delve/">Delve</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/go%E4%B8%AD%E7%9A%84happens-before/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Go中的happens-before</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E5%88%86%E5%B8%83%E5%BC%8F%E9%99%90%E6%B5%81%E5%AE%9E%E7%8E%B0/">
            <span class="next-text nav-default">分布式限流实现</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="forz/forzblog.talk"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span>Forz</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>






<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
docsearch({
    apiKey: "b4b9da2eba53aa6dabe4b8ac9e8676e1",
    indexName: "forz.forzvina.com",
    appId: "IAR2EF5L65",
    inputSelector: '.docsearch-input',
    debug: false,
});
</script>
</body>
</html>
