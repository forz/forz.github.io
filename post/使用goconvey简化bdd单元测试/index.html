<!DOCTYPE html>
<html lang="zh-cn" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>使用goconvey简化BDD单元测试 | Forz Blog</title>
<meta name="keywords" content="Go, goconvey" />
<meta name="description" content="GoConvey简介 GoConvey是一款针对Golang的测试框架，可以管理和运行测试用例，同时提供了丰富的断言函数，并支持很多 Web 界面特性">
<meta name="author" content="">
<link rel="canonical" href="/post/%E4%BD%BF%E7%94%A8goconvey%E7%AE%80%E5%8C%96bdd%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.00d5d4fc479b1575183ee8d86b4fb372ba9d9b1904e96fa8e4c40ff7debe2b94.css" integrity="sha256-ANXU/EebFXUYPujYa0&#43;zcrqdmxkE6W&#43;o5MQP996&#43;K5Q=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.87.0" />
<meta property="og:title" content="使用goconvey简化BDD单元测试" />
<meta property="og:description" content="GoConvey简介 GoConvey是一款针对Golang的测试框架，可以管理和运行测试用例，同时提供了丰富的断言函数，并支持很多 Web 界面特性" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/%E4%BD%BF%E7%94%A8goconvey%E7%AE%80%E5%8C%96bdd%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-01-05T22:11:30&#43;00:00" />
<meta property="article:modified_time" content="2020-01-05T22:11:30&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="使用goconvey简化BDD单元测试"/>
<meta name="twitter:description" content="GoConvey简介 GoConvey是一款针对Golang的测试框架，可以管理和运行测试用例，同时提供了丰富的断言函数，并支持很多 Web 界面特性"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "/post/"
    }
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "使用goconvey简化BDD单元测试",
      "item": "/post/%E4%BD%BF%E7%94%A8goconvey%E7%AE%80%E5%8C%96bdd%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "使用goconvey简化BDD单元测试",
  "name": "使用goconvey简化BDD单元测试",
  "description": "GoConvey简介 GoConvey是一款针对Golang的测试框架，可以管理和运行测试用例，同时提供了丰富的断言函数，并支持很多 Web 界面特性",
  "keywords": [
    "Go", "goconvey"
  ],
  "articleBody": "GoConvey简介 GoConvey是一款针对Golang的测试框架，可以管理和运行测试用例，同时提供了丰富的断言函数，并支持很多 Web 界面特性。\nGolang虽然自带了单元测试功能，并且在GoConvey框架诞生之前也出现了许多第三方测试框架，但没有一个测试框架像GoConvey一样能够让程序员如此简洁优雅的编写测试代码。\n基本使用方法 我们通过一个案例来介绍GoConvey框架的基本使用方法，并对要点进行归纳。\n产品代码 我们实现一个判断两个字符串切片是否相等的函数StringSliceEqual，主要逻辑包括：\n 两个字符串切片长度不相等时，返回false 两个字符串切片一个是nil，另一个不是nil时，返回false 遍历两个切片，比较对应索引的两个切片元素值，如果不相等，返回false 否则，返回true  根据上面的逻辑，代码实现如下所示：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  func StringSliceEqual(a, b []string) bool { if len(a) != len(b) { return false } if (a == nil) != (b == nil) { return false } for i, v := range a { if v != b[i] { return false } } return true }   对于逻辑“两个字符串切片一个是nil，另一个不是nil时，返回false”的实现代码有点不好理解：\n1 2 3  if (a == nil) != (b == nil) { return false }   我们实例化一下a和b，即[]string{}和[]string(nil)，这时两个字符串切片的长度都是0，但肯定不相等。\n测试代码 先写一个正常情况的测试用例，如下所示：\n1 2 3 4 5 6 7 8 9 10 11 12  import ( \"testing\" . \"github.com/smartystreets/goconvey/convey\" ) func TestStringSliceEqual(t *testing.T) { Convey(\"TestStringSliceEqual should return true when a != nil \u0026\u0026 b != nil\", t, func() { a := []string{\"hello\", \"goconvey\"} b := []string{\"hello\", \"goconvey\"} So(StringSliceEqual(a, b), ShouldBeTrue) }) }   由于GoConvey框架兼容Golang原生的单元测试，所以可以使用go test -v来运行测试。\n打开命令行，进入$GOPATH/src/infra/alg目录下，运行go test -v，则测试用例的执行结果如下：\n1 2 3 4 5 6 7 8 9 10  === RUN TestStringSliceEqual TestStringSliceEqual should return true when a != nil \u0026\u0026 b != nil ✔ 1 total assertion --- PASS: TestStringSliceEqual (0.00s) PASS ok infra/alg 0.006s   上面的测试用例代码有如下几个要点：\n import goconvey包时，前面加点号\".\"，以减少冗余的代码。凡是在测试代码中看到Convey和So两个方法，肯定是convey包的，不要在产品代码中定义相同的函数名 测试函数的名字必须以Test开头，而且参数类型必须为*testing.T 每个测试用例必须使用Convey函数包裹起来，它的第一个参数为string类型的测试描述，第二个参数为测试函数的入参（类型为*testing.T），第三个参数为不接收任何参数也不返回任何值的函数（习惯使用闭包） Convey函数的第三个参数闭包的实现中通过So函数完成断言判断，它的第一个参数为实际值，第二个参数为断言函数变量，第三个参数或者没有（当第二个参数为类ShouldBeTrue形式的函数变量）或者有（当第二个函数为类ShouldEqual形式的函数变量）  我们故意将该测试用例改为不过：\n1 2 3 4 5 6 7 8 9 10 11 12  import ( \"testing\" . \"github.com/smartystreets/goconvey/convey\" ) func TestStringSliceEqual(t *testing.T) { Convey(\"TestStringSliceEqual should return true when a != nil \u0026\u0026 b != nil\", t, func() { a := []string{\"hello\", \"goconvey\"} b := []string{\"hello\", \"goconvey\"} So(StringSliceEqual(a, b), ShouldBeFalse) }) }   测试用例的执行结果日下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  === RUN TestStringSliceEqual TestStringSliceEqual should return true when a != nil \u0026\u0026 b != nil ✘ Failures: * /Users/zhangxiaolong/Desktop/D/go-workspace/src/infra/alg/slice_test.go Line 45: Expected: false Actual: true 1 total assertion --- FAIL: TestStringSliceEqual (0.00s) FAIL exit status 1 FAIL infra/alg 0.006s   我们再补充3个测试用例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  import ( \"testing\" . \"github.com/smartystreets/goconvey/convey\" ) func TestStringSliceEqual(t *testing.T) { Convey(\"TestStringSliceEqual should return true when a != nil \u0026\u0026 b != nil\", t, func() { a := []string{\"hello\", \"goconvey\"} b := []string{\"hello\", \"goconvey\"} So(StringSliceEqual(a, b), ShouldBeTrue) }) Convey(\"TestStringSliceEqual should return true when a ＝= nil \u0026\u0026 b ＝= nil\", t, func() { So(StringSliceEqual(nil, nil), ShouldBeTrue) }) Convey(\"TestStringSliceEqual should return false when a ＝= nil \u0026\u0026 b != nil\", t, func() { a := []string(nil) b := []string{} So(StringSliceEqual(a, b), ShouldBeFalse) }) Convey(\"TestStringSliceEqual should return false when a != nil \u0026\u0026 b != nil\", t, func() { a := []string{\"hello\", \"world\"} b := []string{\"hello\", \"goconvey\"} So(StringSliceEqual(a, b), ShouldBeFalse) }) }   从上面的测试代码可以看出，每一个Convey语句对应一个测试用例，那么一个函数的多个测试用例可以通过一个测试函数的多个Convey语句来呈现。\n测试用例的执行结果如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  === RUN TestStringSliceEqual TestStringSliceEqual should return true when a != nil \u0026\u0026 b != nil ✔ 1 total assertion TestStringSliceEqual should return true when a ＝= nil \u0026\u0026 b ＝= nil ✔ 2 total assertions TestStringSliceEqual should return false when a ＝= nil \u0026\u0026 b != nil ✔ 3 total assertions TestStringSliceEqual should return false when a != nil \u0026\u0026 b != nil ✔ 4 total assertions --- PASS: TestStringSliceEqual (0.00s) PASS ok infra/alg 0.006s   Convey语句的嵌套 Convey语句可以无限嵌套，以体现测试用例之间的关系。需要注意的是，只有最外层的Convey需要传入*testing.T类型的变量t。\n我们将前面的测试用例通过嵌套的方式写另一个版本：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  import ( \"testing\" . \"github.com/smartystreets/goconvey/convey\" ) func TestStringSliceEqual(t *testing.T) { Convey(\"TestStringSliceEqual\", t, func() { Convey(\"should return true when a != nil \u0026\u0026 b != nil\", func() { a := []string{\"hello\", \"goconvey\"} b := []string{\"hello\", \"goconvey\"} So(StringSliceEqual(a, b), ShouldBeTrue) }) Convey(\"should return true when a ＝= nil \u0026\u0026 b ＝= nil\", func() { So(StringSliceEqual(nil, nil), ShouldBeTrue) }) Convey(\"should return false when a ＝= nil \u0026\u0026 b != nil\", func() { a := []string(nil) b := []string{} So(StringSliceEqual(a, b), ShouldBeFalse) }) Convey(\"should return false when a != nil \u0026\u0026 b != nil\", func() { a := []string{\"hello\", \"world\"} b := []string{\"hello\", \"goconvey\"} So(StringSliceEqual(a, b), ShouldBeFalse) }) }) }   测试用例的执行结果如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  === RUN TestStringSliceEqual TestStringSliceEqual should return true when a != nil \u0026\u0026 b != nil ✔ should return true when a ＝= nil \u0026\u0026 b ＝= nil ✔ should return false when a ＝= nil \u0026\u0026 b != nil ✔ should return false when a != nil \u0026\u0026 b != nil ✔ 4 total assertions --- PASS: TestStringSliceEqual (0.00s) PASS ok infra/alg 0.006s   可见，Convey语句嵌套的测试日志和Convey语句不嵌套的测试日志的显示有差异，笔者更喜欢这种以测试函数为单位多个测试用例集中显示的形式。\nWeb 界面 GoConvey不仅支持在命令行进行自动化编译测试，而且还支持在 Web 界面进行自动化编译测试。想要使用GoConvey的 Web 界面特性，需要在测试文件所在目录下执行goconvey：\n1  $GOPATH/bin/goconvey   这时弹出一个页面，如下图所示：\n在 Web 界面中:\n 可以设置界面主题 查看完整的测试结果 使用浏览器提醒等实用功能 自动检测代码变动并编译测试 半自动化书写测试用例 查看测试覆盖率 临时屏蔽某个包的编译测试  Skip 针对想忽略但又不想删掉或注释掉某些断言操作，GoConvey提供了Convey/So的Skip方法：\n SkipConvey函数表明相应的闭包函数将不被执行 SkipSo函数表明相应的断言将不被执行  当存在SkipConvey或SkipSo时，测试日志中会显式打上\"skipped\"形式的标记：\n 当测试代码中存在SkipConvey时，相应闭包函数中不管是否为SkipSo，都将被忽略，测试日志中对应的符号仅为一个\"⚠\" 当测试代码Convey语句中存在SkipSo时，测试日志中每个So对应一个\"✔\"或\"✘\"，每个SkipSo对应一个\"⚠\"，按实际顺序排列 不管存在SkipConvey还是SkipSo时，测试日志中都有字符串\"{n} total assertions (one or more sections skipped)\"，其中{n}表示测试中实际已运行的断言语句数  定制断言函数 我们先看一下So的函数原型：\n1  func So(actual interface{}, assert assertion, expected ...interface{})   第二个参数为assertion，它的原型为：\n1  type assertion func(actual interface{}, expected ...interface{}) string   当assertion的返回值为\"“时表示断言成功，否则表示失败，GoConvey框架中的相关代码为：\n1 2 3 4 5  const ( success = \"\" needExactValues = \"This assertion requires exactly %d comparison values (you provided %d).\" needNonEmptyCollection = \"This assertion requires at least 1 comparison value (you provided 0).\" )   我们简单实现一个assertion函数：\n1 2 3 4 5 6 7  func ShouldSummerBeComming(actual interface{}, expected ...interface{}) string { if actual == \"summer\" \u0026\u0026 expected[0] == \"comming\" { return \"\" } else { return \"summer is not comming!\" } }   我们仍然在slice_test文件中写一个简单测试：\n1 2 3 4 5 6  func TestSummer(t *testing.T) { Convey(\"TestSummer\", t, func() { So(\"summer\", ShouldSummerBeComming, \"comming\") So(\"winter\", ShouldSummerBeComming, \"comming\") }) }   根据ShouldSummerBeComming的实现，Convey语句中第一个So将断言成功，第二个So将断言失败。 我们运行测试，查看执行结果，符合期望：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  === RUN TestSummer TestSummer ✔✘ Failures: * /Users/zhangxiaolong/Desktop/D/go-workspace/src/infra/alg/slice_test.go Line 52: summer is not comming! 2 total assertions --- FAIL: TestSummer (0.00s) FAIL exit status 1 FAIL infra/alg 0.006s   ",
  "wordCount" : "2994",
  "inLanguage": "zh-cn",
  "datePublished": "2020-01-05T22:11:30Z",
  "dateModified": "2020-01-05T22:11:30Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/%E4%BD%BF%E7%94%A8goconvey%E7%AE%80%E5%8C%96bdd%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Forz Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="Forz Blog (Alt + H)">Forz Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="/post/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      使用goconvey简化BDD单元测试
    </h1>
    <div class="post-meta">January 5, 2020
</div>
  </header> 
  <div class="post-content"><h1 id="goconvey简介">GoConvey简介<a hidden class="anchor" aria-hidden="true" href="#goconvey简介">#</a></h1>
<p>GoConvey是一款针对Golang的测试框架，可以管理和运行测试用例，同时提供了丰富的断言函数，并支持很多 Web 界面特性。</p>
<p>Golang虽然自带了单元测试功能，并且在GoConvey框架诞生之前也出现了许多第三方测试框架，但没有一个测试框架像GoConvey一样能够让程序员如此简洁优雅的编写测试代码。</p>
<h1 id="基本使用方法">基本使用方法<a hidden class="anchor" aria-hidden="true" href="#基本使用方法">#</a></h1>
<p>我们通过一个案例来介绍GoConvey框架的基本使用方法，并对要点进行归纳。</p>
<h2 id="产品代码">产品代码<a hidden class="anchor" aria-hidden="true" href="#产品代码">#</a></h2>
<p>我们实现一个判断两个字符串切片是否相等的函数<code>StringSliceEqual</code>，主要逻辑包括：</p>
<ul>
<li>两个字符串切片长度不相等时，返回false</li>
<li>两个字符串切片一个是nil，另一个不是nil时，返回false</li>
<li>遍历两个切片，比较对应索引的两个切片元素值，如果不相等，返回false</li>
<li>否则，返回true</li>
</ul>
<p>根据上面的逻辑，代码实现如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">StringSliceEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">==</span> <span class="kc">nil</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="nx">b</span> <span class="o">==</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">a</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">v</span> <span class="o">!=</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>对于逻辑“两个字符串切片一个是nil，另一个不是nil时，返回false”的实现代码有点不好理解：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">==</span> <span class="kc">nil</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="nx">b</span> <span class="o">==</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>我们实例化一下a和b，即<code>[]string{}</code>和<code>[]string(nil)</code>，这时两个字符串切片的长度都是0，但肯定不相等。</p>
<h2 id="测试代码">测试代码<a hidden class="anchor" aria-hidden="true" href="#测试代码">#</a></h2>
<p>先写一个正常情况的测试用例，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;testing&#34;</span>
    <span class="p">.</span> <span class="s">&#34;github.com/smartystreets/goconvey/convey&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">TestStringSliceEqual</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">Convey</span><span class="p">(</span><span class="s">&#34;TestStringSliceEqual should return true when a != nil  &amp;&amp; b != nil&#34;</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">a</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;goconvey&#34;</span><span class="p">}</span>
        <span class="nx">b</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;goconvey&#34;</span><span class="p">}</span>
        <span class="nf">So</span><span class="p">(</span><span class="nf">StringSliceEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">),</span> <span class="nx">ShouldBeTrue</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>由于GoConvey框架兼容Golang原生的单元测试，所以可以使用<code>go test -v</code>来运行测试。</p>
<p>打开命令行，进入<code>$GOPATH/src/infra/alg</code>目录下，运行<code>go test -v</code>，则测试用例的执行结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">=== RUN   TestStringSliceEqual

  TestStringSliceEqual should return true when a != nil  &amp;&amp; b != nil ✔


1 total assertion

--- PASS: TestStringSliceEqual (0.00s)
PASS
ok      infra/alg       0.006s
</code></pre></td></tr></table>
</div>
</div><p>上面的测试用例代码有如下几个要点：</p>
<ul>
<li>import goconvey包时，前面加点号&quot;.&quot;，以减少冗余的代码。凡是在测试代码中看到Convey和So两个方法，肯定是convey包的，不要在产品代码中定义相同的函数名</li>
<li>测试函数的名字必须以Test开头，而且参数类型必须为*testing.T</li>
<li>每个测试用例必须使用Convey函数包裹起来，它的第一个参数为string类型的测试描述，第二个参数为测试函数的入参（类型为*testing.T），第三个参数为不接收任何参数也不返回任何值的函数（习惯使用闭包）</li>
<li>Convey函数的第三个参数闭包的实现中通过So函数完成断言判断，它的第一个参数为实际值，第二个参数为断言函数变量，第三个参数或者没有（当第二个参数为类ShouldBeTrue形式的函数变量）或者有（当第二个函数为类ShouldEqual形式的函数变量）</li>
</ul>
<p>我们故意将该测试用例改为不过：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;testing&#34;</span>
    <span class="p">.</span> <span class="s">&#34;github.com/smartystreets/goconvey/convey&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">TestStringSliceEqual</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">Convey</span><span class="p">(</span><span class="s">&#34;TestStringSliceEqual should return true when a != nil  &amp;&amp; b != nil&#34;</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">a</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;goconvey&#34;</span><span class="p">}</span>
        <span class="nx">b</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;goconvey&#34;</span><span class="p">}</span>
        <span class="nf">So</span><span class="p">(</span><span class="nf">StringSliceEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">),</span> <span class="nx">ShouldBeFalse</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>测试用例的执行结果日下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">=== RUN   TestStringSliceEqual

  TestStringSliceEqual should return true when a != nil  &amp;&amp; b != nil ✘


Failures:

  * /Users/zhangxiaolong/Desktop/D/go-workspace/src/infra/alg/slice_test.go 
  Line 45:
  Expected: false
  Actual:   true


1 total assertion

--- FAIL: TestStringSliceEqual (0.00s)
FAIL
exit status 1
FAIL    infra/alg       0.006s
</code></pre></td></tr></table>
</div>
</div><p>我们再补充3个测试用例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;testing&#34;</span>
    <span class="p">.</span> <span class="s">&#34;github.com/smartystreets/goconvey/convey&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">TestStringSliceEqual</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">Convey</span><span class="p">(</span><span class="s">&#34;TestStringSliceEqual should return true when a != nil  &amp;&amp; b != nil&#34;</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">a</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;goconvey&#34;</span><span class="p">}</span>
        <span class="nx">b</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;goconvey&#34;</span><span class="p">}</span>
        <span class="nf">So</span><span class="p">(</span><span class="nf">StringSliceEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">),</span> <span class="nx">ShouldBeTrue</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="nf">Convey</span><span class="p">(</span><span class="s">&#34;TestStringSliceEqual should return true when a ＝= nil  &amp;&amp; b ＝= nil&#34;</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">So</span><span class="p">(</span><span class="nf">StringSliceEqual</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span><span class="p">),</span> <span class="nx">ShouldBeTrue</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="nf">Convey</span><span class="p">(</span><span class="s">&#34;TestStringSliceEqual should return false when a ＝= nil  &amp;&amp; b != nil&#34;</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">a</span> <span class="o">:=</span> <span class="p">[]</span><span class="nb">string</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
        <span class="nx">b</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{}</span>
        <span class="nf">So</span><span class="p">(</span><span class="nf">StringSliceEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">),</span> <span class="nx">ShouldBeFalse</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="nf">Convey</span><span class="p">(</span><span class="s">&#34;TestStringSliceEqual should return false when a != nil  &amp;&amp; b != nil&#34;</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">a</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;world&#34;</span><span class="p">}</span>
        <span class="nx">b</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;goconvey&#34;</span><span class="p">}</span>
        <span class="nf">So</span><span class="p">(</span><span class="nf">StringSliceEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">),</span> <span class="nx">ShouldBeFalse</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>从上面的测试代码可以看出，每一个Convey语句对应一个测试用例，那么一个函数的多个测试用例可以通过一个测试函数的多个Convey语句来呈现。</p>
<p>测试用例的执行结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">=== RUN   TestStringSliceEqual

  TestStringSliceEqual should return true when a != nil  &amp;&amp; b != nil ✔


1 total assertion


  TestStringSliceEqual should return true when a ＝= nil  &amp;&amp; b ＝= nil ✔


2 total assertions


  TestStringSliceEqual should return false when a ＝= nil  &amp;&amp; b != nil ✔


3 total assertions


  TestStringSliceEqual should return false when a != nil  &amp;&amp; b != nil ✔


4 total assertions

--- PASS: TestStringSliceEqual (0.00s)
PASS
ok      infra/alg       0.006s
</code></pre></td></tr></table>
</div>
</div><h1 id="convey语句的嵌套">Convey语句的嵌套<a hidden class="anchor" aria-hidden="true" href="#convey语句的嵌套">#</a></h1>
<p>Convey语句可以无限嵌套，以体现测试用例之间的关系。需要注意的是，只有最外层的Convey需要传入*testing.T类型的变量t。</p>
<p>我们将前面的测试用例通过嵌套的方式写另一个版本：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;testing&#34;</span>
    <span class="p">.</span> <span class="s">&#34;github.com/smartystreets/goconvey/convey&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">TestStringSliceEqual</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">Convey</span><span class="p">(</span><span class="s">&#34;TestStringSliceEqual&#34;</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">Convey</span><span class="p">(</span><span class="s">&#34;should return true when a != nil  &amp;&amp; b != nil&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">a</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;goconvey&#34;</span><span class="p">}</span>
            <span class="nx">b</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;goconvey&#34;</span><span class="p">}</span>
            <span class="nf">So</span><span class="p">(</span><span class="nf">StringSliceEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">),</span> <span class="nx">ShouldBeTrue</span><span class="p">)</span>
        <span class="p">})</span>

        <span class="nf">Convey</span><span class="p">(</span><span class="s">&#34;should return true when a ＝= nil  &amp;&amp; b ＝= nil&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nf">So</span><span class="p">(</span><span class="nf">StringSliceEqual</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span><span class="p">),</span> <span class="nx">ShouldBeTrue</span><span class="p">)</span>
        <span class="p">})</span>

        <span class="nf">Convey</span><span class="p">(</span><span class="s">&#34;should return false when a ＝= nil  &amp;&amp; b != nil&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">a</span> <span class="o">:=</span> <span class="p">[]</span><span class="nb">string</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
            <span class="nx">b</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{}</span>
            <span class="nf">So</span><span class="p">(</span><span class="nf">StringSliceEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">),</span> <span class="nx">ShouldBeFalse</span><span class="p">)</span>
        <span class="p">})</span>

        <span class="nf">Convey</span><span class="p">(</span><span class="s">&#34;should return false when a != nil  &amp;&amp; b != nil&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">a</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;world&#34;</span><span class="p">}</span>
            <span class="nx">b</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;goconvey&#34;</span><span class="p">}</span>
            <span class="nf">So</span><span class="p">(</span><span class="nf">StringSliceEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">),</span> <span class="nx">ShouldBeFalse</span><span class="p">)</span>
        <span class="p">})</span>
    <span class="p">})</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>测试用例的执行结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">=== RUN   TestStringSliceEqual

  TestStringSliceEqual 
    should return true when a != nil  &amp;&amp; b != nil ✔
    should return true when a ＝= nil  &amp;&amp; b ＝= nil ✔
    should return false when a ＝= nil  &amp;&amp; b != nil ✔
    should return false when a != nil  &amp;&amp; b != nil ✔


4 total assertions

--- PASS: TestStringSliceEqual (0.00s)
PASS
ok      infra/alg       0.006s
</code></pre></td></tr></table>
</div>
</div><p>可见，Convey语句嵌套的测试日志和Convey语句不嵌套的测试日志的显示有差异，笔者更喜欢这种以测试函数为单位多个测试用例集中显示的形式。</p>
<h1 id="web-界面">Web 界面<a hidden class="anchor" aria-hidden="true" href="#web-界面">#</a></h1>
<p>GoConvey不仅支持在命令行进行自动化编译测试，而且还支持在 Web 界面进行自动化编译测试。想要使用GoConvey的 Web 界面特性，需要在测试文件所在目录下执行goconvey：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">$GOPATH/bin/goconvey
</code></pre></td></tr></table>
</div>
</div><p>这时弹出一个页面，如下图所示：</p>
<p><img loading="lazy" src="https://blog-1257321977.cos.ap-beijing.myqcloud.com/20200105223402.png" alt=""  />
</p>
<p>在 Web 界面中:</p>
<ul>
<li>可以设置界面主题</li>
<li>查看完整的测试结果</li>
<li>使用浏览器提醒等实用功能</li>
<li>自动检测代码变动并编译测试</li>
<li>半自动化书写测试用例</li>
<li>查看测试覆盖率</li>
<li>临时屏蔽某个包的编译测试</li>
</ul>
<h1 id="skip">Skip<a hidden class="anchor" aria-hidden="true" href="#skip">#</a></h1>
<p>针对想忽略但又不想删掉或注释掉某些断言操作，GoConvey提供了Convey/So的Skip方法：</p>
<ul>
<li>SkipConvey函数表明相应的闭包函数将不被执行</li>
<li>SkipSo函数表明相应的断言将不被执行</li>
</ul>
<p>当存在SkipConvey或SkipSo时，测试日志中会显式打上&quot;skipped&quot;形式的标记：</p>
<ul>
<li>当测试代码中存在SkipConvey时，相应闭包函数中不管是否为SkipSo，都将被忽略，测试日志中对应的符号仅为一个&quot;⚠&quot;</li>
<li>当测试代码Convey语句中存在SkipSo时，测试日志中每个So对应一个&quot;✔&quot;或&quot;✘&quot;，每个SkipSo对应一个&quot;⚠&quot;，按实际顺序排列</li>
<li>不管存在SkipConvey还是SkipSo时，测试日志中都有字符串&quot;{n} total assertions (one or more sections skipped)&quot;，其中{n}表示测试中实际已运行的断言语句数</li>
</ul>
<h1 id="定制断言函数">定制断言函数<a hidden class="anchor" aria-hidden="true" href="#定制断言函数">#</a></h1>
<p>我们先看一下So的函数原型：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">So</span><span class="p">(</span><span class="nx">actual</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">assert</span> <span class="nx">assertion</span><span class="p">,</span> <span class="nx">expected</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</code></pre></td></tr></table>
</div>
</div><p>第二个参数为assertion，它的原型为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">assertion</span> <span class="kd">func</span><span class="p">(</span><span class="nx">actual</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">expected</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="kt">string</span>
</code></pre></td></tr></table>
</div>
</div><p>当assertion的返回值为&quot;&ldquo;时表示断言成功，否则表示失败，GoConvey框架中的相关代码为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">const</span> <span class="p">(</span>
    <span class="nx">success</span>                <span class="p">=</span> <span class="s">&#34;&#34;</span>
    <span class="nx">needExactValues</span>        <span class="p">=</span> <span class="s">&#34;This assertion requires exactly %d comparison values (you provided %d).&#34;</span>
    <span class="nx">needNonEmptyCollection</span> <span class="p">=</span> <span class="s">&#34;This assertion requires at least 1 comparison value (you provided 0).&#34;</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>我们简单实现一个assertion函数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">ShouldSummerBeComming</span><span class="p">(</span><span class="nx">actual</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">expected</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">actual</span> <span class="o">==</span> <span class="s">&#34;summer&#34;</span> <span class="o">&amp;&amp;</span> <span class="nx">expected</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#34;comming&#34;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&#34;&#34;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&#34;summer is not comming!&#34;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>我们仍然在slice_test文件中写一个简单测试：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">TestSummer</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">Convey</span><span class="p">(</span><span class="s">&#34;TestSummer&#34;</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">So</span><span class="p">(</span><span class="s">&#34;summer&#34;</span><span class="p">,</span> <span class="nx">ShouldSummerBeComming</span><span class="p">,</span> <span class="s">&#34;comming&#34;</span><span class="p">)</span>
        <span class="nf">So</span><span class="p">(</span><span class="s">&#34;winter&#34;</span><span class="p">,</span> <span class="nx">ShouldSummerBeComming</span><span class="p">,</span> <span class="s">&#34;comming&#34;</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>根据ShouldSummerBeComming的实现，Convey语句中第一个So将断言成功，第二个So将断言失败。
我们运行测试，查看执行结果，符合期望：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">=== RUN   TestSummer

  TestSummer ✔✘


Failures:

  * /Users/zhangxiaolong/Desktop/D/go-workspace/src/infra/alg/slice_test.go 
  Line 52:
  summer is not comming!


2 total assertions

--- FAIL: TestSummer (0.00s)
FAIL
exit status 1
FAIL    infra/alg       0.006s
</code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="/tags/go/">Go</a></li>
      <li><a href="/tags/goconvey/">goconvey</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2021 <a href="/">Forz Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
