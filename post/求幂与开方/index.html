<!DOCTYPE html>
<html lang="zh-cn" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>求幂与开方 | Forz Blog</title>
<meta name="keywords" content="Binary Sort, Math" />
<meta name="description" content="LeetCode 50. Pow(x, n) Implement pow(x, n). 解析：快速幂，此处需要判断边界值n，如果n为-2^31，那么需要另外设置一个long long变量存储其相反数。0x800000">
<meta name="author" content="">
<link rel="canonical" href="/post/%E6%B1%82%E5%B9%82%E4%B8%8E%E5%BC%80%E6%96%B9/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.00d5d4fc479b1575183ee8d86b4fb372ba9d9b1904e96fa8e4c40ff7debe2b94.css" integrity="sha256-ANXU/EebFXUYPujYa0&#43;zcrqdmxkE6W&#43;o5MQP996&#43;K5Q=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.87.0" />
<meta property="og:title" content="求幂与开方" />
<meta property="og:description" content="LeetCode 50. Pow(x, n) Implement pow(x, n). 解析：快速幂，此处需要判断边界值n，如果n为-2^31，那么需要另外设置一个long long变量存储其相反数。0x800000" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/%E6%B1%82%E5%B9%82%E4%B8%8E%E5%BC%80%E6%96%B9/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2017-06-25T02:25:15&#43;00:00" />
<meta property="article:modified_time" content="2017-06-25T02:25:15&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="求幂与开方"/>
<meta name="twitter:description" content="LeetCode 50. Pow(x, n) Implement pow(x, n). 解析：快速幂，此处需要判断边界值n，如果n为-2^31，那么需要另外设置一个long long变量存储其相反数。0x800000"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "/post/"
    }
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "求幂与开方",
      "item": "/post/%E6%B1%82%E5%B9%82%E4%B8%8E%E5%BC%80%E6%96%B9/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "求幂与开方",
  "name": "求幂与开方",
  "description": "LeetCode 50. Pow(x, n) Implement pow(x, n). 解析：快速幂，此处需要判断边界值n，如果n为-2^31，那么需要另外设置一个long long变量存储其相反数。0x800000",
  "keywords": [
    "Binary Sort", "Math"
  ],
  "articleBody": "LeetCode 50. Pow(x, n) Implement pow(x, n).\n解析：快速幂，此处需要判断边界值n，如果n为-2^31，那么需要另外设置一个long long变量存储其相反数。0x80000000（10000000000000000000000000000000），计算机在表示INT_MIN的时候，将符号位和数值位混用，使得INT_MIN比INT_MAX的绝对值大1，而且无法在INT范围内取相反数。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  class Solution { public: double myPow(double x, int n) { long long m=n;//  if(m0){ m=-m; x=1.0/x; } double ans=1; while(m){//利用二进制形式快速幂  if(m\u00261) ans=ans*x; x=x*x;//底数直接乘方  m=1;//不能使用n=1,因为n可能是-2147483648 = -2^31  } return ans; } };   注意：\n取相反数过程为取补码的逆过程，首先-1，然后再取反，然后再符号位取反， 0x80000000（10000000000000000000000000000000）-1=0x7FFFFFFF， 取反后0x00000000，符号位取反后仍为0x80000000。\n所以计算机在求-2147483648的相反数是仍然为-2147483648。 同时比较-2147483648和2147483648时会发现返回的结果是二者相等.\nLeetCode 372. Super Pow Your task is to calculate ab mod 1337 where a is a positive integer and b is an extremely large positive integer given in the form of an array.\nExample1: a = 2.\nb = [3].\nResult: 8\nExample2:\na = 2.\nb = [1,0]\nResult: 1024\n解析：此题指数变成数组形式，利用数学公式a^x=（a^(x/10)）^10 * a^(x%10)，进行递归处理\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  class Solution { public: int myPow(int x, int m) //快速幂  { int ans=1; while(m){//通过对指数的二进制处理来进行加速  if(m\u00261) ans=ans*x%1337;//按幂的二进制位计算，如果是1，先乘x  x=x*x%1337;//然后x平方，准备下一个计算  m=1; } return ans; } int superPow(int a, vectorint\u0026 b) { if(b.empty()) return 1; a = a%1337; int lastBit = b.back(); //b的最低位  b.pop_back(); //弹出最低位  return (myPow(superPow(a, b), 10) * myPow(a, lastBit))%1337;//递归  } };   LeetCode 69. Sqrt(x) Implement int sqrt(int x).\nCompute and return the square root of x.\n解析：\n求x开方的结果，用二分法枚举结果，判断是否合格。如果整数范围内不存在，向下取整返回最接近的数字。\n因为leetcode的test case x=2147395599，在算mid*mid的时候造成溢出，所以mid不能使用int型来接，要使用long long型防止溢出（int型的范围：-2147483648 到2147483648）\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  class Solution { public: int mySqrt(int x) { if(x  1) return x; int begin = 1; int end = x; long long mid; while(begin  end) { mid = begin + (end-begin)/2; long long val=mid*mid; if(val == x) //判断避免溢出的写法，  return mid; else if(val  x) begin = mid + 1; else end = mid - 1; } return end; //如果没找到结果，向下取整返回最接近的数 } };   补充：牛顿法\n计算x^2 = n的解，令f(x)=x^2-n，相当于求解f(x)=0的解，如上图所示。\n首先取x0，如果x0不是解，做一个经过(x0,f(x0))这个点的切线，与x轴的交点为x1。\n同样的道理，如果x1不是解，做一个经过(x1,f(x1))这个点的切线，与x轴的交点为x2。\n以此类推。。。\n以这样的方式得到的xi会无限趋近于f(x)=0的解。\n判断xi是否是f(x)=0的解有两种方法：\n一是直接计算f(x[i])的值判断是否为0，二是判断前后两个解xi和xi-1是否无限接近。\n经过(x[i], f(x[i]))这个点的切线方程为f(x) = f(x[i]) + f’(x[i])(x - x[i])，其中f’(x)为f(x)的导数，本题中为2x。\n令切线方程等于0，即可求出x[i]+1=x[i] - f(x[i]) / f’(x[i])。\n继续化简，x[i+1]=x[i] - (x[i]^2 - n) / (2x[i]) = x[i] - x[i] / 2 + n / (2x[i]) = x[i] / 2 + n / 2x[i] = (x[i] + n/x[i]) / 2。\n最后有了迭代公式x[i+1]= (x[i] + n/x[i]) / 2，\n最大可能值为x[i]=n;然后向下递推即可\n1 2 3 4 5 6 7 8 9  class Solution { public: int mySqrt(int x) { long long r = x; while (r*r  x) r = (r + x/r) / 2; return r; } };   补充：经过牛顿法推导的神秘做法\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  class Solution { public: int mySqrt(int x) { //数学大神根据牛顿迭代法来求推导出的神奇方法  assert(x = 0); if (x == 0 || x == 1) { return x; } float tmp = x; float xhalf = 0.5f*tmp; int i = *(int*)\u0026tmp; i = 0x5f375a86 - (i  1); // 这一步是关键  tmp = *(float*)\u0026i; tmp = tmp*(1.5f - xhalf*tmp*tmp); tmp = tmp*(1.5f - xhalf*tmp*tmp); tmp = tmp*(1.5f - xhalf*tmp*tmp); int ret = 1 / tmp; if (ret*ret  x) { return ret - 1; } return ret; } };   LeetCode 367. Valid Perfect Square Given a positive integer num, write a function which returns True if num is a perfect square else False.\nNote: Do not use any built-in library function such as sqrt.\nExample 1: Input: 16.\nReturns: True.\nExample 2: Input: 14.\nReturns: False.\n解析：判断某个数是否为完全平方数，可以用二分法。仍旧要注意mid和val都要为long long型，否则会溢出\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  class Solution { public: bool isPerfectSquare(int num) { if(num  1) return false; if(num == 1) return true; int left = 0, right = num/2; long mid; while(left  right) { mid = (left+right)/2; long val = mid*mid; if(val == num) return true; else if(val  num) right = mid-1; else left = mid+1; } return false; } };   补充：\n完全平方数是一系列奇数之和，例如：\n1 = 1 4 = 1 + 3 9 = 1 + 3 + 5 16 = 1 + 3 + 5 + 7 25 = 1 + 3 + 5 + 7 + 9 36 = 1 + 3 + 5 + 7 + 9 + 11 …. 1+3+…+(2n-1) = (2n-1 + 1)n/2 = n*n  所以可以通过这种方式判断是否为完全平方数：\n1 2 3 4 5 6 7 8 9 10 11 12  class Solution { public: bool isPerfectSquare(int num) { int i = 1; while (num  0) { num -= i; i += 2; } return num == 0; } };   ",
  "wordCount" : "2052",
  "inLanguage": "zh-cn",
  "datePublished": "2017-06-25T02:25:15Z",
  "dateModified": "2017-06-25T02:25:15Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/%E6%B1%82%E5%B9%82%E4%B8%8E%E5%BC%80%E6%96%B9/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Forz Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="Forz Blog (Alt + H)">Forz Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="/post/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      求幂与开方
    </h1>
    <div class="post-meta">June 25, 2017
</div>
  </header> 
  <div class="post-content"><h1 id="leetcode-50-powx-n">LeetCode 50. Pow(x, n)<a hidden class="anchor" aria-hidden="true" href="#leetcode-50-powx-n">#</a></h1>
<p>Implement pow(x, n).</p>
<p>解析：快速幂，此处需要判断边界值n，如果n为-2^31，那么需要另外设置一个long long变量存储其相反数。0x80000000（10000000000000000000000000000000），计算机在表示INT_MIN的时候，将符号位和数值位混用，使得INT_MIN比INT_MAX的绝对值大1，而且无法在INT范围内取相反数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">class</span> <span class="n">Solution</span> <span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
    <span class="kt">double</span> <span class="n">myPow</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">long</span> <span class="kt">long</span> <span class="n">m</span><span class="o">=</span><span class="n">n</span><span class="p">;</span><span class="c1">//
</span><span class="c1"></span>        <span class="k">if</span><span class="p">(</span><span class="n">m</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">){</span>
            <span class="n">m</span><span class="o">=-</span><span class="n">m</span><span class="p">;</span>
            <span class="n">x</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">x</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="kt">double</span> <span class="n">ans</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="n">m</span><span class="p">){</span><span class="c1">//利用二进制形式快速幂
</span><span class="c1"></span>            <span class="k">if</span><span class="p">(</span><span class="n">m</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span> <span class="n">ans</span><span class="o">=</span><span class="n">ans</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">;</span><span class="c1">//底数直接乘方
</span><span class="c1"></span>            <span class="n">m</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">;</span><span class="c1">//不能使用n&gt;&gt;=1,因为n可能是-2147483648 = -2^31
</span><span class="c1"></span>        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>注意：</p>
<p>取相反数过程为取补码的逆过程，首先-1，然后再取反，然后再符号位取反，   <br>
0x80000000（10000000000000000000000000000000）-1=0x7FFFFFFF，   <br>
取反后0x00000000，符号位取反后仍为0x80000000。<br>
所以计算机在求-2147483648的相反数是仍然为-2147483648。  <br>
同时比较-2147483648和2147483648时会发现返回的结果是二者相等.</p>
<h1 id="leetcode-372-super-pow">LeetCode 372. Super Pow<a hidden class="anchor" aria-hidden="true" href="#leetcode-372-super-pow">#</a></h1>
<p>Your task is to calculate ab mod 1337 where a is a positive integer and b is an extremely large positive integer given in the form of an array.</p>
<p>Example1: <br>
a = 2.<br>
b = [3].</p>
<p>Result: 8</p>
<p>Example2:</p>
<p>a = 2.<br>
b = [1,0]</p>
<p>Result: 1024</p>
<p>解析：此题指数变成数组形式，利用数学公式a^x=（a^(x/10)）^10 * a^(x%10)，进行递归处理</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">class</span> <span class="n">Solution</span> <span class="p">{</span>  
<span class="nl">public</span><span class="p">:</span>  
    <span class="kt">int</span> <span class="n">myPow</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span><span class="p">)</span>  <span class="c1">//快速幂
</span><span class="c1"></span>    <span class="p">{</span>  
        <span class="kt">int</span> <span class="n">ans</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="n">m</span><span class="p">){</span><span class="c1">//通过对指数的二进制处理来进行加速
</span><span class="c1"></span>            <span class="k">if</span><span class="p">(</span><span class="n">m</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span> <span class="n">ans</span><span class="o">=</span><span class="n">ans</span><span class="o">*</span><span class="n">x</span><span class="o">%</span><span class="mi">1337</span><span class="p">;</span><span class="c1">//按幂的二进制位计算，如果是1，先乘x
</span><span class="c1"></span>            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">%</span><span class="mi">1337</span><span class="p">;</span><span class="c1">//然后x平方，准备下一个计算
</span><span class="c1"></span>            <span class="n">m</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ans</span><span class="p">;</span> 
    <span class="p">}</span>  
    <span class="kt">int</span> <span class="n">superPow</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>  
        <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>  
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">%</span><span class="mi">1337</span><span class="p">;</span>  
        <span class="kt">int</span> <span class="n">lastBit</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>  <span class="c1">//b的最低位
</span><span class="c1"></span>        <span class="n">b</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>  <span class="c1">//弹出最低位
</span><span class="c1"></span>        <span class="k">return</span> <span class="p">(</span><span class="n">myPow</span><span class="p">(</span><span class="n">superPow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">myPow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">lastBit</span><span class="p">))</span><span class="o">%</span><span class="mi">1337</span><span class="p">;</span><span class="c1">//递归
</span><span class="c1"></span>    <span class="p">}</span>  
<span class="p">};</span>  
</code></pre></td></tr></table>
</div>
</div><h1 id="leetcode-69-sqrtx">LeetCode 69. Sqrt(x)<a hidden class="anchor" aria-hidden="true" href="#leetcode-69-sqrtx">#</a></h1>
<p>Implement int sqrt(int x).</p>
<p>Compute and return the square root of x.</p>
<p>解析：</p>
<p>求x开方的结果，用二分法枚举结果，判断是否合格。如果整数范围内不存在，向下取整返回最接近的数字。</p>
<p>因为leetcode的test case x=2147395599，在算mid*mid的时候造成溢出，所以mid不能使用int型来接，要使用long long型防止溢出（int型的范围：-2147483648 到2147483648）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">class</span> <span class="n">Solution</span> <span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
<span class="kt">int</span> <span class="n">mySqrt</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">begin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">end</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">long</span> <span class="kt">long</span> <span class="n">mid</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">begin</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">begin</span> <span class="o">+</span> <span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">begin</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
        <span class="kt">long</span> <span class="kt">long</span> <span class="n">val</span><span class="o">=</span><span class="n">mid</span><span class="o">*</span><span class="n">mid</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span> <span class="c1">//判断避免溢出的写法，
</span><span class="c1"></span>            <span class="k">return</span> <span class="n">mid</span><span class="p">;</span>
        <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">begin</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">end</span><span class="p">;</span> <span class="c1">//如果没找到结果，向下取整返回最接近的数
</span><span class="c1"></span><span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>补充：牛顿法</p>
<p><img loading="lazy" src="https://blog-1257321977.cos.ap-beijing.myqcloud.com/aa.png" alt=""  />
</p>
<p>计算x^2 = n的解，令f(x)=x^2-n，相当于求解f(x)=0的解，如上图所示。</p>
<p>首先取x0，如果x0不是解，做一个经过(x0,f(x0))这个点的切线，与x轴的交点为x1。</p>
<p>同样的道理，如果x1不是解，做一个经过(x1,f(x1))这个点的切线，与x轴的交点为x2。</p>
<p>以此类推。。。</p>
<p>以这样的方式得到的xi会无限趋近于f(x)=0的解。</p>
<p>判断xi是否是f(x)=0的解有两种方法：</p>
<p>一是直接计算f(x[i])的值判断是否为0，二是判断前后两个解xi和xi-1是否无限接近。</p>
<p>经过(x[i], f(x[i]))这个点的切线方程为f(x) = f(x[i]) + f’(x[i])(x - x[i])，其中f’(x)为f(x)的导数，本题中为2x。</p>
<p>令切线方程等于0，即可求出x[i]+1=x[i] - f(x[i]) / f’(x[i])。</p>
<p>继续化简，x[i+1]=x[i] - (x[i]^2 - n) / (2x[i]) = x[i] - x[i] / 2 + n / (2x[i]) = x[i] / 2 + n / 2x[i] = (x[i] + n/x[i]) / 2。</p>
<p>最后有了迭代公式x[i+1]= (x[i] + n/x[i]) / 2，</p>
<p>最大可能值为x[i]=n;然后向下递推即可</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">class</span> <span class="n">Solution</span> <span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
<span class="kt">int</span> <span class="n">mySqrt</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">long</span> <span class="kt">long</span> <span class="n">r</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="n">x</span><span class="o">/</span><span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>补充：经过牛顿法推导的神秘做法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">class</span> <span class="n">Solution</span>  
<span class="p">{</span>  
<span class="nl">public</span><span class="p">:</span>  
<span class="kt">int</span> <span class="n">mySqrt</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>  
<span class="p">{</span>  
    <span class="c1">//数学大神根据牛顿迭代法来求推导出的神奇方法  
</span><span class="c1"></span>    <span class="n">assert</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>  
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>  
    <span class="p">{</span>  
        <span class="k">return</span> <span class="n">x</span><span class="p">;</span>  
    <span class="p">}</span>  
    <span class="kt">float</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>  
    <span class="kt">float</span> <span class="n">xhalf</span> <span class="o">=</span> <span class="mf">0.5f</span><span class="o">*</span><span class="n">tmp</span><span class="p">;</span>  
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">tmp</span><span class="p">;</span>  

    <span class="n">i</span> <span class="o">=</span> <span class="mh">0x5f375a86</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 这一步是关键  
</span><span class="c1"></span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">i</span><span class="p">;</span>  
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">*</span><span class="p">(</span><span class="mf">1.5f</span> <span class="o">-</span> <span class="n">xhalf</span><span class="o">*</span><span class="n">tmp</span><span class="o">*</span><span class="n">tmp</span><span class="p">);</span>  
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">*</span><span class="p">(</span><span class="mf">1.5f</span> <span class="o">-</span> <span class="n">xhalf</span><span class="o">*</span><span class="n">tmp</span><span class="o">*</span><span class="n">tmp</span><span class="p">);</span>  
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">*</span><span class="p">(</span><span class="mf">1.5f</span> <span class="o">-</span> <span class="n">xhalf</span><span class="o">*</span><span class="n">tmp</span><span class="o">*</span><span class="n">tmp</span><span class="p">);</span>  

    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">tmp</span><span class="p">;</span>  
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="o">*</span><span class="n">ret</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">)</span>  
    <span class="p">{</span>  
        <span class="k">return</span> <span class="n">ret</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>  
    <span class="p">}</span>  
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>  
<span class="p">}</span>  
<span class="p">};</span>  
</code></pre></td></tr></table>
</div>
</div><h1 id="leetcode-367-valid-perfect-square">LeetCode 367. Valid Perfect Square<a hidden class="anchor" aria-hidden="true" href="#leetcode-367-valid-perfect-square">#</a></h1>
<p>Given a positive integer num, write a function which returns True if num is a perfect square else False.</p>
<p>Note: Do not use any built-in library function such as sqrt.</p>
<p>Example 1: <br>
Input: 16.<br>
Returns: True.</p>
<p>Example 2: <br>
Input: 14.<br>
Returns: False.</p>
<p>解析：判断某个数是否为完全平方数，可以用二分法。仍旧要注意mid和val都要为long long型，否则会溢出</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">class</span> <span class="n">Solution</span> <span class="p">{</span>  
<span class="nl">public</span><span class="p">:</span>  
<span class="kt">bool</span> <span class="n">isPerfectSquare</span><span class="p">(</span><span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="p">{</span>  
    <span class="k">if</span><span class="p">(</span><span class="n">num</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>  
    <span class="k">if</span><span class="p">(</span><span class="n">num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>  
    <span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">num</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>  
    <span class="kt">long</span> <span class="n">mid</span><span class="p">;</span>  
    <span class="k">while</span><span class="p">(</span><span class="n">left</span> <span class="o">&lt;=</span> <span class="n">right</span><span class="p">)</span>  
    <span class="p">{</span>  
        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span><span class="o">+</span><span class="n">right</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>  
        <span class="kt">long</span> <span class="n">val</span> <span class="o">=</span> <span class="n">mid</span><span class="o">*</span><span class="n">mid</span><span class="p">;</span>  
        <span class="k">if</span><span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="n">num</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>  
        <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="n">num</span><span class="p">)</span> <span class="n">right</span> <span class="o">=</span> <span class="n">mid</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>  
        <span class="k">else</span> <span class="n">left</span> <span class="o">=</span> <span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>  
    <span class="p">}</span>  
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>  
<span class="p">}</span>  
<span class="p">};</span>  
</code></pre></td></tr></table>
</div>
</div><p>补充：</p>
<p>完全平方数是一系列奇数之和，例如：</p>
<pre><code>1 = 1
4 = 1 + 3
9 = 1 + 3 + 5
16 = 1 + 3 + 5 + 7
25 = 1 + 3 + 5 + 7 + 9
36 = 1 + 3 + 5 + 7 + 9 + 11
….
1+3+…+(2n-1) = (2n-1 + 1)n/2 = n*n
</code></pre>
<p>所以可以通过这种方式判断是否为完全平方数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">class</span> <span class="n">Solution</span> <span class="p">{</span>

<span class="nl">public</span><span class="p">:</span>
    <span class="kt">bool</span> <span class="n">isPerfectSquare</span><span class="p">(</span><span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">num</span> <span class="o">-=</span> <span class="n">i</span><span class="p">;</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="/tags/binary-sort/">Binary Sort</a></li>
      <li><a href="/tags/math/">Math</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2021 <a href="/">Forz Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
