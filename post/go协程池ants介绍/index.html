<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Goåç¨‹æ± antsä»‹ç» - Forz Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author"
  content="Forz" /><meta name="description" content="ç®€ä»‹ å¤„ç†å¤§é‡å¹¶å‘æ˜¯ Go è¯­è¨€çš„ä¸€å¤§ä¼˜åŠ¿ã€‚è¯­è¨€å†…ç½®äº†æ–¹ä¾¿çš„å¹¶å‘è¯­æ³•ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„åˆ›å»ºå¾ˆå¤šä¸ªè½»é‡çº§çš„ goroutine å¹¶å‘å¤„ç†ä»»åŠ¡ã€‚ç›¸æ¯”äºåˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œgorou" /><meta name="keywords"
  content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.84.4 with theme even" />


<link rel="canonical" href="/post/go%E5%8D%8F%E7%A8%8B%E6%B1%A0ants%E4%BB%8B%E7%BB%8D/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link rel="stylesheet" href="/css/search.css" />


<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Goåç¨‹æ± antsä»‹ç»" />
<meta property="og:description" content="ç®€ä»‹ å¤„ç†å¤§é‡å¹¶å‘æ˜¯ Go è¯­è¨€çš„ä¸€å¤§ä¼˜åŠ¿ã€‚è¯­è¨€å†…ç½®äº†æ–¹ä¾¿çš„å¹¶å‘è¯­æ³•ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„åˆ›å»ºå¾ˆå¤šä¸ªè½»é‡çº§çš„ goroutine å¹¶å‘å¤„ç†ä»»åŠ¡ã€‚ç›¸æ¯”äºåˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œgorou" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/go%E5%8D%8F%E7%A8%8B%E6%B1%A0ants%E4%BB%8B%E7%BB%8D/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-07-08T15:05:53+00:00" />
<meta property="article:modified_time" content="2021-07-08T15:05:53+00:00" />

<meta itemprop="name" content="Goåç¨‹æ± antsä»‹ç»">
<meta itemprop="description" content="ç®€ä»‹ å¤„ç†å¤§é‡å¹¶å‘æ˜¯ Go è¯­è¨€çš„ä¸€å¤§ä¼˜åŠ¿ã€‚è¯­è¨€å†…ç½®äº†æ–¹ä¾¿çš„å¹¶å‘è¯­æ³•ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„åˆ›å»ºå¾ˆå¤šä¸ªè½»é‡çº§çš„ goroutine å¹¶å‘å¤„ç†ä»»åŠ¡ã€‚ç›¸æ¯”äºåˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œgorou"><meta itemprop="datePublished" content="2021-07-08T15:05:53+00:00" />
<meta itemprop="dateModified" content="2021-07-08T15:05:53+00:00" />
<meta itemprop="wordCount" content="4985">
<meta itemprop="keywords" content="Go," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Goåç¨‹æ± antsä»‹ç»"/>
<meta name="twitter:description" content="ç®€ä»‹ å¤„ç†å¤§é‡å¹¶å‘æ˜¯ Go è¯­è¨€çš„ä¸€å¤§ä¼˜åŠ¿ã€‚è¯­è¨€å†…ç½®äº†æ–¹ä¾¿çš„å¹¶å‘è¯­æ³•ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„åˆ›å»ºå¾ˆå¤šä¸ªè½»é‡çº§çš„ goroutine å¹¶å‘å¤„ç†ä»»åŠ¡ã€‚ç›¸æ¯”äºåˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œgorou"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->
</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Forz Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="clearfix">
  <div class="logo-wrapper">
    <a href="/" class="logo">Forz Blog</a>
  </div>

  <nav class="site-navbar">
    <ul id="menu" class="menu">
      <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
    </ul>
  </nav>
</div>


<div class="search-container">
  <div class="aa-input-container" id="aa-input-container">
    <input type="search" id="aa-search-input" class="aa-input-search" placeholder="Search for titles or URIs..."
        name="search" autocomplete="off" />
    <svg class="aa-input-icon" viewBox="654 -372 1664 1664">
        <path
            d="M1806,332c0-123.3-43.8-228.8-131.5-316.5C1586.8-72.2,1481.3-116,1358-116s-228.8,43.8-316.5,131.5  C953.8,103.2,910,208.7,910,332s43.8,228.8,131.5,316.5C1129.2,736.2,1234.7,780,1358,780s228.8-43.8,316.5-131.5  C1762.2,560.8,1806,455.3,1806,332z M2318,1164c0,34.7-12.7,64.7-38,90s-55.3,38-90,38c-36,0-66-12.7-90-38l-343-342  c-119.3,82.7-252.3,124-399,124c-95.3,0-186.5-18.5-273.5-55.5s-162-87-225-150s-113-138-150-225S654,427.3,654,332  s18.5-186.5,55.5-273.5s87-162,150-225s138-113,225-150S1262.7-372,1358-372s186.5,18.5,273.5,55.5s162,87,225,150s113,138,150,225  S2062,236.7,2062,332c0,146.7-41.3,279.7-124,399l343,343C2305.7,1098.7,2318,1128.7,2318,1164z" />
    </svg>
</div>
<script
    src="https://res.cloudinary.com/jimmysong/raw/upload/rootsongjc-hugo/algoliasearch.min.js"></script>
<script
    src="https://res.cloudinary.com/jimmysong/raw/upload/rootsongjc-hugo/autocomplete.min.js"></script>
<script>
    var client = algoliasearch("IAR2EF5L65", "b4b9da2eba53aa6dabe4b8ac9e8676e1");
    var index = client.initIndex('forz.forzvina.com');
    autocomplete('#aa-search-input',
        { hint: false }, {
        source: autocomplete.sources.hits(index, { hitsPerPage: 8 }),
        displayKey: 'name',
        templates: {
            suggestion: function (suggestion) {
                var reg = /([A-Z]+)/ig
                var title = suggestion.uri.replace(reg, function (m) {
                    return m.toLowerCase()
                })
                return '<span class="search-item">' + '<a href="\/' + title + '">' +
                    suggestion._highlightResult.title.value + '</a></span>';
            }
        }
    });
</script>
</div>


    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Goåç¨‹æ± antsä»‹ç»</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-07-08 </span>
        <div class="post-category">
            <a href="/categories/go/"> Go </a>
            </div>
          <span class="more-meta"> çº¦ 4985 å­— </span>
          <span class="more-meta"> é¢„è®¡é˜…è¯» 10 åˆ†é’Ÿ </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#ç®€ä»‹">ç®€ä»‹</a></li>
    <li><a href="#å¿«é€Ÿä½¿ç”¨">å¿«é€Ÿä½¿ç”¨</a></li>
    <li><a href="#å‡½æ•°ä½œä¸ºä»»åŠ¡">å‡½æ•°ä½œä¸ºä»»åŠ¡</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="ç®€ä»‹">ç®€ä»‹</h2>
<p>å¤„ç†å¤§é‡å¹¶å‘æ˜¯ Go è¯­è¨€çš„ä¸€å¤§ä¼˜åŠ¿ã€‚è¯­è¨€å†…ç½®äº†æ–¹ä¾¿çš„å¹¶å‘è¯­æ³•ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„åˆ›å»ºå¾ˆå¤šä¸ªè½»é‡çº§çš„ goroutine å¹¶å‘å¤„ç†ä»»åŠ¡ã€‚ç›¸æ¯”äºåˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œgoroutine æ›´è½»é‡ã€èµ„æºå ç”¨æ›´å°‘ã€åˆ‡æ¢é€Ÿåº¦æ›´å¿«ã€æ— çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€æ›´å°‘ã€‚ä½†æ˜¯å—é™äºèµ„æºæ€»é‡ï¼Œç³»ç»Ÿä¸­èƒ½å¤Ÿåˆ›å»ºçš„ goroutine æ•°é‡ä¹Ÿæ˜¯å—é™çš„ã€‚é»˜è®¤æ¯ä¸ª goroutine å ç”¨ 8KB å†…å­˜ï¼Œä¸€å° 8GB å†…å­˜çš„æœºå™¨æ»¡æ‰“æ»¡ç®—ä¹Ÿåªèƒ½åˆ›å»º 8GB/8KB = 1000000 ä¸ª goroutineï¼Œæ›´ä½•å†µç³»ç»Ÿè¿˜éœ€è¦ä¿ç•™ä¸€éƒ¨åˆ†å†…å­˜è¿è¡Œæ—¥å¸¸ç®¡ç†ä»»åŠ¡ï¼Œgo è¿è¡Œæ—¶éœ€è¦å†…å­˜è¿è¡Œ gcã€å¤„ç† goroutine åˆ‡æ¢ç­‰ã€‚ä½¿ç”¨çš„å†…å­˜è¶…è¿‡æœºå™¨å†…å­˜å®¹é‡ï¼Œç³»ç»Ÿä¼šä½¿ç”¨äº¤æ¢åŒºï¼ˆswapï¼‰ï¼Œå¯¼è‡´æ€§èƒ½æ€¥é€Ÿä¸‹é™ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•éªŒè¯ä¸€ä¸‹åˆ›å»ºè¿‡å¤š goroutine ä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
  <span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">10000000</span><span class="p">)</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">10000000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="p">)</span>
    <span class="p">}()</span>
  <span class="p">}</span>
  <span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼ˆ8Gå†…å­˜ï¼‰è¿è¡Œä¸Šé¢çš„ç¨‹åºä¼šæŠ¥<code>errno 1455</code>ï¼Œå³<code>Out of Memory</code>é”™è¯¯ï¼Œè¿™å¾ˆå¥½ç†è§£ã€‚è°¨æ…è¿è¡Œã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œgoroutine çš„ç®¡ç†ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚goroutine åªèƒ½è‡ªå·±è¿è¡Œç»“æŸï¼Œå¤–éƒ¨æ²¡æœ‰ä»»ä½•æ‰‹æ®µå¯ä»¥å¼ºåˆ¶jç»“æŸä¸€ä¸ª goroutineã€‚å¦‚æœä¸€ä¸ª goroutine å› ä¸ºæŸç§åŸå› æ²¡æœ‰è‡ªè¡Œç»“æŸï¼Œå°±ä¼šå‡ºç° goroutine æ³„éœ²ã€‚æ­¤å¤–ï¼Œé¢‘ç¹åˆ›å»º goroutine ä¹Ÿæ˜¯ä¸€ä¸ªå¼€é”€ã€‚</p>
<p>é‰´äºä¸Šè¿°åŸå› ï¼Œè‡ªç„¶å‡ºç°äº†ä¸çº¿ç¨‹æ± ä¸€æ ·çš„éœ€æ±‚ï¼Œå³ goroutine æ± ã€‚ä¸€èˆ¬çš„ goroutine æ± è‡ªåŠ¨ç®¡ç† goroutine çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥æŒ‰éœ€åˆ›å»ºï¼ŒåŠ¨æ€ç¼©å®¹ã€‚å‘ goroutine æ± æäº¤ä¸€ä¸ªä»»åŠ¡ï¼Œgoroutine æ± ä¼šè‡ªåŠ¨å®‰æ’æŸä¸ª goroutine æ¥å¤„ç†ã€‚</p>
<p>antså°±æ˜¯å…¶ä¸­ä¸€ä¸ªå®ç° goroutine æ± çš„åº“ã€‚</p>
<h2 id="å¿«é€Ÿä½¿ç”¨">å¿«é€Ÿä½¿ç”¨</h2>
<p>æœ¬æ–‡ä»£ç ä½¿ç”¨ Go Modulesã€‚</p>
<p>åˆ›å»ºç›®å½•å¹¶åˆå§‹åŒ–ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-s" data-lang="s"><span class="n">mkdir</span> <span class="n">ants</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="n">ants</span>
<span class="n">go</span> <span class="n">mod</span> <span class="n">init</span> <span class="n">github.com</span><span class="o">/</span><span class="n">darjun</span><span class="o">/</span><span class="n">go</span><span class="o">-</span><span class="n">daily</span><span class="o">-</span><span class="n">lib</span><span class="o">/</span><span class="n">ants</span>
</code></pre></td></tr></table>
</div>
</div><p>å®‰è£…antsåº“ï¼Œä½¿ç”¨v2ç‰ˆæœ¬ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-s" data-lang="s"><span class="n">go</span> <span class="n">get</span> <span class="o">-</span><span class="n">u</span> <span class="n">github.com</span><span class="o">/</span><span class="n">panjf2000</span><span class="o">/</span><span class="n">ants</span><span class="o">/</span><span class="n">v2</span>
</code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬æ¥ä¸‹æ¥è¦å®ç°ä¸€ä¸ªè®¡ç®—å¤§é‡æ•´æ•°å’Œçš„ç¨‹åºã€‚é¦–å…ˆåˆ›å»ºåŸºç¡€çš„ä»»åŠ¡ç»“æ„ï¼Œå¹¶å®ç°å…¶æ‰§è¡Œä»»åŠ¡æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Task</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">index</span> <span class="kt">int</span>
  <span class="nx">nums</span>  <span class="p">[]</span><span class="kt">int</span>
  <span class="nx">sum</span>   <span class="kt">int</span>
  <span class="nx">wg</span>    <span class="o">*</span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">Task</span><span class="p">)</span> <span class="nf">Do</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">num</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">t</span><span class="p">.</span><span class="nx">nums</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">sum</span> <span class="o">+=</span> <span class="nx">num</span>
  <span class="p">}</span>

  <span class="nx">t</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>å¾ˆç®€å•ï¼Œå°±æ˜¯å°†ä¸€ä¸ªåˆ‡ç‰‡ä¸­çš„æ‰€æœ‰æ•´æ•°ç›¸åŠ ã€‚</p>
<p>ç„¶åæˆ‘ä»¬åˆ›å»º goroutine æ± ï¼Œæ³¨æ„æ± ä½¿ç”¨å®Œåéœ€è¦æ‰‹åŠ¨å…³é—­ï¼Œè¿™é‡Œä½¿ç”¨deferå…³é—­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">p</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">ants</span><span class="p">.</span><span class="nf">NewPoolWithFunc</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nx">taskFunc</span><span class="p">)</span>
<span class="k">defer</span> <span class="nx">p</span><span class="p">.</span><span class="nf">Release</span><span class="p">()</span>

<span class="kd">func</span> <span class="nf">taskFunc</span><span class="p">(</span><span class="nx">data</span> <span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
  <span class="nx">task</span> <span class="o">:=</span> <span class="nx">data</span><span class="p">.(</span><span class="o">*</span><span class="nx">Task</span><span class="p">)</span>
  <span class="nx">task</span><span class="p">.</span><span class="nf">Do</span><span class="p">()</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;task:%d sum:%d\n&#34;</span><span class="p">,</span> <span class="nx">task</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span> <span class="nx">task</span><span class="p">.</span><span class="nx">sum</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢è°ƒç”¨äº†<code>ants.NewPoolWithFunc()</code>åˆ›å»ºäº†ä¸€ä¸ª goroutine æ± ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ± å®¹é‡ï¼Œå³æ± ä¸­æœ€å¤šæœ‰ 10 ä¸ª goroutineã€‚ç¬¬äºŒä¸ªå‚æ•°ä¸ºæ¯æ¬¡æ‰§è¡Œä»»åŠ¡çš„å‡½æ•°ã€‚å½“æˆ‘ä»¬è°ƒç”¨<code>p.Invoke(data)</code>çš„æ—¶å€™ï¼Œantsæ± ä¼šåœ¨å…¶ç®¡ç†çš„ goroutine ä¸­æ‰¾å‡ºä¸€ä¸ªç©ºé—²çš„ï¼Œè®©å®ƒæ‰§è¡Œå‡½æ•°taskFuncï¼Œå¹¶å°†dataä½œä¸ºå‚æ•°ã€‚</p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿæ•°æ®ï¼Œåšæ•°æ®åˆ‡åˆ†ï¼Œç”Ÿæˆä»»åŠ¡ï¼Œäº¤ç»™ ants å¤„ç†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">const</span> <span class="p">(</span>
  <span class="nx">DataSize</span>    <span class="p">=</span> <span class="mi">10000</span>
  <span class="nx">DataPerTask</span> <span class="p">=</span> <span class="mi">100</span>
<span class="p">)</span>

<span class="nx">nums</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">DataSize</span><span class="p">,</span> <span class="nx">DataSize</span><span class="p">)</span>
<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">nums</span> <span class="p">{</span>
  <span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
<span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="nx">DataSize</span> <span class="o">/</span> <span class="nx">DataPerTask</span><span class="p">)</span>
<span class="nx">tasks</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="o">*</span><span class="nx">Task</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">DataSize</span><span class="o">/</span><span class="nx">DataPerTask</span><span class="p">)</span>
<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">DataSize</span><span class="o">/</span><span class="nx">DataPerTask</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
  <span class="nx">task</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Task</span><span class="p">{</span>
    <span class="nx">index</span><span class="p">:</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">nums</span><span class="p">:</span>  <span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="o">*</span><span class="nx">DataPerTask</span> <span class="p">:</span> <span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">DataPerTask</span><span class="p">],</span>
    <span class="nx">wg</span><span class="p">:</span>    <span class="o">&amp;</span><span class="nx">wg</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="nx">tasks</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">tasks</span><span class="p">,</span> <span class="nx">task</span><span class="p">)</span>
  <span class="nx">p</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">(</span><span class="nx">task</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;running goroutines: %d\n&#34;</span><span class="p">,</span> <span class="nx">ants</span><span class="p">.</span><span class="nf">Running</span><span class="p">())</span>
</code></pre></td></tr></table>
</div>
</div><p>éšæœºç”Ÿæˆ 10000 ä¸ªæ•´æ•°ï¼Œå°†è¿™äº›æ•´æ•°åˆ†ä¸º 100 ä»½ï¼Œæ¯ä»½ 100 ä¸ªï¼Œç”ŸæˆTaskç»“æ„ï¼Œè°ƒç”¨<code>p.Invoke(task)</code>å¤„ç†ã€‚<code>wg.Wait()</code>ç­‰å¾…å¤„ç†å®Œæˆï¼Œç„¶åè¾“å‡ºantsæ­£åœ¨è¿è¡Œçš„ goroutine æ•°é‡ï¼Œè¿™æ—¶åº”è¯¥æ˜¯ 0ã€‚</p>
<p>æœ€åæˆ‘ä»¬å°†ç»“æœæ±‡æ€»ï¼Œå¹¶éªŒè¯ä¸€ä¸‹ç»“æœï¼Œä¸ç›´æ¥ç›¸åŠ å¾—åˆ°çš„ç»“æœåšä¸€ä¸ªæ¯”è¾ƒï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">sum</span> <span class="kt">int</span>
<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">task</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tasks</span> <span class="p">{</span>
  <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">task</span><span class="p">.</span><span class="nx">sum</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">expect</span> <span class="kt">int</span>
<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">num</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">nums</span> <span class="p">{</span>
  <span class="nx">expect</span> <span class="o">+=</span> <span class="nx">num</span>
<span class="p">}</span>

<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;finish all tasks, result is %d expect:%d\n&#34;</span><span class="p">,</span> <span class="nx">sum</span><span class="p">,</span> <span class="nx">expect</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-s" data-lang="s"><span class="o">$</span> <span class="n">go</span> <span class="n">run</span> <span class="n">main.go</span>
<span class="kc">...</span>
<span class="n">task</span><span class="o">:</span><span class="m">96</span> <span class="n">sum</span><span class="o">:</span><span class="m">53275</span>
<span class="n">task</span><span class="o">:</span><span class="m">88</span> <span class="n">sum</span><span class="o">:</span><span class="m">50090</span>
<span class="n">task</span><span class="o">:</span><span class="m">62</span> <span class="n">sum</span><span class="o">:</span><span class="m">57114</span>
<span class="n">task</span><span class="o">:</span><span class="m">45</span> <span class="n">sum</span><span class="o">:</span><span class="m">48041</span>
<span class="n">task</span><span class="o">:</span><span class="m">82</span> <span class="n">sum</span><span class="o">:</span><span class="m">45269</span>
<span class="n">running</span> <span class="n">goroutines</span><span class="o">:</span> <span class="m">0</span>
<span class="n">finish</span> <span class="n">all</span> <span class="n">tasks</span><span class="p">,</span> <span class="n">result</span> <span class="n">is</span> <span class="m">5010172</span> <span class="n">expect</span><span class="o">:</span><span class="m">5010172</span>
</code></pre></td></tr></table>
</div>
</div><p>ç¡®å®ï¼Œä»»åŠ¡å®Œæˆä¹‹åï¼Œæ­£åœ¨è¿è¡Œçš„ goroutine æ•°é‡å˜ä¸º 0ã€‚è€Œä¸”æˆ‘ä»¬éªŒè¯äº†ï¼Œç»“æœæ²¡æœ‰åå·®ã€‚å¦å¤–éœ€è¦æ³¨æ„ï¼Œgoroutine æ± ä¸­ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºæ˜¯éšæœºçš„ï¼Œä¸æäº¤ä»»åŠ¡çš„å…ˆåæ²¡æœ‰å…³ç³»ã€‚ç”±ä¸Šé¢è¿è¡Œæ‰“å°çš„ä»»åŠ¡æ ‡è¯†æˆ‘ä»¬ä¹Ÿèƒ½å‘ç°è¿™ä¸€ç‚¹ã€‚
k8s-jiaoxuegongju-inner</p>
<h2 id="å‡½æ•°ä½œä¸ºä»»åŠ¡">å‡½æ•°ä½œä¸ºä»»åŠ¡</h2>
<p>antsæ”¯æŒå°†ä¸€ä¸ªä¸æ¥å—ä»»ä½•å‚æ•°çš„å‡½æ•°ä½œä¸ºä»»åŠ¡æäº¤ç»™ goroutine è¿è¡Œã€‚ç”±äºä¸æ¥å—å‚æ•°ï¼Œæˆ‘ä»¬æäº¤çš„å‡½æ•°è¦ä¹ˆä¸éœ€è¦å¤–éƒ¨æ•°æ®ï¼Œåªéœ€è¦å¤„ç†è‡ªèº«é€»è¾‘ï¼Œå¦åˆ™å°±å¿…é¡»ç”¨æŸç§æ–¹å¼å°†éœ€è¦çš„æ•°æ®ä¼ é€’è¿›å»ï¼Œä¾‹å¦‚é—­åŒ…ã€‚</p>
<p>æäº¤å‡½æ•°ä½œä¸ºä»»åŠ¡çš„ goroutine æ± ä½¿ç”¨<code>ants.NewPool()</code>åˆ›å»ºï¼Œå®ƒåªæ¥å—ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ± å­çš„å®¹é‡ã€‚è°ƒç”¨æ± å­å¯¹è±¡çš„<code>Submit()</code>æ–¹æ³•æ¥æäº¤ä»»åŠ¡ï¼Œå°†ä¸€ä¸ªä¸æ¥å—ä»»ä½•å‚æ•°çš„å‡½æ•°ä¼ å…¥ã€‚</p>
<p>æœ€å¼€å§‹çš„ä¾‹å­å¯ä»¥æ”¹å†™ä¸€ä¸‹ã€‚å¢åŠ ä¸€ä¸ªä»»åŠ¡åŒ…è£…å‡½æ•°ï¼Œå°†ä»»åŠ¡éœ€è¦çš„å‚æ•°ä½œä¸ºåŒ…è£…å‡½æ•°çš„å‚æ•°ã€‚åŒ…è£…å‡½æ•°è¿”å›å®é™…çš„ä»»åŠ¡å‡½æ•°ï¼Œè¯¥ä»»åŠ¡å‡½æ•°å°±å¯ä»¥é€šè¿‡é—­åŒ…è®¿é—®å®ƒéœ€è¦çš„æ•°æ®äº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">taskFunc</span> <span class="kd">func</span><span class="p">()</span>

<span class="kd">func</span> <span class="nf">taskFuncWrapper</span><span class="p">(</span><span class="nx">nums</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">sum</span> <span class="o">*</span><span class="kt">int</span><span class="p">,</span> <span class="nx">wg</span><span class="o">*</span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span><span class="p">)</span> <span class="nx">taskFunc</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">num</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="o">*</span><span class="nx">DataPerTask</span> <span class="p">:</span> <span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">DataPerTask</span><span class="p">]</span> <span class="p">{</span>
      <span class="o">*</span><span class="nx">sum</span> <span class="o">+=</span> <span class="nx">num</span>
    <span class="p">}</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;task:%d sum:%d\n&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="nx">sum</span><span class="p">)</span>
    <span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>è°ƒç”¨<code>ants.NewPool(10)</code>åˆ›å»º goroutine æ± ï¼ŒåŒæ ·æ± å­ç”¨å®Œéœ€è¦é‡Šæ”¾ï¼Œè¿™é‡Œä½¿ç”¨deferï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">p</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">ants</span><span class="p">.</span><span class="nf">NewPool</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">defer</span> <span class="nx">p</span><span class="p">.</span><span class="nf">Release</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®ï¼Œåˆ‡åˆ†ä»»åŠ¡ã€‚æäº¤ä»»åŠ¡ç»™antsæ± æ‰§è¡Œï¼Œè¿™é‡Œä½¿ç”¨<code>taskFuncWrapper()</code>åŒ…è£…å‡½æ•°ç”Ÿæˆå…·ä½“çš„ä»»åŠ¡ï¼Œç„¶åè°ƒç”¨p.Submit()æäº¤ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">nums</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">DataSize</span><span class="p">,</span> <span class="nx">DataSize</span><span class="p">)</span>
<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">nums</span> <span class="p">{</span>
  <span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
<span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="nx">DataSize</span> <span class="o">/</span> <span class="nx">DataPerTask</span><span class="p">)</span>
<span class="nx">partSums</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">DataSize</span><span class="o">/</span><span class="nx">DataPerTask</span><span class="p">,</span> <span class="nx">DataSize</span><span class="o">/</span><span class="nx">DataPerTask</span><span class="p">)</span>
<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">DataSize</span><span class="o">/</span><span class="nx">DataPerTask</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
  <span class="nx">p</span><span class="p">.</span><span class="nf">Submit</span><span class="p">(</span><span class="nf">taskFuncWrapper</span><span class="p">(</span><span class="nx">nums</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">partSums</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="o">&amp;</span><span class="nx">wg</span><span class="p">))</span>
<span class="p">}</span>
<span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>æ±‡æ€»ç»“æœï¼ŒéªŒè¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">sum</span> <span class="kt">int</span>
<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">partSum</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">partSums</span> <span class="p">{</span>
  <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">partSum</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">expect</span> <span class="kt">int</span>
<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">num</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">nums</span> <span class="p">{</span>
  <span class="nx">expect</span> <span class="o">+=</span> <span class="nx">num</span>
<span class="p">}</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;running goroutines: %d\n&#34;</span><span class="p">,</span> <span class="nx">ants</span><span class="p">.</span><span class="nf">Running</span><span class="p">())</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;finish all tasks, result is %d expect is %d\n&#34;</span><span class="p">,</span> <span class="nx">sum</span><span class="p">,</span> <span class="nx">expect</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªç¨‹åºçš„åŠŸèƒ½ä¸æœ€å¼€å§‹çš„å®Œå…¨ç›¸åŒã€‚</p>
<p>æ‰§è¡Œæµç¨‹
GitHub ä»“åº“ä¸­æœ‰ä¸ªæ‰§è¡Œæµç¨‹å›¾ï¼Œæˆ‘é‡æ–°ç»˜åˆ¶äº†ä¸€ä¸‹ï¼š</p>
<p>å›¾ç‰‡
æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<p>åˆå§‹åŒ– goroutine æ± ï¼›
æäº¤ä»»åŠ¡ç»™ goroutine æ± ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ç©ºé—²çš„ goroutineï¼š
å·²åˆ°ä¸Šé™ï¼Œæ£€æŸ¥ goroutine æ± æ˜¯å¦æ˜¯éé˜»å¡çš„ï¼š
æœªåˆ°ä¸Šé™ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ goroutine å¤„ç†ä»»åŠ¡
éé˜»å¡ï¼Œç›´æ¥è¿”å›nilè¡¨ç¤ºæ‰§è¡Œå¤±è´¥
é˜»å¡ï¼Œç­‰å¾… goroutine ç©ºé—²
æœ‰ï¼Œè·å–ç©ºé—² goroutine
æ— ï¼Œæ£€æŸ¥æ± ä¸­çš„ goroutine æ•°é‡æ˜¯å¦å·²åˆ°æ± å®¹é‡ä¸Šé™ï¼š
ä»»åŠ¡å¤„ç†å®Œæˆï¼Œå°† goroutine äº¤è¿˜ç»™æ± ï¼Œä»¥å¾…å¤„ç†ä¸‹ä¸€ä¸ªä»»åŠ¡
é€‰é¡¹
antsæä¾›äº†ä¸€äº›é€‰é¡¹å¯ä»¥å®šåˆ¶ goroutine æ± çš„è¡Œä¸ºã€‚é€‰é¡¹ä½¿ç”¨Optionsç»“æ„å®šä¹‰ï¼š</p>
<p>// src/github.com/panjf2000/ants/options.go
type Options struct {
ExpiryDuration time.Duration
PreAlloc bool
MaxBlockingTasks int
Nonblocking bool
PanicHandler func(interface{})
Logger Logger
}
å„ä¸ªé€‰é¡¹å«ä¹‰å¦‚ä¸‹ï¼š</p>
<p>ExpiryDurationï¼šè¿‡æœŸæ—¶é—´ã€‚è¡¨ç¤º goroutine ç©ºé—²å¤šé•¿æ—¶é—´ä¹‹åä¼šè¢«antsæ± å›æ”¶
PreAllocï¼šé¢„åˆ†é…ã€‚è°ƒç”¨NewPool()/NewPoolWithFunc()ä¹‹åé¢„åˆ†é…workerï¼ˆç®¡ç†ä¸€ä¸ªå·¥ä½œ goroutine çš„ç»“æ„ä½“ï¼‰åˆ‡ç‰‡ã€‚è€Œä¸”ä½¿ç”¨é¢„åˆ†é…ä¸å¦ä¼šç›´æ¥å½±å“æ± ä¸­ç®¡ç†workerçš„ç»“æ„ã€‚è§ä¸‹é¢æºç 
MaxBlockingTasksï¼šæœ€å¤§é˜»å¡ä»»åŠ¡æ•°é‡ã€‚å³æ± ä¸­ goroutine æ•°é‡å·²åˆ°æ± å®¹é‡ï¼Œä¸”æ‰€æœ‰ goroutine éƒ½å¤„ç†ç¹å¿™çŠ¶æ€ï¼Œè¿™æ—¶åˆ°æ¥çš„ä»»åŠ¡ä¼šåœ¨é˜»å¡åˆ—è¡¨ç­‰å¾…ã€‚è¿™ä¸ªé€‰é¡¹è®¾ç½®çš„æ˜¯åˆ—è¡¨çš„æœ€å¤§é•¿åº¦ã€‚é˜»å¡çš„ä»»åŠ¡æ•°é‡è¾¾åˆ°è¿™ä¸ªå€¼åï¼Œåç»­ä»»åŠ¡æäº¤ç›´æ¥è¿”å›å¤±è´¥
Nonblockingï¼šæ± æ˜¯å¦é˜»å¡ï¼Œé»˜è®¤é˜»å¡ã€‚æäº¤ä»»åŠ¡æ—¶ï¼Œå¦‚æœantsæ± ä¸­ goroutine å·²åˆ°ä¸Šé™ä¸”å…¨éƒ¨ç¹å¿™ï¼Œé˜»å¡çš„æ± ä¼šå°†ä»»åŠ¡æ·»åŠ çš„é˜»å¡åˆ—è¡¨ç­‰å¾…ï¼ˆå½“ç„¶å—é™äºé˜»å¡åˆ—è¡¨é•¿åº¦ï¼Œè§ä¸Šä¸€ä¸ªé€‰é¡¹ï¼‰ã€‚éé˜»å¡çš„æ± ç›´æ¥è¿”å›å¤±è´¥
PanicHandlerï¼španic å¤„ç†ã€‚é‡åˆ° panic ä¼šè°ƒç”¨è¿™é‡Œè®¾ç½®çš„å¤„ç†å‡½æ•°
Loggerï¼šæŒ‡å®šæ—¥å¿—è®°å½•å™¨
NewPool()éƒ¨åˆ†æºç ï¼š</p>
<p>if p.options.PreAlloc {
if size == -1 {
return nil, ErrInvalidPreAllocSize
}
p.workers = newWorkerArray(loopQueueType, size)
} else {
p.workers = newWorkerArray(stackType, 0)
}
ä½¿ç”¨é¢„åˆ†é…æ—¶ï¼Œåˆ›å»ºloopQueueTypeç±»å‹çš„ç»“æ„ï¼Œåä¹‹åˆ›å»ºstackTypeç±»å‹ã€‚è¿™æ˜¯antså®šä¹‰çš„ä¸¤ç§ç®¡ç†workerçš„æ•°æ®ç»“æ„ã€‚</p>
<p>antså®šä¹‰äº†ä¸€äº›With*å‡½æ•°æ¥è®¾ç½®è¿™äº›é€‰é¡¹ï¼š</p>
<p>func WithOptions(options Options) Option {
return func(opts *Options) {
*opts = options
}
}</p>
<p>func WithExpiryDuration(expiryDuration time.Duration) Option {
return func(opts *Options) {
opts.ExpiryDuration = expiryDuration
}
}</p>
<p>func WithPreAlloc(preAlloc bool) Option {
return func(opts *Options) {
opts.PreAlloc = preAlloc
}
}</p>
<p>func WithMaxBlockingTasks(maxBlockingTasks int) Option {
return func(opts *Options) {
opts.MaxBlockingTasks = maxBlockingTasks
}
}</p>
<p>func WithNonblocking(nonblocking bool) Option {
return func(opts *Options) {
opts.Nonblocking = nonblocking
}
}</p>
<p>func WithPanicHandler(panicHandler func(interface{})) Option {
return func(opts *Options) {
opts.PanicHandler = panicHandler
}
}</p>
<p>func WithLogger(logger Logger) Option {
return func(opts *Options) {
opts.Logger = logger
}
}
è¿™é‡Œä½¿ç”¨äº† Go è¯­è¨€ä¸­éå¸¸å¸¸è§çš„ä¸€ç§æ¨¡å¼ï¼Œæˆ‘ç§°ä¹‹ä¸ºé€‰é¡¹æ¨¡å¼ï¼Œéå¸¸æ–¹ä¾¿åœ°æ„é€ æœ‰å¤§é‡å‚æ•°ï¼Œä¸”å¤§éƒ¨åˆ†æœ‰é»˜è®¤å€¼æˆ–ä¸€èˆ¬ä¸éœ€è¦æ˜¾å¼è®¾ç½®çš„å¯¹è±¡ã€‚</p>
<p>æˆ‘ä»¬æ¥éªŒè¯å‡ ä¸ªé€‰é¡¹ã€‚</p>
<p>æœ€å¤§ç­‰å¾…é˜Ÿåˆ—é•¿åº¦
antsæ± è®¾ç½®å®¹é‡ä¹‹åï¼Œå¦‚æœæ‰€æœ‰çš„ goroutine éƒ½åœ¨å¤„ç†ä»»åŠ¡ã€‚è¿™æ—¶æäº¤çš„ä»»åŠ¡é»˜è®¤ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼ŒWithMaxBlockingTasks(maxBlockingTasks int)å¯ä»¥è®¾ç½®ç­‰å¾…é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ã€‚è¶…è¿‡è¿™ä¸ªé•¿åº¦ï¼Œæäº¤ä»»åŠ¡ç›´æ¥è¿”å›é”™è¯¯ï¼š</p>
<p>func wrapper(i int, wg <em>sync.WaitGroup) func() {
return func() {
fmt.Printf(&ldquo;hello from task:%d\n&rdquo;, i)
time.Sleep(1</em> time.Second)
wg.Done()
}
}</p>
<p>func main() {
p, _ := ants.NewPool(4, ants.WithMaxBlockingTasks(2))
defer p.Release()</p>
<p>var wg sync.WaitGroup
wg.Add(8)
for i := 1; i &lt;= 8; i++ {
go func(i int) {
err := p.Submit(wrapper(i, &amp;wg))
if err != nil {
fmt.Printf(&ldquo;task:%d err:%v\n&rdquo;, i, err)
wg.Done()
}
}(i)
}</p>
<p>wg.Wait()
}
ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬è®¾ç½® goroutine æ± çš„å®¹é‡ä¸º 4ï¼Œæœ€å¤§é˜»å¡é˜Ÿåˆ—é•¿åº¦ä¸º 2ã€‚ç„¶åä¸€ä¸ª for æäº¤ 8 ä¸ªä»»åŠ¡ï¼ŒæœŸæœ›ç»“æœæ˜¯ï¼š4 ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œï¼Œ2 ä¸ªä»»åŠ¡åœ¨ç­‰å¾…ï¼Œ2 ä¸ªä»»åŠ¡æäº¤å¤±è´¥ã€‚è¿è¡Œç»“æœï¼š</p>
<p>hello from task:8
hello from task:5
hello from task:4
hello from task:6
task:7 err:too many goroutines blocked on submit or Nonblocking is set
task:3 err:too many goroutines blocked on submit or Nonblocking is set
hello from task:1
hello from task:2
æˆ‘ä»¬çœ‹åˆ°æäº¤ä»»åŠ¡å¤±è´¥ï¼Œæ‰“å°too many goroutines blocked &hellip;ã€‚</p>
<p>ä»£ç ä¸­æœ‰ 4 ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<p>æäº¤ä»»åŠ¡å¿…é¡»å¹¶è¡Œè¿›è¡Œã€‚å¦‚æœæ˜¯ä¸²è¡Œæäº¤ï¼Œç¬¬ 5 ä¸ªä»»åŠ¡æäº¤æ—¶ç”±äºæ± ä¸­æ²¡æœ‰ç©ºé—²çš„ goroutine å¤„ç†è¯¥ä»»åŠ¡ï¼ŒSubmit()æ–¹æ³•ä¼šè¢«é˜»å¡ï¼Œåç»­ä»»åŠ¡å°±éƒ½ä¸èƒ½æäº¤äº†ã€‚ä¹Ÿå°±è¾¾ä¸åˆ°éªŒè¯çš„ç›®çš„äº†
ç”±äºä»»åŠ¡å¯èƒ½æäº¤å¤±è´¥ï¼Œå¤±è´¥çš„ä»»åŠ¡ä¸ä¼šå®é™…æ‰§è¡Œï¼Œæ‰€ä»¥å®é™…ä¸Šwg.Done()æ¬¡æ•°ä¼šå°äº 8ã€‚å› è€Œåœ¨err != nilåˆ†æ”¯ä¸­æˆ‘ä»¬éœ€è¦è°ƒç”¨ä¸€æ¬¡wg.Done()ã€‚å¦åˆ™wg.Wait()ä¼šæ°¸è¿œé˜»å¡
ä¸ºäº†é¿å…ä»»åŠ¡æ‰§è¡Œè¿‡å¿«ï¼Œç©ºå‡ºäº† goroutineï¼Œè§‚å¯Ÿä¸åˆ°ç°è±¡ï¼Œæ¯ä¸ªä»»åŠ¡ä¸­æˆ‘ä½¿ç”¨time.Sleep(1 * time.Second)ä¼‘çœ  1s
ç”±äº goroutine ä¹‹é—´çš„æ‰§è¡Œé¡ºåºæœªæ˜¾å¼åŒæ­¥ï¼Œæ•…æ¯æ¬¡æ‰§è¡Œçš„é¡ºåºä¸ç¡®å®š
ç”±äºç®€å•èµ·è§ï¼Œå‰é¢çš„ä¾‹å­ä¸­Submit()æ–¹æ³•çš„è¿”å›å€¼éƒ½è¢«æˆ‘ä»¬å¿½ç•¥äº†ã€‚å®é™…å¼€å‘ä¸­ä¸€å®šä¸è¦å¿½ç•¥ã€‚</p>
<p>éé˜»å¡
antsæ± é»˜è®¤æ˜¯é˜»å¡çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨WithNonblocking(nonblocking bool)è®¾ç½®å…¶ä¸ºéé˜»å¡ã€‚éé˜»å¡çš„antsæ± ä¸­ï¼Œåœ¨æ‰€æœ‰ goroutine éƒ½åœ¨å¤„ç†ä»»åŠ¡æ—¶ï¼Œæäº¤æ–°ä»»åŠ¡ä¼šç›´æ¥è¿”å›é”™è¯¯ï¼š</p>
<p>func main() {
p, _ := ants.NewPool(2, ants.WithNonblocking(true))
defer p.Release()</p>
<p>var wg sync.WaitGroup
wg.Add(3)
for i := 1; i &lt;= 3; i++ {
err := p.Submit(wrapper(i, &amp;wg))
if err != nil {
fmt.Printf(&ldquo;task:%d err:%v\n&rdquo;, i, err)
wg.Done()
}
}</p>
<p>wg.Wait()
}
ä½¿ç”¨ä¸Šä¸ªä¾‹å­ä¸­çš„wrapper()å‡½æ•°ï¼Œantsæ± å®¹é‡è®¾ç½®ä¸º 2ã€‚è¿ç»­æäº¤ 3 ä¸ªä»»åŠ¡ï¼ŒæœŸæœ›ç»“æœå‰ä¸¤ä¸ªä»»åŠ¡æ­£å¸¸æ‰§è¡Œï¼Œç¬¬ 3 ä¸ªä»»åŠ¡æäº¤æ—¶è¿”å›é”™è¯¯ï¼š</p>
<p>hello from task:2
task:3 err:too many goroutines blocked on submit or Nonblocking is set
hello from task:1
panic å¤„ç†å™¨
ä¸€ä¸ªé²æ£’æ€§å¼ºçš„åº“ä¸€å®šä¸ä¼šå¿½è§†é”™è¯¯çš„å¤„ç†ï¼Œç‰¹åˆ«æ˜¯å®•æœºç›¸å…³çš„é”™è¯¯ã€‚åœ¨ Go è¯­è¨€ä¸­å°±æ˜¯ panicï¼Œä¹Ÿè¢«ç§°ä¸ºè¿è¡Œæ—¶ææ…Œï¼Œåœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸¥é‡æ€§é”™è¯¯ï¼Œä¾‹å¦‚ç´¢å¼•è¶Šç•Œï¼Œç©ºæŒ‡é’ˆè§£å¼•ç”¨ç­‰ï¼Œéƒ½ä¼šè§¦å‘ panicã€‚å¦‚æœä¸å¤„ç† panicï¼Œç¨‹åºä¼šç›´æ¥æ„å¤–é€€å‡ºï¼Œå¯èƒ½é€ æˆæ•°æ®ä¸¢å¤±çš„ä¸¥é‡åæœã€‚</p>
<p>antsä¸­å¦‚æœ goroutine åœ¨æ‰§è¡Œä»»åŠ¡æ—¶å‘ç”Ÿpanicï¼Œä¼šç»ˆæ­¢å½“å‰ä»»åŠ¡çš„æ‰§è¡Œï¼Œå°†å‘ç”Ÿé”™è¯¯çš„å †æ ˆè¾“å‡ºåˆ°os.Stderrã€‚æ³¨æ„ï¼Œè¯¥ goroutine è¿˜æ˜¯ä¼šè¢«æ”¾å›æ± ä¸­ï¼Œä¸‹æ¬¡å¯ä»¥å–å‡ºæ‰§è¡Œæ–°çš„ä»»åŠ¡ã€‚</p>
<p>func wrapper(i int, wg *sync.WaitGroup) func() {
return func() {
fmt.Printf(&ldquo;hello from task:%d\n&rdquo;, i)
if i%2 == 0 {
panic(fmt.Sprintf(&ldquo;panic from task:%d&rdquo;, i))
}
wg.Done()
}
}</p>
<p>func main() {
p, _ := ants.NewPool(2)
defer p.Release()</p>
<p>var wg sync.WaitGroup
wg.Add(3)
for i := 1; i &lt;= 2; i++ {
p.Submit(wrapper(i, &amp;wg))
}</p>
<p>time.Sleep(1 * time.Second)
p.Submit(wrapper(3, &amp;wg))
p.Submit(wrapper(5, &amp;wg))
wg.Wait()
}
æˆ‘ä»¬è®©å¶æ•°ä¸ªä»»åŠ¡è§¦å‘panicã€‚æäº¤ä¸¤ä¸ªä»»åŠ¡ï¼Œç¬¬äºŒä¸ªä»»åŠ¡ä¸€å®šä¼šè§¦å‘panicã€‚è§¦å‘panicä¹‹åï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç»§ç»­æäº¤ä»»åŠ¡ 3ã€5ã€‚æ³¨æ„è¿™é‡Œæ²¡æœ‰ 4ï¼Œæäº¤ä»»åŠ¡ 4 è¿˜æ˜¯ä¼šè§¦å‘panicã€‚</p>
<p>ä¸Šé¢çš„ç¨‹åºéœ€è¦æ³¨æ„ 2 ç‚¹ï¼š</p>
<p>ä»»åŠ¡å‡½æ•°ä¸­wg.Done()æ˜¯åœ¨panicæ–¹æ³•ä¹‹åï¼Œå¦‚æœè§¦å‘äº†panicï¼Œå‡½æ•°ä¸­çš„å…¶ä»–æ­£å¸¸é€»è¾‘å°±ä¸ä¼šå†ç»§ç»­æ‰§è¡Œäº†ã€‚æ‰€ä»¥æˆ‘ä»¬è™½ç„¶wg.Add(3)ï¼Œä½†æ˜¯ä¸€å…±æäº¤äº† 4 ä¸ªä»»åŠ¡ï¼Œå…¶ä¸­ä¸€ä¸ªä»»åŠ¡è§¦å‘äº†panicï¼Œwg.Done()æ²¡æœ‰æ­£ç¡®æ‰§è¡Œã€‚å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨deferè¯­å¥æ¥ç¡®ä¿wg.Done()ä¸€å®šä¼šæ‰§è¡Œ
åœ¨ for å¾ªç¯ä¹‹åï¼Œæˆ‘æ·»åŠ äº†ä¸€è¡Œä»£ç time.Sleep(1 * time.Second)ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸€è¡Œï¼Œåç»­çš„ä¸¤æ¡Submit()æ–¹æ³•å¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»»åŠ¡å¾ˆå¿«å°±å®Œæˆäº†ï¼Œwg.Wait()ç›´æ¥è¿”å›äº†ï¼Œè¿™æ—¶panicçš„å †æ ˆè¿˜æ²¡æœ‰è¾“å‡ºã€‚ä½ å¯ä»¥å°è¯•æ³¨é‡Šæ‰è¿™è¡Œä»£ç è¿è¡Œçœ‹çœ‹ç»“æœ
é™¤äº†antsæä¾›çš„é»˜è®¤ panic å¤„ç†å™¨ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨WithPanicHandler(paincHandler func(interface{}))æŒ‡å®šæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ panic å¤„ç†å™¨ã€‚å¤„ç†å™¨çš„å‚æ•°å°±æ˜¯ä¼ ç»™panicçš„å€¼ï¼š</p>
<p>func panicHandler(err interface{}) {
fmt.Fprintln(os.Stderr, err)
}</p>
<p>p, _ := ants.NewPool(2, ants.WithPanicHandler(panicHandler))
defer p.Release()
å…¶ä½™ä»£ç ä¸ä¸Šé¢çš„å®Œå…¨ç›¸åŒï¼ŒæŒ‡å®šäº†panicHandleråè§¦å‘panicå°±ä¼šæ‰§è¡Œå®ƒã€‚è¿è¡Œï¼š</p>
<p>hello from task:2
panic from task:2
hello from task:1
hello from task:5
hello from task:3
çœ‹åˆ°è¾“å‡ºäº†ä¼ ç»™panicå‡½æ•°çš„å­—ç¬¦ä¸²ï¼ˆç¬¬äºŒè¡Œè¾“å‡ºï¼‰ã€‚</p>
<p>é»˜è®¤æ± 
ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå¾ˆå¤š Go åº“éƒ½å–œæ¬¢æä¾›å…¶æ ¸å¿ƒåŠŸèƒ½ç±»å‹çš„ä¸€ä¸ªé»˜è®¤å®ç°ã€‚å¯ä»¥ç›´æ¥é€šè¿‡åº“æä¾›çš„æ¥å£è°ƒç”¨ã€‚ä¾‹å¦‚net/httpï¼Œä¾‹å¦‚antsã€‚antsåº“ä¸­å®šä¹‰äº†ä¸€ä¸ªé»˜è®¤çš„æ± ï¼Œé»˜è®¤å®¹é‡ä¸ºMaxInt32ã€‚goroutine æ± çš„å„ä¸ªæ–¹æ³•éƒ½å¯ä»¥ç›´æ¥é€šè¿‡antsåŒ…ç›´æ¥è®¿é—®ï¼š</p>
<p>// src/github.com/panjf2000/ants/ants.go
defaultAntsPool, _ = NewPool(DefaultAntsPoolSize)</p>
<p>func Submit(task func()) error {
return defaultAntsPool.Submit(task)
}</p>
<p>func Running() int {
return defaultAntsPool.Running()
}</p>
<p>func Cap() int {
return defaultAntsPool.Cap()
}</p>
<p>func Free() int {
return defaultAntsPool.Free()
}</p>
<p>func Release() {
defaultAntsPool.Release()
}</p>
<p>func Reboot() {
defaultAntsPool.Reboot()
}
ç›´æ¥ä½¿ç”¨ï¼š</p>
<p>func main() {
defer ants.Release()</p>
<p>var wg sync.WaitGroup
wg.Add(2)
for i := 1; i &lt;= 2; i++ {
ants.Submit(wrapper(i, &amp;wg))
}
wg.Wait()
}
é»˜è®¤æ± ä¹Ÿéœ€è¦Release()ã€‚</p>
<p>æ€»ç»“
æœ¬æ–‡ä»‹ç»äº† goroutine æ± çš„ç”±æ¥ï¼Œå¹¶å€Ÿç”±antsåº“ä»‹ç»äº†åŸºæœ¬çš„ä½¿ç”¨æ–¹æ³•ï¼Œå’Œä¸€äº›ç»†èŠ‚ã€‚antsæºç ä¸å¤šï¼Œå»æ‰æµ‹è¯•çš„æ ¸å¿ƒä»£ç åªæœ‰ 1k è¡Œå·¦å³ï¼Œå»ºè®®æœ‰æ—¶é—´ã€æ„Ÿå…´è¶£çš„ç«¥é‹æ·±å…¥é˜…è¯»ã€‚</p>
<p>å¤§å®¶å¦‚æœå‘ç°å¥½ç©ã€å¥½ç”¨çš„ Go è¯­è¨€åº“ï¼Œæ¬¢è¿åˆ° Go æ¯æ—¥ä¸€åº“ GitHub ä¸Šæäº¤ issueğŸ˜„</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">Forz</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        2021-07-08
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/go/">Go</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/go%E7%9A%84%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Goçš„å‡½æ•°å¼ç¼–ç¨‹</span>
            <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
          </a>
        <a class="next" href="/post/%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84map%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/">
            <span class="next-text nav-default">åŸºæœ¬æ•°æ®ç»“æ„mapæºç å‰–æ</span>
            <span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="forz/forzblog.talk"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2021
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Forz</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>








</body>
</html>
