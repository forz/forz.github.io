<!DOCTYPE html>
<html lang="zh-cn" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>etcdctl命令操作 | Forz Blog</title>
<meta name="keywords" content="" />
<meta name="description" content="etcdctl v2 v3 etcd2和etcd3是不兼容的，两者的api参数也不一样，详细请查看 etcdctl -h 。 可以使用api2 和 api3 写入 etcd3 数据，但是需要注意，使用不同的a">
<meta name="author" content="">
<link rel="canonical" href="/post/etcdctl%E5%91%BD%E4%BB%A4%E6%93%8D%E4%BD%9C/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.00d5d4fc479b1575183ee8d86b4fb372ba9d9b1904e96fa8e4c40ff7debe2b94.css" integrity="sha256-ANXU/EebFXUYPujYa0&#43;zcrqdmxkE6W&#43;o5MQP996&#43;K5Q=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.87.0" />
<meta property="og:title" content="etcdctl命令操作" />
<meta property="og:description" content="etcdctl v2 v3 etcd2和etcd3是不兼容的，两者的api参数也不一样，详细请查看 etcdctl -h 。 可以使用api2 和 api3 写入 etcd3 数据，但是需要注意，使用不同的a" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/etcdctl%E5%91%BD%E4%BB%A4%E6%93%8D%E4%BD%9C/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2019-06-23T13:40:47&#43;00:00" />
<meta property="article:modified_time" content="2019-06-23T13:40:47&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="etcdctl命令操作"/>
<meta name="twitter:description" content="etcdctl v2 v3 etcd2和etcd3是不兼容的，两者的api参数也不一样，详细请查看 etcdctl -h 。 可以使用api2 和 api3 写入 etcd3 数据，但是需要注意，使用不同的a"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "/post/"
    }
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "etcdctl命令操作",
      "item": "/post/etcdctl%E5%91%BD%E4%BB%A4%E6%93%8D%E4%BD%9C/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "etcdctl命令操作",
  "name": "etcdctl命令操作",
  "description": "etcdctl v2 v3 etcd2和etcd3是不兼容的，两者的api参数也不一样，详细请查看 etcdctl -h 。 可以使用api2 和 api3 写入 etcd3 数据，但是需要注意，使用不同的a",
  "keywords": [
    
  ],
  "articleBody": "etcdctl v2 v3 etcd2和etcd3是不兼容的，两者的api参数也不一样，详细请查看 etcdctl -h 。 可以使用api2 和 api3 写入 etcd3 数据，但是需要注意，使用不同的api版本写入数据需要使用相应的api版本读取数据。\n默认，为了向后兼容 etcdctl 使用 v2 API 来和 etcd 服务器通讯。为了让 etcdctl 使用 v3 API 来和etcd通讯，API 版本必须通过环境变量 ETCDCTL_API 设置为版本3。\nETCDCTL_API=2 缺省使用 ETCDCTL_API=2\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48  [root@vStacketcd-v3.0.15-linux-amd64]# ./etcdctl help NAME:etcdctl-Asimplecommandlineclientforetcd.USAGE:etcdctl[globaloptions]command[commandoptions][arguments...]VERSION:3.0.15COMMANDS:1.backupbackupanetcddirectory2.cluster-healthcheckthehealthoftheetcdcluster3.mkmakeanewkeywithagivenvalue4.mkdirmakeanewdirectory5.rmremoveakeyoradirectory6.rmdirremovesthekeyifitisanemptydirectoryorakey-valuepair7.getretrievethevalueofakey8.lsretrieveadirectory9.setsetthevalueofakey10.setdircreateanewdirectoryorupdateanexistingdirectoryTTL11.updateupdateanexistingkeywithagivenvalue12.updatedirupdateanexistingdirectory13.watchwatchakeyforchanges14.exec-watchwatchakeyforchangesandexecanexecutable15.membermemberadd,removeandlistsubcommands16.importimportasnapshottoacluster17.useruseradd,grantandrevokesubcommands18.roleroleadd,grantandrevokesubcommands19.authoverallauthcontrolsGLOBALOPTIONS:--debugoutputcURLcommandswhichcanbeusedtoreproducetherequest--no-syncdon't synchronize cluster information before sending request --output simple, -o simple output response in the given format (simple, `extended` or `json`) (default: \"simple\") --discovery-srv value, -D value domain name to query for SRV records describing cluster endpoints --insecure-discovery accept insecure SRV records describing cluster endpoints --peers value, -C value DEPRECATED - \"--endpoints\" should be used instead --endpoint value DEPRECATED - \"--endpoints\" should be used instead --endpoints value a comma-delimited list of machine addresses in the cluster (default: \"http://127.0.0.1:2379,http://127.0.0.1:4001\") --cert-file value identify HTTPS client using this SSL certificate file --key-file value identify HTTPS client using this SSL key file --ca-file value verify certificates of HTTPS-enabled servers using this CA bundle --username value, -u value provide username[:password] and prompt if password is not supplied. --timeout value connection timeout per request (default: 1s) --total-timeout value timeout for the command execution (except watch) (default: 5s) --help, -h show help --version, -v print the version   ETCDCTL_API=3 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88  export ETCDCTL_API=3 [root@vStack etcd-v3.0.15-linux-amd64]# ./etcdctl --help NAME: etcdctl - A simple command line client for etcd3. USAGE: etcdctl VERSION: 3.0.15 COMMANDS: 1. get\tGets the key or a range of keys etcdctl get [options]  [range_end] OPTIONS: --consistency=\"l\"\tLinearizable(l) or Serializable(s) --from-key[=false]\tGet keys that are greater than or equal to the given key --keys-only[=false]\tGet only the keys --limit=0\tMaximum number of results --order=\"\"\tOrder of results; ASCEND or DESCEND --prefix[=false]\tGet keys with matching prefix --rev=0\tSpecify the kv revision --sort-by=\"\"\tSort target; CREATE, KEY, MODIFY, VALUE, or VERSION 2. put\tPuts the given key into the store 3. del\tRemoves the specified key or range of keys [key, range_end) 4. txn\tTxn processes all the requests in one transaction 5. compaction\tCompacts the event history in etcd 。 etcd支持历史数据的读取，为了避免积累无限历史数据。compacting操作后，etcd将删除历史的版本数据，释放资源为后面使用。在compacted 版本前的数据都将无效。 6. alarm disarm\tDisarms all alarms 7. alarm list\tLists all alarms 8. defrag\tDefragments the storage of the etcd members with given endpoints 9. endpoint health\tChecks the healthiness of endpoints specified in `--endpoints` flag 10. endpoint status\tPrints out the status of endpoints specified in `--endpoints` flag 11. watch\tWatches events stream on keys or prefixes 12. version\tPrints the version of etcdctl 13. lease grant\tCreates leases 14. lease revoke\tRevokes leases 15. lease keep-alive\tKeeps leases alive (renew) 16. member add\tAdds a member into the cluster 17. member remove\tRemoves a member from the cluster 18. member update\tUpdates a member in the cluster 19. member list\tLists all members in the cluster 20. snapshot save\tStores an etcd node backend snapshot to a given file 21. snapshot restore\tRestores an etcd member snapshot to an etcd directory 22. snapshot status\tGets backend snapshot status of a given file 23. make-mirror\tMakes a mirror at the destination etcd cluster 24. migrate\tMigrates keys in a v2 store to a mvcc store 25. lock\tAcquires a named lock 26. elect\tObserves and participates in leader election 27. auth enable\tEnables authentication 28. auth disable\tDisables authentication 29. user add\tAdds a new user 30. user delete\tDeletes a user 31. user get\tGets detailed information of a user 32. user list\tLists all users 33. user passwd\tChanges password of user 34. user grant-role\tGrants a role to a user 35. user revoke-role\tRevokes a role from a user 36. role add\tAdds a new role 37. role delete\tDeletes a role 38. role get\tGets detailed information of a role 39. role list\tLists all roles 40. role grant-permission\tGrants a key to a role 41. role revoke-permission\tRevokes a key from a role 42. help\tHelp about any command OPTIONS: --cacert=\"\"\tverify certificates of TLS-enabled secure servers using this CA bundle --cert=\"\"\tidentify secure client using this TLS certificate file --command-timeout=5s\ttimeout for short running command (excluding dial timeout) --dial-timeout=2s\tdial timeout for client connections --endpoints=[127.0.0.1:2379]\tgRPC endpoints --hex[=false]\tprint byte strings as hex encoded strings --insecure-skip-tls-verify[=false]\tskip server certificate verification --insecure-transport[=true]\tdisable transport security for client connections --key=\"\"\tidentify secure client using this TLS key file --user=\"\"\tusername[:password] for authentication (prompt if password is not supplied) -w, --write-out=\"simple\"\tset the output format (simple, json, etc..)   常用命令 增删改查 增 1  etcdctl --endpoints=$ENDPOINTS put foo \"Hello World!\"   查 1 2  etcdctl --endpoints=$ENDPOINTS get foo etcdctl --endpoints=$ENDPOINTS --write-out=\"json\" get foo   基于相同前缀查找\n1 2 3 4 5  etcdctl --endpoints=$ENDPOINTS put web1 value1 etcdctl --endpoints=$ENDPOINTS put web2 value2 etcdctl --endpoints=$ENDPOINTS put web3 value3 etcdctl --endpoints=$ENDPOINTS get web --prefix   删 1 2 3 4 5 6  etcdctl --endpoints=$ENDPOINTS put key myvalue etcdctl --endpoints=$ENDPOINTS del key etcdctl --endpoints=$ENDPOINTS put k1 value1 etcdctl --endpoints=$ENDPOINTS put k2 value2 etcdctl --endpoints=$ENDPOINTS del k --prefix   集群状态 集群状态主要是etcdctl endpoint status 和etcdctl endpoint health两条命令。\n1 2 3 4 5 6 7 8 9  etcdctl --write-out=table --endpoints=$ENDPOINTS endpoint status +------------------+------------------+---------+---------+-----------+-----------+------------+ | ENDPOINT | ID | VERSION | DB SIZE | IS LEADER | RAFT TERM | RAFT INDEX | +------------------+------------------+---------+---------+-----------+-----------+------------+ | 10.240.0.17:2379 | 4917a7ab173fabe7 | 3.0.0 | 45 kB | true | 4 | 16726 | | 10.240.0.18:2379 | 59796ba9cd1bcd72 | 3.0.0 | 45 kB | false | 4 | 16726 | | 10.240.0.19:2379 | 94df724b66343e6c | 3.0.0 | 45 kB | false | 4 | 16726 | +------------------+------------------+---------+---------+-----------+-----------+------------+   1 2 3 4 5  etcdctl --endpoints=$ENDPOINTS endpoint health 10.240.0.17:2379 is healthy: successfully committed proposal: took = 3.345431ms 10.240.0.19:2379 is healthy: successfully committed proposal: took = 3.767967ms 10.240.0.18:2379 is healthy: successfully committed proposal: took = 4.025451ms   集群成员 跟集群成员相关的命令如下：\n1 2 3 4  member add Adds a member into the cluster member remove Removes a member from the cluster member update Updates a member in the cluster member list Lists all members in the cluster   例如 etcdctl member list列出集群成员的命令。\n1 2 3 4 5 6 7 8  etcdctl --endpoints=http://172.16.5.4:12379 member list -w table +-----------------+---------+-------+------------------------+-----------------------------------------------+ | ID | STATUS | NAME | PEER ADDRS | CLIENT ADDRS | +-----------------+---------+-------+------------------------+-----------------------------------------------+ | c856d92a82ba66a | started | etcd0 | http://172.16.5.4:2380 | http://172.16.5.4:2379,http://172.16.5.4:4001 | +-----------------+---------+-------+------------------------+-----------------------------------------------+ ---------------------   身份验证 etcd 默认是没有开启访问控制的，如果我们开启外网访问的话就需要考虑访问控制的问题，etcd 提供了两种访问控制的方式：\n 基于身份验证的访问控制 基于证书的访问控制  这节主要是选择第一种方式，进行的讲解.\nroot 用户 root 是 etcd 的超级管理员，拥有 etcd 的所有权限，在开启角色认证之前为们必须要先建立好 root 用户。还需要注意的是 root 用户必须拥有 root 的角色,允许在 etcd 的所有操作.\nroot 角色 root 角色可以赋予任何用户，拥有 root 角色的用户有全局读写权限和集群身份验证配置权限，此外，还具有修改集群成员身份，碎片整理，建立快照等权限。\n用户操作 查看用户列表：\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 user list   创建用户：\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 user add user1   用户可以被赋予角色，也可以被撤销角色：\n赋予权限:\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 user grant --roles root user1   撤销权限:\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 user revoke --roles root user1   修改用户密码：\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 user passwd user1   角色操作 角色列表:\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role list   创建角色:\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role add myrolename   角色没有密码，仅仅是定义的一组访问权限\n角色的访问权限可以被赋予read（读）,write（写）,readwrite（读和写）权限\n赋予访问权限范例：\n给 role1 角色赋予键 /foo 的读操作\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role grant role1 --path /foo --read   给 role1 角色赋予键 /foo 的写操作\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role grant role1 --path /foo --write   给 role1 角色赋予键 /foo 读写操作\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role grant role1 --path /foo --rw   给 role1 角色赋予键 /foo 目录读写操作\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role grant role1 --path /foo/* --rw   收回访问权限范例：\n收回 role1 角色对 /foo 的读操作\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role revoke role1 --path /foo --read   收回 role1 角色对 /foo 的写操作\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role revoke role1 --path /foo --write   收回 role1 角色对 /foo 的读写操作\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role revoke role1 --path /foo --rw   收回 role1 角色对 /foo 目录的读写操作\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role revoke role1 --path /foo/* --rw   查看角色访问权限:\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role get role1   删除角色 :\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role remove role1   开启身份验证 1.增加root用户:\n1 2  $ etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 user add root Password of root:   2.开启身份验证:\n1  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 etcdctl auth enable   至此，身份验证已经开启，执行下面命令\n1 2  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 set /foo bar //返回bar   这里出现了一个问题，我们已经开启了身份访问验证，却仍然可以不通过任何身份进行操作，这是什么原因呢？其实是因为在 Etcd 开启 Basic Auth 之后，默认会启用两个角色 root 和 guest， root 和 guest 角色都拥有所有权限，当我们未指定身份的时候其实是通过 guest 角色进行的操作，这里需要注意的是两个角色都不要删除，否则你可能会遇到意想不到的Bug，既然无法删除，那么为们可以通过收回权限的方式对 guest 的权限进行限制，执行下面代码：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  etcdctl --ca-file /root/cfssl/ca.pem --username root:passwod --endpoints https://192.168.3.3:2379 ro le revoke guest --path '/*' --rw //返回：Role guest updated //查看guest最新的权限信息 etcdctl --ca-file /root/cfssl/ca.pem --username root:passwod --endpoints https://192.168.3.3:2379 ro le get guest //返回 ： // Role: guest // KV Read: // KV Write: // ok 收回权限成功   继续执行之前的set代码 ：\n1 2  etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 set /foo bar //Error: 110: The request requires user authentication (Insufficient credentials) [0]   如我们所愿的已经不可以对 etcd 进行操作了，下面我们创建一个用户并赋予一个新建的角色试试：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  # 创建user2用户 etcdctl --ca-file /root/cfssl/ca.pem --username root:passwod --endpoints https://192.168.3.3:2379 user add user2 New password: //返回 ：User user2 created # 创建role2角色 etcdctl --ca-file /root/cfssl/ca.pem --username root:passwod --endpoints https://192.168.3.3:2379 role add role2 Role role2 created # 赋予role2 角色权限 etcdctl --ca-file /root/cfssl/ca.pem --username root:passwod --endpoints https://192.168.3.3:2379 ro le grant role2 --path /foo --rw Role role2 updated # 将用户user2赋予角色role2 etcdctl --ca-file /root/cfssl/ca.pem --username root:passwod --endpoints https://192.168.3.3:2379 us er grant --roles role2 user2 User user2 updated # 设置 foo 值 etcdctl --ca-file /root/cfssl/ca.pem --username user2:passwod --endpoints https://192.168.3.3:2379:2379 set foo bar bar   参考:\nhttps://blog.csdn.net/huwh_/article/details/80225902\nhttps://blog.csdn.net/kozazyh/article/details/79586530\nhttps://blog.csdn.net/huwh_/article/details/80225902\nhttp://www.artacode.com/posts/etcd/auth/\n",
  "wordCount" : "2718",
  "inLanguage": "zh-cn",
  "datePublished": "2019-06-23T13:40:47Z",
  "dateModified": "2019-06-23T13:40:47Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/etcdctl%E5%91%BD%E4%BB%A4%E6%93%8D%E4%BD%9C/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Forz Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="Forz Blog (Alt + H)">Forz Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="/post/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      etcdctl命令操作
    </h1>
    <div class="post-meta">June 23, 2019
</div>
  </header> 
  <div class="post-content"><h1 id="etcdctl-v2-v3">etcdctl v2 v3<a hidden class="anchor" aria-hidden="true" href="#etcdctl-v2-v3">#</a></h1>
<p>etcd2和etcd3是不兼容的，两者的api参数也不一样，详细请查看 etcdctl -h 。
可以使用api2 和 api3 写入 etcd3 数据，但是需要注意，使用不同的api版本写入数据需要使用相应的api版本读取数据。</p>
<p>默认，为了向后兼容 etcdctl 使用 v2 API 来和 etcd 服务器通讯。为了让 etcdctl 使用 v3 API 来和etcd通讯，API 版本必须通过环境变量 ETCDCTL_API 设置为版本3。</p>
<h1 id="etcdctl_api2">ETCDCTL_API=2<a hidden class="anchor" aria-hidden="true" href="#etcdctl_api2">#</a></h1>
<p>缺省使用  ETCDCTL_API=2</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="n">vStack</span><span class="w"> </span><span class="n">etcd</span><span class="o">-</span><span class="n">v3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">15</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">amd64</span><span class="p">]</span><span class="c1"># ./etcdctl help
</span><span class="c1"></span><span class="n">NAME</span><span class="p">:</span><span class="w">
</span><span class="w">　　</span><span class="n">etcdctl</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">simple</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">etcd</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">USAGE</span><span class="p">:</span><span class="w">
</span><span class="w">　　</span><span class="n">etcdctl</span><span class="w"> </span><span class="p">[</span><span class="n">global</span><span class="w"> </span><span class="n">options</span><span class="p">]</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="p">[</span><span class="n">command</span><span class="w"> </span><span class="n">options</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">arguments</span><span class="p">...]</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">VERSION</span><span class="p">:</span><span class="w">
</span><span class="w">　　</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">15</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">COMMANDS</span><span class="p">:</span><span class="w">
</span><span class="w">　　</span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="n">backup</span><span class="w"> 　　　　　　　　 　　 　　 </span><span class="n">backup</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">etcd</span><span class="w"> </span><span class="n">directory</span><span class="w">
</span><span class="w">　　</span><span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="n">cluster</span><span class="o">-</span><span class="n">health</span><span class="w"> 　　　　　　　　　　</span><span class="k">check</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">health</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">etcd</span><span class="w"> </span><span class="n">cluster</span><span class="w">
</span><span class="w">　　</span><span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="n">mk</span><span class="w"> 　　　　　　　　　　　　　　　 </span><span class="n">make</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">given</span><span class="w"> </span><span class="n">value</span><span class="w">
</span><span class="w">　　</span><span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="n">mkdir</span><span class="w"> 　　　　　　　　　　　　　　</span><span class="n">make</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">directory</span><span class="w">
</span><span class="w">　　</span><span class="mi">5</span><span class="p">.</span><span class="w"> </span><span class="n">rm</span><span class="w"> 　　　　　　　　　　　　　　　 </span><span class="n">remove</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">directory</span><span class="w">
</span><span class="w">　　</span><span class="mi">6</span><span class="p">.</span><span class="w"> </span><span class="n">rmdir</span><span class="w"> 　　　　　　　　　　　　　　</span><span class="n">removes</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">key</span><span class="o">-</span><span class="n">value</span><span class="w"> </span><span class="n">pair</span><span class="w">
</span><span class="w">　　</span><span class="mi">7</span><span class="p">.</span><span class="w"> </span><span class="n">get</span><span class="w"> 　　　　　　　　　　　　　　   </span><span class="n">retrieve</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">key</span><span class="w">
</span><span class="w">　　</span><span class="mi">8</span><span class="p">.</span><span class="w"> </span><span class="n">ls</span><span class="w"> 　　　　　　　　　　　　　　　　</span><span class="n">retrieve</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">directory</span><span class="w">
</span><span class="w">　　</span><span class="mi">9</span><span class="p">.</span><span class="w"> </span><span class="kt">set</span><span class="w"> 　　　　　  　　　　　　　　　 </span><span class="kt">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">key</span><span class="w">
</span><span class="w">　　</span><span class="mi">10</span><span class="p">.</span><span class="w"> </span><span class="n">setdir</span><span class="w"> 　　　　　　　　　　　　　</span><span class="k">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">existing</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="n">TTL</span><span class="w">
</span><span class="w">　　</span><span class="mi">11</span><span class="p">.</span><span class="w"> </span><span class="k">update</span><span class="w"> 　　　　　　　　　　　    </span><span class="k">update</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">existing</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">given</span><span class="w"> </span><span class="n">value</span><span class="w">
</span><span class="w">　　</span><span class="mi">12</span><span class="p">.</span><span class="w"> </span><span class="n">updatedir</span><span class="w"> 　　　　　　　　　　   </span><span class="k">update</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">existing</span><span class="w"> </span><span class="n">directory</span><span class="w">
</span><span class="w">　　</span><span class="mi">13</span><span class="p">.</span><span class="w"> </span><span class="n">watch</span><span class="w"> 　　　　　　　　　　　　  </span><span class="n">watch</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">changes</span><span class="w">
</span><span class="w">　　</span><span class="mi">14</span><span class="p">.</span><span class="w"> </span><span class="n">exec</span><span class="o">-</span><span class="n">watch</span><span class="w"> 　　　　　　　　　　</span><span class="n">watch</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">changes</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">exec</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">executable</span><span class="w">
</span><span class="w">　　</span><span class="mi">15</span><span class="p">.</span><span class="w"> </span><span class="n">member</span><span class="w"> 　　　　　　　　　　     </span><span class="n">member</span><span class="w"> </span><span class="k">add</span><span class="p">,</span><span class="w"> </span><span class="n">remove</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">subcommands</span><span class="w">
</span><span class="w">　　</span><span class="mi">16</span><span class="p">.</span><span class="w"> </span><span class="n">import</span><span class="w"> 　　　　　　　 　　　　　 </span><span class="n">import</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">cluster</span><span class="w">
</span><span class="w">　　</span><span class="mi">17</span><span class="p">.</span><span class="w"> </span><span class="k">user</span><span class="w"> 　　　　　　　　　　　　　  </span><span class="k">user</span><span class="w"> </span><span class="k">add</span><span class="p">,</span><span class="w"> </span><span class="k">grant</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">revoke</span><span class="w"> </span><span class="n">subcommands</span><span class="w">
</span><span class="w">　　</span><span class="mi">18</span><span class="p">.</span><span class="w"> </span><span class="n">role</span><span class="w"> 　　　　　　　　　　　　　　</span><span class="n">role</span><span class="w"> </span><span class="k">add</span><span class="p">,</span><span class="w"> </span><span class="k">grant</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">revoke</span><span class="w"> </span><span class="n">subcommands</span><span class="w">
</span><span class="w">　　</span><span class="mi">19</span><span class="p">.</span><span class="w"> </span><span class="n">auth</span><span class="w"> 　　　　　　　　　　　　　 </span><span class="n">overall</span><span class="w"> </span><span class="n">auth</span><span class="w"> </span><span class="n">controls</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">GLOBAL</span><span class="w"> </span><span class="n">OPTIONS</span><span class="p">:</span><span class="w">
</span><span class="w"></span><span class="o">--</span><span class="n">debug</span><span class="w"> 　　　　　　　　　　　　　　　　　　 </span><span class="n">output</span><span class="w"> </span><span class="n">cURL</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">reproduce</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">request</span><span class="w">
</span><span class="w"></span><span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">sync</span><span class="w"> 　　　　　　　　　　　　　　　　    </span><span class="n">don</span><span class="s1">&#39;t synchronize cluster information before sending request
</span><span class="s1">--output simple, -o simple 　　　　　　　　   output response in the given format (simple, `extended` or `json`) (default: &#34;simple&#34;)
</span><span class="s1">--discovery-srv value, -D value 　　　　　　  domain name to query for SRV records describing cluster endpoints
</span><span class="s1">--insecure-discovery 　　　　　　　　　　　　accept insecure SRV records describing cluster endpoints
</span><span class="s1">--peers value, -C value 　　　　　　　　　　  DEPRECATED - &#34;--endpoints&#34; should be used instead
</span><span class="s1">--endpoint value 　　　　　　　　　　　　　　DEPRECATED - &#34;--endpoints&#34; should be used instead
</span><span class="s1">--endpoints value 　　　　　　　　　　　　　 a comma-delimited list of machine addresses in the cluster (default: &#34;http://127.0.0.1:2379,http://127.0.0.1:4001&#34;)
</span><span class="s1">--cert-file value 　　　　　　　　　　　　　　  identify HTTPS client using this SSL certificate file
</span><span class="s1">--key-file value 　　　　　　　　　　　　　　   identify HTTPS client using this SSL key file
</span><span class="s1">--ca-file value 　　　　　　　　　　　　　　　  verify certificates of HTTPS-enabled servers using this CA bundle
</span><span class="s1">--username value, -u value 　　　　　　　　   provide username[:password] and prompt if password is not supplied.
</span><span class="s1">--timeout value 　　　　　　　　　　　　　　  connection timeout per request (default: 1s)
</span><span class="s1">--total-timeout value 　　　　　　　　　　　　timeout for the command execution (except watch) (default: 5s)
</span><span class="s1">--help, -h 　　　　　　　　　　　　　　　　     show help
</span><span class="s1">--version, -v 　　　　　　　　　　　　　　　　 print the version
</span></code></pre></td></tr></table>
</div>
</div><h1 id="etcdctl_api3">ETCDCTL_API=3<a hidden class="anchor" aria-hidden="true" href="#etcdctl_api3">#</a></h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"> export ETCDCTL_API=3

[root@vStack etcd-v3.0.15-linux-amd64]# ./etcdctl --help

NAME:
　　etcdctl - A simple command line client for etcd3.

USAGE:
　　etcdctl

VERSION:
　　3.0.15

COMMANDS:
　　1. get	　　　　　　　　　　　　Gets the key or a range of keys

　　　　　　etcdctl get [options] &lt;key&gt; [range_end]

　　　　　　OPTIONS:

　　　　　　　　--consistency=&#34;l&#34;	　　　　　　	Linearizable(l) or Serializable(s)
　　　　　　　　--from-key[=false]	　　　　　  Get keys that are greater than or equal to the given key
　　　　　　　　--keys-only[=false]	　　　　　 Get only the keys
　　　　　　　　--limit=0	　　　　　　　　　　  Maximum number of results
　　　　　　　　--order=&#34;&#34;	　　　　　　　　　　Order of results; ASCEND or DESCEND
　　　　　　　　--prefix[=false]	　　　　　　　  Get keys with matching prefix
　　　　　　　　--rev=0	　　　　　　　　　　   	Specify the kv revision
　　　　　　　　--sort-by=&#34;&#34;	　　　　　　　　  	Sort target; CREATE, KEY, MODIFY, VALUE, or VERSION


　　2. put	　　　　　　　　　　　　Puts the given key into the store
　　3. del	　　　　　　　　	　　　　Removes the specified key or range of keys [key, range_end)
　　4. txn	　　　　　　　　　　　　Txn processes all the requests in one transaction
　　5. compaction	　　　　　　 　  Compacts the event history in etcd  。 etcd支持历史数据的读取，为了避免积累无限历史数据。compacting操作后，etcd将删除历史的版本数据，释放资源为后面使用。在compacted 版本前的数据都将无效。




　　6. alarm disarm	　　　 　　　　Disarms all alarms
　　7. alarm list	　　　　　 　　　　Lists all alarms
　　8. defrag	　　　　　　 	　　　　Defragments the storage of the etcd members with given endpoints
　　9. endpoint health	　　　　　　Checks the healthiness of endpoints specified in `--endpoints` flag
　　10. endpoint status	　　	　　  Prints out the status of endpoints specified in `--endpoints` flag
　　11. watch	　　　　　　　　　　 Watches events stream on keys or prefixes
　　12. version	　　　　　　　　    Prints the version of etcdctl
　　13. lease grant	　　　　　　　  Creates leases
　　14. lease revoke	　　　　　　 	Revokes leases
　　15. lease keep-alive	　　　　　Keeps leases alive (renew)
　　16. member add	　　　　　　  Adds a member into the cluster
　　17. member remove	　　　　 	Removes a member from the cluster
　　18. member update	　　　　  	Updates a member in the cluster
　　19. member list	　　　　　　  	Lists all members in the cluster
　　20. snapshot save	　　　　　  Stores an etcd node backend snapshot to a given file
　　21. snapshot restore	　　　　 Restores an etcd member snapshot to an etcd directory
　　22. snapshot status	　　　　 	Gets backend snapshot status of a given file
　　23. make-mirror	　　　　　　  Makes a mirror at the destination etcd cluster
　　24. migrate	　　　　　　　　 　Migrates keys in a v2 store to a mvcc store
　　25. lock	　　　　　　　　　　   Acquires a named lock
　　26. elect	　　　　　　　　　　 	Observes and participates in leader election
　　27. auth enable	　　　　　　  	Enables authentication
　　28. auth disable	　　　　　　 	Disables authentication
　　29. user add	　　　　　　　　	Adds a new user
　　30. user delete	　　　　　　　 Deletes a user
　　31. user get	　　　　　　　　 	Gets detailed information of a user
　　32. user list	　　　　　　　　 	Lists all users
　　33. user passwd	　　　　　　	Changes password of user
　　34. user grant-role	　　　　　 Grants a role to a user
　　35. user revoke-role	　　　　 Revokes a role from a user
　　36. role add	　　　　　　　　 	Adds a new role
　　37. role delete	　　　　　　    	Deletes a role
　　38. role get	　　　　　　　　  	Gets detailed information of a role
　　39. role list	　　　　　　　　　 Lists all roles
　　40. role grant-permission	　　Grants a key to a role
　　41. role revoke-permission	　 Revokes a key from a role
　　42. help	　　	　　　　　　　　 Help about any command

OPTIONS:  
　　--cacert=&#34;&#34;	　　　　　　　　　　	　　　　	verify certificates of TLS-enabled secure servers using this CA bundle
　　--cert=&#34;&#34;	　　　　　　　　　　　　　　　　identify secure client using this TLS certificate file
　　--command-timeout=5s	　　　　　　　　	timeout for short running command (excluding dial timeout)
　　--dial-timeout=2s	　　　　　　　　　　   	dial timeout for client connections
　　--endpoints=[127.0.0.1:2379]	　　　　   gRPC endpoints
　　--hex[=false]	　　　　　　　　　　　　　   print byte strings as hex encoded strings
　　--insecure-skip-tls-verify[=false]	　　　　skip server certificate verification
　　--insecure-transport[=true]	　　　　　　	disable transport security for client connections
　　--key=&#34;&#34;	　　　　　　　　　　　　　　　　	identify secure client using this TLS key file
　　--user=&#34;&#34;	　　　　　　　　　　　　　　　  username[:password] for authentication (prompt if password is not supplied)
　　-w, --write-out=&#34;simple&#34;	　　　　　　　　	set the output format (simple, json, etc..)
</code></pre></td></tr></table>
</div>
</div><h1 id="常用命令">常用命令<a hidden class="anchor" aria-hidden="true" href="#常用命令">#</a></h1>
<h2 id="增删改查">增删改查<a hidden class="anchor" aria-hidden="true" href="#增删改查">#</a></h2>
<h3 id="增">增<a hidden class="anchor" aria-hidden="true" href="#增">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --endpoints=$ENDPOINTS put foo &#34;Hello World!&#34;
</code></pre></td></tr></table>
</div>
</div><h3 id="查">查<a hidden class="anchor" aria-hidden="true" href="#查">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">etcdctl --endpoints<span class="o">=</span><span class="nv">$ENDPOINTS</span> get foo
etcdctl --endpoints<span class="o">=</span><span class="nv">$ENDPOINTS</span> --write-out<span class="o">=</span><span class="s2">&#34;json&#34;</span> get foo
</code></pre></td></tr></table>
</div>
</div><p>基于相同前缀查找</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --endpoints=$ENDPOINTS put web1 value1
etcdctl --endpoints=$ENDPOINTS put web2 value2
etcdctl --endpoints=$ENDPOINTS put web3 value3

etcdctl --endpoints=$ENDPOINTS get web --prefix
</code></pre></td></tr></table>
</div>
</div><h3 id="删">删<a hidden class="anchor" aria-hidden="true" href="#删">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --endpoints=$ENDPOINTS put key myvalue
etcdctl --endpoints=$ENDPOINTS del key

etcdctl --endpoints=$ENDPOINTS put k1 value1
etcdctl --endpoints=$ENDPOINTS put k2 value2
etcdctl --endpoints=$ENDPOINTS del k --prefix
</code></pre></td></tr></table>
</div>
</div><h2 id="集群状态">集群状态<a hidden class="anchor" aria-hidden="true" href="#集群状态">#</a></h2>
<p>集群状态主要是etcdctl endpoint status 和etcdctl endpoint health两条命令。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --write-out=table --endpoints=$ENDPOINTS endpoint status

+------------------+------------------+---------+---------+-----------+-----------+------------+
|     ENDPOINT     |        ID        | VERSION | DB SIZE | IS LEADER | RAFT TERM | RAFT INDEX |
+------------------+------------------+---------+---------+-----------+-----------+------------+
| 10.240.0.17:2379 | 4917a7ab173fabe7 | 3.0.0   | 45 kB   | true      |         4 |      16726 |
| 10.240.0.18:2379 | 59796ba9cd1bcd72 | 3.0.0   | 45 kB   | false     |         4 |      16726 |
| 10.240.0.19:2379 | 94df724b66343e6c | 3.0.0   | 45 kB   | false     |         4 |      16726 |
+------------------+------------------+---------+---------+-----------+-----------+------------+
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --endpoints=$ENDPOINTS endpoint health

10.240.0.17:2379 is healthy: successfully committed proposal: took = 3.345431ms
10.240.0.19:2379 is healthy: successfully committed proposal: took = 3.767967ms
10.240.0.18:2379 is healthy: successfully committed proposal: took = 4.025451ms
</code></pre></td></tr></table>
</div>
</div><h2 id="集群成员">集群成员<a hidden class="anchor" aria-hidden="true" href="#集群成员">#</a></h2>
<p>跟集群成员相关的命令如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">    member add          Adds a member into the cluster
    member remove       Removes a member from the cluster
    member update       Updates a member in the cluster
    member list         Lists all members in the cluster
</code></pre></td></tr></table>
</div>
</div><p>例如 etcdctl member list列出集群成员的命令。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --endpoints=http://172.16.5.4:12379 member list -w table

+-----------------+---------+-------+------------------------+-----------------------------------------------+
|       ID        | STATUS  | NAME  |       PEER ADDRS       |                 CLIENT ADDRS                  |
+-----------------+---------+-------+------------------------+-----------------------------------------------+
| c856d92a82ba66a | started | etcd0 | http://172.16.5.4:2380 | http://172.16.5.4:2379,http://172.16.5.4:4001 |
+-----------------+---------+-------+------------------------+-----------------------------------------------+
---------------------
</code></pre></td></tr></table>
</div>
</div><h1 id="身份验证">身份验证<a hidden class="anchor" aria-hidden="true" href="#身份验证">#</a></h1>
<p>etcd 默认是没有开启访问控制的，如果我们开启外网访问的话就需要考虑访问控制的问题，etcd 提供了两种访问控制的方式：</p>
<ol>
<li>基于身份验证的访问控制</li>
<li>基于证书的访问控制</li>
</ol>
<p>这节主要是选择第一种方式，进行的讲解.</p>
<h2 id="root-用户">root 用户<a hidden class="anchor" aria-hidden="true" href="#root-用户">#</a></h2>
<p>root 是 etcd 的超级管理员，拥有 etcd 的所有权限，在开启角色认证之前为们必须要先建立好 root 用户。还需要注意的是 root 用户必须拥有 root 的角色,允许在 etcd 的所有操作.</p>
<h2 id="root-角色">root 角色<a hidden class="anchor" aria-hidden="true" href="#root-角色">#</a></h2>
<p>root 角色可以赋予任何用户，拥有 root 角色的用户有全局读写权限和集群身份验证配置权限，此外，还具有修改集群成员身份，碎片整理，建立快照等权限。</p>
<h1 id="用户操作">用户操作<a hidden class="anchor" aria-hidden="true" href="#用户操作">#</a></h1>
<p>查看用户列表：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 user list
</code></pre></td></tr></table>
</div>
</div><p>创建用户：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"> etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 user add user1
</code></pre></td></tr></table>
</div>
</div><p>用户可以被赋予角色，也可以被撤销角色：</p>
<p>赋予权限:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 user grant --roles root user1
</code></pre></td></tr></table>
</div>
</div><p>撤销权限:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 user revoke --roles root user1
</code></pre></td></tr></table>
</div>
</div><p>修改用户密码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 user passwd user1
</code></pre></td></tr></table>
</div>
</div><h1 id="角色操作">角色操作<a hidden class="anchor" aria-hidden="true" href="#角色操作">#</a></h1>
<p>角色列表:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role list
</code></pre></td></tr></table>
</div>
</div><p>创建角色:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role add myrolename
</code></pre></td></tr></table>
</div>
</div><p>角色没有密码，仅仅是定义的一组访问权限</p>
<p>角色的访问权限可以被赋予read（读）,write（写）,readwrite（读和写）权限</p>
<p>赋予访问权限范例：</p>
<p>给 role1 角色赋予键 /foo 的读操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role grant role1 --path /foo --read
</code></pre></td></tr></table>
</div>
</div><p>给 role1 角色赋予键 /foo 的写操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role grant role1 --path /foo --write
</code></pre></td></tr></table>
</div>
</div><p>给 role1 角色赋予键 /foo 读写操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role grant role1 --path /foo --rw
</code></pre></td></tr></table>
</div>
</div><p>给 role1 角色赋予键 /foo 目录读写操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role grant role1 --path /foo/* --rw
</code></pre></td></tr></table>
</div>
</div><p>收回访问权限范例：</p>
<p>收回 role1 角色对 /foo 的读操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role revoke role1 --path /foo --read
</code></pre></td></tr></table>
</div>
</div><p>收回 role1 角色对 /foo 的写操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role revoke role1 --path /foo --write
</code></pre></td></tr></table>
</div>
</div><p>收回 role1 角色对 /foo 的读写操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role revoke role1 --path /foo --rw
</code></pre></td></tr></table>
</div>
</div><p>收回 role1 角色对 /foo 目录的读写操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role revoke role1 --path /foo/* --rw
</code></pre></td></tr></table>
</div>
</div><p>查看角色访问权限:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role get role1
</code></pre></td></tr></table>
</div>
</div><p>删除角色 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 role remove role1
</code></pre></td></tr></table>
</div>
</div><h1 id="开启身份验证">开启身份验证<a hidden class="anchor" aria-hidden="true" href="#开启身份验证">#</a></h1>
<p>1.增加root用户:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">$ etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 user add root
Password of root:
</code></pre></td></tr></table>
</div>
</div><p>2.开启身份验证:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --endpoints https://192.168.3.3:2379 etcdctl auth enable
</code></pre></td></tr></table>
</div>
</div><p>至此，身份验证已经开启，执行下面命令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem  --endpoints https://192.168.3.3:2379 set /foo bar
//返回bar
</code></pre></td></tr></table>
</div>
</div><p>这里出现了一个问题，我们已经开启了身份访问验证，却仍然可以不通过任何身份进行操作，这是什么原因呢？其实是因为在 Etcd 开启 Basic Auth 之后，默认会启用两个角色 root 和 guest， root 和 guest 角色都拥有所有权限，当我们未指定身份的时候其实是通过 guest 角色进行的操作，这里需要注意的是两个角色都不要删除，否则你可能会遇到意想不到的Bug，既然无法删除，那么为们可以通过收回权限的方式对 guest 的权限进行限制，执行下面代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem --username root:passwod --endpoints https://192.168.3.3:2379 ro
le revoke guest --path &#39;/*&#39; --rw

//返回：Role guest updated

//查看guest最新的权限信息
etcdctl --ca-file /root/cfssl/ca.pem --username root:passwod --endpoints https://192.168.3.3:2379 ro
le get guest


//返回 ：
 //       Role: guest
//        KV Read:
//        KV Write:
// ok 收回权限成功
</code></pre></td></tr></table>
</div>
</div><p>继续执行之前的set代码 ：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">etcdctl --ca-file /root/cfssl/ca.pem  --endpoints https://192.168.3.3:2379 set /foo bar
//Error:  110: The request requires user authentication (Insufficient credentials) [0]
</code></pre></td></tr></table>
</div>
</div><p>如我们所愿的已经不可以对 etcd 进行操作了，下面我们创建一个用户并赋予一个新建的角色试试：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"># 创建user2用户
etcdctl --ca-file /root/cfssl/ca.pem --username root:passwod --endpoints https://192.168.3.3:2379 user add user2

New password:
//返回 ：User user2 created

# 创建role2角色
etcdctl --ca-file /root/cfssl/ca.pem --username root:passwod --endpoints https://192.168.3.3:2379 role add role2

Role role2 created

# 赋予role2 角色权限

etcdctl --ca-file /root/cfssl/ca.pem --username root:passwod --endpoints https://192.168.3.3:2379 ro
le grant role2 --path /foo --rw
Role role2 updated


# 将用户user2赋予角色role2
etcdctl --ca-file /root/cfssl/ca.pem --username root:passwod --endpoints https://192.168.3.3:2379 us
er  grant --roles role2 user2

User user2 updated

# 设置 foo 值
etcdctl --ca-file /root/cfssl/ca.pem --username user2:passwod --endpoints https://192.168.3.3:2379:2379 set foo bar

bar
</code></pre></td></tr></table>
</div>
</div><p>参考:<br>
<a href="https://blog.csdn.net/huwh_/article/details/80225902">https://blog.csdn.net/huwh_/article/details/80225902</a><br>
<a href="https://blog.csdn.net/kozazyh/article/details/79586530">https://blog.csdn.net/kozazyh/article/details/79586530</a><br>
<a href="https://blog.csdn.net/huwh_/article/details/80225902">https://blog.csdn.net/huwh_/article/details/80225902</a><br>
<a href="http://www.artacode.com/posts/etcd/auth/">http://www.artacode.com/posts/etcd/auth/</a></p>


  </div>

  <footer class="post-footer">
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2021 <a href="/">Forz Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
