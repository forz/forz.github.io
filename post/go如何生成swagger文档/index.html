<!DOCTYPE html>
<html lang="zh-cn" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Go如何生成swagger文档 | Forz Blog</title>
<meta name="keywords" content="go-swagger" />
<meta name="description" content="swagger Swagger是一个简单但功能强大的API表达工具。它具有地球上最大的API工具生态系统，数以千计的开发人员，使用几乎所有的现代编程语言，">
<meta name="author" content="">
<link rel="canonical" href="/post/go%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90swagger%E6%96%87%E6%A1%A3/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.00d5d4fc479b1575183ee8d86b4fb372ba9d9b1904e96fa8e4c40ff7debe2b94.css" integrity="sha256-ANXU/EebFXUYPujYa0&#43;zcrqdmxkE6W&#43;o5MQP996&#43;K5Q=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.87.0" />
<meta property="og:title" content="Go如何生成swagger文档" />
<meta property="og:description" content="swagger Swagger是一个简单但功能强大的API表达工具。它具有地球上最大的API工具生态系统，数以千计的开发人员，使用几乎所有的现代编程语言，" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/go%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90swagger%E6%96%87%E6%A1%A3/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2019-11-27T15:45:15&#43;00:00" />
<meta property="article:modified_time" content="2019-11-27T15:45:15&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go如何生成swagger文档"/>
<meta name="twitter:description" content="swagger Swagger是一个简单但功能强大的API表达工具。它具有地球上最大的API工具生态系统，数以千计的开发人员，使用几乎所有的现代编程语言，"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "/post/"
    }
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Go如何生成swagger文档",
      "item": "/post/go%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90swagger%E6%96%87%E6%A1%A3/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Go如何生成swagger文档",
  "name": "Go如何生成swagger文档",
  "description": "swagger Swagger是一个简单但功能强大的API表达工具。它具有地球上最大的API工具生态系统，数以千计的开发人员，使用几乎所有的现代编程语言，",
  "keywords": [
    "go-swagger"
  ],
  "articleBody": "swagger Swagger是一个简单但功能强大的API表达工具。它具有地球上最大的API工具生态系统，数以千计的开发人员，使用几乎所有的现代编程语言，都在支持和使用Swagger。使用Swagger生成API，我们可以得到交互式文档，自动生成代码的SDK以及API的发现特性等。\nswagger文档示例:\n1 2 3 4 5 6 7 8 9 10  swagger:\"2.0\"info:version:1.0.0title:Simple APIdescription:A simple API to learn how to write OpenAPI Specificationschemes:- httpshost:simple.apibasePath:/openapi101paths:{}  swag与go-swagger 两种用于生成规范的工具的比较\n在撰写本文时，用于从go源代码生成Swagger规范的两个主要库是Swag和go-swagger。在这里，我将讨论每种方案的优缺点，并说明为什么选择第二种方案。\n swag胜：方便。swag简单。您只需要为您的处理程序添加一些注释，一切就可以使用。为了使规格生成，您需要做些什么。 go-swagger胜：灵活。go-swagger为您提供了更多的功能和灵活性来描述您的API。它使您可以更好地控制生成的内容。 go-swagger胜：代码的可读性。使用Swag，您的每个API都有一些非常冗长的注释，在它们前面有很多注释。注释有时甚至比代码本身还要长！但是，通过go-swagger，您可以将这些注释与代码隔离。这样，代码中的注释可以集中于实际开发它的人员，并且从中生成标准规范的注释将保留在其自己的特定程序包中。如果您没有与go-swagger相关的注释的隔离，这就是代码发生的事情：   使用Swag，每个端点的外观如何\n go-swagger胜：流行：在撰写本文时，go-swagger的星数几乎是Swag的四倍。它似乎也得到了更好的维护，并且似乎错误更少。例如，go-swagger支持在请求/响应主体中表示2D数组，而Swag不支持。（在撰写本文时）  go-swagger 安装 安装有多种方式, 介绍两个稍微常用的安装方式:\n1 2 3 4 5  # brew brew tap go-swagger/go-swagger brew install go-swagger # go get go get -u github.com/go-swagger/go-swagger/cmd/swagger   生成 下面我们讲解一下如何使用go-swagger，在使用之前你或许需要了解一下openAPI是做什么的，我们现在所做的认为你对openAPI有所了解。\n因为我们所做的是依靠源码生成我们要的swagger文档，所以你现在要记住一个这样的命令：\n1 2 3 4  # 根源源码生成一个swagger文档，他的类型可以是json或者是yaml，根据你的后缀名 swagger generate spec -o ./swagger.json/yaml # 测试这个swagger文档是否有效 swagger validate ./swagger.json/yaml   如出现这样一段话，则表示你生成的yaml或json文件没有问题：\n1  The swagger spec at \"swagger.json/yaml\" is valid against swagger specification 2.0   现在我们知道了这样的两个命令，我们就要知道如何才能生成一个合格的swagger文档呢，这时候我们就需要了解一下在源码中如何写注释，从而可以获取这些文档。\n使用 我们来看一下都有哪些形态的注释：\n Swagger:meta Swagger:route Swagger:params Swagger:operation Swagger:response Swagger:model Swagger:allOf Swagger:strfmt Swagger:discriminated Swagger:ignore  接下来我们会一一讲解这些具体怎么做：\nSwagger:meta 这是你应该添加到项目中的第一个注释。它被用来描述你的项目名称，描述，联系电子邮件，网站，许可证等等信息。\n如果你的 API 仅提供在 HTTP 或 HTTPS 上，且只生成 JSON ，您应在此处添加它 - 允许你从每个路由中删除该注释。\n安全也被添加在 swagger:meta 中，在 SwaggerUI 上添加一个授权按钮。为了实现JWT，我使用安全类型承载进行命名并将其定义：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55  // Package classification Petstore API. // // the purpose of this application is to provide an application // that is using plain go code to define an API // // This should demonstrate all the possible comment annotations // that are available to turn go code into a fully compliant swagger 2.0 spec // // Terms Of Service: // // there are no TOS at this moment, use at your own risk we take no responsibility // // Schemes: http, https // Host: localhost // BasePath: /v2 // Version: 0.0.1 // License: MIT http://opensource.org/licenses/MIT // Contact: John Doe http://john.doe.com // // Consumes: // - application/json // - application/xml // // Produces: // - application/json // - application/xml // // Security: // - api_key: // // SecurityDefinitions: // api_key: // type: apiKey // name: KEY // in: header // oauth2: // type: oauth2 // authorizationUrl: /oauth2/auth // tokenUrl: /oauth2/token // in: header // scopes: // bar: foo // flow: accessCode // // Extensions: // x-meta-value: value // x-meta-array: // - value1 // - value2 // x-meta-array-obj: // - name: obj // value: field // // swagger:meta package classification   我们来讲一下这里面的一些参数的设定：\n   参数 介绍     Terms Of Service 描述API的一些基本信息，和一些请求的基本信息   Consumes API从客户端接收的内容的默认(全局)mime类型值列表，每行一个。   Produces API发送给客户端的内容的默认(全局)mime类型值列表，每行一个。   Schemes http、https   Version 版本号   Host 主机的地址   BasePath API的基础路径   License 许可证明   Contact 联系人等信息   Security api-key   SecurityDefinitions 一些授权的信息，比如JWT   Extensions 一些扩展行的信息    支持的MIME类型如下:\n当你执行生成文档的命令时，会生成一个yaml/json文件，你应该可以看到这样的信息：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  ---swagger:'2.0'consumes:- application/json- application/xmlproduces:- application/json- application/xmlschemes:- http- httpsinfo:description:\"the purpose of this application is to provide an application\\nthat is using plain go code to define an API\\n\\nThis should demonstrate all the possible comment annotations\\nthat are available to turn go code into a fully compliant swagger 2.0 spec\"title:'Petstore API.'termsOfService:'there are no TOS at this moment, use at your own risk we take no responsibility'contact:{name: 'John Doe', url: 'http://john.doe.com', email:john.doe@example.com}license:{name: MIT, url:'http://opensource.org/licenses/MIT'}version:0.0.1host:localhostbasePath:/v2x-meta-value:valuex-meta-array:- value1- value2x-meta-array-obj:- name:objvalue:field  生成结果如下图所示:\nSwagger:route 有两种方式注释你的路由，swagger:operation 和swagger:route。两者看起来都很相似，那么主要区别是什么？\n把 swagger:route 看作简单 API 的短注释,它适用于没有输入参数（路径/查询参数）的 API 。那些（带有参数）的例子是 /repos/{owner} ， /user/{id} 或者 /users/search?name=ribice。\n如果你有一个那种类型，那么你就必须使用 swagger:operation ，除此之外，如 /user 或 /version 之类的 APIs 都可以用 swagger:route 来注释。\n1 2 3 4 5 6 7 8 9 10 11 12 13  // ServeAPI serves the API for this record store func TestSwagger(c *gin.Context) { // swagger:route GET /pets PetsUsers listPets  //  // Lists pets filtered by some parameters.  //  // This will show all available pets by default.  // You can get the pets that are out of stock  //  // Responses:  // default: genericError  // 200: someResponse  // 400: validationError   我们来解释一下swagger:route 后面的参数都是干什么的：\n   参数 介绍     swagger:route 注解   GET get请求   /pets 匹配的url地址   PetsUsers 路由所在的空间分割标签   listPets 用于此端点的请求   Lists pets.. 摘要（标题）。对于swager:route注释，在第一个句号（.）前面的是标题。如果没有句号，就会没有标题并且这些文字会被用于描述。   This will… 描述。对于swager:route类型注释，在第一个句号（.）后面的是描述。   responses 这个端点的响应   default 默认返回的错误，包含genericError（用 swagger:response 注释的模型）   200 一个（成功的）响应HTTP状态 200，包含 repoResp（用 swagger:response 注释的模型）   400 此端点的错误响应，包含 validationError（用 swagger:response 注释的模型）    当你执行生成文档的命令时，会生成一个yaml/json文件，你应该可以看到这样的信息：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  ---paths:\"/pets\":get:operationId:listPetssummary:Lists pets filtered by some parameters.description:\"This will show all available pets by default.\\nYou can get the pets that are out of stock\"tags:- PetsUsersresponses:default:$ref:\"#/responses/genericError\"200:$ref:\"#/responses/someResponse\"422:$ref:\"#/responses/validationError\"  请记住，您还可能需要使用其他注释，具体取决于您的 API 。由于我将我的项目定义为仅使用单一模式（ https ），并且我的所有 API 都使用 https ，所以我不需要单独注释方案。如果您为端点使用多个模式，则需要以下注释：\n1  // Schemes: http, https, ws, wss   同样适用于 消费者/生产者 媒体类型。我所有的 API 都只消费/生成 application/json 。如果您的 API 正在 消费/生成 其他类型，则需要使用该媒体类型对其进行注释。例如：\n1 2 3 4 5 6 7  // consumes: // - application/json // - application/x-protobuf // // produces: // - application/json // - application/x-protobuf   安全性：\n1 2 3 4 5 6 7 8 9 10 11 12 13  // security: // api_key: // oauth: read, write // basicAuth: // type: basic // token: // type: apiKey // name: token // in: query // accessToken: // type: apiKey // name: access_token // in: query   另一方面，swagger:operation 用于更复杂的端点。三个破折号（-）下的部分被解析为 YAML ，允许更复杂的注释。确保您的缩进是一致的和正确的，否则将无法正确解析。\nSwagger:operation 使用 Swagger:operation 可以让你使用所有OpenAPI规范，你可以描述你的复杂的端点, 如果你对细节感兴趣，你可以阅读openAPI的规范文档。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  // ServeAPI serves the API for this record store func TestSwagger(c *gin.Context) { // swagger:operation GET /repo/{author} repos repoList  // ---  // summary: List the repositories owned by the given author.  // description: If author length is between 6 and 8, Error Not Found (404) will be returned.  // parameters:  // - name: author  // in: path  // description: username of author  // type: string  // required: true  // responses:  // \"200\":  // \"$ref\": \"#/responses/reposResp\"  // \"404\":  // \"$ref\": \"#/responses/notFound\"   我们可以看到这和我们平常写的openAPI的文档格式一样，我们来解释一下各个参数吧：\n   参数 介绍     GET get请求   /repo/{author} 匹配的url地址   repos 路由所在的空间分割标签   repoList 用于此端点的请求，这个不存在（没有定义），但参数是强制性的，所以你可以用任何东西来替换repoList（noReq，emptyReq等）   “—” 这个部分下面是YAML格式的swagger规范。确保您的缩进是一致的和正确的，否则将无法正确解析。注意，如果你在YAML中定义了标签，摘要，描述或操作标签，将覆盖上述常规swagger语法中的摘要，描述，标记或操作标签。   summary 标题   description 描述   parameters URL参数（在这个例子中是{author}）。字符串格式，强制性的（Swagger不会让你调用端点而不输入），位于路径（/{author}）中。另一种选择是参数内嵌的请求 (?name=\"\")    Swagger:parameters 根据您的应用程序模型，您的 HTTP 请求可能会有所不同（简单，复杂，封装等）。要生成 Swagger 规范，您需要为每个不同的请求创建一个结构，甚至包含仅包含数字（例如id）或字符串（名称）的简单请求。所有的参数必须在结构体中存在.如果不想这样,可以使用Swagger:operation.\n一旦你有这样的结构（例如一个包含一个字符串和一个布尔值的结构），在你的Swagger包中定义如下：\n生成的swagger规范中的参数：\n1 2 3 4 5 6 7 8 9 10 11 12  // Request containing string // swagger:parameters test_demo type BarSliceParam struct { // a BarSlice has bars which are strings  //  // min items: 3  // max items: 10  // unique: true  // Required: true  // in: query  Name string `json:\"name\"` }   此结构的字段可以使用许多注释进行修饰。对于字段名称，它使用struct字段名称，它尊重json struct字段标记以自定义名称。\n我们来解释一下swagger:parameters 后面的参数都是干什么的：\n   参数 介绍     Request containi.. 包含一个在 SwaggerUI 上可见的注释   test_demo operationID, go-swagger会以此来寻找你的关联的方法   a BarSlice… 这个就是你参数的描述   minLength 参数最短长度   maxLength 参数最大长度   in 参数放在什么位置，如：body，query，path   unique 参数是否是唯一的   Required 是否必传    当你执行生成文档的命令时，会生成一个yaml/json文件，你应该可以看到这样的信息：\n1 2 3 4 5 6 7 8 9 10 11 12  ---operations:\"/\":get:operationId:test_demoparameters:- name:namein:querymaxLength:10minLength:3unique:trueRequired:true  入参如果要传json,可以用结构体包一层:\n1 2 3 4 5 6 7 8 9 10 11  // swagger:parameters userBind type userLoginWrapper struct { // in: body \tBody UserBindRequest } type UserLoginRequest struct { // 用户名 \tUserName string `json:\"user_name\"` // id \tId string `json:\"id\"` }   然后consume加上json:\n1 2  // consumes: // - application/json   Swagger:response 响应注释与参数注释非常相似。主要的区别在于，经常将响应包裹到更复杂的结构中。\n一般的响应会是这样的：\n1 2 3 4 5  { \"msg\": \"OK\" \"code\":200, // Code containing HTTP status CODE  \"data\":{} // Data containing actual response data }   要使用常规响应，像上面错误响应那样的，我们需要在代码中新建一个reponse.go这种类似的文件，下面的响应用于 OK 响应（不返回任何数据）：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  // A ValidationError is an error that is used when the required input fails validation. // swagger:response validationError type ValidationError struct { // The error message  // in: body  Body struct { // The validation message  //  // Required: true  Message string // An optional field name to which this validation applies  FieldName string } }   或者是这样的形式：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  // 成功或失败返回的数据格式 // swagger:response SwaggerResponse type SwaggerWapper struct { // The error message  // in: body  Body ResponseMessage } type ResponseMessage struct { // 返回的code码  // Required: true  Code int `json:\"code\"` Msg string `json:\"msg\"` Data interface{} `json:\"data\"` }   只是生成出来的效果不一样，第一个展现的json/yaml格式会被展开：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  ---responses:validationError:description:A ValidationError is an error that is used when the required input fails validation.schema:type:objectdescription:The error messagerequired:- Messageproperties:Message:type:stringdescription:The validation messageexample:Expected type intFieldName:type:stringdescription:an optional field name to which this validation applies  而第二种形式的则会被折叠起来，如这样：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  responses:SwaggerResponse:description:成功或失败返回的数据格式schema:$ref:'#/definitions/ResponseMessage'definitions:ResponseMessage:properties:code:description:返回的code码type:integerdata:type:objectmsg:type:stringrequired:- codetype:object  第二种形式更加通用，复用性很好.\n实战 假设有一个user.server，提供一些REST API，用于对用户数据的增删改查。\n比如这里有一个getOneUser接口，是查询用户信息的：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37  package service import ( \"encoding/json\" \"fmt\" \"net/http\" \"strconv\" \"user.server/models\" \"crypto/md5\" \"errors\" \"github.com/Sirupsen/logrus\" \"github.com/gorilla/mux\" ) type GetUserParam struct { Id int `json:\"id\"` } func GetOneUser(w http.ResponseWriter, r *http.Request) { defer r.Body.Close() decoder := json.NewDecoder(r.Body) var param GetUserParam err := decoder.Decode(\u0026param) if err != nil { WriteResponse(w, ErrorResponseCode, \"request param is invalid, please check!\", nil) return } // get user from db  user, err := models.GetOne(strconv.Itoa(param.Id)) if err != nil { logrus.Warn(err) WriteResponse(w, ErrorResponseCode, \"failed\", nil) return } WriteResponse(w, SuccessResponseCode, \"success\", user) }   根据swagger文档规范，一个swagger文档首先要有swagger的版本和info信息。利用go-swagger只需要在声明package之前加上如下注释即可：\n1 2 3 4 5 6 7 8 9 10  // Package classification User API. // // The purpose of this service is to provide an application // that is using plain go code to define an API // // Host: localhost // Version: 0.0.1 // // swagger:meta package service   然后在项目根目录下使用swagger generate spec -o ./swagger.json命令生成swagger.json文件：\n此命令会找到main.go入口文件，然后遍历所有源码文件，解析然后生成swagger.json文件\n1 2 3 4 5 6 7 8 9 10  { \"swagger\": \"2.0\", \"info\": { \"description\": \"The purpose of this service is to provide an application\\nthat is using plain go code to define an API\", \"title\": \"User API.\", \"version\": \"0.0.1\" }, \"host\": \"localhost\", \"paths\": {} }   基本信息有了，然后就要有路由，请求，响应等，下面针对getOneUser接口编写swagger注释：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  // swagger:parameters getSingleUser type GetUserParam struct { // an id of user info  //  // Required: true  // in: path  Id int `json:\"id\"` } func GetOneUser(w http.ResponseWriter, r *http.Request) { // swagger:route GET /users/{id} users getSingleUser  //  // get a user by userID  //  // This will show a user info  //  // Responses:  // 200: UserResponse  decoder := json.NewDecoder(r.Body) var param GetUserParam err := decoder.Decode(\u0026param) if err != nil { WriteResponse(w, ErrorResponseCode, \"request param is invalid, please check!\", nil) return } // get user from db  user, err := models.GetOne(strconv.Itoa(param.Id)) if err != nil { logrus.Warn(err) WriteResponse(w, ErrorResponseCode, \"failed\", nil) return } WriteResponse(w, SuccessResponseCode, \"success\", user) }   可以看到在GetUserParam结构体上面加了一行swagger:parameters getSingleUser的注释信息，这是声明接口的入参注释，结构体内部的几行注释指明了id这个参数必填，并且查询参数id是在url path中。\n在GetOneUser函数中：\n swagger:route指明使用的http method，路由，以及标签和operation id Responses指明了返回值的code以及类型  如果入参中有多个参数,可以按照如下写法:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  // swagger:parameters getSingleUser // 定义一个 Person 结构体，用来绑定 url query type Person struct { // an id of user info \t// \t// Required: true \t// in: query \tName string `form:\"name\" json:\"name\"` // 使用成员变量标签定义对应的参数名 \t// an address of user info \t// \t// Required: true \t// in: query \tAddress string `form:\"address\" json:\"address\"` }   然后再声明响应:\n1 2 3 4 5 6 7 8 9 10 11 12 13  // User Info // // swagger:response UserResponse type UserWapper struct { // in: body  Body ResponseMessage } type ResponseMessage struct { Code int `json:\"code\"` Message string `json:\"message\"` Data interface{} `json:\"data\"` }   使用swagger:response语法声明返回值，其上两行是返回值的描述\n然后浏览器访问localhost,查看swagger-editor界面,点击工具栏中的File-Impoprt File上传刚才生成的 swagger.json文件，就可以看到界面：\n这样一个简单的api文档就生成了\n3.怎么样？是不是很简单？可是又感觉那里不对，嗯，注释都写在代码里了，很不美观，而且不易维护。想一下go-swagger的原理是扫描目录下的所有go文件，解析注释信息。那么是不是可以把api注释都集中写在单个文件内，统一管理，免得分散在各个源码文件内。\n新建一个doc.go文件，这里还有一个接口是UpdateUser,那么我们在doc.go文件中声明此接口的api注释。先看一下UpdateUser接口的代码：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31  func UpdateUser(w http.ResponseWriter, r *http.Request) { defer r.Body.Close() // decode body data into user struct  decoder := json.NewDecoder(r.Body) user := models.User{} err := decoder.Decode(\u0026user) if err != nil { WriteResponse(w, ErrorResponseCode, \"user data is invalid, please check!\", nil) return } // check if user exists  data, err := models.GetUserById(user.Id) if err != nil { logrus.Warn(err) WriteResponse(w, ErrorResponseCode, \"query user failed\", nil) return } if data.Id == 0 { WriteResponse(w, ErrorResponseCode, \"user not exists, no need to update\", nil) return } // update  _, err = models.Update(user) if err != nil { WriteResponse(w, ErrorResponseCode, \"update user data failed, please try again!\", nil) return } WriteResponse(w, SuccessResponseCode, \"update user data success!\", nil) }   然后再doc.go文件中编写如下声明：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26  package service import \"user.server/models\" // swagger:parameters UpdateUserResponseWrapper type UpdateUserRequest struct { // in: body  Body models.User } // Update User Info // // swagger:response UpdateUserResponseWrapper type UpdateUserResponseWrapper struct { // in: body  Body ResponseMessage } // swagger:route POST /users users UpdateUserResponseWrapper // // Update User // // This will update user info // // Responses: // 200: UpdateUserResponseWrapper   这样就把api声明注释给抽离出来了，然后使用命令swagger generate spec -o ./swagger.json生成json文件,就可以看到这样的结果：\n很简单吧，参照文档编写几行注释，然后一个命令生成API文档。\n优化 因为go-swagger没办法解析interface中包含的结构体,所以swagger没办法看到response的具体内容,有很大的缺陷.我们可以结合手写yaml来做优化\nmain.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  // 测试标题 // // 测试介绍 // // Host: localhost:8888 // Version: 1.0.0 // // swagger:meta package main func main() { router := engine.InitGinEngine() router.GET(\"gettest\", GetTest) router.Run(\":\" + Port) } func GetTest(c *gin.Context) { var req adapter.GetTestRequest // 将 url 查询参数和person绑定在一起 \t_ = c.ShouldBindQuery(\u0026req) res := adapter.GetTestResponse{} comm.SetResultMsg(c, 0, res, \"\") }   adapter.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52  package adapter // swagger:operation GET /gettest GetTest // --- // summary: 接口简介. // description: 接口说明 // responses: // \"200\": // description: 返回值 // schema: // properties: // code: // format: int64 // type: integer // example: 0 // data: // $ref: '#/definitions/GetTestResponse' // message: // type: string // example: \"success\"  // 结构体GetTestRequest介绍 // swagger:parameters GetTest type GetTestRequest struct { // 参数A介绍 \t// Required: true \t// in: query \tName string `form:\"name\" json:\"name\"` // 参数B介绍 \t// Required: true \t// in: query \tAddress string `form:\"address\" json:\"address\"` } // GetTestResWrapper介绍 // swagger:response GetTestResWrapper type getTestResWrapper struct { // The error message \t// in: body \tBody GetTestResponse } // GetTestResult介绍 type GetTestResponse struct { // 学生姓名 \t//example: 小明 \tName string `form:\"name\" json:\"name\"` // 学生住址 \t//example: 北京 \tAddress string `form:\"address\" json:\"address\"` }   因为手写yaml中的#/definitions/GetTestResponse,没有办法自动引进GetTestResponse,可以用一种取巧的办法来引进GetTestResponse,那就是创建swagger:response GetTestResWrapper.\n生成yaml文件如下:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60  definitions:GetTestResponse:description:GetTestResult介绍properties:address:description:学生住址example:北京type:stringx-go-name:Addressname:description:学生姓名example:小明type:stringx-go-name:Nametype:objectx-go-package:suyang/example/go-swagger/adapterhost:localhost:8888info:description:测试介绍title:测试标题version:1.0.0paths:/gettest:get:description:接口说明operationId:GetTestparameters:- description:参数A介绍in:queryname:namerequired:truetype:stringx-go-name:Name- description:参数B介绍in:queryname:addressrequired:truetype:stringx-go-name:Addressresponses:\"200\":description:返回值schema:properties:code:example:0format:int64type:integerdata:$ref:'#/definitions/GetTestResponse'message:example:successtype:stringsummary:接口简介.responses:GetTestResWrapper:description:GetTestResWrapper介绍schema:$ref:'#/definitions/GetTestResponse'swagger:\"2.0\"  解决了上述问题.\n参考:\nhttps://www.zybuluo.com/daduizhang/note/1412629\nhttps://studygolang.com/articles/12354\nhttps://popwalker.github.io/article/6b03ec87/\nhttps://medium.com/@pedram.esmaeeli/generate-swagger-specification-from-go-source-code-648615f7b9d9\n",
  "wordCount" : "7795",
  "inLanguage": "zh-cn",
  "datePublished": "2019-11-27T15:45:15Z",
  "dateModified": "2019-11-27T15:45:15Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/go%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90swagger%E6%96%87%E6%A1%A3/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Forz Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="Forz Blog (Alt + H)">Forz Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="/post/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Go如何生成swagger文档
    </h1>
    <div class="post-meta">November 27, 2019
</div>
  </header> 
  <div class="post-content"><h1 id="swagger">swagger<a hidden class="anchor" aria-hidden="true" href="#swagger">#</a></h1>
<p>Swagger是一个简单但功能强大的API表达工具。它具有地球上最大的API工具生态系统，数以千计的开发人员，使用几乎所有的现代编程语言，都在支持和使用Swagger。使用Swagger生成API，我们可以得到交互式文档，自动生成代码的SDK以及API的发现特性等。</p>
<p>swagger文档示例:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">swagger</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.0&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">info</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w">
</span><span class="w">  </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l">Simple API</span><span class="w">
</span><span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">A simple API to learn how to write OpenAPI Specification</span><span class="w">
</span><span class="w"></span><span class="nt">schemes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="l">https</span><span class="w">
</span><span class="w"></span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">simple.api</span><span class="w">
</span><span class="w"></span><span class="nt">basePath</span><span class="p">:</span><span class="w"> </span><span class="l">/openapi101</span><span class="w">
</span><span class="w"></span><span class="nt">paths</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h1 id="swag与go-swagger">swag与go-swagger<a hidden class="anchor" aria-hidden="true" href="#swag与go-swagger">#</a></h1>
<p>两种用于生成规范的工具的比较</p>
<p>在撰写本文时，用于从go源代码生成Swagger规范的两个主要库是Swag和go-swagger。在这里，我将讨论每种方案的优缺点，并说明为什么选择第二种方案。</p>
<ul>
<li>swag胜：方便。swag简单。您只需要为您的处理程序添加一些注释，一切就可以使用。为了使规格生成，您需要做些什么。</li>
<li>go-swagger胜：灵活。go-swagger为您提供了更多的功能和灵活性来描述您的API。它使您可以更好地控制生成的内容。</li>
<li>go-swagger胜：代码的可读性。使用Swag，您的每个API都有一些非常冗长的注释，在它们前面有很多注释。注释有时甚至比代码本身还要长！但是，通过go-swagger，您可以将这些注释与代码隔离。这样，代码中的注释可以集中于实际开发它的人员，并且从中生成标准规范的注释将保留在其自己的特定程序包中。如果您没有与go-swagger相关的注释的隔离，这就是代码发生的事情：
<img loading="lazy" src="https://blog-1257321977.cos.ap-beijing.myqcloud.com/20191203204859.png" alt=""  />
</li>
</ul>
<p>使用Swag，每个端点的外观如何</p>
<ul>
<li>go-swagger胜：流行：在撰写本文时，go-swagger的星数几乎是Swag的四倍。它似乎也得到了更好的维护，并且似乎错误更少。例如，go-swagger支持在请求/响应主体中表示2D数组，而Swag不支持。（在撰写本文时）</li>
</ul>
<h1 id="go-swagger">go-swagger<a hidden class="anchor" aria-hidden="true" href="#go-swagger">#</a></h1>
<h2 id="安装">安装<a hidden class="anchor" aria-hidden="true" href="#安装">#</a></h2>
<p>安装有多种方式, 介绍两个稍微常用的安装方式:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># brew</span>
brew tap go-swagger/go-swagger
brew install go-swagger
<span class="c1"># go get</span>
go get -u github.com/go-swagger/go-swagger/cmd/swagger
</code></pre></td></tr></table>
</div>
</div><h2 id="生成">生成<a hidden class="anchor" aria-hidden="true" href="#生成">#</a></h2>
<p>下面我们讲解一下如何使用go-swagger，在使用之前你或许需要了解一下openAPI是做什么的，我们现在所做的认为你对openAPI有所了解。</p>
<p>因为我们所做的是依靠源码生成我们要的swagger文档，所以你现在要记住一个这样的命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 根源源码生成一个swagger文档，他的类型可以是json或者是yaml，根据你的后缀名</span>
swagger generate spec -o ./swagger.json/yaml
<span class="c1"># 测试这个swagger文档是否有效</span>
swagger validate ./swagger.json/yaml
</code></pre></td></tr></table>
</div>
</div><p>如出现这样一段话，则表示你生成的yaml或json文件没有问题：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">The swagger spec at &#34;swagger.json/yaml&#34; is valid against swagger specification 2.0
</code></pre></td></tr></table>
</div>
</div><p>现在我们知道了这样的两个命令，我们就要知道如何才能生成一个合格的swagger文档呢，这时候我们就需要了解一下在源码中如何写注释，从而可以获取这些文档。</p>
<h2 id="使用">使用<a hidden class="anchor" aria-hidden="true" href="#使用">#</a></h2>
<p>我们来看一下都有哪些形态的注释：</p>
<ul>
<li>Swagger:meta</li>
<li>Swagger:route</li>
<li>Swagger:params</li>
<li>Swagger:operation</li>
<li>Swagger:response</li>
<li>Swagger:model</li>
<li>Swagger:allOf</li>
<li>Swagger:strfmt</li>
<li>Swagger:discriminated</li>
<li>Swagger:ignore</li>
</ul>
<p>接下来我们会一一讲解这些具体怎么做：</p>
<h3 id="swaggermeta">Swagger:meta<a hidden class="anchor" aria-hidden="true" href="#swaggermeta">#</a></h3>
<p><img loading="lazy" src="https://blog-1257321977.cos.ap-beijing.myqcloud.com/20191127160227.png" alt=""  />
</p>
<p>这是你应该添加到项目中的第一个注释。它被用来描述你的项目名称，描述，联系电子邮件，网站，许可证等等信息。</p>
<p>如果你的 API 仅提供在 HTTP 或 HTTPS 上，且只生成 JSON ，您应在此处添加它 - 允许你从每个路由中删除该注释。</p>
<p>安全也被添加在 swagger:meta 中，在 SwaggerUI 上添加一个授权按钮。为了实现JWT，我使用安全类型承载进行命名并将其定义：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Package classification Petstore API.
</span><span class="c1">//
</span><span class="c1">// the purpose of this application is to provide an application
</span><span class="c1">// that is using plain go code to define an API
</span><span class="c1">//
</span><span class="c1">// This should demonstrate all the possible comment annotations
</span><span class="c1">// that are available to turn go code into a fully compliant swagger 2.0 spec
</span><span class="c1">//
</span><span class="c1">// Terms Of Service:
</span><span class="c1">//
</span><span class="c1">// there are no TOS at this moment, use at your own risk we take no responsibility
</span><span class="c1">//
</span><span class="c1">//     Schemes: http, https
</span><span class="c1">//     Host: localhost
</span><span class="c1">//     BasePath: /v2
</span><span class="c1">//     Version: 0.0.1
</span><span class="c1">//     License: MIT http://opensource.org/licenses/MIT
</span><span class="c1">//     Contact: John Doe&lt;john.doe@example.com&gt; http://john.doe.com
</span><span class="c1">//
</span><span class="c1">//     Consumes:
</span><span class="c1">//     - application/json
</span><span class="c1">//     - application/xml
</span><span class="c1">//
</span><span class="c1">//     Produces:
</span><span class="c1">//     - application/json
</span><span class="c1">//     - application/xml
</span><span class="c1">//
</span><span class="c1">//     Security:
</span><span class="c1">//     - api_key:
</span><span class="c1">//
</span><span class="c1">//     SecurityDefinitions:
</span><span class="c1">//     api_key:
</span><span class="c1">//          type: apiKey
</span><span class="c1">//          name: KEY
</span><span class="c1">//          in: header
</span><span class="c1">//     oauth2:
</span><span class="c1">//         type: oauth2
</span><span class="c1">//         authorizationUrl: /oauth2/auth
</span><span class="c1">//         tokenUrl: /oauth2/token
</span><span class="c1">//         in: header
</span><span class="c1">//         scopes:
</span><span class="c1">//           bar: foo
</span><span class="c1">//         flow: accessCode
</span><span class="c1">//
</span><span class="c1">//     Extensions:
</span><span class="c1">//     x-meta-value: value
</span><span class="c1">//     x-meta-array:
</span><span class="c1">//       - value1
</span><span class="c1">//       - value2
</span><span class="c1">//     x-meta-array-obj:
</span><span class="c1">//       - name: obj
</span><span class="c1">//         value: field
</span><span class="c1">//
</span><span class="c1">// swagger:meta
</span><span class="c1"></span><span class="kn">package</span> <span class="nx">classification</span>
</code></pre></td></tr></table>
</div>
</div><p>我们来讲一下这里面的一些参数的设定：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td>Terms Of Service</td>
<td>描述API的一些基本信息，和一些请求的基本信息</td>
</tr>
<tr>
<td>Consumes</td>
<td>API从客户端接收的内容的默认(全局)mime类型值列表，每行一个。</td>
</tr>
<tr>
<td>Produces</td>
<td>API发送给客户端的内容的默认(全局)mime类型值列表，每行一个。</td>
</tr>
<tr>
<td>Schemes</td>
<td>http、https</td>
</tr>
<tr>
<td>Version</td>
<td>版本号</td>
</tr>
<tr>
<td>Host</td>
<td>主机的地址</td>
</tr>
<tr>
<td>BasePath</td>
<td>API的基础路径</td>
</tr>
<tr>
<td>License</td>
<td>许可证明</td>
</tr>
<tr>
<td>Contact</td>
<td>联系人等信息</td>
</tr>
<tr>
<td>Security</td>
<td>api-key</td>
</tr>
<tr>
<td>SecurityDefinitions</td>
<td>一些授权的信息，比如JWT</td>
</tr>
<tr>
<td>Extensions</td>
<td>一些扩展行的信息</td>
</tr>
</tbody>
</table>
<p>支持的MIME类型如下:</p>
<p><img loading="lazy" src="https://blog-1257321977.cos.ap-beijing.myqcloud.com/20191201170651.png" alt=""  />
</p>
<p>当你执行生成文档的命令时，会生成一个yaml/json文件，你应该可以看到这样的信息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">swagger</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;2.0&#39;</span><span class="w">
</span><span class="w"></span><span class="nt">consumes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="l">application/json</span><span class="w">
</span><span class="w">  </span>- <span class="l">application/xml</span><span class="w">
</span><span class="w"></span><span class="nt">produces</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="l">application/json</span><span class="w">
</span><span class="w">  </span>- <span class="l">application/xml</span><span class="w">
</span><span class="w"></span><span class="nt">schemes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="l">http</span><span class="w">
</span><span class="w">  </span>- <span class="l">https</span><span class="w">
</span><span class="w"></span><span class="nt">info</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;the purpose of this application is to provide an application\nthat is using plain go code to define an API\n\nThis should demonstrate all the possible comment annotations\nthat are available to turn go code into a fully compliant swagger 2.0 spec&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Petstore API.&#39;</span><span class="w">
</span><span class="w">  </span><span class="nt">termsOfService</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;there are no TOS at this moment, use at your own risk we take no responsibility&#39;</span><span class="w">
</span><span class="w">  </span><span class="nt">contact</span><span class="p">:</span><span class="w"> </span>{<span class="nt">name: &#39;John Doe&#39;, url: &#39;http://john.doe.com&#39;, email</span><span class="p">:</span><span class="w"> </span><span class="l">john.doe@example.com}</span><span class="w">
</span><span class="w">  </span><span class="nt">license</span><span class="p">:</span><span class="w"> </span>{<span class="nt">name: MIT, url</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;http://opensource.org/licenses/MIT&#39;</span>}<span class="w">
</span><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">0.0.1</span><span class="w">
</span><span class="w"></span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">localhost</span><span class="w">
</span><span class="w"></span><span class="nt">basePath</span><span class="p">:</span><span class="w"> </span><span class="l">/v2</span><span class="w">
</span><span class="w"></span><span class="nt">x-meta-value</span><span class="p">:</span><span class="w"> </span><span class="l">value</span><span class="w">
</span><span class="w"></span><span class="nt">x-meta-array</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="l">value1</span><span class="w">
</span><span class="w">  </span>- <span class="l">value2</span><span class="w">
</span><span class="w"></span><span class="nt">x-meta-array-obj</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">obj</span><span class="w">
</span><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">field</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>生成结果如下图所示:</p>
<p><img loading="lazy" src="https://blog-1257321977.cos.ap-beijing.myqcloud.com/20191127161143.png" alt=""  />

<img loading="lazy" src="https://blog-1257321977.cos.ap-beijing.myqcloud.com/20191127161259.png" alt=""  />
</p>
<h3 id="swaggerroute">Swagger:route<a hidden class="anchor" aria-hidden="true" href="#swaggerroute">#</a></h3>
<p>有两种方式注释你的路由，swagger:operation 和swagger:route。两者看起来都很相似，那么主要区别是什么？</p>
<p>把 swagger:route 看作简单 API 的短注释,它适用于没有输入参数（路径/查询参数）的 API 。那些（带有参数）的例子是 /repos/{owner} ， /user/{id} 或者 /users/search?name=ribice。</p>
<p>如果你有一个那种类型，那么你就必须使用 swagger:operation ，除此之外，如 /user 或 /version 之类的 APIs 都可以用 swagger:route 来注释。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// ServeAPI serves the API for this record store
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">TestSwagger</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// swagger:route GET /pets PetsUsers listPets
</span><span class="c1"></span>    <span class="c1">//
</span><span class="c1"></span>    <span class="c1">// Lists pets filtered by some parameters.
</span><span class="c1"></span>    <span class="c1">//
</span><span class="c1"></span>    <span class="c1">// This will show all available pets by default.
</span><span class="c1"></span>    <span class="c1">// You can get the pets that are out of stock
</span><span class="c1"></span>    <span class="c1">//
</span><span class="c1"></span>    <span class="c1">//     Responses:
</span><span class="c1"></span>    <span class="c1">//       default: genericError
</span><span class="c1"></span>    <span class="c1">//       200: someResponse
</span><span class="c1"></span>    <span class="c1">//       400: validationError
</span></code></pre></td></tr></table>
</div>
</div><p>我们来解释一下swagger:route 后面的参数都是干什么的：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td>swagger:route</td>
<td>注解</td>
</tr>
<tr>
<td>GET</td>
<td>get请求</td>
</tr>
<tr>
<td>/pets</td>
<td>匹配的url地址</td>
</tr>
<tr>
<td>PetsUsers</td>
<td>路由所在的空间分割标签</td>
</tr>
<tr>
<td>listPets</td>
<td>用于此端点的请求</td>
</tr>
<tr>
<td>Lists pets..</td>
<td>摘要（标题）。对于swager:route注释，在第一个句号（.）前面的是标题。如果没有句号，就会没有标题并且这些文字会被用于描述。</td>
</tr>
<tr>
<td>This will&hellip;</td>
<td>描述。对于swager:route类型注释，在第一个句号（.）后面的是描述。</td>
</tr>
<tr>
<td>responses</td>
<td>这个端点的响应</td>
</tr>
<tr>
<td>default</td>
<td>默认返回的错误，包含genericError（用 swagger:response 注释的模型）</td>
</tr>
<tr>
<td>200</td>
<td>一个（成功的）响应HTTP状态 200，包含 repoResp（用 swagger:response 注释的模型）</td>
</tr>
<tr>
<td>400</td>
<td>此端点的错误响应，包含 validationError（用 swagger:response 注释的模型）</td>
</tr>
</tbody>
</table>
<p>当你执行生成文档的命令时，会生成一个yaml/json文件，你应该可以看到这样的信息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="s2">&#34;/pets&#34;</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">operationId</span><span class="p">:</span><span class="w"> </span><span class="l">listPets</span><span class="w">
</span><span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l">Lists pets filtered by some parameters.</span><span class="w">
</span><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;This will show all available pets by default.\nYou can get the pets that are out of stock&#34;</span><span class="w">
</span><span class="w">      </span><span class="nt">tags</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">PetsUsers</span><span class="w">
</span><span class="w">      </span><span class="nt">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">default</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/genericError&#34;</span><span class="w">
</span><span class="w">        </span><span class="nt">200</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/someResponse&#34;</span><span class="w">
</span><span class="w">        </span><span class="nt">422</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#/responses/validationError&#34;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>请记住，您还可能需要使用其他注释，具体取决于您的 API 。由于我将我的项目定义为仅使用单一模式（ https ），并且我的所有 API 都使用 https ，所以我不需要单独注释方案。如果您为端点使用多个模式，则需要以下注释：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Schemes: http, https, ws, wss
</span></code></pre></td></tr></table>
</div>
</div><p>同样适用于 消费者/生产者 媒体类型。我所有的 API 都只消费/生成 application/json 。如果您的 API 正在 消费/生成 其他类型，则需要使用该媒体类型对其进行注释。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// consumes:
</span><span class="c1">// - application/json
</span><span class="c1">// - application/x-protobuf
</span><span class="c1">//
</span><span class="c1">// produces:
</span><span class="c1">// - application/json
</span><span class="c1">// - application/x-protobuf
</span></code></pre></td></tr></table>
</div>
</div><p>安全性：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// security:
</span><span class="c1">//   api_key:
</span><span class="c1">//   oauth: read, write
</span><span class="c1">//   basicAuth:
</span><span class="c1">//      type: basic
</span><span class="c1">//   token:
</span><span class="c1">//      type: apiKey
</span><span class="c1">//      name: token
</span><span class="c1">//      in: query
</span><span class="c1">//   accessToken:
</span><span class="c1">//      type: apiKey
</span><span class="c1">//      name: access_token
</span><span class="c1">//      in: query
</span></code></pre></td></tr></table>
</div>
</div><p>另一方面，swagger:operation 用于更复杂的端点。三个破折号（-）下的部分被解析为 YAML ，允许更复杂的注释。确保您的缩进是一致的和正确的，否则将无法正确解析。</p>
<h3 id="swaggeroperation">Swagger:operation<a hidden class="anchor" aria-hidden="true" href="#swaggeroperation">#</a></h3>
<p>使用 Swagger:operation 可以让你使用所有OpenAPI规范，你可以描述你的复杂的端点, 如果你对细节感兴趣，你可以阅读openAPI的规范文档。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// ServeAPI serves the API for this record store
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">TestSwagger</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// swagger:operation GET /repo/{author} repos repoList
</span><span class="c1"></span>    <span class="c1">// ---
</span><span class="c1"></span>    <span class="c1">// summary: List the repositories owned by the given author.
</span><span class="c1"></span>    <span class="c1">// description: If author length is between 6 and 8, Error Not Found (404) will be returned.
</span><span class="c1"></span>    <span class="c1">// parameters:
</span><span class="c1"></span>    <span class="c1">// - name: author
</span><span class="c1"></span>    <span class="c1">//   in: path
</span><span class="c1"></span>    <span class="c1">//   description: username of author
</span><span class="c1"></span>    <span class="c1">//   type: string
</span><span class="c1"></span>    <span class="c1">//   required: true
</span><span class="c1"></span>    <span class="c1">// responses:
</span><span class="c1"></span>    <span class="c1">//   &#34;200&#34;:
</span><span class="c1"></span>    <span class="c1">//     &#34;$ref&#34;: &#34;#/responses/reposResp&#34;
</span><span class="c1"></span>    <span class="c1">//   &#34;404&#34;:
</span><span class="c1"></span>    <span class="c1">//     &#34;$ref&#34;: &#34;#/responses/notFound&#34;
</span></code></pre></td></tr></table>
</div>
</div><p>我们可以看到这和我们平常写的openAPI的文档格式一样，我们来解释一下各个参数吧：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>get请求</td>
</tr>
<tr>
<td>/repo/{author}</td>
<td>匹配的url地址</td>
</tr>
<tr>
<td>repos</td>
<td>路由所在的空间分割标签</td>
</tr>
<tr>
<td>repoList</td>
<td>用于此端点的请求，这个不存在（没有定义），但参数是强制性的，所以你可以用任何东西来替换repoList（noReq，emptyReq等）</td>
</tr>
<tr>
<td>“&mdash;”</td>
<td>这个部分下面是YAML格式的swagger规范。确保您的缩进是一致的和正确的，否则将无法正确解析。注意，如果你在YAML中定义了标签，摘要，描述或操作标签，将覆盖上述常规swagger语法中的摘要，描述，标记或操作标签。</td>
</tr>
<tr>
<td>summary</td>
<td>标题</td>
</tr>
<tr>
<td>description</td>
<td>描述</td>
</tr>
<tr>
<td>parameters</td>
<td>URL参数（在这个例子中是{author}）。字符串格式，强制性的（Swagger不会让你调用端点而不输入），位于路径（/{author}）中。另一种选择是参数内嵌的请求 (?name=&quot;&quot;)</td>
</tr>
</tbody>
</table>
<h3 id="swaggerparameters">Swagger:parameters<a hidden class="anchor" aria-hidden="true" href="#swaggerparameters">#</a></h3>
<p>根据您的应用程序模型，您的 HTTP 请求可能会有所不同（简单，复杂，封装等）。要生成 Swagger 规范，您需要为每个不同的请求创建一个结构，甚至包含仅包含数字（例如id）或字符串（名称）的简单请求。所有的参数必须在结构体中存在.如果不想这样,可以使用Swagger:operation.</p>
<p>一旦你有这样的结构（例如一个包含一个字符串和一个布尔值的结构），在你的Swagger包中定义如下：</p>
<p>生成的swagger规范中的参数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Request containing string
</span><span class="c1">// swagger:parameters test_demo
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">BarSliceParam</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// a BarSlice has bars which are strings
</span><span class="c1"></span>    <span class="c1">//
</span><span class="c1"></span>    <span class="c1">// min items: 3
</span><span class="c1"></span>    <span class="c1">// max items: 10
</span><span class="c1"></span>    <span class="c1">// unique: true
</span><span class="c1"></span>    <span class="c1">// Required: true
</span><span class="c1"></span>    <span class="c1">// in: query
</span><span class="c1"></span>    <span class="nx">Name</span> <span class="kt">string</span> <span class="s">`json:&#34;name&#34;`</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>此结构的字段可以使用许多注释进行修饰。对于字段名称，它使用struct字段名称，它尊重json struct字段标记以自定义名称。</p>
<p>我们来解释一下swagger:parameters 后面的参数都是干什么的：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td>Request containi..</td>
<td>包含一个在 SwaggerUI 上可见的注释</td>
</tr>
<tr>
<td>test_demo</td>
<td>operationID, go-swagger会以此来寻找你的关联的方法</td>
</tr>
<tr>
<td>a BarSlice&hellip;</td>
<td>这个就是你参数的描述</td>
</tr>
<tr>
<td>minLength</td>
<td>参数最短长度</td>
</tr>
<tr>
<td>maxLength</td>
<td>参数最大长度</td>
</tr>
<tr>
<td>in</td>
<td>参数放在什么位置，如：body，query，path</td>
</tr>
<tr>
<td>unique</td>
<td>参数是否是唯一的</td>
</tr>
<tr>
<td>Required</td>
<td>是否必传</td>
</tr>
</tbody>
</table>
<p>当你执行生成文档的命令时，会生成一个yaml/json文件，你应该可以看到这样的信息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">operations</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="s2">&#34;/&#34;</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">operationId</span><span class="p">:</span><span class="w"> </span><span class="l">test_demo</span><span class="w">
</span><span class="w">      </span><span class="nt">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">name</span><span class="w">
</span><span class="w">          </span><span class="nt">in</span><span class="p">:</span><span class="w"> </span><span class="l">query</span><span class="w">
</span><span class="w">          </span><span class="nt">maxLength</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="w">          </span><span class="nt">minLength</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span><span class="w">          </span><span class="nt">unique</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">          </span><span class="nt">Required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>入参如果要传json,可以用结构体包一层:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">//  swagger:parameters userBind
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">userLoginWrapper</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// in: body
</span><span class="c1"></span>	<span class="nx">Body</span> <span class="nx">UserBindRequest</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">UserLoginRequest</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">//  用户名
</span><span class="c1"></span>	<span class="nx">UserName</span> <span class="kt">string</span> <span class="s">`json:&#34;user_name&#34;`</span>
	<span class="c1">//  id
</span><span class="c1"></span>	<span class="nx">Id</span> <span class="kt">string</span> <span class="s">`json:&#34;id&#34;`</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>然后consume加上json:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// consumes:
</span><span class="c1">//   - application/json
</span></code></pre></td></tr></table>
</div>
</div><h3 id="swaggerresponse">Swagger:response<a hidden class="anchor" aria-hidden="true" href="#swaggerresponse">#</a></h3>
<p>响应注释与参数注释非常相似。主要的区别在于，经常将响应包裹到更复杂的结构中。</p>
<p>一般的响应会是这样的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="p">{</span>
     <span class="s">&#34;msg&#34;</span><span class="p">:</span> <span class="s">&#34;OK&#34;</span> 
     <span class="s">&#34;code&#34;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span> <span class="c1">// Code containing HTTP status CODE
</span><span class="c1"></span>     <span class="s">&#34;data&#34;</span><span class="p">:{}</span> <span class="c1">// Data containing actual response data
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>要使用常规响应，像上面错误响应那样的，我们需要在代码中新建一个reponse.go这种类似的文件，下面的响应用于 OK 响应（不返回任何数据）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// A ValidationError is an error that is used when the required input fails validation.
</span><span class="c1">// swagger:response validationError
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">ValidationError</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// The error message
</span><span class="c1"></span>    <span class="c1">// in: body
</span><span class="c1"></span>    <span class="nx">Body</span> <span class="kd">struct</span> <span class="p">{</span>
        <span class="c1">// The validation message
</span><span class="c1"></span>        <span class="c1">//
</span><span class="c1"></span>        <span class="c1">// Required: true
</span><span class="c1"></span>        <span class="nx">Message</span> <span class="kt">string</span>
        <span class="c1">// An optional field name to which this validation applies
</span><span class="c1"></span>        <span class="nx">FieldName</span> <span class="kt">string</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>或者是这样的形式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// 成功或失败返回的数据格式
</span><span class="c1">// swagger:response SwaggerResponse
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">SwaggerWapper</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// The error message
</span><span class="c1"></span>    <span class="c1">// in: body
</span><span class="c1"></span>    <span class="nx">Body</span> <span class="nx">ResponseMessage</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">ResponseMessage</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// 返回的code码
</span><span class="c1"></span>    <span class="c1">// Required: true
</span><span class="c1"></span>    <span class="nx">Code</span> <span class="kt">int</span>         <span class="s">`json:&#34;code&#34;`</span>
    <span class="nx">Msg</span>  <span class="kt">string</span>      <span class="s">`json:&#34;msg&#34;`</span>
    <span class="nx">Data</span> <span class="kd">interface</span><span class="p">{}</span> <span class="s">`json:&#34;data&#34;`</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>只是生成出来的效果不一样，第一个展现的json/yaml格式会被展开：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">responses</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">validationError</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">A ValidationError is an error that is used when the required input fails validation.</span><span class="w">
</span><span class="w">    </span><span class="nt">schema</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">object</span><span class="w">
</span><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">The error message</span><span class="w">
</span><span class="w">      </span><span class="nt">required</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">Message</span><span class="w">
</span><span class="w">      </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">Message</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">string</span><span class="w">
</span><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">The validation message</span><span class="w">
</span><span class="w">          </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="l">Expected type int</span><span class="w">
</span><span class="w">        </span><span class="nt">FieldName</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">string</span><span class="w">
</span><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">an optional field name to which this validation applies</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>而第二种形式的则会被折叠起来，如这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">responses</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">SwaggerResponse</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">成功或失败返回的数据格式</span><span class="w">
</span><span class="w">    </span><span class="nt">schema</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/definitions/ResponseMessage&#39;</span><span class="w">
</span><span class="w"></span><span class="nt">definitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">ResponseMessage</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">code</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">返回的code码</span><span class="w">
</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">integer</span><span class="w">
</span><span class="w">      </span><span class="nt">data</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">object</span><span class="w">
</span><span class="w">      </span><span class="nt">msg</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">string</span><span class="w">
</span><span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="l">code</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">object</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>第二种形式更加通用，复用性很好.</p>
<h1 id="实战">实战<a hidden class="anchor" aria-hidden="true" href="#实战">#</a></h1>
<p>假设有一个user.server，提供一些REST API，用于对用户数据的增删改查。</p>
<p>比如这里有一个getOneUser接口，是查询用户信息的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">service</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;encoding/json&#34;</span>
    <span class="s">&#34;fmt&#34;</span>
    <span class="s">&#34;net/http&#34;</span>
    <span class="s">&#34;strconv&#34;</span>
    <span class="s">&#34;user.server/models&#34;</span>
    <span class="s">&#34;crypto/md5&#34;</span>
    <span class="s">&#34;errors&#34;</span>
    <span class="s">&#34;github.com/Sirupsen/logrus&#34;</span>
    <span class="s">&#34;github.com/gorilla/mux&#34;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">GetUserParam</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Id</span> <span class="kt">int</span> <span class="s">`json:&#34;id&#34;`</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">GetOneUser</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">defer</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
    <span class="nx">decoder</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">NewDecoder</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">param</span> <span class="nx">GetUserParam</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">decoder</span><span class="p">.</span><span class="nf">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">param</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nf">WriteResponse</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">ErrorResponseCode</span><span class="p">,</span> <span class="s">&#34;request param is invalid, please check!&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">// get user from db
</span><span class="c1"></span>    <span class="nx">user</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">models</span><span class="p">.</span><span class="nf">GetOne</span><span class="p">(</span><span class="nx">strconv</span><span class="p">.</span><span class="nf">Itoa</span><span class="p">(</span><span class="nx">param</span><span class="p">.</span><span class="nx">Id</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">logrus</span><span class="p">.</span><span class="nf">Warn</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="nf">WriteResponse</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">ErrorResponseCode</span><span class="p">,</span> <span class="s">&#34;failed&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nf">WriteResponse</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">SuccessResponseCode</span><span class="p">,</span> <span class="s">&#34;success&#34;</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>根据swagger文档规范，一个swagger文档首先要有swagger的版本和info信息。利用go-swagger只需要在声明package之前加上如下注释即可：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Package classification User API.
</span><span class="c1">//
</span><span class="c1">// The purpose of this service is to provide an application
</span><span class="c1">// that is using plain go code to define an API
</span><span class="c1">//
</span><span class="c1">//      Host: localhost
</span><span class="c1">//      Version: 0.0.1
</span><span class="c1">//
</span><span class="c1">// swagger:meta
</span><span class="c1"></span><span class="kn">package</span> <span class="nx">service</span>
</code></pre></td></tr></table>
</div>
</div><p>然后在项目根目录下使用<code>swagger generate spec -o ./swagger.json</code>命令生成<code>swagger.json</code>文件：</p>
<p>此命令会找到main.go入口文件，然后遍历所有源码文件，解析然后生成swagger.json文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;swagger&#34;</span><span class="p">:</span> <span class="s2">&#34;2.0&#34;</span><span class="p">,</span>
  <span class="nt">&#34;info&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The purpose of this service is to provide an application\nthat is using plain go code to define an API&#34;</span><span class="p">,</span>
    <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;User API.&#34;</span><span class="p">,</span>
    <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;0.0.1&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;host&#34;</span><span class="p">:</span> <span class="s2">&#34;localhost&#34;</span><span class="p">,</span>
  <span class="nt">&#34;paths&#34;</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>基本信息有了，然后就要有路由，请求，响应等，下面针对getOneUser接口编写swagger注释：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// swagger:parameters getSingleUser
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">GetUserParam</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// an id of user info
</span><span class="c1"></span>    <span class="c1">//
</span><span class="c1"></span>    <span class="c1">// Required: true
</span><span class="c1"></span>    <span class="c1">// in: path
</span><span class="c1"></span>    <span class="nx">Id</span> <span class="kt">int</span> <span class="s">`json:&#34;id&#34;`</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">GetOneUser</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// swagger:route GET /users/{id} users getSingleUser
</span><span class="c1"></span>    <span class="c1">//
</span><span class="c1"></span>    <span class="c1">// get a user by userID
</span><span class="c1"></span>    <span class="c1">//
</span><span class="c1"></span>    <span class="c1">// This will show a user info
</span><span class="c1"></span>    <span class="c1">//
</span><span class="c1"></span>    <span class="c1">//     Responses:
</span><span class="c1"></span>    <span class="c1">//       200: UserResponse
</span><span class="c1"></span>    <span class="nx">decoder</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">NewDecoder</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">param</span> <span class="nx">GetUserParam</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">decoder</span><span class="p">.</span><span class="nf">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">param</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nf">WriteResponse</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">ErrorResponseCode</span><span class="p">,</span> <span class="s">&#34;request param is invalid, please check!&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">// get user from db
</span><span class="c1"></span>    <span class="nx">user</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">models</span><span class="p">.</span><span class="nf">GetOne</span><span class="p">(</span><span class="nx">strconv</span><span class="p">.</span><span class="nf">Itoa</span><span class="p">(</span><span class="nx">param</span><span class="p">.</span><span class="nx">Id</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">logrus</span><span class="p">.</span><span class="nf">Warn</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="nf">WriteResponse</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">ErrorResponseCode</span><span class="p">,</span> <span class="s">&#34;failed&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nf">WriteResponse</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">SuccessResponseCode</span><span class="p">,</span> <span class="s">&#34;success&#34;</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>可以看到在GetUserParam结构体上面加了一行<code>swagger:parameters getSingleUser</code>的注释信息，这是声明接口的入参注释，结构体内部的几行注释指明了id这个参数必填，并且查询参数id是在url path中。</p>
<p>在GetOneUser函数中：</p>
<ul>
<li>swagger:route指明使用的http method，路由，以及标签和operation id</li>
<li>Responses指明了返回值的code以及类型</li>
</ul>
<p>如果入参中有多个参数,可以按照如下写法:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// swagger:parameters getSingleUser
</span><span class="c1">// 定义一个 Person 结构体，用来绑定 url query
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">Person</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// an id of user info
</span><span class="c1"></span>	<span class="c1">//
</span><span class="c1"></span>	<span class="c1">// Required: true
</span><span class="c1"></span>	<span class="c1">// in: query
</span><span class="c1"></span>	<span class="nx">Name</span> <span class="kt">string</span> <span class="s">`form:&#34;name&#34; json:&#34;name&#34;`</span> <span class="c1">// 使用成员变量标签定义对应的参数名
</span><span class="c1"></span>	<span class="c1">// an address of user info
</span><span class="c1"></span>	<span class="c1">//
</span><span class="c1"></span>	<span class="c1">// Required: true
</span><span class="c1"></span>	<span class="c1">// in: query
</span><span class="c1"></span>	<span class="nx">Address</span> <span class="kt">string</span> <span class="s">`form:&#34;address&#34; json:&#34;address&#34;`</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>然后再声明响应:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// User Info
</span><span class="c1">//
</span><span class="c1">// swagger:response UserResponse
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">UserWapper</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// in: body
</span><span class="c1"></span>    <span class="nx">Body</span> <span class="nx">ResponseMessage</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">ResponseMessage</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Code</span>    <span class="kt">int</span>         <span class="s">`json:&#34;code&#34;`</span>
    <span class="nx">Message</span> <span class="kt">string</span>      <span class="s">`json:&#34;message&#34;`</span>
    <span class="nx">Data</span>    <span class="kd">interface</span><span class="p">{}</span> <span class="s">`json:&#34;data&#34;`</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>使用swagger:response语法声明返回值，其上两行是返回值的描述</p>
<p>然后浏览器访问localhost,查看swagger-editor界面,点击工具栏中的File-&gt;Impoprt File上传刚才生成的 swagger.json文件，就可以看到界面：</p>
<p><img loading="lazy" src="https://blog-1257321977.cos.ap-beijing.myqcloud.com/20191127173912.png" alt=""  />
</p>
<p>这样一个简单的api文档就生成了</p>
<p>3.怎么样？是不是很简单？可是又感觉那里不对，嗯，注释都写在代码里了，很不美观，而且不易维护。想一下go-swagger的原理是扫描目录下的所有go文件，解析注释信息。那么是不是可以把api注释都集中写在单个文件内，统一管理，免得分散在各个源码文件内。</p>
<p>新建一个doc.go文件，这里还有一个接口是UpdateUser,那么我们在doc.go文件中声明此接口的api注释。先看一下UpdateUser接口的代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">UpdateUser</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">defer</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
    <span class="c1">// decode body data into user struct
</span><span class="c1"></span>    <span class="nx">decoder</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">NewDecoder</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
    <span class="nx">user</span> <span class="o">:=</span> <span class="nx">models</span><span class="p">.</span><span class="nx">User</span><span class="p">{}</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">decoder</span><span class="p">.</span><span class="nf">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nf">WriteResponse</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">ErrorResponseCode</span><span class="p">,</span> <span class="s">&#34;user data is invalid, please check!&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">// check if user exists
</span><span class="c1"></span>    <span class="nx">data</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">models</span><span class="p">.</span><span class="nf">GetUserById</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">Id</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">logrus</span><span class="p">.</span><span class="nf">Warn</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="nf">WriteResponse</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">ErrorResponseCode</span><span class="p">,</span> <span class="s">&#34;query user failed&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">data</span><span class="p">.</span><span class="nx">Id</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nf">WriteResponse</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">ErrorResponseCode</span><span class="p">,</span> <span class="s">&#34;user not exists, no need to update&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">// update
</span><span class="c1"></span>    <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">models</span><span class="p">.</span><span class="nf">Update</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nf">WriteResponse</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">ErrorResponseCode</span><span class="p">,</span> <span class="s">&#34;update user data failed, please try again!&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nf">WriteResponse</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">SuccessResponseCode</span><span class="p">,</span> <span class="s">&#34;update user data success!&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>然后再doc.go文件中编写如下声明：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">service</span>

<span class="kn">import</span> <span class="s">&#34;user.server/models&#34;</span>

<span class="c1">// swagger:parameters UpdateUserResponseWrapper
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">UpdateUserRequest</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// in: body
</span><span class="c1"></span>    <span class="nx">Body</span> <span class="nx">models</span><span class="p">.</span><span class="nx">User</span>
<span class="p">}</span>

<span class="c1">// Update User Info
</span><span class="c1">//
</span><span class="c1">// swagger:response UpdateUserResponseWrapper
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">UpdateUserResponseWrapper</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// in: body
</span><span class="c1"></span>    <span class="nx">Body</span> <span class="nx">ResponseMessage</span>
<span class="p">}</span>

<span class="c1">// swagger:route POST /users users UpdateUserResponseWrapper
</span><span class="c1">//
</span><span class="c1">// Update User
</span><span class="c1">//
</span><span class="c1">// This will update user info
</span><span class="c1">//
</span><span class="c1">//     Responses:
</span><span class="c1">//       200: UpdateUserResponseWrapper 
</span></code></pre></td></tr></table>
</div>
</div><p>这样就把api声明注释给抽离出来了，然后使用命令<code>swagger generate spec -o ./swagger.json</code>生成json文件,就可以看到这样的结果：</p>
<p><img loading="lazy" src="https://blog-1257321977.cos.ap-beijing.myqcloud.com/20191127173912.png" alt=""  />
</p>
<p>很简单吧，参照文档编写几行注释，然后一个命令生成API文档。</p>
<h1 id="优化">优化<a hidden class="anchor" aria-hidden="true" href="#优化">#</a></h1>
<p>因为go-swagger没办法解析interface中包含的结构体,所以swagger没办法看到response的具体内容,有很大的缺陷.我们可以结合手写yaml来做优化</p>
<p>main.go</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// 测试标题
</span><span class="c1">//
</span><span class="c1">// 测试介绍
</span><span class="c1">//
</span><span class="c1">// Host: localhost:8888
</span><span class="c1">// Version: 1.0.0
</span><span class="c1">//
</span><span class="c1">// swagger:meta
</span><span class="c1"></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">router</span> <span class="o">:=</span> <span class="nx">engine</span><span class="p">.</span><span class="nf">InitGinEngine</span><span class="p">()</span>
	<span class="nx">router</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;gettest&#34;</span><span class="p">,</span> <span class="nx">GetTest</span><span class="p">)</span>
	<span class="nx">router</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:&#34;</span> <span class="o">+</span> <span class="nx">Port</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">GetTest</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">req</span> <span class="nx">adapter</span><span class="p">.</span><span class="nx">GetTestRequest</span>
	<span class="c1">// 将 url 查询参数和person绑定在一起
</span><span class="c1"></span>	<span class="nx">_</span> <span class="p">=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">ShouldBindQuery</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">req</span><span class="p">)</span>
	<span class="nx">res</span> <span class="o">:=</span> <span class="nx">adapter</span><span class="p">.</span><span class="nx">GetTestResponse</span><span class="p">{}</span>
	<span class="nx">comm</span><span class="p">.</span><span class="nf">SetResultMsg</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>adapter.go</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">adapter</span>

<span class="c1">// swagger:operation GET /gettest GetTest
</span><span class="c1">// ---
</span><span class="c1">// summary: 接口简介.
</span><span class="c1">// description: 接口说明
</span><span class="c1">// responses:
</span><span class="c1">//   &#34;200&#34;:
</span><span class="c1">//     description: 返回值
</span><span class="c1">//     schema:
</span><span class="c1">//       properties:
</span><span class="c1">//         code:
</span><span class="c1">//           format: int64
</span><span class="c1">//           type: integer
</span><span class="c1">//           example: 0
</span><span class="c1">//         data:
</span><span class="c1">//           $ref: &#39;#/definitions/GetTestResponse&#39;
</span><span class="c1">//         message:
</span><span class="c1">//           type: string
</span><span class="c1">//           example: &#34;success&#34;
</span><span class="c1"></span>
<span class="c1">// 结构体GetTestRequest介绍
</span><span class="c1">//  swagger:parameters GetTest
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">GetTestRequest</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">//  参数A介绍
</span><span class="c1"></span>	<span class="c1">//  Required: true
</span><span class="c1"></span>	<span class="c1">//  in: query
</span><span class="c1"></span>	<span class="nx">Name</span> <span class="kt">string</span> <span class="s">`form:&#34;name&#34; json:&#34;name&#34;`</span>

	<span class="c1">//  参数B介绍
</span><span class="c1"></span>	<span class="c1">//  Required: true
</span><span class="c1"></span>	<span class="c1">//  in: query
</span><span class="c1"></span>	<span class="nx">Address</span> <span class="kt">string</span> <span class="s">`form:&#34;address&#34; json:&#34;address&#34;`</span>
<span class="p">}</span>

<span class="c1">// GetTestResWrapper介绍
</span><span class="c1">// swagger:response GetTestResWrapper
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">getTestResWrapper</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// The error message
</span><span class="c1"></span>	<span class="c1">// in: body
</span><span class="c1"></span>	<span class="nx">Body</span> <span class="nx">GetTestResponse</span>
<span class="p">}</span>

<span class="c1">// GetTestResult介绍
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">GetTestResponse</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// 学生姓名
</span><span class="c1"></span>	<span class="c1">//example: 小明
</span><span class="c1"></span>	<span class="nx">Name</span> <span class="kt">string</span> <span class="s">`form:&#34;name&#34; json:&#34;name&#34;`</span>
	<span class="c1">//  学生住址
</span><span class="c1"></span>	<span class="c1">//example: 北京
</span><span class="c1"></span>	<span class="nx">Address</span> <span class="kt">string</span> <span class="s">`form:&#34;address&#34; json:&#34;address&#34;`</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>因为手写yaml中的<code>#/definitions/GetTestResponse</code>,没有办法自动引进GetTestResponse,可以用一种取巧的办法来引进GetTestResponse,那就是创建<code>swagger:response GetTestResWrapper</code>.</p>
<p>生成yaml文件如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">definitions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">GetTestResponse</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">GetTestResult介绍</span><span class="w">
</span><span class="w">    </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">学生住址</span><span class="w">
</span><span class="w">        </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="l">北京</span><span class="w">
</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">string</span><span class="w">
</span><span class="w">        </span><span class="nt">x-go-name</span><span class="p">:</span><span class="w"> </span><span class="l">Address</span><span class="w">
</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">学生姓名</span><span class="w">
</span><span class="w">        </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="l">小明</span><span class="w">
</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">string</span><span class="w">
</span><span class="w">        </span><span class="nt">x-go-name</span><span class="p">:</span><span class="w"> </span><span class="l">Name</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">object</span><span class="w">
</span><span class="w">    </span><span class="nt">x-go-package</span><span class="p">:</span><span class="w"> </span><span class="l">suyang/example/go-swagger/adapter</span><span class="w">
</span><span class="w"></span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8888</span><span class="w">
</span><span class="w"></span><span class="nt">info</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">测试介绍</span><span class="w">
</span><span class="w">  </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l">测试标题</span><span class="w">
</span><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w">
</span><span class="w"></span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">/gettest</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">get</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">接口说明</span><span class="w">
</span><span class="w">      </span><span class="nt">operationId</span><span class="p">:</span><span class="w"> </span><span class="l">GetTest</span><span class="w">
</span><span class="w">      </span><span class="nt">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">参数A介绍</span><span class="w">
</span><span class="w">        </span><span class="nt">in</span><span class="p">:</span><span class="w"> </span><span class="l">query</span><span class="w">
</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">name</span><span class="w">
</span><span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">string</span><span class="w">
</span><span class="w">        </span><span class="nt">x-go-name</span><span class="p">:</span><span class="w"> </span><span class="l">Name</span><span class="w">
</span><span class="w">      </span>- <span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">参数B介绍</span><span class="w">
</span><span class="w">        </span><span class="nt">in</span><span class="p">:</span><span class="w"> </span><span class="l">query</span><span class="w">
</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">address</span><span class="w">
</span><span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">string</span><span class="w">
</span><span class="w">        </span><span class="nt">x-go-name</span><span class="p">:</span><span class="w"> </span><span class="l">Address</span><span class="w">
</span><span class="w">      </span><span class="nt">responses</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="s2">&#34;200&#34;</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">返回值</span><span class="w">
</span><span class="w">          </span><span class="nt">schema</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="nt">code</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span><span class="w">                </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l">int64</span><span class="w">
</span><span class="w">                </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">integer</span><span class="w">
</span><span class="w">              </span><span class="nt">data</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/definitions/GetTestResponse&#39;</span><span class="w">
</span><span class="w">              </span><span class="nt">message</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="l">success</span><span class="w">
</span><span class="w">                </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">string</span><span class="w">
</span><span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l">接口简介.</span><span class="w">
</span><span class="w"></span><span class="nt">responses</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">GetTestResWrapper</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">GetTestResWrapper介绍</span><span class="w">
</span><span class="w">    </span><span class="nt">schema</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;#/definitions/GetTestResponse&#39;</span><span class="w">
</span><span class="w"></span><span class="nt">swagger</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.0&#34;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>解决了上述问题.</p>
<p>参考:<br>
<a href="https://www.zybuluo.com/daduizhang/note/1412629">https://www.zybuluo.com/daduizhang/note/1412629</a><br>
<a href="https://studygolang.com/articles/12354">https://studygolang.com/articles/12354</a><br>
<a href="https://popwalker.github.io/article/6b03ec87/">https://popwalker.github.io/article/6b03ec87/</a><br>
<a href="https://medium.com/@pedram.esmaeeli/generate-swagger-specification-from-go-source-code-648615f7b9d9">https://medium.com/@pedram.esmaeeli/generate-swagger-specification-from-go-source-code-648615f7b9d9</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="/tags/go-swagger/">go-swagger</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2021 <a href="/">Forz Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
