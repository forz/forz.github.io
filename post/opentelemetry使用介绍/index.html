<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>opentelemetry使用介绍 - Forz Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Forz" /><meta name="description" content="otel func GetTextMapPropagator 1 func GetTextMapPropagator() propagation.TextMapPropagator GetTextMapPropagator返回全局TextMapPropagator。如果未设置任何内容，则返回No-Op Tex" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.89.4 with theme even" />


<link rel="canonical" href="/post/opentelemetry%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.98f8e47918247c097fa26317cbb567fe9f05503485bf08d8547f5579543303b1.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="opentelemetry使用介绍" />
<meta property="og:description" content="otel func GetTextMapPropagator 1 func GetTextMapPropagator() propagation.TextMapPropagator GetTextMapPropagator返回全局TextMapPropagator。如果未设置任何内容，则返回No-Op Tex" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/opentelemetry%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-04-01T18:01:15+00:00" />
<meta property="article:modified_time" content="2021-04-01T18:01:15+00:00" />

<meta itemprop="name" content="opentelemetry使用介绍">
<meta itemprop="description" content="otel func GetTextMapPropagator 1 func GetTextMapPropagator() propagation.TextMapPropagator GetTextMapPropagator返回全局TextMapPropagator。如果未设置任何内容，则返回No-Op Tex"><meta itemprop="datePublished" content="2021-04-01T18:01:15+00:00" />
<meta itemprop="dateModified" content="2021-04-01T18:01:15+00:00" />
<meta itemprop="wordCount" content="6917">
<meta itemprop="keywords" content="opentelemetry," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="opentelemetry使用介绍"/>
<meta name="twitter:description" content="otel func GetTextMapPropagator 1 func GetTextMapPropagator() propagation.TextMapPropagator GetTextMapPropagator返回全局TextMapPropagator。如果未设置任何内容，则返回No-Op Tex"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Forz Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Forz Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
      <a class="menu-item-link" href="/">Home</a>
    </li><li class="menu-item">
      <a class="menu-item-link" href="/post/">Archives</a>
    </li><li class="menu-item">
      <a class="menu-item-link" href="/tags/">Tags</a>
    </li><li class="menu-item">
      <a class="menu-item-link" href="/categories/">Categories</a>
    </li>
  </ul>
</nav><div class="docsearch-input__container">
  <input type="search" class="docsearch-input" placeholder="Search" />
</div>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">opentelemetry使用介绍</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-04-01 </span>
        <div class="post-category">
            <a href="/categories/opentelemetry/"> opentelemetry </a>
            </div>
          <span class="more-meta"> 约 6917 字 </span>
          <span class="more-meta"> 预计阅读 14 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#func-gettextmappropagator">func GetTextMapPropagator</a></li>
    <li><a href="#func-gettracerprovider">func GetTracerProvider</a></li>
    <li><a href="#func-handle">func Handle</a>
      <ul>
        <li><a href="#func-seterrorhandler">func SetErrorHandler</a></li>
        <li><a href="#func-settextmappropagator">func SetTextMapPropagator</a></li>
        <li><a href="#func-settracerprovider">func SetTracerProvider</a></li>
      </ul>
    </li>
    <li><a href="#func-tracer">func Tracer</a></li>
    <li><a href="#func-version">func Version</a></li>
    <li><a href="#type-errorhandler">type ErrorHandler</a></li>
    <li><a href="#func-geterrorhandler">func GetErrorHandler</a></li>
  </ul>

  <ul>
    <li><a href="#概述">概述</a></li>
    <li><a href="#常量">常量</a></li>
    <li><a href="#func-contextwithremotespancontext">func ContextWithRemoteSpanContext</a></li>
    <li><a href="#func-contextwithspan">func ContextWithSpan</a></li>
    <li><a href="#type-event">type Event</a></li>
    <li><a href="#type-eventoption">type EventOption</a></li>
    <li><a href="#type-instrumentationoption">type InstrumentationOption</a></li>
    <li><a href="#func-withinstrumentationversion">func WithInstrumentationVersion</a></li>
    <li><a href="#type-lifecycleoption">type LifeCycleOption</a></li>
    <li><a href="#func-withattributes">func WithAttributes</a></li>
    <li><a href="#func-withtimestamp">func WithTimestamp</a></li>
    <li><a href="#type-link">type Link</a></li>
    <li><a href="#type-span">type Span</a></li>
    <li><a href="#func-spanfromcontext">func SpanFromContext</a>
      <ul>
        <li><a href="#type-spanconfig">type SpanConfig</a></li>
      </ul>
    </li>
    <li><a href="#func-neweventconfig">func NewEventConfig</a></li>
    <li><a href="#func-newspanconfig">func NewSpanConfig</a></li>
    <li><a href="#type-spancontext">type SpanContext</a>
      <ul>
        <li><a href="#func-newspancontext">func NewSpanContext</a></li>
        <li><a href="#func-remotespancontextfromcontext">func RemoteSpanContextFromContext</a></li>
        <li><a href="#func-spancontextfromcontext">func SpanContextFromContext</a></li>
        <li><a href="#func-spancontext-equal">func (SpanContext) Equal</a></li>
        <li><a href="#func-spancontext-hasspanid">func (SpanContext) HasSpanID</a></li>
        <li><a href="#func-spancontext-hastraceid">func (SpanContext) HasTraceID</a></li>
        <li><a href="#func-spancontext-isdebug">func (SpanContext) IsDebug</a></li>
        <li><a href="#func-spancontext-isdeferred">func (SpanContext) IsDeferred</a></li>
        <li><a href="#func-spancontext-isremote">func (SpanContext) IsRemote</a></li>
        <li><a href="#func-spancontext-issampled">func (SpanContext) IsSampled</a></li>
        <li><a href="#func-spancontext-isvalid">func (SpanContext) IsValid</a></li>
        <li><a href="#func-spancontext-marshaljson">func (SpanContext) MarshalJSON</a></li>
        <li><a href="#func-spancontext-spanid">func (SpanContext) SpanID</a></li>
        <li><a href="#func-spancontext-traceflags">func (SpanContext) TraceFlags</a></li>
        <li><a href="#func-spancontext-traceid">func (SpanContext) TraceID</a></li>
        <li><a href="#func-spancontext-tracestate">func (SpanContext) TraceState</a></li>
        <li><a href="#func-spancontext-withremote">func (SpanContext) WithRemote</a></li>
        <li><a href="#func-spancontext-withspanid">func (SpanContext) WithSpanID</a></li>
        <li><a href="#func-spancontext-withtraceflags">func (SpanContext) WithTraceFlags</a></li>
        <li><a href="#func-spancontext-withtraceid">func (SpanContext) WithTraceID</a></li>
        <li><a href="#func-spancontext-withtracestate">func (SpanContext) WithTraceState</a></li>
      </ul>
    </li>
    <li><a href="#type-spancontextconfig">type SpanContextConfig</a></li>
    <li><a href="#type-spanid">type SpanID</a>
      <ul>
        <li><a href="#func-spanidfromhex">func SpanIDFromHex</a></li>
        <li><a href="#func-spanid-isvalid">func (SpanID) IsValid</a></li>
        <li><a href="#func-spanid-marshaljson">func (SpanID) MarshalJSON</a></li>
        <li><a href="#func-spanid-string">func (SpanID) String</a></li>
      </ul>
    </li>
    <li><a href="#type-spankind">type SpanKind</a>
      <ul>
        <li><a href="#func-validatespankind">func ValidateSpanKind</a></li>
        <li><a href="#func-spankind-string">func (SpanKind) String</a></li>
      </ul>
    </li>
    <li><a href="#type-spanoption">type SpanOption</a></li>
    <li><a href="#func-withlinks">func WithLinks</a></li>
    <li><a href="#func-withnewroot">func WithNewRoot</a></li>
    <li><a href="#func-withspankind">func WithSpanKind</a></li>
    <li><a href="#type-traceid">type TraceID</a>
      <ul>
        <li><a href="#func-traceidfromhex">func TraceIDFromHex</a></li>
        <li><a href="#func-traceid-isvalid">func (TraceID) IsValid</a></li>
        <li><a href="#func-traceid-marshaljson">func (TraceID) MarshalJSON</a></li>
        <li><a href="#func-traceid-string">func (TraceID) String</a></li>
      </ul>
    </li>
    <li><a href="#type-tracestate">type TraceState</a>
      <ul>
        <li><a href="#func-tracestatefromkeyvalues">func TraceStateFromKeyValues</a></li>
        <li><a href="#func-tracestate-delete">func (TraceState) Delete</a></li>
        <li><a href="#func-tracestate-get">func (TraceState) Get</a></li>
        <li><a href="#func-tracestate-insert">func (TraceState) Insert</a></li>
        <li><a href="#func-tracestate-isempty">func (TraceState) IsEmpty</a></li>
        <li><a href="#func-tracestate-marshaljson">func (TraceState) MarshalJSON</a></li>
        <li><a href="#func-tracestate-string">func (TraceState) String</a></li>
      </ul>
    </li>
    <li><a href="#type-tracer">type Tracer</a></li>
    <li><a href="#type-tracerconfig">type TracerConfig</a></li>
    <li><a href="#func-newtracerconfig">func NewTracerConfig</a></li>
    <li><a href="#type-traceroption">type TracerOption</a></li>
    <li><a href="#type-tracerprovider">type TracerProvider</a></li>
    <li><a href="#func-newnooptracerprovider">func NewNoopTracerProvider</a></li>
  </ul>

  <ul>
    <li><a href="#func-withagentendpoint">func WithAgentEndpoint</a></li>
    <li><a href="#func-withbuffermaxcount">func WithBufferMaxCount</a></li>
    <li><a href="#func-withcollectorendpoint">func WithCollectorEndpoint</a></li>
    <li><a href="#func-withonerror">func WithOnError</a></li>
    <li><a href="#func-withpassword">func WithPassword</a></li>
    <li><a href="#func-withprocess">func WithProcess</a></li>
    <li><a href="#func-withusername">func WithUsername</a></li>
    <li><a href="#type-collectorendpointoption">type CollectorEndpointOption</a></li>
    <li><a href="#type-collectorendpointoptions">type CollectorEndpointOptions</a></li>
    <li><a href="#type-endpointoption">type EndpointOption</a></li>
    <li><a href="#type-exporter">type Exporter</a></li>
    <li><a href="#func-newexporter">func NewExporter</a>
      <ul>
        <li><a href="#func-exporter-exportspan">func (*Exporter) ExportSpan</a></li>
        <li><a href="#func-exporter-flush">func (*Exporter) Flush</a></li>
      </ul>
    </li>
    <li><a href="#type-option">type Option</a></li>
    <li><a href="#type-process">type Process</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h1 id="otel">otel</h1>
<h2 id="func-gettextmappropagator">func GetTextMapPropagator</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">GetTextMapPropagator</span><span class="p">()</span> <span class="nx">propagation</span><span class="p">.</span><span class="nx">TextMapPropagator</span>
</code></pre></td></tr></table>
</div>
</div><p>GetTextMapPropagator返回全局TextMapPropagator。如果未设置任何内容，则返回No-Op TextMapPropagator。</p>
<h2 id="func-gettracerprovider">func GetTracerProvider</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">GetTracerProvider</span><span class="p">()</span> <span class="nx">trace</span><span class="p">.</span><span class="nx">TracerProvider</span>
</code></pre></td></tr></table>
</div>
</div><p>GetTracerProvider返回已注册的全局跟踪提供程序。如果未注册任何内容，则返回NoopTracerProvider的实例。</p>
<p>使用跟踪提供程序创建一个命名的tracer。例如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">tracer</span> <span class="o">:=</span> <span class="nx">global</span><span class="p">.</span><span class="nf">GetTracerProvider</span><span class="p">().</span><span class="nf">Tracer</span><span class="p">(</span><span class="s">&#34;example.com/foo&#34;</span><span class="p">)</span>

</code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">tracer</span> <span class="o">:=</span> <span class="nx">global</span><span class="p">.</span><span class="nf">Tracer</span><span class="p">(</span><span class="s">&#34;example.com/foo&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="func-handle">func Handle</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">Handle</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Handle是ErrorHandler（）的便捷函数。</p>
<h3 id="func-seterrorhandler">func SetErrorHandler</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">SetErrorHandler</span><span class="p">(</span><span class="nx">h</span> <span class="nx">ErrorHandler</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>SetErrorHandler将全局ErrorHandler设置为h。</p>
<h3 id="func-settextmappropagator">func SetTextMapPropagator</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">SetTextMapPropagator</span><span class="p">(</span><span class="nx">propagator</span> <span class="nx">propagation</span><span class="p">.</span><span class="nx">TextMapPropagator</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>SetTextMapPropagator将propagator设置为全局TextMapPropagator。</p>
<h3 id="func-settracerprovider">func SetTracerProvider</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">SetTracerProvider</span><span class="p">(</span><span class="nx">tp</span> <span class="nx">trace</span><span class="p">.</span><span class="nx">TracerProvider</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>SetTracerProvider registers <code>tp</code> as the global trace provider.</p>
<p>SetTracerProvider将tp注册为全局trace provider。</p>
<h2 id="func-tracer">func Tracer</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">Tracer</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">trace</span><span class="p">.</span><span class="nx">Tracer</span>
</code></pre></td></tr></table>
</div>
</div><p>tracer创建一个实现tracer接口的命名tracer。如果名称为空字符串，则提供程序将使用默认名称。</p>
<p>这是 GetTracerProvider().Tracer(name) 的缩写</p>
<h2 id="func-version">func Version</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">Version</span><span class="p">()</span> <span class="kt">string</span>
</code></pre></td></tr></table>
</div>
</div><p>版本是正在使用的OpenTelemetry的当前发行版本。</p>
<h2 id="type-errorhandler">type ErrorHandler</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">ErrorHandler</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="c1">// Handle handles any error deemed irremediable by an OpenTelemetry
</span><span class="c1"></span>	<span class="c1">// component.
</span><span class="c1"></span>	<span class="nf">Handle</span><span class="p">(</span><span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ErrorHandler处理不可补救的事件。</p>
<h2 id="func-geterrorhandler">func GetErrorHandler</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">GetErrorHandler</span><span class="p">()</span> <span class="nx">ErrorHandler</span>
</code></pre></td></tr></table>
</div>
</div><p>GetErrorHandler返回全局ErrorHandler实例。如果没有设置ErrorHandler实例（SetErrorHandler），则返回将错误记录到STDERR的默认ErrorHandler。</p>
<h1 id="trace">trace</h1>
<h2 id="概述">概述</h2>
<p>trace 提供了OpenTelemetry APItrace部分的实现。</p>
<p>该程序包目前处于GA预发布阶段。在我们trace不断发展的OpenTelemetry规范和用户反馈的过程中，向后不兼容的更改可能会在后续的次要版本中引入。</p>
<p>为了参与分布式trace，需要为要执行的操作创建span，作为trace工作流的一部分。它是最简单的形式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">tracer</span> <span class="nx">trace</span><span class="p">.</span><span class="nx">Tracer</span>

<span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">tracer</span> <span class="p">=</span> <span class="nx">otel</span><span class="p">.</span><span class="nf">Tracer</span><span class="p">(</span><span class="s">&#34;instrumentation/package/name&#34;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">operation</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">span</span> <span class="nx">trace</span><span class="p">.</span><span class="nx">Span</span>
	<span class="nx">ctx</span><span class="p">,</span> <span class="nx">span</span> <span class="p">=</span> <span class="nx">tracer</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;operation&#34;</span><span class="p">)</span>
	<span class="k">defer</span> <span class="nx">span</span><span class="p">.</span><span class="nf">End</span><span class="p">()</span>
	<span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Tracer是仪器特有的，用于创建span。仪器应设计为接受TracerProvider，从中可以创建自己的唯一Tracer。或者，可以将go.opentelemetry.io/otel软件包中已注册的全局TracerProvider用作默认值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">const</span> <span class="p">(</span>
	<span class="nx">name</span>    <span class="p">=</span> <span class="s">&#34;instrumentation/package/name&#34;</span>
	<span class="nx">version</span> <span class="p">=</span> <span class="s">&#34;0.1.0&#34;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Instrumentation</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">tracer</span> <span class="nx">trace</span><span class="p">.</span><span class="nx">Tracer</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewInstrumentation</span><span class="p">(</span><span class="nx">tp</span> <span class="nx">trace</span><span class="p">.</span><span class="nx">TracerProvider</span><span class="p">)</span> <span class="o">*</span><span class="nx">Instrumentation</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">tp</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">tp</span> <span class="p">=</span> <span class="nx">otel</span><span class="p">.</span><span class="nf">TracerProvider</span><span class="p">()</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">Instrumentation</span><span class="p">{</span>
		<span class="nx">tracer</span><span class="p">:</span> <span class="nx">tp</span><span class="p">.</span><span class="nf">Tracer</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">trace</span><span class="p">.</span><span class="nf">WithInstrumentationVersion</span><span class="p">(</span><span class="nx">version</span><span class="p">)),</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">operation</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">inst</span> <span class="o">*</span><span class="nx">Instrumentation</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">span</span> <span class="nx">trace</span><span class="p">.</span><span class="nx">Span</span>
	<span class="nx">ctx</span><span class="p">,</span> <span class="nx">span</span> <span class="p">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">tracer</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;operation&#34;</span><span class="p">)</span>
	<span class="k">defer</span> <span class="nx">span</span><span class="p">.</span><span class="nf">End</span><span class="p">()</span>
	<span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="常量">常量</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">const</span> <span class="p">(</span>
	<span class="c1">// FlagsSampled is a bitmask with the sampled bit set. A SpanContext
</span><span class="c1"></span>	<span class="c1">// with the sampling bit set means the span is sampled.
</span><span class="c1"></span>	<span class="nx">FlagsSampled</span> <span class="p">=</span> <span class="nb">byte</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span>
	<span class="c1">// FlagsDeferred is a bitmask with the deferred bit set. A SpanContext
</span><span class="c1"></span>	<span class="c1">// with the deferred bit set means the sampling decision has been
</span><span class="c1"></span>	<span class="c1">// defered to the receiver.
</span><span class="c1"></span>	<span class="nx">FlagsDeferred</span> <span class="p">=</span> <span class="nb">byte</span><span class="p">(</span><span class="mh">0x02</span><span class="p">)</span>
	<span class="c1">// FlagsDebug is a bitmask with the debug bit set.
</span><span class="c1"></span>	<span class="nx">FlagsDebug</span> <span class="p">=</span> <span class="nb">byte</span><span class="p">(</span><span class="mh">0x04</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="func-contextwithremotespancontext">func ContextWithRemoteSpanContext</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">ContextWithRemoteSpanContext</span><span class="p">(</span><span class="nx">parent</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">remote</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span>
</code></pre></td></tr></table>
</div>
</div><p>ContextWithRemoteSpanContext返回具有远程集的父级副本作为远程span上下文。</p>
<h2 id="func-contextwithspan">func ContextWithSpan</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">ContextWithSpan</span><span class="p">(</span><span class="nx">parent</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">span</span> <span class="nx">Span</span><span class="p">)</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span>
</code></pre></td></tr></table>
</div>
</div><p>ContextWithSpan返回span设置为current的parent的副本。</p>
<h2 id="type-event">type Event</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Event</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// Name is the name of this event
</span><span class="c1"></span>	<span class="nx">Name</span> <span class="kt">string</span>

	<span class="c1">// Attributes describe the aspects of the event.
</span><span class="c1"></span>	<span class="nx">Attributes</span> <span class="p">[]</span><span class="nx">attribute</span><span class="p">.</span><span class="nx">KeyValue</span>

	<span class="c1">// Time at which this event was recorded.
</span><span class="c1"></span>	<span class="nx">Time</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Event是Span一生中发生的一件事情。</p>
<h2 id="type-eventoption">type EventOption</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">EventOption</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="nf">ApplyEvent</span><span class="p">(</span><span class="o">*</span><span class="nx">SpanConfig</span><span class="p">)</span>
	<span class="c1">// contains filtered or unexported methods
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>EventOption将spanEvent选项应用于SpanConfig。</p>
<h2 id="type-instrumentationoption">type InstrumentationOption</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">InstrumentationOption</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="nx">TracerOption</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>InstrumentationOption是用于应用特定于工具的选项的接口。</p>
<h2 id="func-withinstrumentationversion">func WithInstrumentationVersion</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithInstrumentationVersion</span><span class="p">(</span><span class="nx">version</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">InstrumentationOption</span>
</code></pre></td></tr></table>
</div>
</div><p>WithInstrumentationVersion设置检测版本。</p>
<h2 id="type-lifecycleoption">type LifeCycleOption</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">LifeCycleOption</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="nx">SpanOption</span>
	<span class="nx">EventOption</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>LifeCycleOption将span生命周期选项应用于SpanConfig。这些选项设置与整个生命周期中的Event相关的值，例如开始，结束，遇到错误以及其他用户定义的值得注意的Event。</p>
<h2 id="func-withattributes">func WithAttributes</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithAttributes</span><span class="p">(</span><span class="nx">attributes</span> <span class="o">...</span><span class="nx">attribute</span><span class="p">.</span><span class="nx">KeyValue</span><span class="p">)</span> <span class="nx">LifeCycleOption</span>
</code></pre></td></tr></table>
</div>
</div><p>WithAttributes添加与span生命周期Event相关的属性。这些属性用于描述当向Span的开始或结束Event提供此选项时Span代表的工作。否则，这些属性将提供有关正在记录的Event的其他信息（例如，错误，状态更改，处理进度，系统Event）。</p>
<p>如果传递了这些选项中的多个，则每个后续选项的属性将扩展属性，而不是覆盖属性。不能保证结果属性的唯一性。</p>
<h2 id="func-withtimestamp">func WithTimestamp</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithTimestamp</span><span class="p">(</span><span class="nx">t</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">)</span> <span class="nx">LifeCycleOption</span>
</code></pre></td></tr></table>
</div>
</div><p>WithTimestamp设置span生命周期时刻（例如开始，停止，错误）的时间。</p>
<h2 id="type-link">type Link</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Link</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">SpanContext</span>
	<span class="nx">Attributes</span> <span class="p">[]</span><span class="nx">attribute</span><span class="p">.</span><span class="nx">KeyValue</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Link是两个Span之间的关系。关系可以在同一Trace内，也可以在不同Trace之间。</p>
<p>例如，在以下情况下使用Link：</p>
<ol>
<li>批处理：一批操作可能包含一些操作，与一个或多个Trace/span相关联。由于只能有一个父SpanContext，则使用Link来保持对批处理中所有操作的SpanContext。</li>
<li>Public Endpoint：针对一个传入客户端请求的SpanContext。公共端点应被视为不受信任。在这种情况下，以自己的身份进行trace，并需要创建抽样决策，但是在某些情况下，此新trace需要与原始trace相关形式。Link用于保留对原始SpanContext的引用，并且trace关系。</li>
</ol>
<h2 id="type-span">type Span</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Span</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="c1">// Tracer returns the Tracer that created the Span. Tracer MUST NOT be
</span><span class="c1"></span>	<span class="c1">// nil.
</span><span class="c1"></span>	<span class="nf">Tracer</span><span class="p">()</span> <span class="nx">Tracer</span>

	<span class="c1">// End completes the Span. The Span is considered complete and ready to be
</span><span class="c1"></span>	<span class="c1">// delivered through the rest of the telemetry pipeline after this method
</span><span class="c1"></span>	<span class="c1">// is called. Therefore, updates to the Span are not allowed after this
</span><span class="c1"></span>	<span class="c1">// method has been called.
</span><span class="c1"></span>	<span class="nf">End</span><span class="p">(</span><span class="nx">options</span> <span class="o">...</span><span class="nx">SpanOption</span><span class="p">)</span>

	<span class="c1">// AddEvent adds an event with the provided name and options.
</span><span class="c1"></span>	<span class="nf">AddEvent</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">options</span> <span class="o">...</span><span class="nx">EventOption</span><span class="p">)</span>

	<span class="c1">// IsRecording returns the recording state of the Span. It will return
</span><span class="c1"></span>	<span class="c1">// true if the Span is active and events can be recorded.
</span><span class="c1"></span>	<span class="nf">IsRecording</span><span class="p">()</span> <span class="kt">bool</span>

	<span class="c1">// RecordError records an error as a Span event.
</span><span class="c1"></span>	<span class="nf">RecordError</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">,</span> <span class="nx">options</span> <span class="o">...</span><span class="nx">EventOption</span><span class="p">)</span>

	<span class="c1">// SpanContext returns the SpanContext of the Span. The returned
</span><span class="c1"></span>	<span class="c1">// SpanContext is usable even after the End has been called for the Span.
</span><span class="c1"></span>	<span class="nf">SpanContext</span><span class="p">()</span> <span class="nx">SpanContext</span>

	<span class="c1">// SetStatus sets the status of the Span in the form of a code and a
</span><span class="c1"></span>	<span class="c1">// message. SetStatus overrides the value of previous calls to SetStatus
</span><span class="c1"></span>	<span class="c1">// on the Span.
</span><span class="c1"></span>	<span class="nf">SetStatus</span><span class="p">(</span><span class="nx">code</span> <span class="nx">codes</span><span class="p">.</span><span class="nx">Code</span><span class="p">,</span> <span class="nx">msg</span> <span class="kt">string</span><span class="p">)</span>

	<span class="c1">// SetName sets the Span name.
</span><span class="c1"></span>	<span class="nf">SetName</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span>

	<span class="c1">// SetAttributes sets kv as attributes of the Span. If a key from kv
</span><span class="c1"></span>	<span class="c1">// already exists for an attribute of the Span it will be overwritten with
</span><span class="c1"></span>	<span class="c1">// the value contained in kv.
</span><span class="c1"></span>	<span class="nf">SetAttributes</span><span class="p">(</span><span class="nx">kv</span> <span class="o">...</span><span class="nx">attribute</span><span class="p">.</span><span class="nx">KeyValue</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>span是trace的单个组成部分。它表示trace的工作流的单个命名和定时操作。trace用于创建span，然后由该span表示的操作可以在操作本身结束时正确结束span。</p>
<h2 id="func-spanfromcontext">func SpanFromContext</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">SpanFromContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="nx">Span</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanFromContext返回来自ctx的当前范围，如果未设置，则返回noop范围。</p>
<h3 id="type-spanconfig">type SpanConfig</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">SpanConfig</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// Attributes describe the associated qualities of a Span.
</span><span class="c1"></span>	<span class="nx">Attributes</span> <span class="p">[]</span><span class="nx">attribute</span><span class="p">.</span><span class="nx">KeyValue</span>
	<span class="c1">// Timestamp is a time in a Span life-cycle.
</span><span class="c1"></span>	<span class="nx">Timestamp</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
	<span class="c1">// Links are the associations a Span has with other Spans.
</span><span class="c1"></span>	<span class="nx">Links</span> <span class="p">[]</span><span class="nx">Link</span>
	<span class="c1">// NewRoot identifies a Span as the root Span for a new trace. This is
</span><span class="c1"></span>	<span class="c1">// commonly used when an existing trace crosses trust boundaries and the
</span><span class="c1"></span>	<span class="c1">// remote parent span context should be ignored for security.
</span><span class="c1"></span>	<span class="nx">NewRoot</span> <span class="kt">bool</span>
	<span class="c1">// SpanKind is the role a Span has in a trace.
</span><span class="c1"></span>	<span class="nx">SpanKind</span> <span class="nx">SpanKind</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanConfig是Span的一组选项。</p>
<h2 id="func-neweventconfig">func NewEventConfig</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">NewEventConfig</span><span class="p">(</span><span class="nx">options</span> <span class="o">...</span><span class="nx">EventOption</span><span class="p">)</span> <span class="o">*</span><span class="nx">SpanConfig</span>
</code></pre></td></tr></table>
</div>
</div><p>NewEventConfig将所有EventOptions应用于返回的SpanConfig。如果未传递任何时间戳选项，则返回的SpanConfig会将Timestamp设置为呼叫时间，否则将不对返回的SpanConfig进行验证。</p>
<h2 id="func-newspanconfig">func NewSpanConfig</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">NewSpanConfig</span><span class="p">(</span><span class="nx">options</span> <span class="o">...</span><span class="nx">SpanOption</span><span class="p">)</span> <span class="o">*</span><span class="nx">SpanConfig</span>
</code></pre></td></tr></table>
</div>
</div><p>NewSpanConfig将所有选项应用于返回的SpanConfig。对返回的SpanConfig不会执行任何验证（例如，不进行唯一性检查或数据绑定），它将留给SDK来执行此操作。</p>
<h2 id="type-spancontext">type SpanContext</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">SpanContext</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// contains filtered or unexported fields
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanContext包含有关Span的标识trace信息。</p>
<h3 id="func-newspancontext">func NewSpanContext</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">NewSpanContext</span><span class="p">(</span><span class="nx">config</span> <span class="nx">SpanContextConfig</span><span class="p">)</span> <span class="nx">SpanContext</span>
</code></pre></td></tr></table>
</div>
</div><p>NewSpanContext使用提供的SpanContextConfig中的值构造一个SpanContext。</p>
<h3 id="func-remotespancontextfromcontext">func RemoteSpanContextFromContext</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">RemoteSpanContextFromContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="nx">SpanContext</span>
</code></pre></td></tr></table>
</div>
</div><p>RemoteSpanContextFromContext从ctx返回远程span上下文。</p>
<h3 id="func-spancontextfromcontext">func SpanContextFromContext</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">SpanContextFromContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="nx">SpanContext</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanContextFromContext从ctx返回当前的SpanContext，如果未设置，则返回一个空的SpanContext。</p>
<h3 id="func-spancontext-equal">func (SpanContext) Equal</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">Equal</span><span class="p">(</span><span class="nx">other</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>Equal是确定两个SpanContext值是否相等的谓词。</p>
<h3 id="func-spancontext-hasspanid">func (SpanContext) HasSpanID</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">HasSpanID</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>HasSpanID检查SpanContext是否具有有效的SpanID。</p>
<h3 id="func-spancontext-hastraceid">func (SpanContext) HasTraceID</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">HasTraceID</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>HasTraceID检查SpanContext是否具有有效的TraceID。</p>
<h3 id="func-spancontext-isdebug">func (SpanContext) IsDebug</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">IsDebug</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>如果在trace标志中设置了调试位，则IsDebug返回。</p>
<h3 id="func-spancontext-isdeferred">func (SpanContext) IsDeferred</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">IsDeferred</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>如果在trace标志中设置了延迟位，则IsDeferred返回。</p>
<h3 id="func-spancontext-isremote">func (SpanContext) IsRemote</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">IsRemote</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>IsRemote指示SpanContext是否表示远程创建的Span。</p>
<h3 id="func-spancontext-issampled">func (SpanContext) IsSampled</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">IsSampled</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>如果在trace标志中设置了采样位，则IsSampled返回。</p>
<h3 id="func-spancontext-isvalid">func (SpanContext) IsValid</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">IsValid</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>如果SpanContext有效，则IsValid返回。有效的span上下文具有有效的TraceID和SpanID。</p>
<h3 id="func-spancontext-marshaljson">func (SpanContext) MarshalJSON</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">MarshalJSON</span><span class="p">()</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>MarshalJSON实现了一个自定义的marshal函数来对SpanContext进行编码。</p>
<h3 id="func-spancontext-spanid">func (SpanContext) SpanID</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">SpanID</span><span class="p">()</span> <span class="nx">SpanID</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanID从SpanContext返回SpanID。</p>
<h3 id="func-spancontext-traceflags">func (SpanContext) TraceFlags</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">TraceFlags</span><span class="p">()</span> <span class="kt">byte</span>
</code></pre></td></tr></table>
</div>
</div><p>TraceFlags从SpanContext返回标志。</p>
<h3 id="func-spancontext-traceid">func (SpanContext) TraceID</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">TraceID</span><span class="p">()</span> <span class="nx">TraceID</span>
</code></pre></td></tr></table>
</div>
</div><p>TraceID从SpanContext返回TraceID。</p>
<h3 id="func-spancontext-tracestate">func (SpanContext) TraceState</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">TraceState</span><span class="p">()</span> <span class="nx">TraceState</span>
</code></pre></td></tr></table>
</div>
</div><p>TraceState从SpanContext返回TraceState。</p>
<h3 id="func-spancontext-withremote">func (SpanContext) WithRemote</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">WithRemote</span><span class="p">(</span><span class="nx">remote</span> <span class="kt">bool</span><span class="p">)</span> <span class="nx">SpanContext</span>
</code></pre></td></tr></table>
</div>
</div><p>WithRemote返回sc的副本，其中Remote属性设置为remote。</p>
<h3 id="func-spancontext-withspanid">func (SpanContext) WithSpanID</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">WithSpanID</span><span class="p">(</span><span class="nx">spanID</span> <span class="nx">SpanID</span><span class="p">)</span> <span class="nx">SpanContext</span>
</code></pre></td></tr></table>
</div>
</div><p>WithSpanID返回替换了SpanID的新SpanContext。</p>
<h3 id="func-spancontext-withtraceflags">func (SpanContext) WithTraceFlags</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">WithTraceFlags</span><span class="p">(</span><span class="nx">flags</span> <span class="kt">byte</span><span class="p">)</span> <span class="nx">SpanContext</span>
</code></pre></td></tr></table>
</div>
</div><p>WithTraceFlags返回替换了TraceFlags的新SpanContext。</p>
<h3 id="func-spancontext-withtraceid">func (SpanContext) WithTraceID</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">WithTraceID</span><span class="p">(</span><span class="nx">traceID</span> <span class="nx">TraceID</span><span class="p">)</span> <span class="nx">SpanContext</span>
</code></pre></td></tr></table>
</div>
</div><p>WithTraceID返回替换了TraceID的新SpanContext。</p>
<h3 id="func-spancontext-withtracestate">func (SpanContext) WithTraceState</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">WithTraceState</span><span class="p">(</span><span class="nx">state</span> <span class="nx">TraceState</span><span class="p">)</span> <span class="nx">SpanContext</span>
</code></pre></td></tr></table>
</div>
</div><p>WithTraceState返回替换了TraceState的新SpanContext。</p>
<h2 id="type-spancontextconfig">type SpanContextConfig</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">SpanContextConfig</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">TraceID</span>    <span class="nx">TraceID</span>
	<span class="nx">SpanID</span>     <span class="nx">SpanID</span>
	<span class="nx">TraceFlags</span> <span class="kt">byte</span>
	<span class="nx">TraceState</span> <span class="nx">TraceState</span>
	<span class="nx">Remote</span>     <span class="kt">bool</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanContextConfig包含可用于构造不可变SpanContext的可变字段。</p>
<h2 id="type-spanid">type SpanID</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">SpanID</span> <span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="kt">byte</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanID是trace中span的唯一标识。</p>
<h3 id="func-spanidfromhex">func SpanIDFromHex</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">SpanIDFromHex</span><span class="p">(</span><span class="nx">h</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">SpanID</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>如果SpanIDFromHex符合w3c trace-context规范，则从十六进制字符串返回SpanID。详情请参阅<a href="https://www.w3.org/TR/trace-context/#parent-id">https://www.w3.org/TR/trace-context/#parent-id</a></p>
<h3 id="func-spanid-isvalid">func (SpanID) IsValid</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="nx">SpanID</span><span class="p">)</span> <span class="nf">IsValid</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>IsValid检查SpanID是否有效。有效的SpanID不仅由零组成。</p>
<h3 id="func-spanid-marshaljson">func (SpanID) MarshalJSON</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="nx">SpanID</span><span class="p">)</span> <span class="nf">MarshalJSON</span><span class="p">()</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>MarshalJSON实现了一个自定义的marshal函数，以将SpanID编码为十六进制字符串。</p>
<h3 id="func-spanid-string">func (SpanID) String</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="nx">SpanID</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span>
</code></pre></td></tr></table>
</div>
</div><p>String返回SpanID的十六进制字符串表示形式</p>
<h2 id="type-spankind">type SpanKind</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">SpanKind</span> <span class="kt">int</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanKind是Span在trace中扮演的角色。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">const</span> <span class="p">(</span>
	<span class="c1">// SpanKindUnspecified is an unspecified SpanKind and is not a valid
</span><span class="c1"></span>	<span class="c1">// SpanKind. SpanKindUnspecified should be replaced with SpanKindInternal
</span><span class="c1"></span>	<span class="c1">// if it is received.
</span><span class="c1"></span>	<span class="nx">SpanKindUnspecified</span> <span class="nx">SpanKind</span> <span class="p">=</span> <span class="mi">0</span>
	<span class="c1">// SpanKindInternal is a SpanKind for a Span that represents an internal
</span><span class="c1"></span>	<span class="c1">// operation within an application.
</span><span class="c1"></span>	<span class="nx">SpanKindInternal</span> <span class="nx">SpanKind</span> <span class="p">=</span> <span class="mi">1</span>
	<span class="c1">// SpanKindServer is a SpanKind for a Span that represents the operation
</span><span class="c1"></span>	<span class="c1">// of handling a request from a client.
</span><span class="c1"></span>	<span class="nx">SpanKindServer</span> <span class="nx">SpanKind</span> <span class="p">=</span> <span class="mi">2</span>
	<span class="c1">// SpanKindClient is a SpanKind for a Span that represents the operation
</span><span class="c1"></span>	<span class="c1">// of client making a request to a server.
</span><span class="c1"></span>	<span class="nx">SpanKindClient</span> <span class="nx">SpanKind</span> <span class="p">=</span> <span class="mi">3</span>
	<span class="c1">// SpanKindProducer is a SpanKind for a Span that represents the operation
</span><span class="c1"></span>	<span class="c1">// of a producer sending a message to a message broker. Unlike
</span><span class="c1"></span>	<span class="c1">// SpanKindClient and SpanKindServer, there is often no direct
</span><span class="c1"></span>	<span class="c1">// relationship between this kind of Span and a SpanKindConsumer kind. A
</span><span class="c1"></span>	<span class="c1">// SpanKindProducer Span will end once the message is accepted by the
</span><span class="c1"></span>	<span class="c1">// message broker which might not overlap with the processing of that
</span><span class="c1"></span>	<span class="c1">// message.
</span><span class="c1"></span>	<span class="nx">SpanKindProducer</span> <span class="nx">SpanKind</span> <span class="p">=</span> <span class="mi">4</span>
	<span class="c1">// SpanKindConsumer is a SpanKind for a Span that represents the operation
</span><span class="c1"></span>	<span class="c1">// of a consumer receiving a message from a message broker. Like
</span><span class="c1"></span>	<span class="c1">// SpanKindProducer Spans, there is often no direct relationship between
</span><span class="c1"></span>	<span class="c1">// this Span and the Span that produced the message.
</span><span class="c1"></span>	<span class="nx">SpanKindConsumer</span> <span class="nx">SpanKind</span> <span class="p">=</span> <span class="mi">5</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>为方便起见，这些匹配原型定义，请参见 <a href="https://github.com/open-telemetry/opentelemetry-proto/blob/30d237e1ff3ab7aa50e0922b5bebdd93505090af/opentelemetry/proto/trace/v1/trace.proto#L101-L129">https://github.com/open-telemetry/opentelemetry-proto/blob/30d237e1ff3ab7aa50e0922b5bebdd93505090af/opentelemetry/proto/trace/v1/trace.proto#L101-L129</a></p>
<p>未指定的值不是有效的“ SpanKind”。使用“ ValidateSpanKind（）”将span类型强制为有效值。</p>
<h3 id="func-validatespankind">func ValidateSpanKind</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">ValidateSpanKind</span><span class="p">(</span><span class="nx">spanKind</span> <span class="nx">SpanKind</span><span class="p">)</span> <span class="nx">SpanKind</span>
</code></pre></td></tr></table>
</div>
</div><p>ValidateSpanKind返回有效的span种类值。这会将无效值强制为默认值SpanKindInternal。</p>
<h3 id="func-spankind-string">func (SpanKind) String</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sk</span> <span class="nx">SpanKind</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span>
</code></pre></td></tr></table>
</div>
</div><p>String以小写形式返回SpanKind的指定名称。</p>
<h2 id="type-spanoption">type SpanOption</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">SpanOption</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="nf">ApplySpan</span><span class="p">(</span><span class="o">*</span><span class="nx">SpanConfig</span><span class="p">)</span>
	<span class="c1">// contains filtered or unexported methods
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanOption将选项应用于SpanConfig。</p>
<h2 id="func-withlinks">func WithLinks</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithLinks</span><span class="p">(</span><span class="nx">links</span> <span class="o">...</span><span class="nx">Link</span><span class="p">)</span> <span class="nx">SpanOption</span>
</code></pre></td></tr></table>
</div>
</div><p>WithLinks将Link添加到span。这些Link将添加到现有的SpanLink中，即不会被覆盖。</p>
<h2 id="func-withnewroot">func WithNewRoot</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithNewRoot</span><span class="p">()</span> <span class="nx">SpanOption</span>
</code></pre></td></tr></table>
</div>
</div><p>WithNewRoot指定将span视为根span。定义span的trace标识符时，将忽略任何现有的父span上下文。</p>
<h2 id="func-withspankind">func WithSpanKind</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithSpanKind</span><span class="p">(</span><span class="nx">kind</span> <span class="nx">SpanKind</span><span class="p">)</span> <span class="nx">SpanOption</span>
</code></pre></td></tr></table>
</div>
</div><p>WithSpanKind设置span的SpanKind。</p>
<h2 id="type-traceid">type TraceID</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">TraceID</span> <span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="kt">byte</span>
</code></pre></td></tr></table>
</div>
</div><p>TraceID是trace的唯一标识。nolint：golint</p>
<h3 id="func-traceidfromhex">func TraceIDFromHex</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">TraceIDFromHex</span><span class="p">(</span><span class="nx">h</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">TraceID</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>如果TraceIDFromHex符合W3C trace-context规范，则从十六进制字符串返回TraceID。详情请参阅 <a href="https://www.w3.org/TR/trace-context/#trace-id">https://www.w3.org/TR/trace-context/#trace-id</a> nolint：golint</p>
<h3 id="func-traceid-isvalid">func (TraceID) IsValid</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="nx">TraceID</span><span class="p">)</span> <span class="nf">IsValid</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>IsValid检查traceTraceID是否有效。有效的traceID不仅由零组成。</p>
<h3 id="func-traceid-marshaljson">func (TraceID) MarshalJSON</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="nx">TraceID</span><span class="p">)</span> <span class="nf">MarshalJSON</span><span class="p">()</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>MarshalJSON实现了一个自定义的marshal函数，将TraceID编码为十六进制字符串。</p>
<h3 id="func-traceid-string">func (TraceID) String</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="nx">TraceID</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span>
</code></pre></td></tr></table>
</div>
</div><p>String返回TraceID的十六进制字符串表示形式</p>
<h2 id="type-tracestate">type TraceState</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">TraceState</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// contains filtered or unexported fields
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>TraceState在不同的分布式trace系统中提供了其他特定于供应商的trace标识信息。它表示由键/值对组成的不可变列表。列表中最多可以包含32个条目。</p>
<p>每个列表成员的键和值必须根据W3Ctrace上下文规范有效（请参阅<a href="https://www.w3.org/TR/trace-context-1/#key%E5%92%8Chttps://www.w3.org/">https://www.w3.org/TR/trace-context-1/#key和https://www.w3.org/</a> TR / trace-context-1 /＃value ）。</p>
<p>根据W3Ctrace上下文规范，trace状态必须始终有效。所有变异操作都会验证其输入，并在参数有效的情况下返回新的TraceState。</p>
<h3 id="func-tracestatefromkeyvalues">func TraceStateFromKeyValues</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">TraceStateFromKeyValues</span><span class="p">(</span><span class="nx">kvs</span> <span class="o">...</span><span class="nx">attribute</span><span class="p">.</span><span class="nx">KeyValue</span><span class="p">)</span> <span class="p">(</span><span class="nx">TraceState</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>TraceStateFromKeyValues是从提供的键/值对创建新的TraceState的便捷方法。</p>
<h3 id="func-tracestate-delete">func (TraceState) Delete</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">ts</span> <span class="nx">TraceState</span><span class="p">)</span> <span class="nf">Delete</span><span class="p">(</span><span class="nx">key</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">Key</span><span class="p">)</span> <span class="p">(</span><span class="nx">TraceState</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>删除将从trace状态中删除指定的条目。</p>
<h3 id="func-tracestate-get">func (TraceState) Get</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">ts</span> <span class="nx">TraceState</span><span class="p">)</span> <span class="nf">Get</span><span class="p">(</span><span class="nx">key</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">Key</span><span class="p">)</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">Value</span>
</code></pre></td></tr></table>
</div>
</div><p>Get从trace状态返回给定键的值。如果找不到密钥或提供的密钥无效，则返回一个空值。</p>
<h3 id="func-tracestate-insert">func (TraceState) Insert</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">ts</span> <span class="nx">TraceState</span><span class="p">)</span> <span class="nf">Insert</span><span class="p">(</span><span class="nx">entry</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">KeyValue</span><span class="p">)</span> <span class="p">(</span><span class="nx">TraceState</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>如果不存在，Insert会添加一个新的键/值。否则，更新现有条目。根据W3Ctrace上下文规范要求，新的或更新的条目总是插入到TraceState的开头，即左侧。</p>
<h3 id="func-tracestate-isempty">func (TraceState) IsEmpty</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">ts</span> <span class="nx">TraceState</span><span class="p">)</span> <span class="nf">IsEmpty</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>如果TraceState不包含任何条目，则IsEmpty返回true</p>
<h3 id="func-tracestate-marshaljson">func (TraceState) MarshalJSON</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">ts</span> <span class="nx">TraceState</span><span class="p">)</span> <span class="nf">MarshalJSON</span><span class="p">()</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>MarshalJSON实现了自定义的marshal函数以对trace状态进行编码。</p>
<h3 id="func-tracestate-string">func (TraceState) String</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">ts</span> <span class="nx">TraceState</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span>
</code></pre></td></tr></table>
</div>
</div><p>String根据W3Ctrace上下文规范将trace状态作为有效的字符串返回。</p>
<h2 id="type-tracer">type Tracer</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Tracer</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="c1">// Start creates a span.
</span><span class="c1"></span>	<span class="nf">Start</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">spanName</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">SpanOption</span><span class="p">)</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">Span</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Tracer是Spans的创建者。</p>
<h2 id="type-tracerconfig">type TracerConfig</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">TracerConfig</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// InstrumentationVersion is the version of the library providing
</span><span class="c1"></span>	<span class="c1">// instrumentation.
</span><span class="c1"></span>	<span class="nx">InstrumentationVersion</span> <span class="kt">string</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>TracerConfig是Tracer的一组选项。</p>
<h2 id="func-newtracerconfig">func NewTracerConfig</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">NewTracerConfig</span><span class="p">(</span><span class="nx">options</span> <span class="o">...</span><span class="nx">TracerOption</span><span class="p">)</span> <span class="o">*</span><span class="nx">TracerConfig</span>
</code></pre></td></tr></table>
</div>
</div><p>NewTracerConfig将所有选项应用于返回的TracerConfig。</p>
<h2 id="type-traceroption">type TracerOption</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">TracerOption</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="nf">ApplyTracer</span><span class="p">(</span><span class="o">*</span><span class="nx">TracerConfig</span><span class="p">)</span>
	<span class="c1">// contains filtered or unexported methods
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>TracerOption将选项应用于TracerConfig。</p>
<h2 id="type-tracerprovider">type TracerProvider</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">TracerProvider</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="c1">// Tracer creates an implementation of the Tracer interface.
</span><span class="c1"></span>	<span class="c1">// The instrumentationName must be the name of the library providing
</span><span class="c1"></span>	<span class="c1">// instrumentation. This name may be the same as the instrumented code
</span><span class="c1"></span>	<span class="c1">// only if that code provides built-in instrumentation. If the
</span><span class="c1"></span>	<span class="c1">// instrumentationName is empty, then a implementation defined default
</span><span class="c1"></span>	<span class="c1">// name will be used instead.
</span><span class="c1"></span>	<span class="c1">//
</span><span class="c1"></span>	<span class="c1">// This method must be concurrency safe.
</span><span class="c1"></span>	<span class="nf">Tracer</span><span class="p">(</span><span class="nx">instrumentationName</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">TracerOption</span><span class="p">)</span> <span class="nx">Tracer</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>TracerProvider提供对仪器trace的访问。</p>
<h2 id="func-newnooptracerprovider">func NewNoopTracerProvider</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">NewNoopTracerProvider</span><span class="p">()</span> <span class="nx">TracerProvider</span>
</code></pre></td></tr></table>
</div>
</div><p>NewNoopTracerProvider返回不执行任何操作的TracerProvider实现。从返回的TracerProvider创建的Tracer和Span也不会执行任何操作。</p>
<h1 id="exportertracejaeger">exporter/trace/jaeger</h1>
<h2 id="func-withagentendpoint">func WithAgentEndpoint</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithAgentEndpoint</span><span class="p">(</span><span class="nx">agentEndpoint</span> <span class="kt">string</span><span class="p">)</span> <span class="kd">func</span><span class="p">()</span> <span class="p">(</span><span class="nx">batchUploader</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>WithAgentEndpoint指示导出器将跨度发送到该地址的jaeger-agent。例如，localhost：6831。</p>
<h2 id="func-withbuffermaxcount">func WithBufferMaxCount</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithBufferMaxCount</span><span class="p">(</span><span class="nx">bufferMaxCount</span> <span class="kt">int</span><span class="p">)</span> <span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">options</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>WithBufferMaxCount定义可以在内存中缓冲的跟踪总数</p>
<h2 id="func-withcollectorendpoint">func WithCollectorEndpoint</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithCollectorEndpoint</span><span class="p">(</span><span class="nx">collectorEndpoint</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">options</span> <span class="o">...</span><span class="nx">CollectorEndpointOption</span><span class="p">)</span> <span class="kd">func</span><span class="p">()</span> <span class="p">(</span><span class="nx">batchUploader</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>WithCollectorEndpoint定义Jaeger HTTP Thrift收集器的完整URL。例如，http：// localhost：14268 / api / traces</p>
<h2 id="func-withonerror">func WithOnError</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithOnError</span><span class="p">(</span><span class="nx">onError</span> <span class="kd">func</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">))</span> <span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">options</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>WithOnError设置在上载跨度数据时发生错误时要调用的挂钩。如果未设置自定义钩子，则会记录错误。</p>
<h2 id="func-withpassword">func WithPassword</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithPassword</span><span class="p">(</span><span class="nx">password</span> <span class="kt">string</span><span class="p">)</span> <span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">CollectorEndpointOptions</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>WithPassword设置需要基本身份验证时使用的密码。</p>
<h2 id="func-withprocess">func WithProcess</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithProcess</span><span class="p">(</span><span class="nx">process</span> <span class="nx">Process</span><span class="p">)</span> <span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">options</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>WithProcess使用有关导出过程的信息来设置过程。</p>
<h2 id="func-withusername">func WithUsername</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithUsername</span><span class="p">(</span><span class="nx">username</span> <span class="kt">string</span><span class="p">)</span> <span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">CollectorEndpointOptions</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>WithUsername设置需要基本身份验证时要使用的用户名。</p>
<h2 id="type-collectorendpointoption">type CollectorEndpointOption</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">CollectorEndpointOption</span> <span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">CollectorEndpointOptions</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="type-collectorendpointoptions">type CollectorEndpointOptions</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">CollectorEndpointOptions</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// contains filtered or unexported fields
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="type-endpointoption">type EndpointOption</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">EndpointOption</span> <span class="kd">func</span><span class="p">()</span> <span class="p">(</span><span class="nx">batchUploader</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="type-exporter">type Exporter</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Exporter</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// contains filtered or unexported fields
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>导出器是trace.Exporter的实现，可将跨度上传到Jaeger。</p>
<h2 id="func-newexporter">func NewExporter</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">NewExporter</span><span class="p">(</span><span class="nx">endpointOption</span> <span class="nx">EndpointOption</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">Option</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">Exporter</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>NewExporter返回trace.Exporter实现，该实现将收集的跨度导出到Jaeger。</p>
<h3 id="func-exporter-exportspan">func (*Exporter) ExportSpan</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Exporter</span><span class="p">)</span> <span class="nf">ExportSpan</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">d</span> <span class="o">*</span><span class="nx">export</span><span class="p">.</span><span class="nx">SpanData</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>ExportSpan将SpanData导出到Jaeger。</p>
<h3 id="func-exporter-flush">func (*Exporter) Flush</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Exporter</span><span class="p">)</span> <span class="nf">Flush</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>刷新等待导出的跟踪范围上载。</p>
<p>如果您的程序即将结束并且您不想丢失最近的跨度，则此功能很有用。</p>
<h2 id="type-option">type Option</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Option</span> <span class="kd">func</span><span class="p">(</span><span class="o">*</span><span class="nx">options</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="type-process">type Process</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Process</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// ServiceName is the Jaeger service name.
</span><span class="c1"></span>	<span class="nx">ServiceName</span> <span class="kt">string</span>

	<span class="c1">// Tags are added to Jaeger Process exports
</span><span class="c1"></span>	<span class="nx">Tags</span> <span class="p">[]</span><span class="nx">core</span><span class="p">.</span><span class="nx">KeyValue</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>流程包含导出到jaeger的有关跟踪数据源的信息。</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Forz</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2021-04-01
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/opentelemetry/">opentelemetry</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/proto3%E8%AF%AD%E8%A8%80%E6%8C%87%E5%8D%97/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Proto3语言指南</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E5%B8%B8%E8%A7%81%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95%E7%9A%84%E6%AF%94%E8%BE%83/">
            <span class="next-text nav-default">常见负载均衡算法的比较</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="forz/forzblog.talk"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2021<span class="heart"><i class="iconfont icon-heart"></i></span><span>Forz</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>






<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
docsearch({
    apiKey: "b4b9da2eba53aa6dabe4b8ac9e8676e1",
    indexName: "forz.forzvina.com",
    appId: "IAR2EF5L65",
    inputSelector: '.docsearch-input',
    debug: false,
});
</script>
</body>
</html>
