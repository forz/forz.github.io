<!DOCTYPE html>
<html lang="zh-cn" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>opentelemetry使用介绍 | Forz Blog</title>
<meta name="keywords" content="opentelemetry" />
<meta name="description" content="otel func GetTextMapPropagator 1 func GetTextMapPropagator() propagation.TextMapPropagator GetTextMapPropagator返回全局TextMapPropagator。如果未设置任何内容，则返回No-Op Tex">
<meta name="author" content="">
<link rel="canonical" href="/post/opentelemetry%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.00d5d4fc479b1575183ee8d86b4fb372ba9d9b1904e96fa8e4c40ff7debe2b94.css" integrity="sha256-ANXU/EebFXUYPujYa0&#43;zcrqdmxkE6W&#43;o5MQP996&#43;K5Q=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.87.0" />
<meta property="og:title" content="opentelemetry使用介绍" />
<meta property="og:description" content="otel func GetTextMapPropagator 1 func GetTextMapPropagator() propagation.TextMapPropagator GetTextMapPropagator返回全局TextMapPropagator。如果未设置任何内容，则返回No-Op Tex" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/opentelemetry%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-04-01T18:01:15&#43;00:00" />
<meta property="article:modified_time" content="2021-04-01T18:01:15&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="opentelemetry使用介绍"/>
<meta name="twitter:description" content="otel func GetTextMapPropagator 1 func GetTextMapPropagator() propagation.TextMapPropagator GetTextMapPropagator返回全局TextMapPropagator。如果未设置任何内容，则返回No-Op Tex"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "/post/"
    }
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "opentelemetry使用介绍",
      "item": "/post/opentelemetry%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "opentelemetry使用介绍",
  "name": "opentelemetry使用介绍",
  "description": "otel func GetTextMapPropagator 1 func GetTextMapPropagator() propagation.TextMapPropagator GetTextMapPropagator返回全局TextMapPropagator。如果未设置任何内容，则返回No-Op Tex",
  "keywords": [
    "opentelemetry"
  ],
  "articleBody": "otel func GetTextMapPropagator 1  func GetTextMapPropagator() propagation.TextMapPropagator   GetTextMapPropagator返回全局TextMapPropagator。如果未设置任何内容，则返回No-Op TextMapPropagator。\nfunc GetTracerProvider 1  func GetTracerProvider() trace.TracerProvider   GetTracerProvider返回已注册的全局跟踪提供程序。如果未注册任何内容，则返回NoopTracerProvider的实例。\n使用跟踪提供程序创建一个命名的tracer。例如\n1 2  tracer := global.GetTracerProvider().Tracer(\"example.com/foo\")   或者\n1  tracer := global.Tracer(\"example.com/foo\")   func Handle 1  func Handle(err error)   Handle是ErrorHandler（）的便捷函数。\nfunc SetErrorHandler 1  func SetErrorHandler(h ErrorHandler)   SetErrorHandler将全局ErrorHandler设置为h。\nfunc SetTextMapPropagator 1  func SetTextMapPropagator(propagator propagation.TextMapPropagator)   SetTextMapPropagator将propagator设置为全局TextMapPropagator。\nfunc SetTracerProvider 1  func SetTracerProvider(tp trace.TracerProvider)   SetTracerProvider registers tp as the global trace provider.\nSetTracerProvider将tp注册为全局trace provider。\nfunc Tracer 1  func Tracer(name string) trace.Tracer   tracer创建一个实现tracer接口的命名tracer。如果名称为空字符串，则提供程序将使用默认名称。\n这是 GetTracerProvider().Tracer(name) 的缩写\nfunc Version 1  func Version() string   版本是正在使用的OpenTelemetry的当前发行版本。\ntype ErrorHandler 1 2 3 4 5  type ErrorHandler interface { // Handle handles any error deemed irremediable by an OpenTelemetry \t// component. \tHandle(error) }   ErrorHandler处理不可补救的事件。\nfunc GetErrorHandler 1  func GetErrorHandler() ErrorHandler   GetErrorHandler返回全局ErrorHandler实例。如果没有设置ErrorHandler实例（SetErrorHandler），则返回将错误记录到STDERR的默认ErrorHandler。\ntrace 概述 trace 提供了OpenTelemetry APItrace部分的实现。\n该程序包目前处于GA预发布阶段。在我们trace不断发展的OpenTelemetry规范和用户反馈的过程中，向后不兼容的更改可能会在后续的次要版本中引入。\n为了参与分布式trace，需要为要执行的操作创建span，作为trace工作流的一部分。它是最简单的形式：\n1 2 3 4 5 6 7 8 9 10 11 12  var tracer trace.Tracer func init() { tracer = otel.Tracer(\"instrumentation/package/name\") } func operation(ctx context.Context) { var span trace.Span ctx, span = tracer.Start(ctx, \"operation\") defer span.End() // ... }   Tracer是仪器特有的，用于创建span。仪器应设计为接受TracerProvider，从中可以创建自己的唯一Tracer。或者，可以将go.opentelemetry.io/otel软件包中已注册的全局TracerProvider用作默认值。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  const ( name = \"instrumentation/package/name\" version = \"0.1.0\" ) type Instrumentation struct { tracer trace.Tracer } func NewInstrumentation(tp trace.TracerProvider) *Instrumentation { if tp == nil { tp = otel.TracerProvider() } return \u0026Instrumentation{ tracer: tp.Tracer(name, trace.WithInstrumentationVersion(version)), } } func operation(ctx context.Context, inst *Instrumentation) { var span trace.Span ctx, span = inst.tracer.Start(ctx, \"operation\") defer span.End() // ... }   常量 1 2 3 4 5 6 7 8 9 10 11  const ( // FlagsSampled is a bitmask with the sampled bit set. A SpanContext \t// with the sampling bit set means the span is sampled. \tFlagsSampled = byte(0x01) // FlagsDeferred is a bitmask with the deferred bit set. A SpanContext \t// with the deferred bit set means the sampling decision has been \t// defered to the receiver. \tFlagsDeferred = byte(0x02) // FlagsDebug is a bitmask with the debug bit set. \tFlagsDebug = byte(0x04) )   func ContextWithRemoteSpanContext 1  func ContextWithRemoteSpanContext(parent context.Context, remote SpanContext) context.Context   ContextWithRemoteSpanContext返回具有远程集的父级副本作为远程span上下文。\nfunc ContextWithSpan 1  func ContextWithSpan(parent context.Context, span Span) context.Context   ContextWithSpan返回span设置为current的parent的副本。\ntype Event 1 2 3 4 5 6 7 8 9 10  type Event struct { // Name is the name of this event \tName string // Attributes describe the aspects of the event. \tAttributes []attribute.KeyValue // Time at which this event was recorded. \tTime time.Time }   Event是Span一生中发生的一件事情。\ntype EventOption 1 2 3 4  type EventOption interface { ApplyEvent(*SpanConfig) // contains filtered or unexported methods }   EventOption将spanEvent选项应用于SpanConfig。\ntype InstrumentationOption 1 2 3  type InstrumentationOption interface { TracerOption }   InstrumentationOption是用于应用特定于工具的选项的接口。\nfunc WithInstrumentationVersion 1  func WithInstrumentationVersion(version string) InstrumentationOption   WithInstrumentationVersion设置检测版本。\ntype LifeCycleOption 1 2 3 4  type LifeCycleOption interface { SpanOption EventOption }   LifeCycleOption将span生命周期选项应用于SpanConfig。这些选项设置与整个生命周期中的Event相关的值，例如开始，结束，遇到错误以及其他用户定义的值得注意的Event。\nfunc WithAttributes 1  func WithAttributes(attributes ...attribute.KeyValue) LifeCycleOption   WithAttributes添加与span生命周期Event相关的属性。这些属性用于描述当向Span的开始或结束Event提供此选项时Span代表的工作。否则，这些属性将提供有关正在记录的Event的其他信息（例如，错误，状态更改，处理进度，系统Event）。\n如果传递了这些选项中的多个，则每个后续选项的属性将扩展属性，而不是覆盖属性。不能保证结果属性的唯一性。\nfunc WithTimestamp 1  func WithTimestamp(t time.Time) LifeCycleOption   WithTimestamp设置span生命周期时刻（例如开始，停止，错误）的时间。\ntype Link 1 2 3 4  type Link struct { SpanContext Attributes []attribute.KeyValue }   Link是两个Span之间的关系。关系可以在同一Trace内，也可以在不同Trace之间。\n例如，在以下情况下使用Link：\n 批处理：一批操作可能包含一些操作，与一个或多个Trace/span相关联。由于只能有一个父SpanContext，则使用Link来保持对批处理中所有操作的SpanContext。 Public Endpoint：针对一个传入客户端请求的SpanContext。公共端点应被视为不受信任。在这种情况下，以自己的身份进行trace，并需要创建抽样决策，但是在某些情况下，此新trace需要与原始trace相关形式。Link用于保留对原始SpanContext的引用，并且trace关系。  type Span 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38  type Span interface { // Tracer returns the Tracer that created the Span. Tracer MUST NOT be \t// nil. \tTracer() Tracer // End completes the Span. The Span is considered complete and ready to be \t// delivered through the rest of the telemetry pipeline after this method \t// is called. Therefore, updates to the Span are not allowed after this \t// method has been called. \tEnd(options ...SpanOption) // AddEvent adds an event with the provided name and options. \tAddEvent(name string, options ...EventOption) // IsRecording returns the recording state of the Span. It will return \t// true if the Span is active and events can be recorded. \tIsRecording() bool // RecordError records an error as a Span event. \tRecordError(err error, options ...EventOption) // SpanContext returns the SpanContext of the Span. The returned \t// SpanContext is usable even after the End has been called for the Span. \tSpanContext() SpanContext // SetStatus sets the status of the Span in the form of a code and a \t// message. SetStatus overrides the value of previous calls to SetStatus \t// on the Span. \tSetStatus(code codes.Code, msg string) // SetName sets the Span name. \tSetName(name string) // SetAttributes sets kv as attributes of the Span. If a key from kv \t// already exists for an attribute of the Span it will be overwritten with \t// the value contained in kv. \tSetAttributes(kv ...attribute.KeyValue) }   span是trace的单个组成部分。它表示trace的工作流的单个命名和定时操作。trace用于创建span，然后由该span表示的操作可以在操作本身结束时正确结束span。\nfunc SpanFromContext 1  func SpanFromContext(ctx context.Context) Span   SpanFromContext返回来自ctx的当前范围，如果未设置，则返回noop范围。\ntype SpanConfig 1 2 3 4 5 6 7 8 9 10 11 12 13 14  type SpanConfig struct { // Attributes describe the associated qualities of a Span. \tAttributes []attribute.KeyValue // Timestamp is a time in a Span life-cycle. \tTimestamp time.Time // Links are the associations a Span has with other Spans. \tLinks []Link // NewRoot identifies a Span as the root Span for a new trace. This is \t// commonly used when an existing trace crosses trust boundaries and the \t// remote parent span context should be ignored for security. \tNewRoot bool // SpanKind is the role a Span has in a trace. \tSpanKind SpanKind }   SpanConfig是Span的一组选项。\nfunc NewEventConfig 1  func NewEventConfig(options ...EventOption) *SpanConfig   NewEventConfig将所有EventOptions应用于返回的SpanConfig。如果未传递任何时间戳选项，则返回的SpanConfig会将Timestamp设置为呼叫时间，否则将不对返回的SpanConfig进行验证。\nfunc NewSpanConfig 1  func NewSpanConfig(options ...SpanOption) *SpanConfig   NewSpanConfig将所有选项应用于返回的SpanConfig。对返回的SpanConfig不会执行任何验证（例如，不进行唯一性检查或数据绑定），它将留给SDK来执行此操作。\ntype SpanContext 1 2 3  type SpanContext struct { // contains filtered or unexported fields }   SpanContext包含有关Span的标识trace信息。\nfunc NewSpanContext 1  func NewSpanContext(config SpanContextConfig) SpanContext   NewSpanContext使用提供的SpanContextConfig中的值构造一个SpanContext。\nfunc RemoteSpanContextFromContext 1  func RemoteSpanContextFromContext(ctx context.Context) SpanContext   RemoteSpanContextFromContext从ctx返回远程span上下文。\nfunc SpanContextFromContext 1  func SpanContextFromContext(ctx context.Context) SpanContext   SpanContextFromContext从ctx返回当前的SpanContext，如果未设置，则返回一个空的SpanContext。\nfunc (SpanContext) Equal 1  func (sc SpanContext) Equal(other SpanContext) bool   Equal是确定两个SpanContext值是否相等的谓词。\nfunc (SpanContext) HasSpanID 1  func (sc SpanContext) HasSpanID() bool   HasSpanID检查SpanContext是否具有有效的SpanID。\nfunc (SpanContext) HasTraceID 1  func (sc SpanContext) HasTraceID() bool   HasTraceID检查SpanContext是否具有有效的TraceID。\nfunc (SpanContext) IsDebug 1  func (sc SpanContext) IsDebug() bool   如果在trace标志中设置了调试位，则IsDebug返回。\nfunc (SpanContext) IsDeferred 1  func (sc SpanContext) IsDeferred() bool   如果在trace标志中设置了延迟位，则IsDeferred返回。\nfunc (SpanContext) IsRemote 1  func (sc SpanContext) IsRemote() bool   IsRemote指示SpanContext是否表示远程创建的Span。\nfunc (SpanContext) IsSampled 1  func (sc SpanContext) IsSampled() bool   如果在trace标志中设置了采样位，则IsSampled返回。\nfunc (SpanContext) IsValid 1  func (sc SpanContext) IsValid() bool   如果SpanContext有效，则IsValid返回。有效的span上下文具有有效的TraceID和SpanID。\nfunc (SpanContext) MarshalJSON 1  func (sc SpanContext) MarshalJSON() ([]byte, error)   MarshalJSON实现了一个自定义的marshal函数来对SpanContext进行编码。\nfunc (SpanContext) SpanID 1  func (sc SpanContext) SpanID() SpanID   SpanID从SpanContext返回SpanID。\nfunc (SpanContext) TraceFlags 1  func (sc SpanContext) TraceFlags() byte   TraceFlags从SpanContext返回标志。\nfunc (SpanContext) TraceID 1  func (sc SpanContext) TraceID() TraceID   TraceID从SpanContext返回TraceID。\nfunc (SpanContext) TraceState 1  func (sc SpanContext) TraceState() TraceState   TraceState从SpanContext返回TraceState。\nfunc (SpanContext) WithRemote 1  func (sc SpanContext) WithRemote(remote bool) SpanContext   WithRemote返回sc的副本，其中Remote属性设置为remote。\nfunc (SpanContext) WithSpanID 1  func (sc SpanContext) WithSpanID(spanID SpanID) SpanContext   WithSpanID返回替换了SpanID的新SpanContext。\nfunc (SpanContext) WithTraceFlags 1  func (sc SpanContext) WithTraceFlags(flags byte) SpanContext   WithTraceFlags返回替换了TraceFlags的新SpanContext。\nfunc (SpanContext) WithTraceID 1  func (sc SpanContext) WithTraceID(traceID TraceID) SpanContext   WithTraceID返回替换了TraceID的新SpanContext。\nfunc (SpanContext) WithTraceState 1  func (sc SpanContext) WithTraceState(state TraceState) SpanContext   WithTraceState返回替换了TraceState的新SpanContext。\ntype SpanContextConfig 1 2 3 4 5 6 7  type SpanContextConfig struct { TraceID TraceID SpanID SpanID TraceFlags byte TraceState TraceState Remote bool }   SpanContextConfig包含可用于构造不可变SpanContext的可变字段。\ntype SpanID 1  type SpanID [8]byte   SpanID是trace中span的唯一标识。\nfunc SpanIDFromHex 1  func SpanIDFromHex(h string) (SpanID, error)   如果SpanIDFromHex符合w3c trace-context规范，则从十六进制字符串返回SpanID。详情请参阅https://www.w3.org/TR/trace-context/#parent-id\nfunc (SpanID) IsValid 1  func (s SpanID) IsValid() bool   IsValid检查SpanID是否有效。有效的SpanID不仅由零组成。\nfunc (SpanID) MarshalJSON 1  func (s SpanID) MarshalJSON() ([]byte, error)   MarshalJSON实现了一个自定义的marshal函数，以将SpanID编码为十六进制字符串。\nfunc (SpanID) String 1  func (s SpanID) String() string   String返回SpanID的十六进制字符串表示形式\ntype SpanKind 1  type SpanKind int   SpanKind是Span在trace中扮演的角色。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  const ( // SpanKindUnspecified is an unspecified SpanKind and is not a valid \t// SpanKind. SpanKindUnspecified should be replaced with SpanKindInternal \t// if it is received. \tSpanKindUnspecified SpanKind = 0 // SpanKindInternal is a SpanKind for a Span that represents an internal \t// operation within an application. \tSpanKindInternal SpanKind = 1 // SpanKindServer is a SpanKind for a Span that represents the operation \t// of handling a request from a client. \tSpanKindServer SpanKind = 2 // SpanKindClient is a SpanKind for a Span that represents the operation \t// of client making a request to a server. \tSpanKindClient SpanKind = 3 // SpanKindProducer is a SpanKind for a Span that represents the operation \t// of a producer sending a message to a message broker. Unlike \t// SpanKindClient and SpanKindServer, there is often no direct \t// relationship between this kind of Span and a SpanKindConsumer kind. A \t// SpanKindProducer Span will end once the message is accepted by the \t// message broker which might not overlap with the processing of that \t// message. \tSpanKindProducer SpanKind = 4 // SpanKindConsumer is a SpanKind for a Span that represents the operation \t// of a consumer receiving a message from a message broker. Like \t// SpanKindProducer Spans, there is often no direct relationship between \t// this Span and the Span that produced the message. \tSpanKindConsumer SpanKind = 5 )   为方便起见，这些匹配原型定义，请参见 https://github.com/open-telemetry/opentelemetry-proto/blob/30d237e1ff3ab7aa50e0922b5bebdd93505090af/opentelemetry/proto/trace/v1/trace.proto#L101-L129\n未指定的值不是有效的“ SpanKind”。使用“ ValidateSpanKind（）”将span类型强制为有效值。\nfunc ValidateSpanKind 1  func ValidateSpanKind(spanKind SpanKind) SpanKind   ValidateSpanKind返回有效的span种类值。这会将无效值强制为默认值SpanKindInternal。\nfunc (SpanKind) String 1  func (sk SpanKind) String() string   String以小写形式返回SpanKind的指定名称。\ntype SpanOption 1 2 3 4  type SpanOption interface { ApplySpan(*SpanConfig) // contains filtered or unexported methods }   SpanOption将选项应用于SpanConfig。\nfunc WithLinks 1  func WithLinks(links ...Link) SpanOption   WithLinks将Link添加到span。这些Link将添加到现有的SpanLink中，即不会被覆盖。\nfunc WithNewRoot 1  func WithNewRoot() SpanOption   WithNewRoot指定将span视为根span。定义span的trace标识符时，将忽略任何现有的父span上下文。\nfunc WithSpanKind 1  func WithSpanKind(kind SpanKind) SpanOption   WithSpanKind设置span的SpanKind。\ntype TraceID 1  type TraceID [16]byte   TraceID是trace的唯一标识。nolint：golint\nfunc TraceIDFromHex 1  func TraceIDFromHex(h string) (TraceID, error)   如果TraceIDFromHex符合W3C trace-context规范，则从十六进制字符串返回TraceID。详情请参阅 https://www.w3.org/TR/trace-context/#trace-id nolint：golint\nfunc (TraceID) IsValid 1  func (t TraceID) IsValid() bool   IsValid检查traceTraceID是否有效。有效的traceID不仅由零组成。\nfunc (TraceID) MarshalJSON 1  func (t TraceID) MarshalJSON() ([]byte, error)   MarshalJSON实现了一个自定义的marshal函数，将TraceID编码为十六进制字符串。\nfunc (TraceID) String 1  func (t TraceID) String() string   String返回TraceID的十六进制字符串表示形式\ntype TraceState 1 2 3  type TraceState struct { // contains filtered or unexported fields }   TraceState在不同的分布式trace系统中提供了其他特定于供应商的trace标识信息。它表示由键/值对组成的不可变列表。列表中最多可以包含32个条目。\n每个列表成员的键和值必须根据W3Ctrace上下文规范有效（请参阅https://www.w3.org/TR/trace-context-1/#key和https://www.w3.org/ TR / trace-context-1 /＃value ）。\n根据W3Ctrace上下文规范，trace状态必须始终有效。所有变异操作都会验证其输入，并在参数有效的情况下返回新的TraceState。\nfunc TraceStateFromKeyValues 1  func TraceStateFromKeyValues(kvs ...attribute.KeyValue) (TraceState, error)   TraceStateFromKeyValues是从提供的键/值对创建新的TraceState的便捷方法。\nfunc (TraceState) Delete 1  func (ts TraceState) Delete(key attribute.Key) (TraceState, error)   删除将从trace状态中删除指定的条目。\nfunc (TraceState) Get 1  func (ts TraceState) Get(key attribute.Key) attribute.Value   Get从trace状态返回给定键的值。如果找不到密钥或提供的密钥无效，则返回一个空值。\nfunc (TraceState) Insert 1  func (ts TraceState) Insert(entry attribute.KeyValue) (TraceState, error)   如果不存在，Insert会添加一个新的键/值。否则，更新现有条目。根据W3Ctrace上下文规范要求，新的或更新的条目总是插入到TraceState的开头，即左侧。\nfunc (TraceState) IsEmpty 1  func (ts TraceState) IsEmpty() bool   如果TraceState不包含任何条目，则IsEmpty返回true\nfunc (TraceState) MarshalJSON 1  func (ts TraceState) MarshalJSON() ([]byte, error)   MarshalJSON实现了自定义的marshal函数以对trace状态进行编码。\nfunc (TraceState) String 1  func (ts TraceState) String() string   String根据W3Ctrace上下文规范将trace状态作为有效的字符串返回。\ntype Tracer 1 2 3 4  type Tracer interface { // Start creates a span. \tStart(ctx context.Context, spanName string, opts ...SpanOption) (context.Context, Span) }   Tracer是Spans的创建者。\ntype TracerConfig 1 2 3 4 5  type TracerConfig struct { // InstrumentationVersion is the version of the library providing \t// instrumentation. \tInstrumentationVersion string }   TracerConfig是Tracer的一组选项。\nfunc NewTracerConfig 1  func NewTracerConfig(options ...TracerOption) *TracerConfig   NewTracerConfig将所有选项应用于返回的TracerConfig。\ntype TracerOption 1 2 3 4  type TracerOption interface { ApplyTracer(*TracerConfig) // contains filtered or unexported methods }   TracerOption将选项应用于TracerConfig。\ntype TracerProvider 1 2 3 4 5 6 7 8 9 10 11  type TracerProvider interface { // Tracer creates an implementation of the Tracer interface. \t// The instrumentationName must be the name of the library providing \t// instrumentation. This name may be the same as the instrumented code \t// only if that code provides built-in instrumentation. If the \t// instrumentationName is empty, then a implementation defined default \t// name will be used instead. \t// \t// This method must be concurrency safe. \tTracer(instrumentationName string, opts ...TracerOption) Tracer }   TracerProvider提供对仪器trace的访问。\nfunc NewNoopTracerProvider 1  func NewNoopTracerProvider() TracerProvider   NewNoopTracerProvider返回不执行任何操作的TracerProvider实现。从返回的TracerProvider创建的Tracer和Span也不会执行任何操作。\nexporter/trace/jaeger func WithAgentEndpoint 1  func WithAgentEndpoint(agentEndpoint string) func() (batchUploader, error)   WithAgentEndpoint指示导出器将跨度发送到该地址的jaeger-agent。例如，localhost：6831。\nfunc WithBufferMaxCount 1  func WithBufferMaxCount(bufferMaxCount int) func(o *options)   WithBufferMaxCount定义可以在内存中缓冲的跟踪总数\nfunc WithCollectorEndpoint 1  func WithCollectorEndpoint(collectorEndpoint string, options ...CollectorEndpointOption) func() (batchUploader, error)   WithCollectorEndpoint定义Jaeger HTTP Thrift收集器的完整URL。例如，http：// localhost：14268 / api / traces\nfunc WithOnError 1  func WithOnError(onError func(err error)) func(o *options)   WithOnError设置在上载跨度数据时发生错误时要调用的挂钩。如果未设置自定义钩子，则会记录错误。\nfunc WithPassword 1  func WithPassword(password string) func(o *CollectorEndpointOptions)   WithPassword设置需要基本身份验证时使用的密码。\nfunc WithProcess 1  func WithProcess(process Process) func(o *options)   WithProcess使用有关导出过程的信息来设置过程。\nfunc WithUsername 1  func WithUsername(username string) func(o *CollectorEndpointOptions)   WithUsername设置需要基本身份验证时要使用的用户名。\ntype CollectorEndpointOption 1  type CollectorEndpointOption func(o *CollectorEndpointOptions)   type CollectorEndpointOptions 1 2 3  type CollectorEndpointOptions struct { // contains filtered or unexported fields }   type EndpointOption 1  type EndpointOption func() (batchUploader, error)   type Exporter 1 2 3  type Exporter struct { // contains filtered or unexported fields }   导出器是trace.Exporter的实现，可将跨度上传到Jaeger。\nfunc NewExporter 1  func NewExporter(endpointOption EndpointOption, opts ...Option) (*Exporter, error)   NewExporter返回trace.Exporter实现，该实现将收集的跨度导出到Jaeger。\nfunc (*Exporter) ExportSpan 1  func (e *Exporter) ExportSpan(ctx context.Context, d *export.SpanData)   ExportSpan将SpanData导出到Jaeger。\nfunc (*Exporter) Flush 1  func (e *Exporter) Flush()   刷新等待导出的跟踪范围上载。\n如果您的程序即将结束并且您不想丢失最近的跨度，则此功能很有用。\ntype Option 1  type Option func(*options)   type Process 1 2 3 4 5 6 7  type Process struct { // ServiceName is the Jaeger service name. \tServiceName string // Tags are added to Jaeger Process exports \tTags []core.KeyValue }   流程包含导出到jaeger的有关跟踪数据源的信息。\n",
  "wordCount" : "6917",
  "inLanguage": "zh-cn",
  "datePublished": "2021-04-01T18:01:15Z",
  "dateModified": "2021-04-01T18:01:15Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/opentelemetry%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Forz Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="Forz Blog (Alt + H)">Forz Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="/post/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      opentelemetry使用介绍
    </h1>
    <div class="post-meta">April 1, 2021
</div>
  </header> 
  <div class="post-content"><h1 id="otel">otel<a hidden class="anchor" aria-hidden="true" href="#otel">#</a></h1>
<h2 id="func-gettextmappropagator">func GetTextMapPropagator<a hidden class="anchor" aria-hidden="true" href="#func-gettextmappropagator">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">GetTextMapPropagator</span><span class="p">()</span> <span class="nx">propagation</span><span class="p">.</span><span class="nx">TextMapPropagator</span>
</code></pre></td></tr></table>
</div>
</div><p>GetTextMapPropagator返回全局TextMapPropagator。如果未设置任何内容，则返回No-Op TextMapPropagator。</p>
<h2 id="func-gettracerprovider">func GetTracerProvider<a hidden class="anchor" aria-hidden="true" href="#func-gettracerprovider">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">GetTracerProvider</span><span class="p">()</span> <span class="nx">trace</span><span class="p">.</span><span class="nx">TracerProvider</span>
</code></pre></td></tr></table>
</div>
</div><p>GetTracerProvider返回已注册的全局跟踪提供程序。如果未注册任何内容，则返回NoopTracerProvider的实例。</p>
<p>使用跟踪提供程序创建一个命名的tracer。例如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">tracer</span> <span class="o">:=</span> <span class="nx">global</span><span class="p">.</span><span class="nf">GetTracerProvider</span><span class="p">().</span><span class="nf">Tracer</span><span class="p">(</span><span class="s">&#34;example.com/foo&#34;</span><span class="p">)</span>

</code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">tracer</span> <span class="o">:=</span> <span class="nx">global</span><span class="p">.</span><span class="nf">Tracer</span><span class="p">(</span><span class="s">&#34;example.com/foo&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="func-handle">func Handle<a hidden class="anchor" aria-hidden="true" href="#func-handle">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">Handle</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Handle是ErrorHandler（）的便捷函数。</p>
<h3 id="func-seterrorhandler">func SetErrorHandler<a hidden class="anchor" aria-hidden="true" href="#func-seterrorhandler">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">SetErrorHandler</span><span class="p">(</span><span class="nx">h</span> <span class="nx">ErrorHandler</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>SetErrorHandler将全局ErrorHandler设置为h。</p>
<h3 id="func-settextmappropagator">func SetTextMapPropagator<a hidden class="anchor" aria-hidden="true" href="#func-settextmappropagator">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">SetTextMapPropagator</span><span class="p">(</span><span class="nx">propagator</span> <span class="nx">propagation</span><span class="p">.</span><span class="nx">TextMapPropagator</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>SetTextMapPropagator将propagator设置为全局TextMapPropagator。</p>
<h3 id="func-settracerprovider">func SetTracerProvider<a hidden class="anchor" aria-hidden="true" href="#func-settracerprovider">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">SetTracerProvider</span><span class="p">(</span><span class="nx">tp</span> <span class="nx">trace</span><span class="p">.</span><span class="nx">TracerProvider</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>SetTracerProvider registers <code>tp</code> as the global trace provider.</p>
<p>SetTracerProvider将tp注册为全局trace provider。</p>
<h2 id="func-tracer">func Tracer<a hidden class="anchor" aria-hidden="true" href="#func-tracer">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">Tracer</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">trace</span><span class="p">.</span><span class="nx">Tracer</span>
</code></pre></td></tr></table>
</div>
</div><p>tracer创建一个实现tracer接口的命名tracer。如果名称为空字符串，则提供程序将使用默认名称。</p>
<p>这是 GetTracerProvider().Tracer(name) 的缩写</p>
<h2 id="func-version">func Version<a hidden class="anchor" aria-hidden="true" href="#func-version">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">Version</span><span class="p">()</span> <span class="kt">string</span>
</code></pre></td></tr></table>
</div>
</div><p>版本是正在使用的OpenTelemetry的当前发行版本。</p>
<h2 id="type-errorhandler">type ErrorHandler<a hidden class="anchor" aria-hidden="true" href="#type-errorhandler">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">ErrorHandler</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="c1">// Handle handles any error deemed irremediable by an OpenTelemetry
</span><span class="c1"></span>	<span class="c1">// component.
</span><span class="c1"></span>	<span class="nf">Handle</span><span class="p">(</span><span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ErrorHandler处理不可补救的事件。</p>
<h2 id="func-geterrorhandler">func GetErrorHandler<a hidden class="anchor" aria-hidden="true" href="#func-geterrorhandler">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">GetErrorHandler</span><span class="p">()</span> <span class="nx">ErrorHandler</span>
</code></pre></td></tr></table>
</div>
</div><p>GetErrorHandler返回全局ErrorHandler实例。如果没有设置ErrorHandler实例（SetErrorHandler），则返回将错误记录到STDERR的默认ErrorHandler。</p>
<h1 id="trace">trace<a hidden class="anchor" aria-hidden="true" href="#trace">#</a></h1>
<h2 id="概述">概述<a hidden class="anchor" aria-hidden="true" href="#概述">#</a></h2>
<p>trace 提供了OpenTelemetry APItrace部分的实现。</p>
<p>该程序包目前处于GA预发布阶段。在我们trace不断发展的OpenTelemetry规范和用户反馈的过程中，向后不兼容的更改可能会在后续的次要版本中引入。</p>
<p>为了参与分布式trace，需要为要执行的操作创建span，作为trace工作流的一部分。它是最简单的形式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">tracer</span> <span class="nx">trace</span><span class="p">.</span><span class="nx">Tracer</span>

<span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">tracer</span> <span class="p">=</span> <span class="nx">otel</span><span class="p">.</span><span class="nf">Tracer</span><span class="p">(</span><span class="s">&#34;instrumentation/package/name&#34;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">operation</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">span</span> <span class="nx">trace</span><span class="p">.</span><span class="nx">Span</span>
	<span class="nx">ctx</span><span class="p">,</span> <span class="nx">span</span> <span class="p">=</span> <span class="nx">tracer</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;operation&#34;</span><span class="p">)</span>
	<span class="k">defer</span> <span class="nx">span</span><span class="p">.</span><span class="nf">End</span><span class="p">()</span>
	<span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Tracer是仪器特有的，用于创建span。仪器应设计为接受TracerProvider，从中可以创建自己的唯一Tracer。或者，可以将go.opentelemetry.io/otel软件包中已注册的全局TracerProvider用作默认值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">const</span> <span class="p">(</span>
	<span class="nx">name</span>    <span class="p">=</span> <span class="s">&#34;instrumentation/package/name&#34;</span>
	<span class="nx">version</span> <span class="p">=</span> <span class="s">&#34;0.1.0&#34;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Instrumentation</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">tracer</span> <span class="nx">trace</span><span class="p">.</span><span class="nx">Tracer</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewInstrumentation</span><span class="p">(</span><span class="nx">tp</span> <span class="nx">trace</span><span class="p">.</span><span class="nx">TracerProvider</span><span class="p">)</span> <span class="o">*</span><span class="nx">Instrumentation</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">tp</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">tp</span> <span class="p">=</span> <span class="nx">otel</span><span class="p">.</span><span class="nf">TracerProvider</span><span class="p">()</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">Instrumentation</span><span class="p">{</span>
		<span class="nx">tracer</span><span class="p">:</span> <span class="nx">tp</span><span class="p">.</span><span class="nf">Tracer</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">trace</span><span class="p">.</span><span class="nf">WithInstrumentationVersion</span><span class="p">(</span><span class="nx">version</span><span class="p">)),</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">operation</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">inst</span> <span class="o">*</span><span class="nx">Instrumentation</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">span</span> <span class="nx">trace</span><span class="p">.</span><span class="nx">Span</span>
	<span class="nx">ctx</span><span class="p">,</span> <span class="nx">span</span> <span class="p">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">tracer</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;operation&#34;</span><span class="p">)</span>
	<span class="k">defer</span> <span class="nx">span</span><span class="p">.</span><span class="nf">End</span><span class="p">()</span>
	<span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="常量">常量<a hidden class="anchor" aria-hidden="true" href="#常量">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">const</span> <span class="p">(</span>
	<span class="c1">// FlagsSampled is a bitmask with the sampled bit set. A SpanContext
</span><span class="c1"></span>	<span class="c1">// with the sampling bit set means the span is sampled.
</span><span class="c1"></span>	<span class="nx">FlagsSampled</span> <span class="p">=</span> <span class="nb">byte</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span>
	<span class="c1">// FlagsDeferred is a bitmask with the deferred bit set. A SpanContext
</span><span class="c1"></span>	<span class="c1">// with the deferred bit set means the sampling decision has been
</span><span class="c1"></span>	<span class="c1">// defered to the receiver.
</span><span class="c1"></span>	<span class="nx">FlagsDeferred</span> <span class="p">=</span> <span class="nb">byte</span><span class="p">(</span><span class="mh">0x02</span><span class="p">)</span>
	<span class="c1">// FlagsDebug is a bitmask with the debug bit set.
</span><span class="c1"></span>	<span class="nx">FlagsDebug</span> <span class="p">=</span> <span class="nb">byte</span><span class="p">(</span><span class="mh">0x04</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="func-contextwithremotespancontext">func ContextWithRemoteSpanContext<a hidden class="anchor" aria-hidden="true" href="#func-contextwithremotespancontext">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">ContextWithRemoteSpanContext</span><span class="p">(</span><span class="nx">parent</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">remote</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span>
</code></pre></td></tr></table>
</div>
</div><p>ContextWithRemoteSpanContext返回具有远程集的父级副本作为远程span上下文。</p>
<h2 id="func-contextwithspan">func ContextWithSpan<a hidden class="anchor" aria-hidden="true" href="#func-contextwithspan">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">ContextWithSpan</span><span class="p">(</span><span class="nx">parent</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">span</span> <span class="nx">Span</span><span class="p">)</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span>
</code></pre></td></tr></table>
</div>
</div><p>ContextWithSpan返回span设置为current的parent的副本。</p>
<h2 id="type-event">type Event<a hidden class="anchor" aria-hidden="true" href="#type-event">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Event</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// Name is the name of this event
</span><span class="c1"></span>	<span class="nx">Name</span> <span class="kt">string</span>

	<span class="c1">// Attributes describe the aspects of the event.
</span><span class="c1"></span>	<span class="nx">Attributes</span> <span class="p">[]</span><span class="nx">attribute</span><span class="p">.</span><span class="nx">KeyValue</span>

	<span class="c1">// Time at which this event was recorded.
</span><span class="c1"></span>	<span class="nx">Time</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Event是Span一生中发生的一件事情。</p>
<h2 id="type-eventoption">type EventOption<a hidden class="anchor" aria-hidden="true" href="#type-eventoption">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">EventOption</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="nf">ApplyEvent</span><span class="p">(</span><span class="o">*</span><span class="nx">SpanConfig</span><span class="p">)</span>
	<span class="c1">// contains filtered or unexported methods
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>EventOption将spanEvent选项应用于SpanConfig。</p>
<h2 id="type-instrumentationoption">type InstrumentationOption<a hidden class="anchor" aria-hidden="true" href="#type-instrumentationoption">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">InstrumentationOption</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="nx">TracerOption</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>InstrumentationOption是用于应用特定于工具的选项的接口。</p>
<h2 id="func-withinstrumentationversion">func WithInstrumentationVersion<a hidden class="anchor" aria-hidden="true" href="#func-withinstrumentationversion">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithInstrumentationVersion</span><span class="p">(</span><span class="nx">version</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">InstrumentationOption</span>
</code></pre></td></tr></table>
</div>
</div><p>WithInstrumentationVersion设置检测版本。</p>
<h2 id="type-lifecycleoption">type LifeCycleOption<a hidden class="anchor" aria-hidden="true" href="#type-lifecycleoption">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">LifeCycleOption</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="nx">SpanOption</span>
	<span class="nx">EventOption</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>LifeCycleOption将span生命周期选项应用于SpanConfig。这些选项设置与整个生命周期中的Event相关的值，例如开始，结束，遇到错误以及其他用户定义的值得注意的Event。</p>
<h2 id="func-withattributes">func WithAttributes<a hidden class="anchor" aria-hidden="true" href="#func-withattributes">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithAttributes</span><span class="p">(</span><span class="nx">attributes</span> <span class="o">...</span><span class="nx">attribute</span><span class="p">.</span><span class="nx">KeyValue</span><span class="p">)</span> <span class="nx">LifeCycleOption</span>
</code></pre></td></tr></table>
</div>
</div><p>WithAttributes添加与span生命周期Event相关的属性。这些属性用于描述当向Span的开始或结束Event提供此选项时Span代表的工作。否则，这些属性将提供有关正在记录的Event的其他信息（例如，错误，状态更改，处理进度，系统Event）。</p>
<p>如果传递了这些选项中的多个，则每个后续选项的属性将扩展属性，而不是覆盖属性。不能保证结果属性的唯一性。</p>
<h2 id="func-withtimestamp">func WithTimestamp<a hidden class="anchor" aria-hidden="true" href="#func-withtimestamp">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithTimestamp</span><span class="p">(</span><span class="nx">t</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">)</span> <span class="nx">LifeCycleOption</span>
</code></pre></td></tr></table>
</div>
</div><p>WithTimestamp设置span生命周期时刻（例如开始，停止，错误）的时间。</p>
<h2 id="type-link">type Link<a hidden class="anchor" aria-hidden="true" href="#type-link">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Link</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">SpanContext</span>
	<span class="nx">Attributes</span> <span class="p">[]</span><span class="nx">attribute</span><span class="p">.</span><span class="nx">KeyValue</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Link是两个Span之间的关系。关系可以在同一Trace内，也可以在不同Trace之间。</p>
<p>例如，在以下情况下使用Link：</p>
<ol>
<li>批处理：一批操作可能包含一些操作，与一个或多个Trace/span相关联。由于只能有一个父SpanContext，则使用Link来保持对批处理中所有操作的SpanContext。</li>
<li>Public Endpoint：针对一个传入客户端请求的SpanContext。公共端点应被视为不受信任。在这种情况下，以自己的身份进行trace，并需要创建抽样决策，但是在某些情况下，此新trace需要与原始trace相关形式。Link用于保留对原始SpanContext的引用，并且trace关系。</li>
</ol>
<h2 id="type-span">type Span<a hidden class="anchor" aria-hidden="true" href="#type-span">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Span</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="c1">// Tracer returns the Tracer that created the Span. Tracer MUST NOT be
</span><span class="c1"></span>	<span class="c1">// nil.
</span><span class="c1"></span>	<span class="nf">Tracer</span><span class="p">()</span> <span class="nx">Tracer</span>

	<span class="c1">// End completes the Span. The Span is considered complete and ready to be
</span><span class="c1"></span>	<span class="c1">// delivered through the rest of the telemetry pipeline after this method
</span><span class="c1"></span>	<span class="c1">// is called. Therefore, updates to the Span are not allowed after this
</span><span class="c1"></span>	<span class="c1">// method has been called.
</span><span class="c1"></span>	<span class="nf">End</span><span class="p">(</span><span class="nx">options</span> <span class="o">...</span><span class="nx">SpanOption</span><span class="p">)</span>

	<span class="c1">// AddEvent adds an event with the provided name and options.
</span><span class="c1"></span>	<span class="nf">AddEvent</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">options</span> <span class="o">...</span><span class="nx">EventOption</span><span class="p">)</span>

	<span class="c1">// IsRecording returns the recording state of the Span. It will return
</span><span class="c1"></span>	<span class="c1">// true if the Span is active and events can be recorded.
</span><span class="c1"></span>	<span class="nf">IsRecording</span><span class="p">()</span> <span class="kt">bool</span>

	<span class="c1">// RecordError records an error as a Span event.
</span><span class="c1"></span>	<span class="nf">RecordError</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">,</span> <span class="nx">options</span> <span class="o">...</span><span class="nx">EventOption</span><span class="p">)</span>

	<span class="c1">// SpanContext returns the SpanContext of the Span. The returned
</span><span class="c1"></span>	<span class="c1">// SpanContext is usable even after the End has been called for the Span.
</span><span class="c1"></span>	<span class="nf">SpanContext</span><span class="p">()</span> <span class="nx">SpanContext</span>

	<span class="c1">// SetStatus sets the status of the Span in the form of a code and a
</span><span class="c1"></span>	<span class="c1">// message. SetStatus overrides the value of previous calls to SetStatus
</span><span class="c1"></span>	<span class="c1">// on the Span.
</span><span class="c1"></span>	<span class="nf">SetStatus</span><span class="p">(</span><span class="nx">code</span> <span class="nx">codes</span><span class="p">.</span><span class="nx">Code</span><span class="p">,</span> <span class="nx">msg</span> <span class="kt">string</span><span class="p">)</span>

	<span class="c1">// SetName sets the Span name.
</span><span class="c1"></span>	<span class="nf">SetName</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span>

	<span class="c1">// SetAttributes sets kv as attributes of the Span. If a key from kv
</span><span class="c1"></span>	<span class="c1">// already exists for an attribute of the Span it will be overwritten with
</span><span class="c1"></span>	<span class="c1">// the value contained in kv.
</span><span class="c1"></span>	<span class="nf">SetAttributes</span><span class="p">(</span><span class="nx">kv</span> <span class="o">...</span><span class="nx">attribute</span><span class="p">.</span><span class="nx">KeyValue</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>span是trace的单个组成部分。它表示trace的工作流的单个命名和定时操作。trace用于创建span，然后由该span表示的操作可以在操作本身结束时正确结束span。</p>
<h2 id="func-spanfromcontext">func SpanFromContext<a hidden class="anchor" aria-hidden="true" href="#func-spanfromcontext">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">SpanFromContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="nx">Span</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanFromContext返回来自ctx的当前范围，如果未设置，则返回noop范围。</p>
<h3 id="type-spanconfig">type SpanConfig<a hidden class="anchor" aria-hidden="true" href="#type-spanconfig">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">SpanConfig</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// Attributes describe the associated qualities of a Span.
</span><span class="c1"></span>	<span class="nx">Attributes</span> <span class="p">[]</span><span class="nx">attribute</span><span class="p">.</span><span class="nx">KeyValue</span>
	<span class="c1">// Timestamp is a time in a Span life-cycle.
</span><span class="c1"></span>	<span class="nx">Timestamp</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
	<span class="c1">// Links are the associations a Span has with other Spans.
</span><span class="c1"></span>	<span class="nx">Links</span> <span class="p">[]</span><span class="nx">Link</span>
	<span class="c1">// NewRoot identifies a Span as the root Span for a new trace. This is
</span><span class="c1"></span>	<span class="c1">// commonly used when an existing trace crosses trust boundaries and the
</span><span class="c1"></span>	<span class="c1">// remote parent span context should be ignored for security.
</span><span class="c1"></span>	<span class="nx">NewRoot</span> <span class="kt">bool</span>
	<span class="c1">// SpanKind is the role a Span has in a trace.
</span><span class="c1"></span>	<span class="nx">SpanKind</span> <span class="nx">SpanKind</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanConfig是Span的一组选项。</p>
<h2 id="func-neweventconfig">func NewEventConfig<a hidden class="anchor" aria-hidden="true" href="#func-neweventconfig">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">NewEventConfig</span><span class="p">(</span><span class="nx">options</span> <span class="o">...</span><span class="nx">EventOption</span><span class="p">)</span> <span class="o">*</span><span class="nx">SpanConfig</span>
</code></pre></td></tr></table>
</div>
</div><p>NewEventConfig将所有EventOptions应用于返回的SpanConfig。如果未传递任何时间戳选项，则返回的SpanConfig会将Timestamp设置为呼叫时间，否则将不对返回的SpanConfig进行验证。</p>
<h2 id="func-newspanconfig">func NewSpanConfig<a hidden class="anchor" aria-hidden="true" href="#func-newspanconfig">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">NewSpanConfig</span><span class="p">(</span><span class="nx">options</span> <span class="o">...</span><span class="nx">SpanOption</span><span class="p">)</span> <span class="o">*</span><span class="nx">SpanConfig</span>
</code></pre></td></tr></table>
</div>
</div><p>NewSpanConfig将所有选项应用于返回的SpanConfig。对返回的SpanConfig不会执行任何验证（例如，不进行唯一性检查或数据绑定），它将留给SDK来执行此操作。</p>
<h2 id="type-spancontext">type SpanContext<a hidden class="anchor" aria-hidden="true" href="#type-spancontext">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">SpanContext</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// contains filtered or unexported fields
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanContext包含有关Span的标识trace信息。</p>
<h3 id="func-newspancontext">func NewSpanContext<a hidden class="anchor" aria-hidden="true" href="#func-newspancontext">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">NewSpanContext</span><span class="p">(</span><span class="nx">config</span> <span class="nx">SpanContextConfig</span><span class="p">)</span> <span class="nx">SpanContext</span>
</code></pre></td></tr></table>
</div>
</div><p>NewSpanContext使用提供的SpanContextConfig中的值构造一个SpanContext。</p>
<h3 id="func-remotespancontextfromcontext">func RemoteSpanContextFromContext<a hidden class="anchor" aria-hidden="true" href="#func-remotespancontextfromcontext">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">RemoteSpanContextFromContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="nx">SpanContext</span>
</code></pre></td></tr></table>
</div>
</div><p>RemoteSpanContextFromContext从ctx返回远程span上下文。</p>
<h3 id="func-spancontextfromcontext">func SpanContextFromContext<a hidden class="anchor" aria-hidden="true" href="#func-spancontextfromcontext">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">SpanContextFromContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="nx">SpanContext</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanContextFromContext从ctx返回当前的SpanContext，如果未设置，则返回一个空的SpanContext。</p>
<h3 id="func-spancontext-equal">func (SpanContext) Equal<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-equal">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">Equal</span><span class="p">(</span><span class="nx">other</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>Equal是确定两个SpanContext值是否相等的谓词。</p>
<h3 id="func-spancontext-hasspanid">func (SpanContext) HasSpanID<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-hasspanid">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">HasSpanID</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>HasSpanID检查SpanContext是否具有有效的SpanID。</p>
<h3 id="func-spancontext-hastraceid">func (SpanContext) HasTraceID<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-hastraceid">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">HasTraceID</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>HasTraceID检查SpanContext是否具有有效的TraceID。</p>
<h3 id="func-spancontext-isdebug">func (SpanContext) IsDebug<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-isdebug">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">IsDebug</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>如果在trace标志中设置了调试位，则IsDebug返回。</p>
<h3 id="func-spancontext-isdeferred">func (SpanContext) IsDeferred<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-isdeferred">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">IsDeferred</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>如果在trace标志中设置了延迟位，则IsDeferred返回。</p>
<h3 id="func-spancontext-isremote">func (SpanContext) IsRemote<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-isremote">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">IsRemote</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>IsRemote指示SpanContext是否表示远程创建的Span。</p>
<h3 id="func-spancontext-issampled">func (SpanContext) IsSampled<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-issampled">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">IsSampled</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>如果在trace标志中设置了采样位，则IsSampled返回。</p>
<h3 id="func-spancontext-isvalid">func (SpanContext) IsValid<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-isvalid">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">IsValid</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>如果SpanContext有效，则IsValid返回。有效的span上下文具有有效的TraceID和SpanID。</p>
<h3 id="func-spancontext-marshaljson">func (SpanContext) MarshalJSON<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-marshaljson">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">MarshalJSON</span><span class="p">()</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>MarshalJSON实现了一个自定义的marshal函数来对SpanContext进行编码。</p>
<h3 id="func-spancontext-spanid">func (SpanContext) SpanID<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-spanid">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">SpanID</span><span class="p">()</span> <span class="nx">SpanID</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanID从SpanContext返回SpanID。</p>
<h3 id="func-spancontext-traceflags">func (SpanContext) TraceFlags<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-traceflags">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">TraceFlags</span><span class="p">()</span> <span class="kt">byte</span>
</code></pre></td></tr></table>
</div>
</div><p>TraceFlags从SpanContext返回标志。</p>
<h3 id="func-spancontext-traceid">func (SpanContext) TraceID<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-traceid">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">TraceID</span><span class="p">()</span> <span class="nx">TraceID</span>
</code></pre></td></tr></table>
</div>
</div><p>TraceID从SpanContext返回TraceID。</p>
<h3 id="func-spancontext-tracestate">func (SpanContext) TraceState<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-tracestate">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">TraceState</span><span class="p">()</span> <span class="nx">TraceState</span>
</code></pre></td></tr></table>
</div>
</div><p>TraceState从SpanContext返回TraceState。</p>
<h3 id="func-spancontext-withremote">func (SpanContext) WithRemote<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-withremote">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">WithRemote</span><span class="p">(</span><span class="nx">remote</span> <span class="kt">bool</span><span class="p">)</span> <span class="nx">SpanContext</span>
</code></pre></td></tr></table>
</div>
</div><p>WithRemote返回sc的副本，其中Remote属性设置为remote。</p>
<h3 id="func-spancontext-withspanid">func (SpanContext) WithSpanID<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-withspanid">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">WithSpanID</span><span class="p">(</span><span class="nx">spanID</span> <span class="nx">SpanID</span><span class="p">)</span> <span class="nx">SpanContext</span>
</code></pre></td></tr></table>
</div>
</div><p>WithSpanID返回替换了SpanID的新SpanContext。</p>
<h3 id="func-spancontext-withtraceflags">func (SpanContext) WithTraceFlags<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-withtraceflags">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">WithTraceFlags</span><span class="p">(</span><span class="nx">flags</span> <span class="kt">byte</span><span class="p">)</span> <span class="nx">SpanContext</span>
</code></pre></td></tr></table>
</div>
</div><p>WithTraceFlags返回替换了TraceFlags的新SpanContext。</p>
<h3 id="func-spancontext-withtraceid">func (SpanContext) WithTraceID<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-withtraceid">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">WithTraceID</span><span class="p">(</span><span class="nx">traceID</span> <span class="nx">TraceID</span><span class="p">)</span> <span class="nx">SpanContext</span>
</code></pre></td></tr></table>
</div>
</div><p>WithTraceID返回替换了TraceID的新SpanContext。</p>
<h3 id="func-spancontext-withtracestate">func (SpanContext) WithTraceState<a hidden class="anchor" aria-hidden="true" href="#func-spancontext-withtracestate">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="nx">SpanContext</span><span class="p">)</span> <span class="nf">WithTraceState</span><span class="p">(</span><span class="nx">state</span> <span class="nx">TraceState</span><span class="p">)</span> <span class="nx">SpanContext</span>
</code></pre></td></tr></table>
</div>
</div><p>WithTraceState返回替换了TraceState的新SpanContext。</p>
<h2 id="type-spancontextconfig">type SpanContextConfig<a hidden class="anchor" aria-hidden="true" href="#type-spancontextconfig">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">SpanContextConfig</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">TraceID</span>    <span class="nx">TraceID</span>
	<span class="nx">SpanID</span>     <span class="nx">SpanID</span>
	<span class="nx">TraceFlags</span> <span class="kt">byte</span>
	<span class="nx">TraceState</span> <span class="nx">TraceState</span>
	<span class="nx">Remote</span>     <span class="kt">bool</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanContextConfig包含可用于构造不可变SpanContext的可变字段。</p>
<h2 id="type-spanid">type SpanID<a hidden class="anchor" aria-hidden="true" href="#type-spanid">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">SpanID</span> <span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="kt">byte</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanID是trace中span的唯一标识。</p>
<h3 id="func-spanidfromhex">func SpanIDFromHex<a hidden class="anchor" aria-hidden="true" href="#func-spanidfromhex">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">SpanIDFromHex</span><span class="p">(</span><span class="nx">h</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">SpanID</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>如果SpanIDFromHex符合w3c trace-context规范，则从十六进制字符串返回SpanID。详情请参阅<a href="https://www.w3.org/TR/trace-context/#parent-id">https://www.w3.org/TR/trace-context/#parent-id</a></p>
<h3 id="func-spanid-isvalid">func (SpanID) IsValid<a hidden class="anchor" aria-hidden="true" href="#func-spanid-isvalid">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="nx">SpanID</span><span class="p">)</span> <span class="nf">IsValid</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>IsValid检查SpanID是否有效。有效的SpanID不仅由零组成。</p>
<h3 id="func-spanid-marshaljson">func (SpanID) MarshalJSON<a hidden class="anchor" aria-hidden="true" href="#func-spanid-marshaljson">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="nx">SpanID</span><span class="p">)</span> <span class="nf">MarshalJSON</span><span class="p">()</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>MarshalJSON实现了一个自定义的marshal函数，以将SpanID编码为十六进制字符串。</p>
<h3 id="func-spanid-string">func (SpanID) String<a hidden class="anchor" aria-hidden="true" href="#func-spanid-string">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="nx">SpanID</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span>
</code></pre></td></tr></table>
</div>
</div><p>String返回SpanID的十六进制字符串表示形式</p>
<h2 id="type-spankind">type SpanKind<a hidden class="anchor" aria-hidden="true" href="#type-spankind">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">SpanKind</span> <span class="kt">int</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanKind是Span在trace中扮演的角色。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">const</span> <span class="p">(</span>
	<span class="c1">// SpanKindUnspecified is an unspecified SpanKind and is not a valid
</span><span class="c1"></span>	<span class="c1">// SpanKind. SpanKindUnspecified should be replaced with SpanKindInternal
</span><span class="c1"></span>	<span class="c1">// if it is received.
</span><span class="c1"></span>	<span class="nx">SpanKindUnspecified</span> <span class="nx">SpanKind</span> <span class="p">=</span> <span class="mi">0</span>
	<span class="c1">// SpanKindInternal is a SpanKind for a Span that represents an internal
</span><span class="c1"></span>	<span class="c1">// operation within an application.
</span><span class="c1"></span>	<span class="nx">SpanKindInternal</span> <span class="nx">SpanKind</span> <span class="p">=</span> <span class="mi">1</span>
	<span class="c1">// SpanKindServer is a SpanKind for a Span that represents the operation
</span><span class="c1"></span>	<span class="c1">// of handling a request from a client.
</span><span class="c1"></span>	<span class="nx">SpanKindServer</span> <span class="nx">SpanKind</span> <span class="p">=</span> <span class="mi">2</span>
	<span class="c1">// SpanKindClient is a SpanKind for a Span that represents the operation
</span><span class="c1"></span>	<span class="c1">// of client making a request to a server.
</span><span class="c1"></span>	<span class="nx">SpanKindClient</span> <span class="nx">SpanKind</span> <span class="p">=</span> <span class="mi">3</span>
	<span class="c1">// SpanKindProducer is a SpanKind for a Span that represents the operation
</span><span class="c1"></span>	<span class="c1">// of a producer sending a message to a message broker. Unlike
</span><span class="c1"></span>	<span class="c1">// SpanKindClient and SpanKindServer, there is often no direct
</span><span class="c1"></span>	<span class="c1">// relationship between this kind of Span and a SpanKindConsumer kind. A
</span><span class="c1"></span>	<span class="c1">// SpanKindProducer Span will end once the message is accepted by the
</span><span class="c1"></span>	<span class="c1">// message broker which might not overlap with the processing of that
</span><span class="c1"></span>	<span class="c1">// message.
</span><span class="c1"></span>	<span class="nx">SpanKindProducer</span> <span class="nx">SpanKind</span> <span class="p">=</span> <span class="mi">4</span>
	<span class="c1">// SpanKindConsumer is a SpanKind for a Span that represents the operation
</span><span class="c1"></span>	<span class="c1">// of a consumer receiving a message from a message broker. Like
</span><span class="c1"></span>	<span class="c1">// SpanKindProducer Spans, there is often no direct relationship between
</span><span class="c1"></span>	<span class="c1">// this Span and the Span that produced the message.
</span><span class="c1"></span>	<span class="nx">SpanKindConsumer</span> <span class="nx">SpanKind</span> <span class="p">=</span> <span class="mi">5</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>为方便起见，这些匹配原型定义，请参见 <a href="https://github.com/open-telemetry/opentelemetry-proto/blob/30d237e1ff3ab7aa50e0922b5bebdd93505090af/opentelemetry/proto/trace/v1/trace.proto#L101-L129">https://github.com/open-telemetry/opentelemetry-proto/blob/30d237e1ff3ab7aa50e0922b5bebdd93505090af/opentelemetry/proto/trace/v1/trace.proto#L101-L129</a></p>
<p>未指定的值不是有效的“ SpanKind”。使用“ ValidateSpanKind（）”将span类型强制为有效值。</p>
<h3 id="func-validatespankind">func ValidateSpanKind<a hidden class="anchor" aria-hidden="true" href="#func-validatespankind">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">ValidateSpanKind</span><span class="p">(</span><span class="nx">spanKind</span> <span class="nx">SpanKind</span><span class="p">)</span> <span class="nx">SpanKind</span>
</code></pre></td></tr></table>
</div>
</div><p>ValidateSpanKind返回有效的span种类值。这会将无效值强制为默认值SpanKindInternal。</p>
<h3 id="func-spankind-string">func (SpanKind) String<a hidden class="anchor" aria-hidden="true" href="#func-spankind-string">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">sk</span> <span class="nx">SpanKind</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span>
</code></pre></td></tr></table>
</div>
</div><p>String以小写形式返回SpanKind的指定名称。</p>
<h2 id="type-spanoption">type SpanOption<a hidden class="anchor" aria-hidden="true" href="#type-spanoption">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">SpanOption</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="nf">ApplySpan</span><span class="p">(</span><span class="o">*</span><span class="nx">SpanConfig</span><span class="p">)</span>
	<span class="c1">// contains filtered or unexported methods
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>SpanOption将选项应用于SpanConfig。</p>
<h2 id="func-withlinks">func WithLinks<a hidden class="anchor" aria-hidden="true" href="#func-withlinks">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithLinks</span><span class="p">(</span><span class="nx">links</span> <span class="o">...</span><span class="nx">Link</span><span class="p">)</span> <span class="nx">SpanOption</span>
</code></pre></td></tr></table>
</div>
</div><p>WithLinks将Link添加到span。这些Link将添加到现有的SpanLink中，即不会被覆盖。</p>
<h2 id="func-withnewroot">func WithNewRoot<a hidden class="anchor" aria-hidden="true" href="#func-withnewroot">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithNewRoot</span><span class="p">()</span> <span class="nx">SpanOption</span>
</code></pre></td></tr></table>
</div>
</div><p>WithNewRoot指定将span视为根span。定义span的trace标识符时，将忽略任何现有的父span上下文。</p>
<h2 id="func-withspankind">func WithSpanKind<a hidden class="anchor" aria-hidden="true" href="#func-withspankind">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithSpanKind</span><span class="p">(</span><span class="nx">kind</span> <span class="nx">SpanKind</span><span class="p">)</span> <span class="nx">SpanOption</span>
</code></pre></td></tr></table>
</div>
</div><p>WithSpanKind设置span的SpanKind。</p>
<h2 id="type-traceid">type TraceID<a hidden class="anchor" aria-hidden="true" href="#type-traceid">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">TraceID</span> <span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="kt">byte</span>
</code></pre></td></tr></table>
</div>
</div><p>TraceID是trace的唯一标识。nolint：golint</p>
<h3 id="func-traceidfromhex">func TraceIDFromHex<a hidden class="anchor" aria-hidden="true" href="#func-traceidfromhex">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">TraceIDFromHex</span><span class="p">(</span><span class="nx">h</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">TraceID</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>如果TraceIDFromHex符合W3C trace-context规范，则从十六进制字符串返回TraceID。详情请参阅 <a href="https://www.w3.org/TR/trace-context/#trace-id">https://www.w3.org/TR/trace-context/#trace-id</a> nolint：golint</p>
<h3 id="func-traceid-isvalid">func (TraceID) IsValid<a hidden class="anchor" aria-hidden="true" href="#func-traceid-isvalid">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="nx">TraceID</span><span class="p">)</span> <span class="nf">IsValid</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>IsValid检查traceTraceID是否有效。有效的traceID不仅由零组成。</p>
<h3 id="func-traceid-marshaljson">func (TraceID) MarshalJSON<a hidden class="anchor" aria-hidden="true" href="#func-traceid-marshaljson">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="nx">TraceID</span><span class="p">)</span> <span class="nf">MarshalJSON</span><span class="p">()</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>MarshalJSON实现了一个自定义的marshal函数，将TraceID编码为十六进制字符串。</p>
<h3 id="func-traceid-string">func (TraceID) String<a hidden class="anchor" aria-hidden="true" href="#func-traceid-string">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="nx">TraceID</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span>
</code></pre></td></tr></table>
</div>
</div><p>String返回TraceID的十六进制字符串表示形式</p>
<h2 id="type-tracestate">type TraceState<a hidden class="anchor" aria-hidden="true" href="#type-tracestate">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">TraceState</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// contains filtered or unexported fields
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>TraceState在不同的分布式trace系统中提供了其他特定于供应商的trace标识信息。它表示由键/值对组成的不可变列表。列表中最多可以包含32个条目。</p>
<p>每个列表成员的键和值必须根据W3Ctrace上下文规范有效（请参阅<a href="https://www.w3.org/TR/trace-context-1/#key%E5%92%8Chttps://www.w3.org/">https://www.w3.org/TR/trace-context-1/#key和https://www.w3.org/</a> TR / trace-context-1 /＃value ）。</p>
<p>根据W3Ctrace上下文规范，trace状态必须始终有效。所有变异操作都会验证其输入，并在参数有效的情况下返回新的TraceState。</p>
<h3 id="func-tracestatefromkeyvalues">func TraceStateFromKeyValues<a hidden class="anchor" aria-hidden="true" href="#func-tracestatefromkeyvalues">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">TraceStateFromKeyValues</span><span class="p">(</span><span class="nx">kvs</span> <span class="o">...</span><span class="nx">attribute</span><span class="p">.</span><span class="nx">KeyValue</span><span class="p">)</span> <span class="p">(</span><span class="nx">TraceState</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>TraceStateFromKeyValues是从提供的键/值对创建新的TraceState的便捷方法。</p>
<h3 id="func-tracestate-delete">func (TraceState) Delete<a hidden class="anchor" aria-hidden="true" href="#func-tracestate-delete">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">ts</span> <span class="nx">TraceState</span><span class="p">)</span> <span class="nf">Delete</span><span class="p">(</span><span class="nx">key</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">Key</span><span class="p">)</span> <span class="p">(</span><span class="nx">TraceState</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>删除将从trace状态中删除指定的条目。</p>
<h3 id="func-tracestate-get">func (TraceState) Get<a hidden class="anchor" aria-hidden="true" href="#func-tracestate-get">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">ts</span> <span class="nx">TraceState</span><span class="p">)</span> <span class="nf">Get</span><span class="p">(</span><span class="nx">key</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">Key</span><span class="p">)</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">Value</span>
</code></pre></td></tr></table>
</div>
</div><p>Get从trace状态返回给定键的值。如果找不到密钥或提供的密钥无效，则返回一个空值。</p>
<h3 id="func-tracestate-insert">func (TraceState) Insert<a hidden class="anchor" aria-hidden="true" href="#func-tracestate-insert">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">ts</span> <span class="nx">TraceState</span><span class="p">)</span> <span class="nf">Insert</span><span class="p">(</span><span class="nx">entry</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">KeyValue</span><span class="p">)</span> <span class="p">(</span><span class="nx">TraceState</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>如果不存在，Insert会添加一个新的键/值。否则，更新现有条目。根据W3Ctrace上下文规范要求，新的或更新的条目总是插入到TraceState的开头，即左侧。</p>
<h3 id="func-tracestate-isempty">func (TraceState) IsEmpty<a hidden class="anchor" aria-hidden="true" href="#func-tracestate-isempty">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">ts</span> <span class="nx">TraceState</span><span class="p">)</span> <span class="nf">IsEmpty</span><span class="p">()</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p>如果TraceState不包含任何条目，则IsEmpty返回true</p>
<h3 id="func-tracestate-marshaljson">func (TraceState) MarshalJSON<a hidden class="anchor" aria-hidden="true" href="#func-tracestate-marshaljson">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">ts</span> <span class="nx">TraceState</span><span class="p">)</span> <span class="nf">MarshalJSON</span><span class="p">()</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>MarshalJSON实现了自定义的marshal函数以对trace状态进行编码。</p>
<h3 id="func-tracestate-string">func (TraceState) String<a hidden class="anchor" aria-hidden="true" href="#func-tracestate-string">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">ts</span> <span class="nx">TraceState</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span>
</code></pre></td></tr></table>
</div>
</div><p>String根据W3Ctrace上下文规范将trace状态作为有效的字符串返回。</p>
<h2 id="type-tracer">type Tracer<a hidden class="anchor" aria-hidden="true" href="#type-tracer">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Tracer</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="c1">// Start creates a span.
</span><span class="c1"></span>	<span class="nf">Start</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">spanName</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">SpanOption</span><span class="p">)</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">Span</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Tracer是Spans的创建者。</p>
<h2 id="type-tracerconfig">type TracerConfig<a hidden class="anchor" aria-hidden="true" href="#type-tracerconfig">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">TracerConfig</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// InstrumentationVersion is the version of the library providing
</span><span class="c1"></span>	<span class="c1">// instrumentation.
</span><span class="c1"></span>	<span class="nx">InstrumentationVersion</span> <span class="kt">string</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>TracerConfig是Tracer的一组选项。</p>
<h2 id="func-newtracerconfig">func NewTracerConfig<a hidden class="anchor" aria-hidden="true" href="#func-newtracerconfig">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">NewTracerConfig</span><span class="p">(</span><span class="nx">options</span> <span class="o">...</span><span class="nx">TracerOption</span><span class="p">)</span> <span class="o">*</span><span class="nx">TracerConfig</span>
</code></pre></td></tr></table>
</div>
</div><p>NewTracerConfig将所有选项应用于返回的TracerConfig。</p>
<h2 id="type-traceroption">type TracerOption<a hidden class="anchor" aria-hidden="true" href="#type-traceroption">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">TracerOption</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="nf">ApplyTracer</span><span class="p">(</span><span class="o">*</span><span class="nx">TracerConfig</span><span class="p">)</span>
	<span class="c1">// contains filtered or unexported methods
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>TracerOption将选项应用于TracerConfig。</p>
<h2 id="type-tracerprovider">type TracerProvider<a hidden class="anchor" aria-hidden="true" href="#type-tracerprovider">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">TracerProvider</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="c1">// Tracer creates an implementation of the Tracer interface.
</span><span class="c1"></span>	<span class="c1">// The instrumentationName must be the name of the library providing
</span><span class="c1"></span>	<span class="c1">// instrumentation. This name may be the same as the instrumented code
</span><span class="c1"></span>	<span class="c1">// only if that code provides built-in instrumentation. If the
</span><span class="c1"></span>	<span class="c1">// instrumentationName is empty, then a implementation defined default
</span><span class="c1"></span>	<span class="c1">// name will be used instead.
</span><span class="c1"></span>	<span class="c1">//
</span><span class="c1"></span>	<span class="c1">// This method must be concurrency safe.
</span><span class="c1"></span>	<span class="nf">Tracer</span><span class="p">(</span><span class="nx">instrumentationName</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">TracerOption</span><span class="p">)</span> <span class="nx">Tracer</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>TracerProvider提供对仪器trace的访问。</p>
<h2 id="func-newnooptracerprovider">func NewNoopTracerProvider<a hidden class="anchor" aria-hidden="true" href="#func-newnooptracerprovider">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">NewNoopTracerProvider</span><span class="p">()</span> <span class="nx">TracerProvider</span>
</code></pre></td></tr></table>
</div>
</div><p>NewNoopTracerProvider返回不执行任何操作的TracerProvider实现。从返回的TracerProvider创建的Tracer和Span也不会执行任何操作。</p>
<h1 id="exportertracejaeger">exporter/trace/jaeger<a hidden class="anchor" aria-hidden="true" href="#exportertracejaeger">#</a></h1>
<h2 id="func-withagentendpoint">func WithAgentEndpoint<a hidden class="anchor" aria-hidden="true" href="#func-withagentendpoint">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithAgentEndpoint</span><span class="p">(</span><span class="nx">agentEndpoint</span> <span class="kt">string</span><span class="p">)</span> <span class="kd">func</span><span class="p">()</span> <span class="p">(</span><span class="nx">batchUploader</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>WithAgentEndpoint指示导出器将跨度发送到该地址的jaeger-agent。例如，localhost：6831。</p>
<h2 id="func-withbuffermaxcount">func WithBufferMaxCount<a hidden class="anchor" aria-hidden="true" href="#func-withbuffermaxcount">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithBufferMaxCount</span><span class="p">(</span><span class="nx">bufferMaxCount</span> <span class="kt">int</span><span class="p">)</span> <span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">options</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>WithBufferMaxCount定义可以在内存中缓冲的跟踪总数</p>
<h2 id="func-withcollectorendpoint">func WithCollectorEndpoint<a hidden class="anchor" aria-hidden="true" href="#func-withcollectorendpoint">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithCollectorEndpoint</span><span class="p">(</span><span class="nx">collectorEndpoint</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">options</span> <span class="o">...</span><span class="nx">CollectorEndpointOption</span><span class="p">)</span> <span class="kd">func</span><span class="p">()</span> <span class="p">(</span><span class="nx">batchUploader</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>WithCollectorEndpoint定义Jaeger HTTP Thrift收集器的完整URL。例如，http：// localhost：14268 / api / traces</p>
<h2 id="func-withonerror">func WithOnError<a hidden class="anchor" aria-hidden="true" href="#func-withonerror">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithOnError</span><span class="p">(</span><span class="nx">onError</span> <span class="kd">func</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">))</span> <span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">options</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>WithOnError设置在上载跨度数据时发生错误时要调用的挂钩。如果未设置自定义钩子，则会记录错误。</p>
<h2 id="func-withpassword">func WithPassword<a hidden class="anchor" aria-hidden="true" href="#func-withpassword">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithPassword</span><span class="p">(</span><span class="nx">password</span> <span class="kt">string</span><span class="p">)</span> <span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">CollectorEndpointOptions</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>WithPassword设置需要基本身份验证时使用的密码。</p>
<h2 id="func-withprocess">func WithProcess<a hidden class="anchor" aria-hidden="true" href="#func-withprocess">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithProcess</span><span class="p">(</span><span class="nx">process</span> <span class="nx">Process</span><span class="p">)</span> <span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">options</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>WithProcess使用有关导出过程的信息来设置过程。</p>
<h2 id="func-withusername">func WithUsername<a hidden class="anchor" aria-hidden="true" href="#func-withusername">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithUsername</span><span class="p">(</span><span class="nx">username</span> <span class="kt">string</span><span class="p">)</span> <span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">CollectorEndpointOptions</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>WithUsername设置需要基本身份验证时要使用的用户名。</p>
<h2 id="type-collectorendpointoption">type CollectorEndpointOption<a hidden class="anchor" aria-hidden="true" href="#type-collectorendpointoption">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">CollectorEndpointOption</span> <span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">CollectorEndpointOptions</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="type-collectorendpointoptions">type CollectorEndpointOptions<a hidden class="anchor" aria-hidden="true" href="#type-collectorendpointoptions">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">CollectorEndpointOptions</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// contains filtered or unexported fields
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="type-endpointoption">type EndpointOption<a hidden class="anchor" aria-hidden="true" href="#type-endpointoption">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">EndpointOption</span> <span class="kd">func</span><span class="p">()</span> <span class="p">(</span><span class="nx">batchUploader</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="type-exporter">type Exporter<a hidden class="anchor" aria-hidden="true" href="#type-exporter">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Exporter</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// contains filtered or unexported fields
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>导出器是trace.Exporter的实现，可将跨度上传到Jaeger。</p>
<h2 id="func-newexporter">func NewExporter<a hidden class="anchor" aria-hidden="true" href="#func-newexporter">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">NewExporter</span><span class="p">(</span><span class="nx">endpointOption</span> <span class="nx">EndpointOption</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">Option</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">Exporter</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>NewExporter返回trace.Exporter实现，该实现将收集的跨度导出到Jaeger。</p>
<h3 id="func-exporter-exportspan">func (*Exporter) ExportSpan<a hidden class="anchor" aria-hidden="true" href="#func-exporter-exportspan">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Exporter</span><span class="p">)</span> <span class="nf">ExportSpan</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">d</span> <span class="o">*</span><span class="nx">export</span><span class="p">.</span><span class="nx">SpanData</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>ExportSpan将SpanData导出到Jaeger。</p>
<h3 id="func-exporter-flush">func (*Exporter) Flush<a hidden class="anchor" aria-hidden="true" href="#func-exporter-flush">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Exporter</span><span class="p">)</span> <span class="nf">Flush</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>刷新等待导出的跟踪范围上载。</p>
<p>如果您的程序即将结束并且您不想丢失最近的跨度，则此功能很有用。</p>
<h2 id="type-option">type Option<a hidden class="anchor" aria-hidden="true" href="#type-option">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Option</span> <span class="kd">func</span><span class="p">(</span><span class="o">*</span><span class="nx">options</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="type-process">type Process<a hidden class="anchor" aria-hidden="true" href="#type-process">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Process</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// ServiceName is the Jaeger service name.
</span><span class="c1"></span>	<span class="nx">ServiceName</span> <span class="kt">string</span>

	<span class="c1">// Tags are added to Jaeger Process exports
</span><span class="c1"></span>	<span class="nx">Tags</span> <span class="p">[]</span><span class="nx">core</span><span class="p">.</span><span class="nx">KeyValue</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>流程包含导出到jaeger的有关跟踪数据源的信息。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="/tags/opentelemetry/">opentelemetry</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2021 <a href="/">Forz Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
