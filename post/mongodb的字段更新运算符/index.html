<!DOCTYPE html>
<html lang="zh-cn" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>MongoDB的字段更新运算符 | Forz Blog</title>
<meta name="keywords" content="MongoDB" />
<meta name="description" content="$currentDate $ currentDate运算符将字段的值设置为当前日期，可以是Date或时间戳。默认类型为日期。 $currentDate的形式为： 1 { $currentDate: {">
<meta name="author" content="">
<link rel="canonical" href="/post/mongodb%E7%9A%84%E5%AD%97%E6%AE%B5%E6%9B%B4%E6%96%B0%E8%BF%90%E7%AE%97%E7%AC%A6/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.00d5d4fc479b1575183ee8d86b4fb372ba9d9b1904e96fa8e4c40ff7debe2b94.css" integrity="sha256-ANXU/EebFXUYPujYa0&#43;zcrqdmxkE6W&#43;o5MQP996&#43;K5Q=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.87.0" />
<meta property="og:title" content="MongoDB的字段更新运算符" />
<meta property="og:description" content="$currentDate $ currentDate运算符将字段的值设置为当前日期，可以是Date或时间戳。默认类型为日期。 $currentDate的形式为： 1 { $currentDate: {" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/mongodb%E7%9A%84%E5%AD%97%E6%AE%B5%E6%9B%B4%E6%96%B0%E8%BF%90%E7%AE%97%E7%AC%A6/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-05-14T16:54:32&#43;00:00" />
<meta property="article:modified_time" content="2020-05-14T16:54:32&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MongoDB的字段更新运算符"/>
<meta name="twitter:description" content="$currentDate $ currentDate运算符将字段的值设置为当前日期，可以是Date或时间戳。默认类型为日期。 $currentDate的形式为： 1 { $currentDate: {"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "/post/"
    }
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "MongoDB的字段更新运算符",
      "item": "/post/mongodb%E7%9A%84%E5%AD%97%E6%AE%B5%E6%9B%B4%E6%96%B0%E8%BF%90%E7%AE%97%E7%AC%A6/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "MongoDB的字段更新运算符",
  "name": "MongoDB的字段更新运算符",
  "description": "$currentDate $ currentDate运算符将字段的值设置为当前日期，可以是Date或时间戳。默认类型为日期。 $currentDate的形式为： 1 { $currentDate: {",
  "keywords": [
    "MongoDB"
  ],
  "articleBody": "$currentDate $ currentDate运算符将字段的值设置为当前日期，可以是Date或时间戳。默认类型为日期。\n$currentDate的形式为：\n1  { $currentDate: { field1: typeSpecification1, ... } }   可以是：\n 一个布尔值，true用于将字段值设置为当前日期作为Date，或者 明确指定类型的文档{$type：“ timestamp”}或{$type：“ date”}。运算符区分大小写，并且仅接受小写的“时间戳”或小写的“日期”。  若要在嵌入式文档或数组中指定，请使用点表示法。\n特性 如果该字段不存在，则$currentDate将该字段添加到文档中。\n例子 customers使用以下文档创建样本集合：\n1 2 3  db.customers.insertOne( { _id: 1, status: \"a\", lastModified: ISODate(\"2013-10-02T01:11:18.965Z\") } )   以下操作将lastModified字段更新为当前日期，将“cancellation.date”字段更新为当前时间戳，并将状态字段更新为“D”，将“cancellation.reason”更新为“用户请求”。\n1 2 3 4 5 6 7 8 9 10 11 12 13  db.customers.updateOne( { _id: 1 }, { $currentDate: { lastModified: true, \"cancellation.date\": { $type: \"timestamp\" } }, $set: { \"cancellation.reason\": \"user request\", status: \"D\" } } )   更新后的文档类似于：\n1 2 3 4 5 6 7 8 9  { \"_id\" : 1, \"status\" : \"D\", \"lastModified\" : ISODate(\"2020-01-22T21:21:41.052Z\"), \"cancellation\" : { \"date\" : Timestamp(1579728101, 1), \"reason\" : \"user request\" } }   Aggregation替代$currentDate 从4.2版开始，更新方法可以接受聚合管道。这样，可以使用聚合阶段$set和聚合变量 NOW（对于当前日期时间）和CLUSTER_TIME （对于当前时间戳记）将前面的示例重写为以下示例：\nTIP:\n 要访问聚合变量，请在变量前加双美元符号$$并用引号引起来。 CLUSTER_TIME 仅在副本集和分片群集上可用。 在整个管道中，NOW和CLUSTER_TIME值保持不变。  1 2 3 4 5 6  db.customers.updateOne( { _id: 1 }, [ { $set: { lastModified: \"$$NOW\", cancellation: {date: \"$$CLUSTER_TIME\", reason: \"user request\"}, status: \"D\" } } ] )   查询应返回以下文档：\n1 2 3 4 5 6 7 8 9  { \"_id\" : 1, \"status\" : \"D\", \"lastModified\" : ISODate(\"2020-01-22T21:02:18.994Z\"), \"cancellation\" : { \"date\" : Timestamp(1579726934, 2), \"reason\" : \"user request\" } }   $inc $inc通过增加指定的值的字段，并具有以下形式：\n1  { $inc: { field1: amount1, field2: amount2, ... } }   若要在嵌入式文档或数组中指定，请使用点表示法。\n特性 $inc运算符接受正值和负值。\n如果该字段不存在，则$inc将创建该字段并将该字段设置为指定的值。\n在具有空值的字段上使用$inc运算符将产生错误。\n$inc是单个文档中的原子操作。\n例子 考虑products包含以下文档的集合：\n1 2 3 4 5 6 7 8 9  { _id: 1, sku: \"abc123\", quantity: 10, metrics: { orders: 2, ratings: 3.5 } }   以下update()操作使用$inc运算符将quantity字段减小2（即增加-2），并将\"metrics.orders\"字段增大1：\n1 2 3 4  db.products.update( { sku: \"abc123\" }, { $inc: { quantity: -2, \"metrics.orders\": 1 } } )   更新后的文档类似于：\n1 2 3 4 5 6 7 8 9  { \"_id\" : 1, \"sku\" : \"abc123\", \"quantity\" : 8, \"metrics\" : { \"orders\" : 3, \"ratings\" : 3.5 } }   $min 如果指定的值小于字段的当前值，则$min将字段的值更新为指定的值。 $min运算符可以使用BSON比较顺序来比较不同类型的值。\n1  { $min: { field1: value1, ... } }   若要在嵌入式文档或数组中指定，请使用点表示法。\n特性 如果该字段不存在，则$min运算符会将字段设置为指定的值。\n对于不同类型的值（例如数字和空值）之间的比较，$min使用BSON比较顺序。\n例子 使用$min比较数字 考虑集合中的以下文档scores：\n1  { _id: 1, highScore: 800, lowScore: 200 }   文档的lowScore当前具有值200。以下操作使用$ min将200与指定值150进行比较，由于150小于200，因此将lowScore的值更新为150：\n1  db.scores.update( { _id: 1 }, { $min: { lowScore: 150 } } )   scores现在，该集合包含以下修改后的文档：\n1  { _id: 1, highScore: 800, lowScore: 150 }   下一操作无效，因为该字段的当前值（lowScore即150）小于250：\n1  db.scores.update( { _id: 1 }, { $min: { lowScore: 250 } } )   该文档在scores集合中保持不变：\n1  { _id: 1, highScore: 800, lowScore: 150 }   使用$min比较日期 考虑集合中的以下文档tags：\n1 2 3 4 5 6  { _id: 1, desc: \"crafts\", dateEntered: ISODate(\"2013-10-01T05:00:00Z\"), dateExpired: ISODate(\"2013-10-01T16:38:16Z\") }   以下操作将dateEntered字段的当前值（即ISODate（“ 2013-10-01T05：00：00Z”））与指定的日期new Date（“ 2013-09-25”）进行比较，以确定是否更新该字段：\n1 2 3 4  db.tags.update( { _id: 1 }, { $min: { dateEntered: new Date(\"2013-09-25\") } } )   该操作将更新dateEntered字段：\n1 2 3 4 5 6 7 8  { _id: 1, desc: \"crafts\", dateEntered: ISODate(\"2013-09-25T00:00:00Z\"), dateExpired: ISODate(\"2013-10-01T16:38:16Z\") }   $max 如果指定的值大于字段的当前值，则$ max运算符会将字段的值更新为指定的值。 $ max运算符可以使用BSON比较顺序来比较不同类型的值。\n$max运算符表达式的形式为：\n1  { $max: { : , ... } }   若要在嵌入式文档或数组中指定，请使用点表示法。\n特性 如果该字段不存在，则$max操作员将该字段设置为指定值。\n例子 使用$max比较数字 考虑集合中的以下文档scores：\n1  { _id: 1, highScore: 800, lowScore: 200 }   文档的highScore当前具有值800。以下操作使用$ max将800与指定值950进行比较，由于950大于800，因此将highScore的值更新为950。\n1  db.scores.update( { _id: 1 }, { $max: { highScore: 950 } } )   scores现在，该集合包含以下修改后的文档：\n1  { _id: 1, highScore: 950, lowScore: 200 }   下一操作无效，因为该字段的当前值（highScore即950）大于870：\n1  db.scores.update( { _id: 1 }, { $max: { highScore: 870 } } )   该文档在scores集合中保持不变：\n1  { _id: 1, highScore: 950, lowScore: 200 }   使用$max比较日期 考虑集合中的以下文档tags：\n1 2 3 4 5 6  { _id: 1, desc: \"crafts\", dateEntered: ISODate(\"2013-10-01T05:00:00Z\"), dateExpired: ISODate(\"2013-10-01T16:38:16.163Z\") }   以下操作将dateExpired字段的当前值（即ISODate（“ 2013-10-01T16：38：16.163Z”））与指定的日期new Date（“ 2013-09-30”）进行比较，以确定是否更新field：\n1 2 3 4  db.tags.update( { _id: 1 }, { $max: { dateExpired: new Date(\"2013-09-30\") } } )   操作并没有更新的dateExpired领域：\n1 2 3 4 5 6 7 8  { _id: 1, desc: \"decorative arts\", dateEntered: ISODate(\"2013-10-01T05:00:00Z\"), dateExpired: ISODate(\"2013-10-01T16:38:16.163Z\") }   $mul 将字段的值乘以数字。要指定 $mul表达式，请使用以下原型：\n1  { $mul: { : , ... } }   要更新的字段必须包含一个数字值。\n若要在嵌入式文档或数组中指定，请使用点表示法。\n特性 缺少字段 如果文档中不存在该字段，则$ mul将创建该字段并将其值设置为与乘法器相同的数字类型为零。\n原子 $mul 是单个文档中的原子操作。\n混合型 与混合数字类型（32位整数，64位整数，浮点数）的值相乘可能会导致数字类型转换。对于与混合数值类型的值相乘，将应用以下类型转换规则：\n注意\n 如果两个32位整数的乘积超过了32位整数的最大值，则结果为64位整数。 超过64位整数最大值的任何类型的整数运算都会产生错误。  例子 乘以字段的值 考虑products包含以下文档的集合：\n1  { \"_id\" : 1, \"item\" : \"ABC\", \"price\" : NumberDecimal(\"10.99\"), \"qty\" : 25 }   以下db.collection.update()操作使用$mul运算符将price by 1.25和qty字段乘以2：\n1 2 3 4  db.products.update( { _id: 1 }, { $mul: { price: NumberDecimal(\"1.25\"), qty: 2 } } )   该操作得出以下文档，其中价格的新值反映了原始值10.99乘以1.25，而数量的新值反映了原始值25乘以2：\n1  { \"_id\" : 1, \"item\" : \"ABC\", \"price\" : NumberDecimal(\"13.7375\"), \"qty\" : 50 }   应用$mul操作员到一个不存在的字段 考虑products包含以下文档的集合：\n1  { _id: 2, item: \"Unknown\" }   以下db.collection.update（）操作将$mul运算符应用于文档中不存在的字段价格来更新文档：\n1 2 3 4  db.products.update( { _id: 2 }, { $mul: { price: NumberLong(100) } } )   该操作将导致以下文档的price字段设置为数值类型NumberLong的值0 ，该类型与乘数相同：\n1  { \"_id\" : 2, \"item\" : \"Unknown\", \"price\" : NumberLong(0) }   乘法混合数值类型 考虑products包含以下文档的集合：\n1  { _id: 3, item: \"XYZ\", price: NumberLong(10) }   以下db.collection.update（）操作使用$ mul运算符将价格字段NumberLong（10）中的值乘以NumberInt（5）\n1 2 3 4  db.products.update( { _id: 3 }, { $mul: { price: NumberInt(5) } } )   该操作产生以下文档：\n1  { \"_id\" : 3, \"item\" : \"XYZ\", \"price\" : NumberLong(50) }   该price字段中的值是NumberLong类型。\n$rename $rename运算符将更新字段名称，并具有以下格式\n1  {$rename: { field1: newName1, field2: newName2, ... } }   新的字段名称必须与现有的字段名称不同。要在嵌入式文档中指定，请使用点号。\n考虑以下示例：\n1  db.students.update( { _id: 1 }, { $rename: { 'nickname': 'alias', 'cell': 'mobile' } } )   此操作将字段重命名nickname为alias，并将字段重命名cell为mobile。\n特性 $rename运算符在逻辑上执行旧名称和新名称的$unset，然后使用新名称执行$set操作。因此，该操作可能不会保留文档中字段的顺序；即重命名的字段可能会在文档中移动。\n如果文档中已有一个带有的字段，则$rename运算符将删除该字段，并将指定的重命名为。\n如果文档中不存在要重命名的字段，则$rename不执行任何操作（即不执行任何操作）。\n对于嵌入式文档中的字段，$rename运算符可以重命名这些字段，也可以将字段移入或移出嵌入式文档。如果这些字段在数组元素中，则$rename不起作用。\n例子 集合students包含以下文档，其中某个字段的nmae拼写错误，即应为name：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  { \"_id\": 1, \"alias\": [ \"The American Cincinnatus\", \"The American Fabius\" ], \"mobile\": \"555-555-5555\", \"nmae\": { \"first\" : \"george\", \"last\" : \"washington\" } } { \"_id\": 2, \"alias\": [ \"My dearest friend\" ], \"mobile\": \"222-222-2222\", \"nmae\": { \"first\" : \"abigail\", \"last\" : \"adams\" } } { \"_id\": 3, \"alias\": [ \"Amazing grace\" ], \"mobile\": \"111-111-1111\", \"nmae\": { \"first\" : \"grace\", \"last\" : \"hopper\" } }   本节中的示例将依次更新集合中的文档。\n重命名字段 要重命名字段，请使用字段$rename的当前名称和新名称来调用运算符：\n1  db.students.updateMany( {}, { $rename: { \"nmae\": \"name\" } } )   此操作将重命名字段nmae来name为集合中的所有文档：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  { \"_id\": 1, \"alias\": [ \"The American Cincinnatus\", \"The American Fabius\" ], \"mobile\": \"555-555-5555\", \"name\": { \"first\" : \"george\", \"last\" : \"washington\" } } { \"_id\" : 2, \"alias\" : [ \"My dearest friend\" ], \"mobile\" : \"222-222-2222\", \"name\" : { \"first\" : \"abigail\", \"last\" : \"adams\" } } { \"_id\" : 3, \"alias\" : [ \"Amazing grace\" ], \"mobile\" : \"111-111-1111\", \"name\" : { \"first\" : \"grace\", \"last\" : \"hopper\" } }   重命名嵌入文档中的字段 要重命名嵌入式文档中的字段，请使用点表示法调用$rename运算符以引用该字段。如果该字段将保留在同一嵌入式文档中，则还应使用新名称中的点号，如下所示：\n1  db.students.update( { _id: 1 }, { $rename: { \"name.first\": \"name.fname\" } } )   此操作将嵌入式字段重命名first为fname：\n1 2 3 4 5 6  { \"_id\" : 1, \"alias\" : [ \"The American Cincinnatus\", \"The American Fabius\" ], \"mobile\" : \"555-555-5555\", \"name\" : { \"fname\" : \"george\", \"last\" : \"washington\" } }   重命名一个不存在的字段 重命名字段并且现有字段名称引用的字段不存在时，$rename运算符不执行任何操作，如下所示：\n1  db.students.update( { _id: 1 }, { $rename: { 'wife': 'spouse' } } )   此操作没有执行任何操作，因为没有名为wife的字段。\n$set 该$set操作者更换一个字段与指定的值。\n所述$set操作者的表达具有以下形式：\n1  { $set: { : , ... } }   若要在嵌入式文档或数组中指定，请使用点表示法。\n特性 如果该字段不存在，$set则将添加具有指定值的新字段，前提是该新字段不违反类型约束。如果为不存在的字段指定点划线路径，$ set将根据需要创建嵌入的文档，以实现到该字段的点划线路径。\n如果指定多个字段/值对，$set将更新或创建每个字段。\n例子 考虑products包含以下文档的集合：\n1 2 3 4 5 6 7 8 9 10  { _id: 100, sku: \"abc123\", quantity: 250, instock: true, reorder: false, details: { model: \"14Q2\", make: \"xyz\" }, tags: [ \"apparel\", \"clothing\" ], ratings: [ { by: \"ijk\", rating: 4 } ] }   设置顶级字段 对于符合_id等于的条件的文档100，以下操作使用$set运算符更新quantity字段，details字段和tags 字段的值。\n1 2 3 4 5 6 7 8 9 10  db.products.update( { _id: 100 }, { $set: { quantity: 500, details: { model: \"14Q3\", make: \"xyz\" }, tags: [ \"coats\", \"outerwear\", \"clothing\" ] } } )   该操作将值替换为：quantity为500。详细信息字段到新的嵌入式文档，而标签字段到新数组。\n在嵌入式文档中设置字段 若要在嵌入式文档或数组中指定，请使用点表示法。\n对于符合标准_id等于100的文档，以下操作将更新details文档中的make字段：\n1 2 3 4  db.products.update( { _id: 100 }, { $set: { \"details.make\": \"zzz\" } } )   在数组中设置元素 若要在嵌入式文档或数组中指定，请使用点表示法。\n对于符合等于_id等于100的条件的文档，以下操作将更新tags数组的第二个元素（数组索引为1）的值，以及ratings数组的第一个元素（array索引为0）中的rating字段。\n1 2 3 4 5 6 7 8 9  db.products.update( { _id: 100 }, { $set: { \"tags.1\": \"rain gear\", \"ratings.0.rating\": 2 } } )   $setOnInsert 如果使用upsert：true进行更新操作会导致插入文档，则$setOnInsertm’k会将指定的值分配给文档中的字段。如果更新操作未导致插入，则$setOnInsert不执行任何操作。\n您可以为db.collection.update（）或db.collection.findAndModify（）方法指定upsert选项。\n1 2 3 4 5  db.collection.update( query, { $setOnInsert: { field1: value1, ... } }, { upsert: true } )   若要在嵌入式文档或数组中指定，请使用点表示法。\n例子 名为的集合products不包含任何文档。\n然后，以下带有upsert：true的db.collection.update（）插入新文档。\n1 2 3 4 5 6 7 8  db.products.update( { _id: 1 }, { $set: { item: \"apple\" }, $setOnInsert: { defaultQty: 100 } }, { upsert: true } )   MongoDB从条件创建一个_id等于1的新文档，然后将$set和$setOnInsert操作应用于此文档。\n该products集合包含新插入的文档：\n1  { \"_id\" : 1, \"item\" : \"apple\", \"defaultQty\" : 100 }   如果具有upsert：true的db.collection.update（）找到了匹配的文档，则MongoDB将执行更新，应用$set操作，但忽略$setOnInsert操作。\n$unset 该$unset操作删除特定的领域。请考虑以下语法：\n1  { $unset: { field1: \"\", ... } }   $unset表达式中的指定值（即“”）不会影响该操作。\n若要在嵌入式文档或数组中指定，请使用点表示法。\n特性 如果该字段不存在，则$unset不执行任何操作（即不执行任何操作）。\n与$配合使用以匹配数组元素时，$unset会将匹配元素替换为null，而不是从数组中删除匹配元素。此特性使数组大小和元素位置保持一致。\n例子 以下update（）操作使用$unset运算符从字段sku值为未知的产品集合中的第一个文档中删除字段quantity和instock。\n1 2 3 4  db.products.update( { sku: \"unknown\" }, { $unset: { quantity: \"\", instock: \"\" } } )   ",
  "wordCount" : "5610",
  "inLanguage": "zh-cn",
  "datePublished": "2020-05-14T16:54:32Z",
  "dateModified": "2020-05-14T16:54:32Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/mongodb%E7%9A%84%E5%AD%97%E6%AE%B5%E6%9B%B4%E6%96%B0%E8%BF%90%E7%AE%97%E7%AC%A6/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Forz Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="Forz Blog (Alt + H)">Forz Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="/post/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      MongoDB的字段更新运算符
    </h1>
    <div class="post-meta">May 14, 2020
</div>
  </header> 
  <div class="post-content"><h1 id="currentdate">$currentDate<a hidden class="anchor" aria-hidden="true" href="#currentdate">#</a></h1>
<p><code>$ currentDate</code>运算符将字段的值设置为当前日期，可以是Date或时间戳。默认类型为日期。</p>
<p>$currentDate的形式为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">{</span> <span class="o">$</span><span class="n">currentDate</span><span class="o">:</span> <span class="p">{</span> <span class="o">&lt;</span><span class="n">field1</span><span class="o">&gt;:</span> <span class="o">&lt;</span><span class="n">typeSpecification1</span><span class="o">&gt;</span><span class="p">,</span> <span class="kc">...</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><!-- raw HTML omitted --> 可以是：</p>
<ul>
<li>一个布尔值，true用于将字段值设置为当前日期作为Date，或者</li>
<li>明确指定类型的文档<code>{$type：“ timestamp”}</code>或<code>{$type：“ date”}</code>。运算符区分大小写，并且仅接受小写的“时间戳”或小写的“日期”。</li>
</ul>
<p>若要在嵌入式文档或数组中指定<code>&lt;field&gt;</code>，请使用点表示法。</p>
<h2 id="特性">特性<a hidden class="anchor" aria-hidden="true" href="#特性">#</a></h2>
<p>如果该字段不存在，则<code>$currentDate</code>将该字段添加到文档中。</p>
<h2 id="例子">例子<a hidden class="anchor" aria-hidden="true" href="#例子">#</a></h2>
<p>customers使用以下文档创建样本集合：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.customers.insertOne</span><span class="p">(</span>
   <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">1</span><span class="p">,</span> <span class="n">status</span><span class="o">:</span> <span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="n">lastModified</span><span class="o">:</span> <span class="nf">ISODate</span><span class="p">(</span><span class="s">&#34;2013-10-02T01:11:18.965Z&#34;</span><span class="p">)</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>以下操作将lastModified字段更新为当前日期，将“cancellation.date”字段更新为当前时间戳，并将状态字段更新为“D”，将“cancellation.reason”更新为“用户请求”。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.customers.updateOne</span><span class="p">(</span>
   <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">1</span> <span class="p">},</span>
   <span class="p">{</span>
     <span class="o">$</span><span class="n">currentDate</span><span class="o">:</span> <span class="p">{</span>
        <span class="n">lastModified</span><span class="o">:</span> <span class="n">true</span><span class="p">,</span>
        <span class="s">&#34;cancellation.date&#34;</span><span class="o">:</span> <span class="p">{</span> <span class="o">$</span><span class="n">type</span><span class="o">:</span> <span class="s">&#34;timestamp&#34;</span> <span class="p">}</span>
     <span class="p">},</span>
     <span class="o">$</span><span class="n">set</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">&#34;cancellation.reason&#34;</span><span class="o">:</span> <span class="s">&#34;user request&#34;</span><span class="p">,</span>
        <span class="n">status</span><span class="o">:</span> <span class="s">&#34;D&#34;</span>
     <span class="p">}</span>
   <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>更新后的文档类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
   <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="nt">&#34;status&#34;</span> <span class="p">:</span> <span class="s2">&#34;D&#34;</span><span class="p">,</span>
   <span class="nt">&#34;lastModified&#34;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&#34;2020-01-22T21:21:41.052Z&#34;</span><span class="err">)</span><span class="p">,</span>
   <span class="nt">&#34;cancellation&#34;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;date&#34;</span> <span class="p">:</span> <span class="err">Timestamp(</span><span class="mi">1579728101</span><span class="p">,</span> <span class="err">1),</span>
      <span class="nt">&#34;reason&#34;</span> <span class="p">:</span> <span class="s2">&#34;user request&#34;</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="aggregation替代currentdate">Aggregation替代$currentDate<a hidden class="anchor" aria-hidden="true" href="#aggregation替代currentdate">#</a></h3>
<p>从4.2版开始，更新方法可以接受聚合管道。这样，可以使用聚合阶段<code>$set</code>和聚合变量 NOW（对于当前日期时间）和CLUSTER_TIME （对于当前时间戳记）将前面的示例重写为以下示例：</p>
<p>TIP:</p>
<ul>
<li>要访问聚合变量，请在变量前加双美元符号$$并用引号引起来。</li>
<li>CLUSTER_TIME 仅在副本集和分片群集上可用。</li>
<li>在整个管道中，NOW和CLUSTER_TIME值保持不变。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.customers.updateOne</span><span class="p">(</span>
  <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">1</span> <span class="p">},</span>
  <span class="n">[</span>
   <span class="p">{</span> <span class="o">$</span><span class="n">set</span><span class="o">:</span> <span class="p">{</span> <span class="n">lastModified</span><span class="o">:</span> <span class="s">&#34;$$NOW&#34;</span><span class="p">,</span> <span class="n">cancellation</span><span class="o">:</span> <span class="p">{</span><span class="n">date</span><span class="o">:</span> <span class="s">&#34;$$CLUSTER_TIME&#34;</span><span class="p">,</span> <span class="n">reason</span><span class="o">:</span> <span class="s">&#34;user request&#34;</span><span class="p">},</span> <span class="n">status</span><span class="o">:</span> <span class="s">&#34;D&#34;</span> <span class="p">}</span> <span class="p">}</span>
  <span class="n">]</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>查询应返回以下文档：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
   <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="nt">&#34;status&#34;</span> <span class="p">:</span> <span class="s2">&#34;D&#34;</span><span class="p">,</span>
   <span class="nt">&#34;lastModified&#34;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&#34;2020-01-22T21:02:18.994Z&#34;</span><span class="err">)</span><span class="p">,</span>
   <span class="nt">&#34;cancellation&#34;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;date&#34;</span> <span class="p">:</span> <span class="err">Timestamp(</span><span class="mi">1579726934</span><span class="p">,</span> <span class="err">2),</span>
      <span class="nt">&#34;reason&#34;</span> <span class="p">:</span> <span class="s2">&#34;user request&#34;</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="inc">$inc<a hidden class="anchor" aria-hidden="true" href="#inc">#</a></h1>
<p><code>$inc</code>通过增加指定的值的字段，并具有以下形式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">{</span> <span class="o">$</span><span class="n">inc</span><span class="o">:</span> <span class="p">{</span> <span class="o">&lt;</span><span class="n">field1</span><span class="o">&gt;:</span> <span class="o">&lt;</span><span class="n">amount1</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">field2</span><span class="o">&gt;:</span> <span class="o">&lt;</span><span class="n">amount2</span><span class="o">&gt;</span><span class="p">,</span> <span class="kc">...</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>若要在嵌入式文档或数组中指定<!-- raw HTML omitted -->，请使用点表示法。</p>
<h2 id="特性-1">特性<a hidden class="anchor" aria-hidden="true" href="#特性-1">#</a></h2>
<p>$inc运算符接受正值和负值。</p>
<p>如果该字段不存在，则<code>$inc</code>将创建该字段并将该字段设置为指定的值。</p>
<p>在具有空值的字段上使用$inc运算符将产生错误。</p>
<p>$inc是单个文档中的原子操作。</p>
<h2 id="例子-1">例子<a hidden class="anchor" aria-hidden="true" href="#例子-1">#</a></h2>
<p>考虑products包含以下文档的集合：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="err">_id:</span> <span class="err">1,</span>
  <span class="err">sku:</span> <span class="nt">&#34;abc123&#34;</span><span class="p">,</span>
  <span class="err">quantity:</span> <span class="err">10,</span>
  <span class="err">metrics:</span> <span class="err">{</span>
    <span class="err">orders:</span> <span class="err">2,</span>
    <span class="err">ratings:</span> <span class="err">3.5</span>
  <span class="p">}</span>
<span class="err">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以下update()操作使用$inc运算符将quantity字段减小2（即增加-2），并将&quot;metrics.orders&quot;字段增大1：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.products.update</span><span class="p">(</span>
   <span class="p">{</span> <span class="n">sku</span><span class="o">:</span> <span class="s">&#34;abc123&#34;</span> <span class="p">},</span>
   <span class="p">{</span> <span class="o">$</span><span class="n">inc</span><span class="o">:</span> <span class="p">{</span> <span class="n">quantity</span><span class="o">:</span> <span class="m">-2</span><span class="p">,</span> <span class="s">&#34;metrics.orders&#34;</span><span class="o">:</span> <span class="m">1</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>更新后的文档类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
   <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="nt">&#34;sku&#34;</span> <span class="p">:</span> <span class="s2">&#34;abc123&#34;</span><span class="p">,</span>
   <span class="nt">&#34;quantity&#34;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
   <span class="nt">&#34;metrics&#34;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;orders&#34;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="nt">&#34;ratings&#34;</span> <span class="p">:</span> <span class="mf">3.5</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="min">$min<a hidden class="anchor" aria-hidden="true" href="#min">#</a></h1>
<p>如果指定的值小于字段的当前值，则<code>$min</code>将字段的值更新为指定的值。 <code>$min</code>运算符可以使用BSON比较顺序来比较不同类型的值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">{</span> <span class="o">$</span><span class="n">min</span><span class="o">:</span> <span class="p">{</span> <span class="o">&lt;</span><span class="n">field1</span><span class="o">&gt;:</span> <span class="o">&lt;</span><span class="n">value1</span><span class="o">&gt;</span><span class="p">,</span> <span class="kc">...</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>若要在嵌入式文档或数组中指定<code>&lt;field&gt;</code>，请使用点表示法。</p>
<h2 id="特性-2">特性<a hidden class="anchor" aria-hidden="true" href="#特性-2">#</a></h2>
<p>如果该字段不存在，则$min运算符会将字段设置为指定的值。</p>
<p>对于不同类型的值（例如数字和空值）之间的比较，$min使用<a href="https://docs.mongodb.com/manual/reference/bson-type-comparison-order/#faq-dev-compare-order-for-bson-types">BSON比较顺序</a>。</p>
<h2 id="例子-2">例子<a hidden class="anchor" aria-hidden="true" href="#例子-2">#</a></h2>
<h3 id="使用min比较数字">使用$min比较数字<a hidden class="anchor" aria-hidden="true" href="#使用min比较数字">#</a></h3>
<p>考虑集合中的以下文档scores：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span> <span class="err">_id:</span> <span class="err">1,</span> <span class="err">highScore:</span> <span class="err">800,</span> <span class="err">lowScore:</span> <span class="err">200</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>文档的lowScore当前具有值200。以下操作使用$ min将200与指定值150进行比较，由于150小于200，因此将lowScore的值更新为150：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.scores.update</span><span class="p">(</span> <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">1</span> <span class="p">},</span> <span class="p">{</span> <span class="o">$</span><span class="n">min</span><span class="o">:</span> <span class="p">{</span> <span class="n">lowScore</span><span class="o">:</span> <span class="m">150</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>scores现在，该集合包含以下修改后的文档：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span> <span class="err">_id:</span> <span class="err">1,</span> <span class="err">highScore:</span> <span class="err">800,</span> <span class="err">lowScore:</span> <span class="err">150</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>下一操作无效，因为该字段的当前值（lowScore即150）小于250：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.scores.update</span><span class="p">(</span> <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">1</span> <span class="p">},</span> <span class="p">{</span> <span class="o">$</span><span class="n">min</span><span class="o">:</span> <span class="p">{</span> <span class="n">lowScore</span><span class="o">:</span> <span class="m">250</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>该文档在scores集合中保持不变：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span> <span class="err">_id:</span> <span class="err">1,</span> <span class="err">highScore:</span> <span class="err">800,</span> <span class="err">lowScore:</span> <span class="err">150</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="使用min比较日期">使用$min比较日期<a hidden class="anchor" aria-hidden="true" href="#使用min比较日期">#</a></h3>
<p>考虑集合中的以下文档tags：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="err">_id:</span> <span class="err">1,</span>
  <span class="err">desc:</span> <span class="nt">&#34;crafts&#34;</span><span class="p">,</span>
  <span class="err">dateEntered:</span> <span class="err">ISODate(</span><span class="nt">&#34;2013-10-01T05:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="err">dateExpired:</span> <span class="err">ISODate(</span><span class="nt">&#34;2013-10-01T16:38:16Z&#34;</span><span class="err">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以下操作将dateEntered字段的当前值（即ISODate（“ 2013-10-01T05：00：00Z”））与指定的日期new Date（“ 2013-09-25”）进行比较，以确定是否更新该字段：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.tags.update</span><span class="p">(</span>
   <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">1</span> <span class="p">},</span>
   <span class="p">{</span> <span class="o">$</span><span class="n">min</span><span class="o">:</span> <span class="p">{</span> <span class="n">dateEntered</span><span class="o">:</span> <span class="n">new</span> <span class="nf">Date</span><span class="p">(</span><span class="s">&#34;2013-09-25&#34;</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>该操作将更新dateEntered字段：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="err">_id:</span> <span class="err">1,</span>
  <span class="err">desc:</span> <span class="nt">&#34;crafts&#34;</span><span class="p">,</span>

  <span class="err">dateEntered:</span> <span class="err">ISODate(</span><span class="nt">&#34;2013-09-25T00:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>

  <span class="err">dateExpired:</span> <span class="err">ISODate(</span><span class="nt">&#34;2013-10-01T16:38:16Z&#34;</span><span class="err">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="max">$max<a hidden class="anchor" aria-hidden="true" href="#max">#</a></h1>
<p>如果指定的值大于字段的当前值，则$ max运算符会将字段的值更新为指定的值。 $ max运算符可以使用BSON比较顺序来比较不同类型的值。</p>
<p><code>$max</code>运算符表达式的形式为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">{ $max: { &lt;field1&gt;: &lt;value1&gt;, ... } }
</code></pre></td></tr></table>
</div>
</div><p>若要在嵌入式文档或数组中指定<code>&lt;field&gt;</code>，请使用点表示法。</p>
<h2 id="特性-3">特性<a hidden class="anchor" aria-hidden="true" href="#特性-3">#</a></h2>
<p>如果该字段不存在，则$max操作员将该字段设置为指定值。</p>
<h2 id="例子-3">例子<a hidden class="anchor" aria-hidden="true" href="#例子-3">#</a></h2>
<h3 id="使用max比较数字">使用$max比较数字<a hidden class="anchor" aria-hidden="true" href="#使用max比较数字">#</a></h3>
<p>考虑集合中的以下文档scores：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span> <span class="err">_id:</span> <span class="err">1,</span> <span class="err">highScore:</span> <span class="err">800,</span> <span class="err">lowScore:</span> <span class="err">200</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>文档的highScore当前具有值800。以下操作使用$ max将800与指定值950进行比较，由于950大于800，因此将highScore的值更新为950。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.scores.update</span><span class="p">(</span> <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">1</span> <span class="p">},</span> <span class="p">{</span> <span class="o">$</span><span class="n">max</span><span class="o">:</span> <span class="p">{</span> <span class="n">highScore</span><span class="o">:</span> <span class="m">950</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>scores现在，该集合包含以下修改后的文档：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span> <span class="err">_id:</span> <span class="err">1,</span> <span class="err">highScore:</span> <span class="err">950,</span> <span class="err">lowScore:</span> <span class="err">200</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>下一操作无效，因为该字段的当前值（highScore即950）大于870：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.scores.update</span><span class="p">(</span> <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">1</span> <span class="p">},</span> <span class="p">{</span> <span class="o">$</span><span class="n">max</span><span class="o">:</span> <span class="p">{</span> <span class="n">highScore</span><span class="o">:</span> <span class="m">870</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>该文档在scores集合中保持不变：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span> <span class="err">_id:</span> <span class="err">1,</span> <span class="err">highScore:</span> <span class="err">950,</span> <span class="err">lowScore:</span> <span class="err">200</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="使用max比较日期">使用$max比较日期<a hidden class="anchor" aria-hidden="true" href="#使用max比较日期">#</a></h3>
<p>考虑集合中的以下文档tags：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="err">_id:</span> <span class="err">1,</span>
  <span class="err">desc:</span> <span class="nt">&#34;crafts&#34;</span><span class="p">,</span>
  <span class="err">dateEntered:</span> <span class="err">ISODate(</span><span class="nt">&#34;2013-10-01T05:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="err">dateExpired:</span> <span class="err">ISODate(</span><span class="nt">&#34;2013-10-01T16:38:16.163Z&#34;</span><span class="err">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以下操作将dateExpired字段的当前值（即ISODate（“ 2013-10-01T16：38：16.163Z”））与指定的日期new Date（“ 2013-09-30”）进行比较，以确定是否更新field：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.tags.update</span><span class="p">(</span>
   <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">1</span> <span class="p">},</span>
   <span class="p">{</span> <span class="o">$</span><span class="n">max</span><span class="o">:</span> <span class="p">{</span> <span class="n">dateExpired</span><span class="o">:</span> <span class="n">new</span> <span class="nf">Date</span><span class="p">(</span><span class="s">&#34;2013-09-30&#34;</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>操作并没有更新的dateExpired领域：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
   <span class="err">_id:</span> <span class="err">1,</span>
   <span class="err">desc:</span> <span class="nt">&#34;decorative arts&#34;</span><span class="p">,</span>
   <span class="err">dateEntered:</span> <span class="err">ISODate(</span><span class="nt">&#34;2013-10-01T05:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>

   <span class="err">dateExpired:</span> <span class="err">ISODate(</span><span class="nt">&#34;2013-10-01T16:38:16.163Z&#34;</span><span class="err">)</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="mul">$mul<a hidden class="anchor" aria-hidden="true" href="#mul">#</a></h1>
<p>将字段的值乘以数字。要指定 $mul表达式，请使用以下原型：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">{ $mul: { &lt;field1&gt;: &lt;number1&gt;, ... } }
</code></pre></td></tr></table>
</div>
</div><p>要更新的字段必须包含一个数字值。</p>
<p>若要在嵌入式文档或数组中指定<code>&lt;field&gt;</code>，请使用点表示法。</p>
<h2 id="特性-4">特性<a hidden class="anchor" aria-hidden="true" href="#特性-4">#</a></h2>
<h3 id="缺少字段">缺少字段<a hidden class="anchor" aria-hidden="true" href="#缺少字段">#</a></h3>
<p>如果文档中不存在该字段，则$ mul将创建该字段并将其值设置为与乘法器相同的数字类型为零。</p>
<h3 id="原子">原子<a hidden class="anchor" aria-hidden="true" href="#原子">#</a></h3>
<p><code>$mul</code> 是单个文档中的原子操作。</p>
<h3 id="混合型">混合型<a hidden class="anchor" aria-hidden="true" href="#混合型">#</a></h3>
<p>与混合数字类型（32位整数，64位整数，浮点数）的值相乘可能会导致数字类型转换。对于与混合数值类型的值相乘，将应用以下类型转换规则：</p>
<p><img loading="lazy" src="https://blog-1257321977.cos.ap-beijing.myqcloud.com/20200514190409.png" alt=""  />
</p>
<p>注意</p>
<ul>
<li>如果两个32位整数的乘积超过了32位整数的最大值，则结果为64位整数。</li>
<li>超过64位整数最大值的任何类型的整数运算都会产生错误。</li>
</ul>
<h2 id="例子-4">例子<a hidden class="anchor" aria-hidden="true" href="#例子-4">#</a></h2>
<h3 id="乘以字段的值">乘以字段的值<a hidden class="anchor" aria-hidden="true" href="#乘以字段的值">#</a></h3>
<p>考虑products包含以下文档的集合：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span> <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nt">&#34;item&#34;</span> <span class="p">:</span> <span class="s2">&#34;ABC&#34;</span><span class="p">,</span> <span class="nt">&#34;price&#34;</span> <span class="p">:</span> <span class="err">NumberDecimal(</span><span class="s2">&#34;10.99&#34;</span><span class="err">)</span><span class="p">,</span> <span class="nt">&#34;qty&#34;</span> <span class="p">:</span> <span class="mi">25</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以下db.collection.update()操作使用$mul运算符将price by 1.25和qty字段乘以2：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.products.update</span><span class="p">(</span>
   <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">1</span> <span class="p">},</span>
   <span class="p">{</span> <span class="o">$</span><span class="n">mul</span><span class="o">:</span> <span class="p">{</span> <span class="n">price</span><span class="o">:</span> <span class="nf">NumberDecimal</span><span class="p">(</span><span class="s">&#34;1.25&#34;</span><span class="p">),</span> <span class="n">qty</span><span class="o">:</span> <span class="m">2</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>该操作得出以下文档，其中价格的新值反映了原始值10.99乘以1.25，而数量的新值反映了原始值25乘以2：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">{</span> <span class="s">&#34;_id&#34;</span> <span class="o">:</span> <span class="m">1</span><span class="p">,</span> <span class="s">&#34;item&#34;</span> <span class="o">:</span> <span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="s">&#34;price&#34;</span> <span class="o">:</span> <span class="nf">NumberDecimal</span><span class="p">(</span><span class="s">&#34;13.7375&#34;</span><span class="p">),</span> <span class="s">&#34;qty&#34;</span> <span class="o">:</span> <span class="m">50</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="应用mul操作员到一个不存在的字段">应用$mul操作员到一个不存在的字段<a hidden class="anchor" aria-hidden="true" href="#应用mul操作员到一个不存在的字段">#</a></h3>
<p>考虑products包含以下文档的集合：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span> <span class="err">_id:</span> <span class="err">2,</span>  <span class="err">item:</span> <span class="nt">&#34;Unknown&#34;</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以下db.collection.update（）操作将<code>$mul</code>运算符应用于文档中不存在的字段价格来更新文档：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.products.update</span><span class="p">(</span>
   <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">2</span> <span class="p">},</span>
   <span class="p">{</span> <span class="o">$</span><span class="n">mul</span><span class="o">:</span> <span class="p">{</span> <span class="n">price</span><span class="o">:</span> <span class="nf">NumberLong</span><span class="p">(</span><span class="m">100</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>该操作将导致以下文档的price字段设置为数值类型NumberLong的值0 ，该类型与乘数相同：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span> <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nt">&#34;item&#34;</span> <span class="p">:</span> <span class="s2">&#34;Unknown&#34;</span><span class="p">,</span> <span class="nt">&#34;price&#34;</span> <span class="p">:</span> <span class="err">NumberLong(</span><span class="mi">0</span><span class="err">)</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="乘法混合数值类型">乘法混合数值类型<a hidden class="anchor" aria-hidden="true" href="#乘法混合数值类型">#</a></h3>
<p>考虑products包含以下文档的集合：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">3</span><span class="p">,</span>  <span class="n">item</span><span class="o">:</span> <span class="s">&#34;XYZ&#34;</span><span class="p">,</span> <span class="n">price</span><span class="o">:</span> <span class="nf">NumberLong</span><span class="p">(</span><span class="m">10</span><span class="p">)</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以下db.collection.update（）操作使用$ mul运算符将价格字段NumberLong（10）中的值乘以NumberInt（5）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.products.update</span><span class="p">(</span>
   <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">3</span> <span class="p">},</span>
   <span class="p">{</span> <span class="o">$</span><span class="n">mul</span><span class="o">:</span> <span class="p">{</span> <span class="n">price</span><span class="o">:</span> <span class="nf">NumberInt</span><span class="p">(</span><span class="m">5</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>该操作产生以下文档：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span> <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nt">&#34;item&#34;</span> <span class="p">:</span> <span class="s2">&#34;XYZ&#34;</span><span class="p">,</span> <span class="nt">&#34;price&#34;</span> <span class="p">:</span> <span class="err">NumberLong(</span><span class="mi">50</span><span class="err">)</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>该price字段中的值是NumberLong类型。</p>
<h1 id="rename">$rename<a hidden class="anchor" aria-hidden="true" href="#rename">#</a></h1>
<p><code>$rename</code>运算符将更新字段名称，并具有以下格式</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">{</span><span class="o">$</span><span class="n">rename</span><span class="o">:</span> <span class="p">{</span> <span class="o">&lt;</span><span class="n">field1</span><span class="o">&gt;:</span> <span class="o">&lt;</span><span class="n">newName1</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">field2</span><span class="o">&gt;:</span> <span class="o">&lt;</span><span class="n">newName2</span><span class="o">&gt;</span><span class="p">,</span> <span class="kc">...</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>新的字段名称必须与现有的字段名称不同。要在嵌入式文档中指定<code>&lt;field&gt;</code>，请使用点号。</p>
<p>考虑以下示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.students.update</span><span class="p">(</span> <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">1</span> <span class="p">},</span> <span class="p">{</span> <span class="o">$</span><span class="n">rename</span><span class="o">:</span> <span class="p">{</span> <span class="s">&#39;nickname&#39;</span><span class="o">:</span> <span class="s">&#39;alias&#39;</span><span class="p">,</span> <span class="s">&#39;cell&#39;</span><span class="o">:</span> <span class="s">&#39;mobile&#39;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>此操作将字段重命名nickname为alias，并将字段重命名cell为mobile。</p>
<h2 id="特性-5">特性<a hidden class="anchor" aria-hidden="true" href="#特性-5">#</a></h2>
<p><code>$rename</code>运算符在逻辑上执行旧名称和新名称的<code>$unset</code>，然后使用新名称执行<code>$set</code>操作。因此，该操作可能不会保留文档中字段的顺序；即重命名的字段可能会在文档中移动。</p>
<p>如果文档中已有一个带有<code>&lt;newName&gt;</code>的字段，则<code>$rename</code>运算符将删除该字段，并将指定的<code>&lt;field&gt;</code>重命名为<code>&lt;newName&gt;</code>。</p>
<p>如果文档中不存在要重命名的字段，则<code>$rename</code>不执行任何操作（即不执行任何操作）。</p>
<p>对于嵌入式文档中的字段，<code>$rename</code>运算符可以重命名这些字段，也可以将字段移入或移出嵌入式文档。如果这些字段在数组元素中，则<code>$rename</code>不起作用。</p>
<h2 id="例子-5">例子<a hidden class="anchor" aria-hidden="true" href="#例子-5">#</a></h2>
<p>集合students包含以下文档，其中某个字段的nmae拼写错误，即应为name：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&#34;alias&#34;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&#34;The American Cincinnatus&#34;</span><span class="p">,</span> <span class="s2">&#34;The American Fabius&#34;</span> <span class="p">],</span>
  <span class="nt">&#34;mobile&#34;</span><span class="p">:</span> <span class="s2">&#34;555-555-5555&#34;</span><span class="p">,</span>
  <span class="nt">&#34;nmae&#34;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&#34;first&#34;</span> <span class="p">:</span> <span class="s2">&#34;george&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span> <span class="p">:</span> <span class="s2">&#34;washington&#34;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="nt">&#34;alias&#34;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&#34;My dearest friend&#34;</span> <span class="p">],</span>
  <span class="nt">&#34;mobile&#34;</span><span class="p">:</span> <span class="s2">&#34;222-222-2222&#34;</span><span class="p">,</span>
  <span class="nt">&#34;nmae&#34;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&#34;first&#34;</span> <span class="p">:</span> <span class="s2">&#34;abigail&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span> <span class="p">:</span> <span class="s2">&#34;adams&#34;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="nt">&#34;alias&#34;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&#34;Amazing grace&#34;</span> <span class="p">],</span>
  <span class="nt">&#34;mobile&#34;</span><span class="p">:</span> <span class="s2">&#34;111-111-1111&#34;</span><span class="p">,</span>
  <span class="nt">&#34;nmae&#34;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&#34;first&#34;</span> <span class="p">:</span> <span class="s2">&#34;grace&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span> <span class="p">:</span> <span class="s2">&#34;hopper&#34;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>本节中的示例将依次更新集合中的文档。</p>
<h3 id="重命名字段">重命名字段<a hidden class="anchor" aria-hidden="true" href="#重命名字段">#</a></h3>
<p>要重命名字段，请使用字段$rename的当前名称和新名称来调用运算符：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.students.updateMany</span><span class="p">(</span> <span class="p">{},</span> <span class="p">{</span> <span class="o">$</span><span class="n">rename</span><span class="o">:</span> <span class="p">{</span> <span class="s">&#34;nmae&#34;</span><span class="o">:</span> <span class="s">&#34;name&#34;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>此操作将重命名字段nmae来name为集合中的所有文档：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&#34;alias&#34;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&#34;The American Cincinnatus&#34;</span><span class="p">,</span> <span class="s2">&#34;The American Fabius&#34;</span> <span class="p">],</span>
  <span class="nt">&#34;mobile&#34;</span><span class="p">:</span> <span class="s2">&#34;555-555-5555&#34;</span><span class="p">,</span>
  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&#34;first&#34;</span> <span class="p">:</span> <span class="s2">&#34;george&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span> <span class="p">:</span> <span class="s2">&#34;washington&#34;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="p">{</span>
   <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
   <span class="nt">&#34;alias&#34;</span> <span class="p">:</span> <span class="p">[</span> <span class="s2">&#34;My dearest friend&#34;</span> <span class="p">],</span>
   <span class="nt">&#34;mobile&#34;</span> <span class="p">:</span> <span class="s2">&#34;222-222-2222&#34;</span><span class="p">,</span>
   <span class="nt">&#34;name&#34;</span> <span class="p">:</span> <span class="p">{</span> <span class="nt">&#34;first&#34;</span> <span class="p">:</span> <span class="s2">&#34;abigail&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span> <span class="p">:</span> <span class="s2">&#34;adams&#34;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="p">{</span> <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="nt">&#34;alias&#34;</span> <span class="p">:</span> <span class="p">[</span> <span class="s2">&#34;Amazing grace&#34;</span> <span class="p">],</span>
  <span class="nt">&#34;mobile&#34;</span> <span class="p">:</span> <span class="s2">&#34;111-111-1111&#34;</span><span class="p">,</span>
  <span class="nt">&#34;name&#34;</span> <span class="p">:</span> <span class="p">{</span> <span class="nt">&#34;first&#34;</span> <span class="p">:</span> <span class="s2">&#34;grace&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span> <span class="p">:</span> <span class="s2">&#34;hopper&#34;</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="重命名嵌入文档中的字段">重命名嵌入文档中的字段<a hidden class="anchor" aria-hidden="true" href="#重命名嵌入文档中的字段">#</a></h3>
<p>要重命名嵌入式文档中的字段，请使用点表示法调用<code>$rename</code>运算符以引用该字段。如果该字段将保留在同一嵌入式文档中，则还应使用新名称中的点号，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.students.update</span><span class="p">(</span> <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">1</span> <span class="p">},</span> <span class="p">{</span> <span class="o">$</span><span class="n">rename</span><span class="o">:</span> <span class="p">{</span> <span class="s">&#34;name.first&#34;</span><span class="o">:</span> <span class="s">&#34;name.fname&#34;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>此操作将嵌入式字段重命名first为fname：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&#34;alias&#34;</span> <span class="p">:</span> <span class="p">[</span> <span class="s2">&#34;The American Cincinnatus&#34;</span><span class="p">,</span> <span class="s2">&#34;The American Fabius&#34;</span> <span class="p">],</span>
  <span class="nt">&#34;mobile&#34;</span> <span class="p">:</span> <span class="s2">&#34;555-555-5555&#34;</span><span class="p">,</span>
  <span class="nt">&#34;name&#34;</span> <span class="p">:</span> <span class="p">{</span> <span class="nt">&#34;fname&#34;</span> <span class="p">:</span> <span class="s2">&#34;george&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span> <span class="p">:</span> <span class="s2">&#34;washington&#34;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="重命名一个不存在的字段">重命名一个不存在的字段<a hidden class="anchor" aria-hidden="true" href="#重命名一个不存在的字段">#</a></h3>
<p>重命名字段并且现有字段名称引用的字段不存在时，<code>$rename</code>运算符不执行任何操作，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.students.update</span><span class="p">(</span> <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">1</span> <span class="p">},</span> <span class="p">{</span> <span class="o">$</span><span class="n">rename</span><span class="o">:</span> <span class="p">{</span> <span class="s">&#39;wife&#39;</span><span class="o">:</span> <span class="s">&#39;spouse&#39;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>此操作没有执行任何操作，因为没有名为wife的字段。</p>
<h1 id="set">$set<a hidden class="anchor" aria-hidden="true" href="#set">#</a></h1>
<p>该<code>$set</code>操作者更换一个字段与指定的值。</p>
<p>所述$set操作者的表达具有以下形式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">{ $set: { &lt;field1&gt;: &lt;value1&gt;, ... } }
</code></pre></td></tr></table>
</div>
</div><p>若要在嵌入式文档或数组中指定<code>&lt;field&gt;</code>，请使用点表示法。</p>
<h2 id="特性-6">特性<a hidden class="anchor" aria-hidden="true" href="#特性-6">#</a></h2>
<p>如果该字段不存在，$set则将添加具有指定值的新字段，前提是该新字段不违反类型约束。如果为不存在的字段指定点划线路径，$ set将根据需要创建嵌入的文档，以实现到该字段的点划线路径。</p>
<p>如果指定多个字段/值对，$set将更新或创建每个字段。</p>
<h2 id="例子-6">例子<a hidden class="anchor" aria-hidden="true" href="#例子-6">#</a></h2>
<p>考虑products包含以下文档的集合：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="err">_id:</span> <span class="err">100,</span>
  <span class="err">sku:</span> <span class="nt">&#34;abc123&#34;</span><span class="p">,</span>
  <span class="err">quantity:</span> <span class="err">250,</span>
  <span class="err">instock:</span> <span class="err">true,</span>
  <span class="err">reorder:</span> <span class="err">false,</span>
  <span class="err">details:</span> <span class="err">{</span> <span class="err">model:</span> <span class="nt">&#34;14Q2&#34;</span><span class="p">,</span> <span class="err">make:</span> <span class="nt">&#34;xyz&#34;</span> <span class="p">}</span><span class="err">,</span>
  <span class="err">tags:</span> <span class="p">[</span> <span class="s2">&#34;apparel&#34;</span><span class="p">,</span> <span class="s2">&#34;clothing&#34;</span> <span class="p">]</span><span class="err">,</span>
  <span class="err">ratings:</span> <span class="p">[</span> <span class="p">{</span> <span class="err">by:</span> <span class="nt">&#34;ijk&#34;</span><span class="p">,</span> <span class="err">rating:</span> <span class="err">4</span> <span class="p">}</span> <span class="p">]</span>
<span class="err">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="设置顶级字段">设置顶级字段<a hidden class="anchor" aria-hidden="true" href="#设置顶级字段">#</a></h3>
<p>对于符合_id等于的条件的文档100，以下操作使用$set运算符更新quantity字段，details字段和tags 字段的值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.products.update</span><span class="p">(</span>
   <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">100</span> <span class="p">},</span>
   <span class="p">{</span> <span class="o">$</span><span class="n">set</span><span class="o">:</span>
      <span class="p">{</span>
        <span class="n">quantity</span><span class="o">:</span> <span class="m">500</span><span class="p">,</span>
        <span class="n">details</span><span class="o">:</span> <span class="p">{</span> <span class="n">model</span><span class="o">:</span> <span class="s">&#34;14Q3&#34;</span><span class="p">,</span> <span class="n">make</span><span class="o">:</span> <span class="s">&#34;xyz&#34;</span> <span class="p">},</span>
        <span class="n">tags</span><span class="o">:</span> <span class="n">[</span> <span class="s">&#34;coats&#34;</span><span class="p">,</span> <span class="s">&#34;outerwear&#34;</span><span class="p">,</span> <span class="s">&#34;clothing&#34;</span> <span class="n">]</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>该操作将值替换为：quantity为500。详细信息字段到新的嵌入式文档，而标签字段到新数组。</p>
<h3 id="在嵌入式文档中设置字段">在嵌入式文档中设置字段<a hidden class="anchor" aria-hidden="true" href="#在嵌入式文档中设置字段">#</a></h3>
<p>若要在嵌入式文档或数组中指定<code>&lt;field&gt;</code>，请使用点表示法。</p>
<p>对于符合标准_id等于100的文档，以下操作将更新details文档中的make字段：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.products.update</span><span class="p">(</span>
   <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">100</span> <span class="p">},</span>
   <span class="p">{</span> <span class="o">$</span><span class="n">set</span><span class="o">:</span> <span class="p">{</span> <span class="s">&#34;details.make&#34;</span><span class="o">:</span> <span class="s">&#34;zzz&#34;</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="在数组中设置元素">在数组中设置元素<a hidden class="anchor" aria-hidden="true" href="#在数组中设置元素">#</a></h3>
<p>若要在嵌入式文档或数组中指定<code>&lt;field&gt;</code>，请使用点表示法。</p>
<p>对于符合等于_id等于100的条件的文档，以下操作将更新tags数组的第二个元素（数组索引为1）的值，以及ratings数组的第一个元素（array索引为0）中的rating字段。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.products.update</span><span class="p">(</span>
   <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">100</span> <span class="p">},</span>
   <span class="p">{</span> <span class="o">$</span><span class="n">set</span><span class="o">:</span>
      <span class="p">{</span>
        <span class="s">&#34;tags.1&#34;</span><span class="o">:</span> <span class="s">&#34;rain gear&#34;</span><span class="p">,</span>
        <span class="s">&#34;ratings.0.rating&#34;</span><span class="o">:</span> <span class="m">2</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="setoninsert">$setOnInsert<a hidden class="anchor" aria-hidden="true" href="#setoninsert">#</a></h1>
<p>如果使用<code>upsert：true</code>进行更新操作会导致插入文档，则<code>$setOnInsert</code>m&rsquo;k会将指定的值分配给文档中的字段。如果更新操作未导致插入，则<code>$setOnInsert</code>不执行任何操作。</p>
<p>您可以为<code>db.collection.update（）</code>或<code>db.collection.findAndModify（）</code>方法指定upsert选项。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-S" data-lang="S"><span class="nf">db.collection.update</span><span class="p">(</span>
   <span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span><span class="p">,</span>
   <span class="p">{</span> <span class="o">$</span><span class="n">setOnInsert</span><span class="o">:</span> <span class="p">{</span> <span class="o">&lt;</span><span class="n">field1</span><span class="o">&gt;:</span> <span class="o">&lt;</span><span class="n">value1</span><span class="o">&gt;</span><span class="p">,</span> <span class="kc">...</span> <span class="p">}</span> <span class="p">},</span>
   <span class="p">{</span> <span class="n">upsert</span><span class="o">:</span> <span class="n">true</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>若要在嵌入式文档或数组中指定<code>&lt;field&gt;</code>，请使用点表示法。</p>
<h2 id="例子-7">例子<a hidden class="anchor" aria-hidden="true" href="#例子-7">#</a></h2>
<p>名为的集合products不包含任何文档。</p>
<p>然后，以下带有upsert：true的db.collection.update（）插入新文档。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.products.update</span><span class="p">(</span>
  <span class="p">{</span> <span class="n">_id</span><span class="o">:</span> <span class="m">1</span> <span class="p">},</span>
  <span class="p">{</span>
     <span class="o">$</span><span class="n">set</span><span class="o">:</span> <span class="p">{</span> <span class="n">item</span><span class="o">:</span> <span class="s">&#34;apple&#34;</span> <span class="p">},</span>
     <span class="o">$</span><span class="n">setOnInsert</span><span class="o">:</span> <span class="p">{</span> <span class="n">defaultQty</span><span class="o">:</span> <span class="m">100</span> <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span> <span class="n">upsert</span><span class="o">:</span> <span class="n">true</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>MongoDB从<code>&lt;query&gt;</code>条件创建一个_id等于1的新文档，然后将<code>$set</code>和<code>$setOnInsert</code>操作应用于此文档。</p>
<p>该products集合包含新插入的文档：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span> <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nt">&#34;item&#34;</span> <span class="p">:</span> <span class="s2">&#34;apple&#34;</span><span class="p">,</span> <span class="nt">&#34;defaultQty&#34;</span> <span class="p">:</span> <span class="mi">100</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>如果具有<code>upsert：true</code>的db.collection.update（）找到了匹配的文档，则MongoDB将执行更新，应用<code>$set</code>操作，但忽略<code>$setOnInsert</code>操作。</p>
<h1 id="unset">$unset<a hidden class="anchor" aria-hidden="true" href="#unset">#</a></h1>
<p>该<code>$unset</code>操作删除特定的领域。请考虑以下语法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">{</span> <span class="o">$</span><span class="n">unset</span><span class="o">:</span> <span class="p">{</span> <span class="o">&lt;</span><span class="n">field1</span><span class="o">&gt;:</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="kc">...</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>$unset</code>表达式中的指定值（即“”）不会影响该操作。</p>
<p>若要在嵌入式文档或数组中指定<code>&lt;field&gt;</code>，请使用点表示法。</p>
<h2 id="特性-7">特性<a hidden class="anchor" aria-hidden="true" href="#特性-7">#</a></h2>
<p>如果该字段不存在，则<code>$unset</code>不执行任何操作（即不执行任何操作）。</p>
<p>与<code>$</code>配合使用以匹配数组元素时，<code>$unset</code>会将匹配元素替换为<code>null</code>，而不是从数组中删除匹配元素。此特性使数组大小和元素位置保持一致。</p>
<h2 id="例子-8">例子<a hidden class="anchor" aria-hidden="true" href="#例子-8">#</a></h2>
<p>以下update（）操作使用<code>$unset</code>运算符从字段sku值为未知的产品集合中的第一个文档中删除字段quantity和instock。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="nf">db.products.update</span><span class="p">(</span>
   <span class="p">{</span> <span class="n">sku</span><span class="o">:</span> <span class="s">&#34;unknown&#34;</span> <span class="p">},</span>
   <span class="p">{</span> <span class="o">$</span><span class="n">unset</span><span class="o">:</span> <span class="p">{</span> <span class="n">quantity</span><span class="o">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="n">instock</span><span class="o">:</span> <span class="s">&#34;&#34;</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="/tags/mongodb/">MongoDB</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2021 <a href="/">Forz Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
