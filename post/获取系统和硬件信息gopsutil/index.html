<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>获取系统和硬件信息:gopsutil - Forz Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Forz" /><meta name="description" content="简介 gopsutil是 Python 工具库psutil 的 Golang 移植版，可以帮助我们方便地获取各种系统和硬件信息。gopsutil为我们屏蔽了各个系统之间的差" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.89.4 with theme even" />


<link rel="canonical" href="/post/%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E5%92%8C%E7%A1%AC%E4%BB%B6%E4%BF%A1%E6%81%AFgopsutil/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.98f8e47918247c097fa26317cbb567fe9f05503485bf08d8547f5579543303b1.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="获取系统和硬件信息:gopsutil" />
<meta property="og:description" content="简介 gopsutil是 Python 工具库psutil 的 Golang 移植版，可以帮助我们方便地获取各种系统和硬件信息。gopsutil为我们屏蔽了各个系统之间的差" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E5%92%8C%E7%A1%AC%E4%BB%B6%E4%BF%A1%E6%81%AFgopsutil/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-15T14:31:30+00:00" />
<meta property="article:modified_time" content="2021-11-15T14:31:30+00:00" />

<meta itemprop="name" content="获取系统和硬件信息:gopsutil">
<meta itemprop="description" content="简介 gopsutil是 Python 工具库psutil 的 Golang 移植版，可以帮助我们方便地获取各种系统和硬件信息。gopsutil为我们屏蔽了各个系统之间的差"><meta itemprop="datePublished" content="2021-11-15T14:31:30+00:00" />
<meta itemprop="dateModified" content="2021-11-15T14:31:30+00:00" />
<meta itemprop="wordCount" content="4101">
<meta itemprop="keywords" content="Go," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="获取系统和硬件信息:gopsutil"/>
<meta name="twitter:description" content="简介 gopsutil是 Python 工具库psutil 的 Golang 移植版，可以帮助我们方便地获取各种系统和硬件信息。gopsutil为我们屏蔽了各个系统之间的差"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Forz Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Forz Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
      <a class="menu-item-link" href="/">Home</a>
    </li><li class="menu-item">
      <a class="menu-item-link" href="/post/">Archives</a>
    </li><li class="menu-item">
      <a class="menu-item-link" href="/tags/">Tags</a>
    </li><li class="menu-item">
      <a class="menu-item-link" href="/categories/">Categories</a>
    </li>
  </ul>
</nav><div class="docsearch-input__container">
  <input type="search" class="docsearch-input" placeholder="Search" />
</div>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">获取系统和硬件信息:gopsutil</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-11-15 </span>
        <div class="post-category">
            <a href="/categories/go/"> Go </a>
            </div>
          <span class="more-meta"> 约 4101 字 </span>
          <span class="more-meta"> 预计阅读 9 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#简介">简介</a></li>
    <li><a href="#快速使用">快速使用</a></li>
    <li><a href="#cpu">CPU</a></li>
    <li><a href="#详细信息">详细信息</a></li>
    <li><a href="#时间占用">时间占用</a></li>
    <li><a href="#磁盘">磁盘</a>
      <ul>
        <li><a href="#io-统计">IO 统计</a></li>
        <li><a href="#分区">分区</a></li>
        <li><a href="#使用率">使用率</a></li>
      </ul>
    </li>
    <li><a href="#主机">主机</a>
      <ul>
        <li><a href="#开机时间">开机时间</a></li>
        <li><a href="#内核版本和平台信息">内核版本和平台信息</a></li>
      </ul>
    </li>
    <li><a href="#终端用户">终端用户</a></li>
    <li><a href="#内存">内存</a></li>
    <li><a href="#进程">进程</a></li>
    <li><a href="#错误和超时">错误和超时</a></li>
    <li><a href="#转载">转载</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="简介">简介</h2>
<p>gopsutil是 Python 工具库psutil 的 Golang 移植版，可以帮助我们方便地获取各种系统和硬件信息。gopsutil为我们屏蔽了各个系统之间的差异，具有非常强悍的可移植性。有了gopsutil，我们不再需要针对不同的系统使用syscall调用对应的系统方法。更棒的是gopsutil的实现中没有任何cgo的代码，使得交叉编译成为可能。</p>
<h2 id="快速使用">快速使用</h2>
<p>先安装：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="n">go</span> <span class="n">get</span> <span class="n">github.com</span><span class="o">/</span><span class="n">shirou</span><span class="o">/</span><span class="n">gopsutil</span><span class="o">/</span><span class="n">v3</span>
</code></pre></td></tr></table>
</div>
</div><p>使用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
  <span class="s">&#34;fmt&#34;</span>

  <span class="s">&#34;github.com/shirou/gopsutil/v3/mem&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">v</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">mem</span><span class="p">.</span><span class="nf">VirtualMemory</span><span class="p">()</span>

  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Total: %v, Available: %v, UsedPercent:%f%%\n&#34;</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">Total</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">Available</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">UsedPercent</span><span class="p">)</span>

  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>gopsutil将不同的功能划分到不同的子包中：</p>
<ul>
<li>cpu：CPU 相关；</li>
<li>disk：磁盘相关；</li>
<li>docker：docker 相关；</li>
<li>host：主机相关；</li>
<li>mem：内存相关；</li>
<li>net：网络相关；</li>
<li>process：进程相关；</li>
<li>winservices：Windows 服务相关。</li>
</ul>
<p>想要使用对应的功能，要导入对应的子包。例如，上面代码中，我们要获取内存信息，导入的是mem子包。mem.VirtualMemory()方法返回内存信息结构mem.VirtualMemoryStat，该结构有丰富的字段，我们最常使用的无外乎Total（总内存）、Available（可用内存）、Used（已使用内存）和UsedPercent（内存使用百分比）。mem.VirtualMemoryStat还实现了fmt.Stringer接口，以 JSON 格式返回内存信息。语句fmt.Println(v)会自动调用v.String()，将返回信息输出。程序输出：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="n">Total</span><span class="o">:</span> <span class="m">8526921728</span><span class="p">,</span> <span class="n">Available</span><span class="o">:</span> <span class="m">3768975360</span><span class="p">,</span> <span class="n">UsedPercent</span><span class="o">:</span><span class="m">55.000000</span>%
<span class="p">{</span><span class="s">&#34;total&#34;</span><span class="o">:</span><span class="m">8526921728</span><span class="p">,</span><span class="s">&#34;available&#34;</span><span class="o">:</span><span class="m">3768975360</span><span class="p">,</span><span class="s">&#34;used&#34;</span><span class="o">:</span><span class="m">4757946368</span><span class="p">,</span><span class="s">&#34;usedPercent&#34;</span><span class="o">:</span><span class="m">55</span><span class="p">,</span><span class="s">&#34;free&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;active&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;inactive&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;wired&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;laundry&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;buffers&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;cached&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;writeback&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;dirty&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;writebacktmp&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;shared&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;slab&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;sreclaimable&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;sunreclaim&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;pagetables&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;swapcached&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;commitlimit&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;committedas&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;hightotal&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;highfree&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;lowtotal&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;lowfree&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;swaptotal&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;swapfree&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;mapped&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;vmalloctotal&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;vmallocused&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;vmallocchunk&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;hugepagestotal&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;hugepagesfree&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">,</span><span class="s">&#34;hugepagesize&#34;</span><span class="o">:</span><span class="m">0</span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>单位为字节，我的电脑内存 8GB，当前使用百分比为 55%，可用内存 3768975360B（即 3.51GB）。</p>
<h2 id="cpu">CPU</h2>
<p>我们知道 CPU 的核数有两种，一种是物理核数，一种是逻辑核数。物理核数就是主板上实际有多少个 CPU，一个物理 CPU 上可以有多个核心，这些核心被称为逻辑核。gopsutil中 CPU 相关功能在cpu子包中，cpu子包提供了获取物理和逻辑核数、CPU 使用率的接口：</p>
<ul>
<li>Counts(logical bool)：传入false，返回物理核数，传入true，返回逻辑核数；</li>
<li>Percent(interval time.Duration, percpu bool)：表示获取interval时间间隔内的 CPU 使用率，percpu为false时，获取总的 CPU 使用率，percpu为true时，分别获取每个 CPU 的使用率，返回一个[]float64类型的值。
例如：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;time&#34;</span>

	<span class="s">&#34;github.com/shirou/gopsutil/v3/cpu&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">physicalCnt</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cpu</span><span class="p">.</span><span class="nf">Counts</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
	<span class="nx">logicalCnt</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cpu</span><span class="p">.</span><span class="nf">Counts</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;physical count:%d logical count:%d\n&#34;</span><span class="p">,</span> <span class="nx">physicalCnt</span><span class="p">,</span> <span class="nx">logicalCnt</span><span class="p">)</span>

	<span class="nx">totalPercent</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cpu</span><span class="p">.</span><span class="nf">Percent</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
	<span class="nx">perPercents</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cpu</span><span class="p">.</span><span class="nf">Percent</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;total percent:%v per percents:%v&#34;</span><span class="p">,</span> <span class="nx">totalPercent</span><span class="p">,</span> <span class="nx">perPercents</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>上面代码获取物理核数和逻辑核数，并获取 3s 内的总 CPU 使用率和每个 CPU 各自的使用率，程序输出（注意每次运行输出可能都不相同）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="n">physical</span> <span class="n">count</span><span class="o">:</span><span class="m">4</span> <span class="n">logical</span> <span class="n">count</span><span class="o">:</span><span class="m">8</span>
<span class="n">total</span> <span class="n">percent</span><span class="o">:</span><span class="n">[30.729166666666668]</span> <span class="n">per</span> <span class="n">percents</span><span class="o">:</span><span class="n">[32.64248704663213</span> <span class="m">26.94300518134715</span> <span class="m">44.559585492227974</span> <span class="m">23.958333333333336</span> <span class="m">36.787564766839374</span> <span class="m">20.3125</span> <span class="m">38.54166666666667</span> <span class="m">28.125</span><span class="n">]</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="详细信息">详细信息</h2>
<p>调用cpu.Info()可获取 CPU 的详细信息，返回[]cpu.InfoStat：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;encoding/json&#34;</span>
	<span class="s">&#34;fmt&#34;</span>

	<span class="s">&#34;github.com/shirou/gopsutil/v3/cpu&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">infos</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cpu</span><span class="p">.</span><span class="nf">Info</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">info</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">infos</span> <span class="p">{</span>
		<span class="nx">data</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">MarshalIndent</span><span class="p">(</span><span class="nx">info</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">)</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
	<span class="p">}</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>为了方便查看，我使用 JSON 输出结果：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">{</span>
 <span class="s">&#34;cpu&#34;</span><span class="o">:</span> <span class="m">0</span><span class="p">,</span>
 <span class="s">&#34;vendorId&#34;</span><span class="o">:</span> <span class="s">&#34;GenuineIntel&#34;</span><span class="p">,</span>
 <span class="s">&#34;family&#34;</span><span class="o">:</span> <span class="s">&#34;198&#34;</span><span class="p">,</span>
 <span class="s">&#34;model&#34;</span><span class="o">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span>
 <span class="s">&#34;stepping&#34;</span><span class="o">:</span> <span class="m">0</span><span class="p">,</span>
 <span class="s">&#34;physicalId&#34;</span><span class="o">:</span> <span class="s">&#34;BFEBFBFF000906E9&#34;</span><span class="p">,</span>
 <span class="s">&#34;coreId&#34;</span><span class="o">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span>
 <span class="s">&#34;cores&#34;</span><span class="o">:</span> <span class="m">8</span><span class="p">,</span>
 <span class="s">&#34;modelName&#34;</span><span class="o">:</span> <span class="s">&#34;Intel(R) Core(TM) i7-7700 CPU @ 3.60GHz&#34;</span><span class="p">,</span>
 <span class="s">&#34;mhz&#34;</span><span class="o">:</span> <span class="m">3601</span><span class="p">,</span>
 <span class="s">&#34;cacheSize&#34;</span><span class="o">:</span> <span class="m">0</span><span class="p">,</span>
 <span class="s">&#34;flags&#34;</span><span class="o">:</span> <span class="n">[]</span><span class="p">,</span>
 <span class="s">&#34;microcode&#34;</span><span class="o">:</span> <span class="s">&#34;&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>由结果可以看出，CPU 是 Intel 的 i7-7700 系列，频率 3.60GHz。上面是我在 Windows 上运行的返回结果，内部使用了github.com/StackExchange/wmi库。在 Linux 下每个逻辑 CPU 都会返回一个InfoStat结构。</p>
<h2 id="时间占用">时间占用</h2>
<p>调用<code>cpu.Times(percpu bool)</code>可以获取从开机算起，总 CPU 和 每个单独的 CPU 时间占用情况。传入<code>percpu=false</code>返回总的，传入<code>percpu=true</code>返回单个的。每个 CPU 时间占用情况是一个TimeStat结构：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// src/github.com/shirou/gopsutil/cpu/cpu.go
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">TimesStat</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">CPU</span>       <span class="kt">string</span>  <span class="s">`json:&#34;cpu&#34;`</span>
  <span class="nx">User</span>      <span class="kt">float64</span> <span class="s">`json:&#34;user&#34;`</span>
  <span class="nx">System</span>    <span class="kt">float64</span> <span class="s">`json:&#34;system&#34;`</span>
  <span class="nx">Idle</span>      <span class="kt">float64</span> <span class="s">`json:&#34;idle&#34;`</span>
  <span class="nx">Nice</span>      <span class="kt">float64</span> <span class="s">`json:&#34;nice&#34;`</span>
  <span class="nx">Iowait</span>    <span class="kt">float64</span> <span class="s">`json:&#34;iowait&#34;`</span>
  <span class="nx">Irq</span>       <span class="kt">float64</span> <span class="s">`json:&#34;irq&#34;`</span>
  <span class="nx">Softirq</span>   <span class="kt">float64</span> <span class="s">`json:&#34;softirq&#34;`</span>
  <span class="nx">Steal</span>     <span class="kt">float64</span> <span class="s">`json:&#34;steal&#34;`</span>
  <span class="nx">Guest</span>     <span class="kt">float64</span> <span class="s">`json:&#34;guest&#34;`</span>
  <span class="nx">GuestNice</span> <span class="kt">float64</span> <span class="s">`json:&#34;guestNice&#34;`</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>CPU：CPU 标识，如果是总的，该字段为cpu-total，否则为cpu0、cpu1&hellip;；</li>
<li>User：用户时间占用（用户态）；</li>
<li>System：系统时间占用（内核态）；</li>
<li>Idle：空闲时间；</li>
<li>&hellip;</li>
</ul>
<p>例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;encoding/json&#34;</span>
	<span class="s">&#34;fmt&#34;</span>

	<span class="s">&#34;github.com/shirou/gopsutil/v3/cpu&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">infos</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cpu</span><span class="p">.</span><span class="nf">Times</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">info</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">infos</span> <span class="p">{</span>
		<span class="nx">data</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">MarshalIndent</span><span class="p">(</span><span class="nx">info</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">)</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>为了方便查看，我用 JSON 输出结果，下面是其中一个输出：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="p">{</span>
 <span class="s">&#34;cpu&#34;</span><span class="p">:</span> <span class="s">&#34;cpu0&#34;</span><span class="p">,</span>
 <span class="s">&#34;user&#34;</span><span class="p">:</span> <span class="mf">674.46875</span><span class="p">,</span>
 <span class="s">&#34;system&#34;</span><span class="p">:</span> <span class="mf">1184.984375</span><span class="p">,</span>
 <span class="s">&#34;idle&#34;</span><span class="p">:</span> <span class="mf">7497.1875</span><span class="p">,</span>
 <span class="s">&#34;nice&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s">&#34;iowait&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s">&#34;irq&#34;</span><span class="p">:</span> <span class="mf">75.578125</span><span class="p">,</span>
 <span class="s">&#34;softirq&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s">&#34;steal&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s">&#34;guest&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s">&#34;guestNice&#34;</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="磁盘">磁盘</h2>
<p>子包disk用于获取磁盘信息。disk可获取 IO 统计、分区和使用率信息。下面依次介绍。</p>
<h3 id="io-统计">IO 统计</h3>
<p>调用disk.IOCounters()函数，返回的 IO 统计信息用<code>map[string]IOCountersStat</code>类型表示。每个分区一个结构，键为分区名，值为统计信息。这里摘取统计结构的部分字段，主要有读写的次数、字节数和时间：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// src/github.com/shirou/gopsutil/disk/disk.go
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">IOCountersStat</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">ReadCount</span>        <span class="kt">uint64</span> <span class="s">`json:&#34;readCount&#34;`</span>
  <span class="nx">MergedReadCount</span>  <span class="kt">uint64</span> <span class="s">`json:&#34;mergedReadCount&#34;`</span>
  <span class="nx">WriteCount</span>       <span class="kt">uint64</span> <span class="s">`json:&#34;writeCount&#34;`</span>
  <span class="nx">MergedWriteCount</span> <span class="kt">uint64</span> <span class="s">`json:&#34;mergedWriteCount&#34;`</span>
  <span class="nx">ReadBytes</span>        <span class="kt">uint64</span> <span class="s">`json:&#34;readBytes&#34;`</span>
  <span class="nx">WriteBytes</span>       <span class="kt">uint64</span> <span class="s">`json:&#34;writeBytes&#34;`</span>
  <span class="nx">ReadTime</span>         <span class="kt">uint64</span> <span class="s">`json:&#34;readTime&#34;`</span>
  <span class="nx">WriteTime</span>        <span class="kt">uint64</span> <span class="s">`json:&#34;writeTime&#34;`</span>
  <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;encoding/json&#34;</span>
	<span class="s">&#34;fmt&#34;</span>

	<span class="s">&#34;github.com/shirou/gopsutil/v3/disk&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">mapStat</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">disk</span><span class="p">.</span><span class="nf">IOCounters</span><span class="p">()</span>
	<span class="k">for</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">stat</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">mapStat</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
		<span class="nx">data</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">MarshalIndent</span><span class="p">(</span><span class="nx">stat</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;  &#34;</span><span class="p">)</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
	<span class="p">}</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>输出包括所有分区，我这里只展示一个：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="n">disk0</span>
<span class="p">{</span>
  <span class="s">&#34;readCount&#34;</span><span class="o">:</span> <span class="m">8972465</span><span class="p">,</span>
  <span class="s">&#34;mergedReadCount&#34;</span><span class="o">:</span> <span class="m">0</span><span class="p">,</span>
  <span class="s">&#34;writeCount&#34;</span><span class="o">:</span> <span class="m">5391828</span><span class="p">,</span>
  <span class="s">&#34;mergedWriteCount&#34;</span><span class="o">:</span> <span class="m">0</span><span class="p">,</span>
  <span class="s">&#34;readBytes&#34;</span><span class="o">:</span> <span class="m">148790292480</span><span class="p">,</span>
  <span class="s">&#34;writeBytes&#34;</span><span class="o">:</span> <span class="m">93101379584</span><span class="p">,</span>
  <span class="s">&#34;readTime&#34;</span><span class="o">:</span> <span class="m">4216707</span><span class="p">,</span>
  <span class="s">&#34;writeTime&#34;</span><span class="o">:</span> <span class="m">375163</span><span class="p">,</span>
  <span class="s">&#34;iopsInProgress&#34;</span><span class="o">:</span> <span class="m">0</span><span class="p">,</span>
  <span class="s">&#34;ioTime&#34;</span><span class="o">:</span> <span class="m">4591871</span><span class="p">,</span>
  <span class="s">&#34;weightedIO&#34;</span><span class="o">:</span> <span class="m">0</span><span class="p">,</span>
  <span class="s">&#34;name&#34;</span><span class="o">:</span> <span class="s">&#34;disk0&#34;</span><span class="p">,</span>
  <span class="s">&#34;serialNumber&#34;</span><span class="o">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span>
  <span class="s">&#34;label&#34;</span><span class="o">:</span> <span class="s">&#34;&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>注意，disk.IOCounters()可传入可变数量的字符串参数用于标识分区，此参数在 Windows 上无效。</p>
<h3 id="分区">分区</h3>
<p>调用disk.PartitionStat(all bool)函数，返回分区信息。如果all = false，只返回实际的物理分区（包括硬盘、CD-ROM、USB），忽略其它的虚拟分区。如果all = true则返回所有的分区。返回类型为[]PartitionStat，每个分区对应一个PartitionStat结构：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// src/github.com/shirou/gopsutil/disk/
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">PartitionStat</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">Device</span>     <span class="kt">string</span> <span class="s">`json:&#34;device&#34;`</span>
  <span class="nx">Mountpoint</span> <span class="kt">string</span> <span class="s">`json:&#34;mountpoint&#34;`</span>
  <span class="nx">Fstype</span>     <span class="kt">string</span> <span class="s">`json:&#34;fstype&#34;`</span>
  <span class="nx">Opts</span>       <span class="kt">string</span> <span class="s">`json:&#34;opts&#34;`</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Device：分区标识，在 Windows 上即为C:这类格式；</li>
<li>Mountpoint：挂载点，即该分区的文件路径起始位置；</li>
<li>Fstype：文件系统类型，Windows 常用的有 FAT、NTFS 等，Linux 有 ext、ext2、ext3等；</li>
<li>Opts：选项，与系统相关。
例如：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;encoding/json&#34;</span>
	<span class="s">&#34;fmt&#34;</span>

	<span class="s">&#34;github.com/shirou/gopsutil/v3/disk&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">infos</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">disk</span><span class="p">.</span><span class="nf">Partitions</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">info</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">infos</span> <span class="p">{</span>
		<span class="nx">data</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">MarshalIndent</span><span class="p">(</span><span class="nx">info</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;  &#34;</span><span class="p">)</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>我的 Windows 机器输出（只展示第一个分区）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">{</span>
  <span class="s">&#34;device&#34;</span><span class="o">:</span> <span class="s">&#34;C:&#34;</span><span class="p">,</span>
  <span class="s">&#34;mountpoint&#34;</span><span class="o">:</span> <span class="s">&#34;C:&#34;</span><span class="p">,</span>
  <span class="s">&#34;fstype&#34;</span><span class="o">:</span> <span class="s">&#34;NTFS&#34;</span><span class="p">,</span>
  <span class="s">&#34;opts&#34;</span><span class="o">:</span> <span class="s">&#34;rw.compress&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>由上面的输出可知，我的第一个分区为C:，文件系统类型为NTFS。</p>
<h3 id="使用率">使用率</h3>
<p>调用<code>disk.Usage(path string)</code>即可获得路径path所在磁盘的使用情况，返回一个UsageStat结构：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// src/github.com/shirou/gopsutil/disk.go
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">UsageStat</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">Path</span>              <span class="kt">string</span>  <span class="s">`json:&#34;path&#34;`</span>
  <span class="nx">Fstype</span>            <span class="kt">string</span>  <span class="s">`json:&#34;fstype&#34;`</span>
  <span class="nx">Total</span>             <span class="kt">uint64</span>  <span class="s">`json:&#34;total&#34;`</span>
  <span class="nx">Free</span>              <span class="kt">uint64</span>  <span class="s">`json:&#34;free&#34;`</span>
  <span class="nx">Used</span>              <span class="kt">uint64</span>  <span class="s">`json:&#34;used&#34;`</span>
  <span class="nx">UsedPercent</span>       <span class="kt">float64</span> <span class="s">`json:&#34;usedPercent&#34;`</span>
  <span class="nx">InodesTotal</span>       <span class="kt">uint64</span>  <span class="s">`json:&#34;inodesTotal&#34;`</span>
  <span class="nx">InodesUsed</span>        <span class="kt">uint64</span>  <span class="s">`json:&#34;inodesUsed&#34;`</span>
  <span class="nx">InodesFree</span>        <span class="kt">uint64</span>  <span class="s">`json:&#34;inodesFree&#34;`</span>
  <span class="nx">InodesUsedPercent</span> <span class="kt">float64</span> <span class="s">`json:&#34;inodesUsedPercent&#34;`</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Path：路径，传入的参数；</li>
<li>Fstype：文件系统类型；</li>
<li>Total：该分区总容量；</li>
<li>Free：空闲容量；</li>
<li>Used：已使用的容量；</li>
<li>UsedPercent：使用百分比。</li>
</ul>
<p>例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;encoding/json&#34;</span>
	<span class="s">&#34;fmt&#34;</span>

	<span class="s">&#34;github.com/shirou/gopsutil/v3/disk&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">info</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">disk</span><span class="p">.</span><span class="nf">Usage</span><span class="p">(</span><span class="s">&#34;D:/code/golang&#34;</span><span class="p">)</span>
	<span class="nx">data</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">MarshalIndent</span><span class="p">(</span><span class="nx">info</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;  &#34;</span><span class="p">)</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>由于返回的是磁盘的使用情况，所以路径D:/code/golang和D:返回同样的结果，只是结构中的Path字段不同而已。程序输出：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="p">{</span>
  <span class="s">&#34;path&#34;</span><span class="o">:</span> <span class="s">&#34;D:/code/golang&#34;</span><span class="p">,</span>
  <span class="s">&#34;fstype&#34;</span><span class="o">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span>
  <span class="s">&#34;total&#34;</span><span class="o">:</span> <span class="m">475779821568</span><span class="p">,</span>
  <span class="s">&#34;free&#34;</span><span class="o">:</span> <span class="m">385225650176</span><span class="p">,</span>
  <span class="s">&#34;used&#34;</span><span class="o">:</span> <span class="m">90554171392</span><span class="p">,</span>
  <span class="s">&#34;usedPercent&#34;</span><span class="o">:</span> <span class="m">19.032789388496106</span><span class="p">,</span>
  <span class="s">&#34;inodesTotal&#34;</span><span class="o">:</span> <span class="m">0</span><span class="p">,</span>
  <span class="s">&#34;inodesUsed&#34;</span><span class="o">:</span> <span class="m">0</span><span class="p">,</span>
  <span class="s">&#34;inodesFree&#34;</span><span class="o">:</span> <span class="m">0</span><span class="p">,</span>
  <span class="s">&#34;inodesUsedPercent&#34;</span><span class="o">:</span> <span class="m">0</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="主机">主机</h2>
<p>子包host可以获取主机相关信息，如开机时间、内核版本号、平台信息等等。</p>
<h3 id="开机时间">开机时间</h3>
<p>host.BootTime()返回主机开机时间的时间戳：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;time&#34;</span>

	<span class="s">&#34;github.com/shirou/gopsutil/v3/host&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">timestamp</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">host</span><span class="p">.</span><span class="nf">BootTime</span><span class="p">()</span>
	<span class="nx">t</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Unix</span><span class="p">(</span><span class="nb">int64</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nf">Local</span><span class="p">().</span><span class="nf">Format</span><span class="p">(</span><span class="s">&#34;2006-01-02 15:04:05&#34;</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>上面先获取开机时间，然后通过time.Unix()将其转为time.Time类型，最后输出2006-01-02 15:04:05格式的时间：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="m">2020-04-06</span> <span class="m">20</span><span class="o">:</span><span class="m">25</span><span class="o">:</span><span class="m">32</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="内核版本和平台信息">内核版本和平台信息</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">version</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">host</span><span class="p">.</span><span class="nf">KernelVersion</span><span class="p">()</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">version</span><span class="p">)</span>

  <span class="nx">platform</span><span class="p">,</span> <span class="nx">family</span><span class="p">,</span> <span class="nx">version</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">host</span><span class="p">.</span><span class="nf">PlatformInformation</span><span class="p">()</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;platform:&#34;</span><span class="p">,</span> <span class="nx">platform</span><span class="p">)</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;family:&#34;</span><span class="p">,</span> <span class="nx">family</span><span class="p">,</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;version:&#34;</span><span class="p">,</span> <span class="nx">version</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在我的 Win10 上运行输出：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="m">10.0.18362</span> <span class="n">Build</span> <span class="m">18362</span>
<span class="n">platform</span><span class="o">:</span> <span class="n">Microsoft</span> <span class="n">Windows</span> <span class="m">10</span> <span class="n">Pro</span>
<span class="n">family</span><span class="o">:</span> <span class="n">Standalone</span> <span class="n">Workstation</span>
<span class="n">version</span><span class="o">:</span> <span class="m">10.0.18362</span> <span class="n">Build</span> <span class="m">18362</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="终端用户">终端用户</h2>
<p>host.Users()返回终端连接上来的用户信息，每个用户一个UserStat结构：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// src/github.com/shirou/gopsutil/host/host.go
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">UserStat</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">User</span>     <span class="kt">string</span> <span class="s">`json:&#34;user&#34;`</span>
  <span class="nx">Terminal</span> <span class="kt">string</span> <span class="s">`json:&#34;terminal&#34;`</span>
  <span class="nx">Host</span>     <span class="kt">string</span> <span class="s">`json:&#34;host&#34;`</span>
  <span class="nx">Started</span>  <span class="kt">int</span>    <span class="s">`json:&#34;started&#34;`</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>字段一目了然，看示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">users</span><span class="p">,</span> <span class="nx">_</span><span class="o">:=</span> <span class="nx">host</span><span class="p">.</span><span class="nf">Users</span><span class="p">()</span>
<span class="nx">for_</span><span class="p">,</span> <span class="nx">user</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">users</span> <span class="p">{</span>
    <span class="nx">data</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">MarshalIndent</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="内存">内存</h2>
<p>在快速开始中，我们演示了如何使用<code>mem.VirtualMemory()</code>来获取内存信息。该函数返回的只是物理内存信息。我们还可以使用<code>mem.SwapMemory()</code>获取交换内存的信息，信息存储在结构SwapMemoryStat中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// src/github.com/shirou/gopsutil/mem/
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">SwapMemoryStat</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">Total</span>       <span class="kt">uint64</span>  <span class="s">`json:&#34;total&#34;`</span>
  <span class="nx">Used</span>        <span class="kt">uint64</span>  <span class="s">`json:&#34;used&#34;`</span>
  <span class="nx">Free</span>        <span class="kt">uint64</span>  <span class="s">`json:&#34;free&#34;`</span>
  <span class="nx">UsedPercent</span> <span class="kt">float64</span> <span class="s">`json:&#34;usedPercent&#34;`</span>
  <span class="nx">Sin</span>         <span class="kt">uint64</span>  <span class="s">`json:&#34;sin&#34;`</span>
  <span class="nx">Sout</span>        <span class="kt">uint64</span>  <span class="s">`json:&#34;sout&#34;`</span>
  <span class="nx">PgIn</span>        <span class="kt">uint64</span>  <span class="s">`json:&#34;pgin&#34;`</span>
  <span class="nx">PgOut</span>       <span class="kt">uint64</span>  <span class="s">`json:&#34;pgout&#34;`</span>
  <span class="nx">PgFault</span>     <span class="kt">uint64</span>  <span class="s">`json:&#34;pgfault&#34;`</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>字段含义很容易理解，<code>PgIn/PgOut/PgFault</code>这三个字段我们重点介绍一下。交换内存是以页为单位的，如果出现缺页错误(page fault)，操作系统会将磁盘中的某些页载入内存，同时会根据特定的机制淘汰一些内存中的页。PgIn表征载入页数，PgOut淘汰页数，PgFault缺页错误数。</p>
<p>例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;encoding/json&#34;</span>
	<span class="s">&#34;fmt&#34;</span>

	<span class="s">&#34;github.com/shirou/gopsutil/v3/mem&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">swapMemory</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">mem</span><span class="p">.</span><span class="nf">SwapMemory</span><span class="p">()</span>
	<span class="nx">data</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">MarshalIndent</span><span class="p">(</span><span class="nx">swapMemory</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">)</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><h2 id="进程">进程</h2>
<p>process可用于获取系统当前运行的进程信息，创建新进程，对进程进行一些操作等。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>

	<span class="s">&#34;github.com/shirou/gopsutil/process&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">rootProcess</span> <span class="o">*</span><span class="nx">process</span><span class="p">.</span><span class="nx">Process</span>
	<span class="nx">processes</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">process</span><span class="p">.</span><span class="nf">Processes</span><span class="p">()</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">p</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">processes</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">p</span><span class="p">.</span><span class="nx">Pid</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
			<span class="nx">rootProcess</span> <span class="p">=</span> <span class="nx">p</span>
			<span class="k">break</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">rootProcess</span><span class="p">)</span>

	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;children:&#34;</span><span class="p">)</span>
	<span class="nx">children</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">rootProcess</span><span class="p">.</span><span class="nf">Children</span><span class="p">()</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">p</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">children</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>先调用process.Processes()获取当前系统中运行的所有进程，然后找到Pid为 0 的进程，即操作系统的第一个进程，最后调用Children()返回其子进程。还有很多方法可获取进程信息，感兴趣可查看文档了解~</p>
<h2 id="错误和超时">错误和超时</h2>
<p>由于大部分函数都涉及到底层的系统调用，所以发生错误和超时是在所难免的。几乎所有的接口都有两个返回值，第二个作为错误。在前面的例子中，我们为了简化代码都忽略了错误，在实际使用中，建议对错误进行处理。</p>
<p>另外，大部分接口都是一对，一个不带context.Context类型的参数，另一个带有该类型参数，用于做上下文控制。在内部调用发生错误或超时后能及时处理，避免长时间等待返回。实际上，不带context.Context参数的函数内部都是以context.Background()为参数调用带有context.Context的函数的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// src/github.com/shirou/gopsutil/cpu_windows.go
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Times</span><span class="p">(</span><span class="nx">percpu</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">([]</span><span class="nx">TimesStat</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">TimesWithContext</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="nx">percpu</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">TimesWithContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">percpu</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">([]</span><span class="nx">TimesStat</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="转载">转载</h2>
<p><a href="https://zhuanlan.zhihu.com/p/126362239">Go 每日一库之 gopsutil</a></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Forz</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2021-11-15
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/go/">Go</a>
          </div>
      <nav class="post-nav">
        
        <a class="next" href="/post/bbr%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0/">
            <span class="next-text nav-default">BBR自适应限流算法实现</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="forz/forzblog.talk"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2021<span class="heart"><i class="iconfont icon-heart"></i></span><span>Forz</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>






<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
docsearch({
    apiKey: "b4b9da2eba53aa6dabe4b8ac9e8676e1",
    indexName: "forz.forzvina.com",
    appId: "IAR2EF5L65",
    inputSelector: '.docsearch-input',
    debug: false,
});
</script>
</body>
</html>
