<!DOCTYPE html>
<html lang="zh-cn" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Go语言快速解析JSON:gjson | Forz Blog</title>
<meta name="keywords" content="gjson" />
<meta name="description" content="前言 GJSON是一个Go包，它提供了一种快速，简单的方法来从json文档中获取值。它具有诸如单行检索，点符号路径，迭代和解析json行之类的">
<meta name="author" content="">
<link rel="canonical" href="/post/go%E8%AF%AD%E8%A8%80%E5%BF%AB%E9%80%9F%E8%A7%A3%E6%9E%90jsongjson/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.00d5d4fc479b1575183ee8d86b4fb372ba9d9b1904e96fa8e4c40ff7debe2b94.css" integrity="sha256-ANXU/EebFXUYPujYa0&#43;zcrqdmxkE6W&#43;o5MQP996&#43;K5Q=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.87.0" />
<meta property="og:title" content="Go语言快速解析JSON:gjson" />
<meta property="og:description" content="前言 GJSON是一个Go包，它提供了一种快速，简单的方法来从json文档中获取值。它具有诸如单行检索，点符号路径，迭代和解析json行之类的" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/go%E8%AF%AD%E8%A8%80%E5%BF%AB%E9%80%9F%E8%A7%A3%E6%9E%90jsongjson/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2019-12-23T19:38:12&#43;00:00" />
<meta property="article:modified_time" content="2019-12-23T19:38:12&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go语言快速解析JSON:gjson"/>
<meta name="twitter:description" content="前言 GJSON是一个Go包，它提供了一种快速，简单的方法来从json文档中获取值。它具有诸如单行检索，点符号路径，迭代和解析json行之类的"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "/post/"
    }
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Go语言快速解析JSON:gjson",
      "item": "/post/go%E8%AF%AD%E8%A8%80%E5%BF%AB%E9%80%9F%E8%A7%A3%E6%9E%90jsongjson/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Go语言快速解析JSON:gjson",
  "name": "Go语言快速解析JSON:gjson",
  "description": "前言 GJSON是一个Go包，它提供了一种快速，简单的方法来从json文档中获取值。它具有诸如单行检索，点符号路径，迭代和解析json行之类的",
  "keywords": [
    "gjson"
  ],
  "articleBody": "前言 GJSON是一个Go包，它提供了一种快速，简单的方法来从json文档中获取值。它具有诸如单行检索，点符号路径，迭代和解析json行之类的功能。\n获得值 获取搜索json以查找指定的路径。路径采用点语法，例如“name.last”或“age”。找到该值后，将立即返回。\n1 2 3 4 5 6 7 8 9 10  package main import \"github.com/tidwall/gjson\" const json = `{\"name\":{\"first\":\"Janet\",\"last\":\"Prichard\"},\"age\":47}` func main() { value := gjson.Get(json, \"name.last\") println(value.String()) }   1  Prichard   还有一个GetMany函数可以一次获取多个值，还有GetBytes用于处理JSON字节片。\nGJSON路径语法 路径结构 GJSON Path旨在易于表达为一系列由.字符分隔的组件。\n除了.还有一些具有特殊含义，包括几个|，#，@，\\，*，和?。\n举例 给定此JSON\n1 2 3 4 5 6 7 8 9 10 11  { \"name\": {\"first\": \"Tom\", \"last\": \"Anderson\"}, \"age\":37, \"children\": [\"Sara\",\"Alex\",\"Jack\"], \"fav.movie\": \"Deer Hunter\", \"friends\": [ {\"first\": \"Dale\", \"last\": \"Murphy\", \"age\": 44, \"nets\": [\"ig\", \"fb\", \"tw\"]}, {\"first\": \"Roger\", \"last\": \"Craig\", \"age\": 68, \"nets\": [\"fb\", \"tw\"]}, {\"first\": \"Jane\", \"last\": \"Murphy\", \"age\": 47, \"nets\": [\"ig\", \"tw\"]} ] }   以下GJSON路径将评估为随附的值。\n基本的 在许多情况下，您只想按对象名称或数组索引检索值。\n1 2 3 4 5 6 7 8  name.last \"Anderson\" name.first \"Tom\" age 37 children [\"Sara\",\"Alex\",\"Jack\"] children.0 \"Sara\" children.1 \"Alex\" friends.1 {\"first\": \"Roger\", \"last\": \"Craig\", \"age\": 68} friends.1.first \"Roger\"   通配符 key可能包含特殊的通配符*和?。*匹配任何0个以上的字符字符，?匹配任意一个字符。\n1 2  child*.2 \"Jack\" c?ildren.0 \"Sara\"   转义符 特殊用途的字符，例如.，*和?可以进行转义\\。\n1  fav\\.movie \"Deer Hunter\"   数组 #字符允许挖掘JSON数组。\n要获得数组的长度，可以单独使用#。\n1 2  friends.# 3 friends.#.age [44,68,47]   查询 您也可以使用#(...)来查询数组中的第一个匹配项，或者使用#(...)#查找所有匹配项。查询支持==，!=，，，，=比较运算符，和简单模式匹配%（like）和!%（not like）。\n1 2 3 4 5  friends.#(last==\"Murphy\").first \"Dale\" friends.#(last==\"Murphy\")#.first [\"Dale\",\"Jane\"] friends.#(age45)#.last [\"Craig\",\"Murphy\"] friends.#(first%\"D*\").last \"Murphy\" friends.#(first!%\"D*\").last \"Craig\"   要查询数组中的非对象值，可以放弃运算符右侧的字符串。\n1 2  children.#(!%\"*a*\") \"Alex\" children.#(%\"*a*\")# [\"Sara\",\"Jack\"]   允许嵌套查询。\n1  friends.#(nets.#(==\"fb\"))#.first  [\"Dale\",\"Roger\"]   请注意，在v1.3.0之前，查询使用#[...]方括号。为了避免与新的多路径语法混淆，在v1.3.0中对此进行了更改。为了向后兼容，#[...]它将继续工作直到下一个主要版本。\n. vs | .是标准的分隔符，但它也可以使用|。在大多数情况下，它们最终都返回相同的结果。当为了Arrays 和 Queries而在#之后使用时,|和.表现不同。\n这里有些例子\n1 2 3 4 5 6 7 8 9 10 11 12 13  friends.0.first \"Dale\" friends|0.first \"Dale\" friends.0|first \"Dale\" friends|0|first \"Dale\" friends|# 3 friends.# 3 friends.#(last=\"Murphy\")# [{\"first\": \"Dale\", \"last\": \"Murphy\", \"age\": 44},{\"first\": \"Jane\", \"last\": \"Murphy\", \"age\": 47}] friends.#(last=\"Murphy\")#.first [\"Dale\",\"Jane\"] friends.#(last=\"Murphy\")#|first  friends.#(last=\"Murphy\")#.0 [] friends.#(last=\"Murphy\")#|0 {\"first\": \"Dale\", \"last\": \"Murphy\", \"age\": 44} friends.#(last=\"Murphy\")#.# [] friends.#(last=\"Murphy\")#|# 2   让我们分析其中的一些。\n路径friends.#(last=\"Murphy\")#导致\n1  [{\"first\": \"Dale\", \"last\": \"Murphy\", \"age\": 44},{\"first\": \"Jane\", \"last\": \"Murphy\", \"age\": 47}]   所述.first后缀将处理first每个阵列元素上路径之前将结果返回。变成\n1  [\"Dale\",\"Jane\"]   但是|first后缀实际上是在前一个结果之后处理first路径。由于前一个结果是数组，而不是对象，因此无法处理，因为first不存在\n后缀|0返回\n1  {\"first\": \"Dale\", \"last\": \"Murphy\", \"age\": 44}   因为0是先前结果的第一个索引。\n修饰符 修饰符是对JSON执行自定义处理的路径组件。\n例如，@reverse在上述JSON有效负载上使用内置修饰符将反转children数组：\n1 2  children.@reverse [\"Jack\",\"Alex\",\"Sara\"] children.@reverse.0 \"Jack\"   当前有三个内置修饰符：\n @reverse：反转数组或对象的成员。 @ugly：从JSON中删除所有空格。 @pretty：使JSON更具可读性。  修饰符参数 修饰符可以接受可选参数。参数可以是有效的JSON有效负载，也可以只是字符。\n例如，@pretty修饰符将json对象作为其参数。\n1  @pretty:{\"sortKeys\":true}   这使得json很漂亮，并对其所有key进行排序。\n使用此示例：\n1 2 3 4 5  {\"name\": {\"first\":\"Tom\",\"last\":\"Anderson\"}, \"age\":37, \"children\": [\"Sara\",\"Alex\",\"Jack\"], \"fav.movie\": \"Deer Hunter\", \"friends\": [ {\"first\": \"Janet\", \"last\": \"Murphy\", \"age\": 44} ]}   将json格式化为：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  { \"name\": { \"first\": \"Tom\", \"last\": \"Anderson\" }, \"age\": 37, \"children\": [\"Sara\", \"Alex\", \"Jack\"], \"fav.movie\": \"Deer Hunter\", \"friends\": [ { \"first\": \"Janet\", \"last\": \"Murphy\", \"age\": 44 } ] }   @pretty选项的完整列表是sortKeys, indent, prefix和width。\n自定义修饰符 您还可以添加自定义修饰符。\n例如，在这里我们创建一个修饰符，使整个JSON有效负载变为大写或小写。\n1 2 3 4 5 6 7 8 9 10 11  gjson.AddModifier(\"case\", func(json, arg string) string { if arg == \"upper\" { return strings.ToUpper(json) } if arg == \"lower\" { return strings.ToLower(json) } return json }) \"children.@case:upper\" [\"SARA\",\"ALEX\",\"JACK\"] \"children.@case:lower.@reverse\" [\"jack\",\"alex\",\"sara\"]   多路径 从v1.3.0开始，GJSON添加了将多个路径连接在一起以形成新文档的功能。在{...}或[...]之间包装用逗号分隔的路径将分别导致新的数组或对象。\n例如，使用给定的多路径\n1  {name.first,age,\"the_murphys\":friends.#(last=\"Murphy\")#.first}   在这里，我们为姓氏为“Murphy”的朋友选择了名字，年龄和名字。\n您会注意到，可以提供可选key，在本例中为“the_murphys”，以强制将key分配给值。否则，将使用实际字段的名称，在这种情况下为“first”。如果无法确定名称，则使用“ _”。\n这导致\n1  {\"first\":\"Tom\",\"age\":37,\"the_murphys\":[\"Dale\",\"Jane\"]}   结果类型 GJSON支持JSON类型string，number，bool，和null。数组和对象作为其原始json类型返回。\n该Result类型包含以下之一：\n1 2 3 4  bool, for JSON booleans float64, for JSON numbers string, for JSON string literals nil, for JSON null   要直接访问该值：\n1 2 3 4 5  result.Type // can be String, Number, True, False, Null, or JSON result.Str // holds the string result.Num // holds the float64 number result.Raw // holds the raw json result.Index // index of raw value in original json, zero means index unknown   有多种方便的功能可以处理结果：\n1 2 3 4 5 6 7 8 9 10 11 12 13  result.Exists() bool result.Value() interface{} result.Int() int64 result.Uint() uint64 result.Float() float64 result.String() string result.Bool() bool result.Time() time.Time result.Array() []gjson.Result result.Map() map[string]gjson.Result result.Get(path string) Result result.ForEach(iterator func(key, value Result) bool) result.Less(token Result, caseSensitive bool) bool   result.Value()函数返回一个interface{}.并且是以下Go类型之一：\n1 2 3 4 5 6  boolean  bool number  float64 string  string null  nil array  []interface{} object  map[string]interface{}   result.Array()函数返回一个值数组。如果结果表示不存在的值，则将返回一个空数组。如果结果不是JSON数组，则返回值将是一个包含一个结果的数组。\n64位整数 该result.Int()和result.Uint()是能够读取所有64位，允许大型JSON整数。\n1 2  result.Int() int64 // -9223372036854775808 to 9223372036854775807 result.Uint() int64 // 0 to 18446744073709551615   JSON行 支持使用前缀的JSON行，..前缀将多行文档视为数组。\n例如：\n1 2 3 4  {\"name\": \"Gilbert\", \"age\": 61} {\"name\": \"Alexa\", \"age\": 34} {\"name\": \"May\", \"age\": 57} {\"name\": \"Deloise\", \"age\": 44}   1 2 3 4 5  ..#  4 ..1  {\"name\": \"Alexa\", \"age\": 34} ..3  {\"name\": \"Deloise\", \"age\": 44} ..#.name  [\"Gilbert\",\"Alexa\",\"May\",\"Deloise\"] ..#(name=\"May\").age  57   ForEachLines函数将遍历JSON行。\n1 2 3 4  gjson.ForEachLine(json, func(line gjson.Result) bool{ println(line.String()) return true })   获取嵌套数组值 假设您想要来自以下json的所有姓氏：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  { \"programmers\": [ { \"firstName\": \"Janet\", \"lastName\": \"McLaughlin\", }, { \"firstName\": \"Elliotte\", \"lastName\": \"Hunter\", }, { \"firstName\": \"Jason\", \"lastName\": \"Harold\", } ] }   您将使用如下路径：\"programmers.#.lastName\"：\n1 2 3 4  result := gjson.Get(json, \"programmers.#.lastName\") for _, name := range result.Array() { println(name.String()) }   您还可以查询数组内的对象：\n1 2  name := gjson.Get(json, `programmers.#(lastName=\"Hunter\").firstName`) println(name.String()) // prints \"Elliotte\"   遍历对象或数组 ForEach函数允许快速遍历对象或数组。key和value将传递给对象的迭代器函数。仅将值传递给数组。false从迭代器返回将停止迭代。\n1 2 3 4 5  result := gjson.Get(json, \"programmers\") result.ForEach(func(key, value gjson.Result) bool { println(value.String()) return true // keep iterating })   简单解析和获取 Parse(json)函数可以进行简单的解析，result.Get(path)可以搜索结果。\n例如，所有这些将返回相同的结果：\n1 2 3  gjson.Parse(json).Get(\"name\").Get(\"last\") gjson.Get(json, \"name\").Get(\"last\") gjson.Get(json, \"name.last\")   检查值是否存在 有时您只想知道值是否存在。\n1 2 3 4 5 6 7 8 9 10 11  value := gjson.Get(json, \"name.last\") if !value.Exists() { println(\"no last name\") } else { println(value.String()) } // Or as one step if gjson.Get(json, \"name.last\").Exists() { println(\"has a last name\") }   验证JSON Get*和Parse*功能预计，JSON是良好的。错误的json不会panic，但它可能会返回意外结果。\n如果您从不可预测的来源使用JSON，则可能需要在使用GJSON之前进行验证。\n1 2 3 4  if !gjson.Valid(json) { return errors.New(\"invalid json\") } value := gjson.Get(json, \"name.last\")   解码map 解码map[string]interface{}：\n1 2 3 4  m, ok := gjson.Parse(json).Value().(map[string]interface{}) if !ok { // not a map }   使用Bytes 如果您的JSON包含在[]byte切片中，则有GetBytes函数。这优先于Get(string(data), path)。\n1 2  var json []byte = ... result := gjson.GetBytes(json, path)   如果您使用的是gjson.GetBytes(json, path)函数，并且希望避免转换result.Raw为[]byte，则可以使用以下模式：\n1 2 3 4 5 6 7 8  var json []byte = ... result := gjson.GetBytes(json, path) var raw []byte if result.Index  0 { raw = json[result.Index:result.Index+len(result.Raw)] } else { raw = []byte(result.Raw) }   这是原始json的尽力而为的不分配子切片。此方法利用result.Index字段，即原始json中原始数据的位置。result.Index的值可能等于零，在这种情况下，result.Raw会转换为[]byte。\n一次获取多个值 GetMany函数可用于同时获取多个值。\n1  results := gjson.GetMany(json, \"name.first\", \"name.last\", \"age\")   返回值为[]Result，它将始终包含与输入路径完全相同数量的项目。\n性能\nGJSON与encoding / json， ffjson， EasyJSON， jsonparser和json-iterator的Benchmarks\n1 2 3 4 5 6 7 8  BenchmarkGJSONGet-8 3000000 372 ns/op 0 B/op 0 allocs/op BenchmarkGJSONUnmarshalMap-8 900000 4154 ns/op 1920 B/op 26 allocs/op BenchmarkJSONUnmarshalMap-8 600000 9019 ns/op 3048 B/op 69 allocs/op BenchmarkJSONDecoder-8 300000 14120 ns/op 4224 B/op 184 allocs/op BenchmarkFFJSONLexer-8 1500000 3111 ns/op 896 B/op 8 allocs/op BenchmarkEasyJSONLexer-8 3000000 887 ns/op 613 B/op 6 allocs/op BenchmarkJSONParserGet-8 3000000 499 ns/op 21 B/op 0 allocs/op BenchmarkJSONIterator-8 3000000 812 ns/op 544 B/op 9 allocs/op   使用的JSON文档：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  { \"widget\": { \"debug\": \"on\", \"window\": { \"title\": \"Sample Konfabulator Widget\", \"name\": \"main_window\", \"width\": 500, \"height\": 500 }, \"image\": { \"src\": \"Images/Sun.png\", \"hOffset\": 250, \"vOffset\": 250, \"alignment\": \"center\" }, \"text\": { \"data\": \"Click Here\", \"size\": 36, \"style\": \"bold\", \"vOffset\": 100, \"alignment\": \"center\", \"onMouseUp\": \"sun1.opacity = (sun1.opacity / 100) * 90;\" } } }   每个操作都通过以下搜索路径之一进行轮换：\n1 2 3  widget.window.name widget.image.hOffset widget.text.onMouseUp   这些基准测试是在使用Go 1.8的MacBook Pro 15“ 2.8 GHz Intel Core i7上运行的.\n参考:https://github.com/tidwall/gjson\n",
  "wordCount" : "3566",
  "inLanguage": "zh-cn",
  "datePublished": "2019-12-23T19:38:12Z",
  "dateModified": "2019-12-23T19:38:12Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/go%E8%AF%AD%E8%A8%80%E5%BF%AB%E9%80%9F%E8%A7%A3%E6%9E%90jsongjson/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Forz Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="Forz Blog (Alt + H)">Forz Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="/post/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Go语言快速解析JSON:gjson
    </h1>
    <div class="post-meta">December 23, 2019
</div>
  </header> 
  <div class="post-content"><h1 id="前言">前言<a hidden class="anchor" aria-hidden="true" href="#前言">#</a></h1>
<p>GJSON是一个Go包，它提供了一种快速，简单的方法来从json文档中获取值。它具有诸如单行检索，点符号路径，迭代和解析json行之类的功能。</p>
<h1 id="获得值">获得值<a hidden class="anchor" aria-hidden="true" href="#获得值">#</a></h1>
<p>获取搜索json以查找指定的路径。路径采用点语法，例如“name.last”或“age”。找到该值后，将立即返回。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;github.com/tidwall/gjson&#34;</span>

<span class="kd">const</span> <span class="nx">json</span> <span class="p">=</span> <span class="s">`{&#34;name&#34;:{&#34;first&#34;:&#34;Janet&#34;,&#34;last&#34;:&#34;Prichard&#34;},&#34;age&#34;:47}`</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">value</span> <span class="o">:=</span> <span class="nx">gjson</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="s">&#34;name.last&#34;</span><span class="p">)</span>
	<span class="nb">println</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Prichard
</code></pre></td></tr></table>
</div>
</div><p>还有一个GetMany函数可以一次获取多个值，还有GetBytes用于处理JSON字节片。</p>
<h1 id="gjson路径语法">GJSON路径语法<a hidden class="anchor" aria-hidden="true" href="#gjson路径语法">#</a></h1>
<h2 id="路径结构">路径结构<a hidden class="anchor" aria-hidden="true" href="#路径结构">#</a></h2>
<p>GJSON Path旨在易于表达为一系列由.字符分隔的组件。</p>
<p>除了<code>.</code>还有一些具有特殊含义，包括几个<code>|</code>，<code>#</code>，<code>@</code>，<code>\</code>，<code>*</code>，和<code>?</code>。</p>
<h2 id="举例">举例<a hidden class="anchor" aria-hidden="true" href="#举例">#</a></h2>
<p>给定此JSON</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&#34;first&#34;</span><span class="p">:</span> <span class="s2">&#34;Tom&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span><span class="p">:</span> <span class="s2">&#34;Anderson&#34;</span><span class="p">},</span>
  <span class="nt">&#34;age&#34;</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span>
  <span class="nt">&#34;children&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;Sara&#34;</span><span class="p">,</span><span class="s2">&#34;Alex&#34;</span><span class="p">,</span><span class="s2">&#34;Jack&#34;</span><span class="p">],</span>
  <span class="nt">&#34;fav.movie&#34;</span><span class="p">:</span> <span class="s2">&#34;Deer Hunter&#34;</span><span class="p">,</span>
  <span class="nt">&#34;friends&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="nt">&#34;first&#34;</span><span class="p">:</span> <span class="s2">&#34;Dale&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span><span class="p">:</span> <span class="s2">&#34;Murphy&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">44</span><span class="p">,</span> <span class="nt">&#34;nets&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;ig&#34;</span><span class="p">,</span> <span class="s2">&#34;fb&#34;</span><span class="p">,</span> <span class="s2">&#34;tw&#34;</span><span class="p">]},</span>
    <span class="p">{</span><span class="nt">&#34;first&#34;</span><span class="p">:</span> <span class="s2">&#34;Roger&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span><span class="p">:</span> <span class="s2">&#34;Craig&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">68</span><span class="p">,</span> <span class="nt">&#34;nets&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;fb&#34;</span><span class="p">,</span> <span class="s2">&#34;tw&#34;</span><span class="p">]},</span>
    <span class="p">{</span><span class="nt">&#34;first&#34;</span><span class="p">:</span> <span class="s2">&#34;Jane&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span><span class="p">:</span> <span class="s2">&#34;Murphy&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">47</span><span class="p">,</span> <span class="nt">&#34;nets&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;ig&#34;</span><span class="p">,</span> <span class="s2">&#34;tw&#34;</span><span class="p">]}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以下GJSON路径将评估为随附的值。</p>
<h3 id="基本的">基本的<a hidden class="anchor" aria-hidden="true" href="#基本的">#</a></h3>
<p>在许多情况下，您只想按对象名称或数组索引检索值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="err">name.last</span>              <span class="s2">&#34;Anderson&#34;</span>
<span class="err">name.first</span>             <span class="s2">&#34;Tom&#34;</span>
<span class="err">age</span>                    <span class="mi">37</span>
<span class="err">children</span>               <span class="p">[</span><span class="s2">&#34;Sara&#34;</span><span class="p">,</span><span class="s2">&#34;Alex&#34;</span><span class="p">,</span><span class="s2">&#34;Jack&#34;</span><span class="p">]</span>
<span class="err">children.</span><span class="mi">0</span>             <span class="s2">&#34;Sara&#34;</span>
<span class="err">children.</span><span class="mi">1</span>             <span class="s2">&#34;Alex&#34;</span>
<span class="err">friends.</span><span class="mi">1</span>              <span class="p">{</span><span class="nt">&#34;first&#34;</span><span class="p">:</span> <span class="s2">&#34;Roger&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span><span class="p">:</span> <span class="s2">&#34;Craig&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">68</span><span class="p">}</span>
<span class="err">friends.</span><span class="mi">1</span><span class="err">.first</span>        <span class="s2">&#34;Roger&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="通配符">通配符<a hidden class="anchor" aria-hidden="true" href="#通配符">#</a></h3>
<p>key可能包含特殊的通配符<code>*</code>和<code>?</code>。<code>*</code>匹配任何0个以上的字符字符，<code>?</code>匹配任意一个字符。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="err">child*.</span><span class="mi">2</span>               <span class="s2">&#34;Jack&#34;</span>
<span class="err">c?ildren.</span><span class="mi">0</span>             <span class="s2">&#34;Sara&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="转义符">转义符<a hidden class="anchor" aria-hidden="true" href="#转义符">#</a></h3>
<p>特殊用途的字符，例如<code>.</code>，<code>*</code>和<code>?</code>可以进行转义<code>\</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="err">fav\.movie</span>             <span class="s2">&#34;Deer Hunter&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="数组">数组<a hidden class="anchor" aria-hidden="true" href="#数组">#</a></h3>
<p><code>#</code>字符允许挖掘JSON数组。</p>
<p>要获得数组的长度，可以单独使用<code>#</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="err">friends.#</span>              <span class="mi">3</span>
<span class="err">friends.#.age</span>         <span class="p">[</span><span class="mi">44</span><span class="p">,</span><span class="mi">68</span><span class="p">,</span><span class="mi">47</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="查询">查询<a hidden class="anchor" aria-hidden="true" href="#查询">#</a></h3>
<p>您也可以使用<code>#(...)</code>来查询数组中的第一个匹配项，或者使用<code>#(...)#</code>查找所有匹配项。查询支持<code>==</code>，<code>!=</code>，<code>&lt;</code>，<code>&lt;=</code>，<code>&gt;</code>，<code>&gt;=</code>比较运算符，和简单模式匹配<code>%</code>（like）和<code>!%</code>（not like）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="err">friends.#(last==</span><span class="s2">&#34;Murphy&#34;</span><span class="err">).first</span>     <span class="s2">&#34;Dale&#34;</span>
<span class="err">friends.#(last==</span><span class="s2">&#34;Murphy&#34;</span><span class="err">)#.first</span>    <span class="p">[</span><span class="s2">&#34;Dale&#34;</span><span class="p">,</span><span class="s2">&#34;Jane&#34;</span><span class="p">]</span>
<span class="err">friends.#(age&gt;</span><span class="mi">45</span><span class="err">)#.last</span>             <span class="p">[</span><span class="s2">&#34;Craig&#34;</span><span class="p">,</span><span class="s2">&#34;Murphy&#34;</span><span class="p">]</span>
<span class="err">friends.#(first%</span><span class="s2">&#34;D*&#34;</span><span class="err">).last</span>          <span class="s2">&#34;Murphy&#34;</span>
<span class="err">friends.#(first!%</span><span class="s2">&#34;D*&#34;</span><span class="err">).last</span>         <span class="s2">&#34;Craig&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>要查询数组中的非对象值，可以放弃运算符右侧的字符串。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="err">children.#(!%</span><span class="s2">&#34;*a*&#34;</span><span class="err">)</span>                 <span class="s2">&#34;Alex&#34;</span>
<span class="err">children.#(%</span><span class="s2">&#34;*a*&#34;</span><span class="err">)#</span>                 <span class="p">[</span><span class="s2">&#34;Sara&#34;</span><span class="p">,</span><span class="s2">&#34;Jack&#34;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>允许嵌套查询。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="err">friends.#(nets.#(==</span><span class="s2">&#34;fb&#34;</span><span class="err">))#.first</span>  <span class="err">&gt;&gt;</span> <span class="p">[</span><span class="s2">&#34;Dale&#34;</span><span class="p">,</span><span class="s2">&#34;Roger&#34;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>请注意，在v1.3.0之前，查询使用<code>#[...]</code>方括号。为了避免与新的多路径语法混淆，在v1.3.0中对此进行了更改。为了向后兼容，<code>#[...]</code>它将继续工作直到下一个主要版本。</p>
<h3 id="-vs-"><code>.</code> vs <code>|</code><a hidden class="anchor" aria-hidden="true" href="#-vs-">#</a></h3>
<p><code>.</code>是标准的分隔符，但它也可以使用<code>|</code>。在大多数情况下，它们最终都返回相同的结果。当为了Arrays 和 Queries而在<code>#</code>之后使用时,<code>|</code>和<code>.</code>表现不同。</p>
<p>这里有些例子</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="err">friends.</span><span class="mi">0</span><span class="err">.first</span>                     <span class="s2">&#34;Dale&#34;</span>
<span class="err">friends|</span><span class="mi">0</span><span class="err">.first</span>                     <span class="s2">&#34;Dale&#34;</span>
<span class="err">friends.</span><span class="mi">0</span><span class="err">|first</span>                     <span class="s2">&#34;Dale&#34;</span>
<span class="err">friends|</span><span class="mi">0</span><span class="err">|first</span>                     <span class="s2">&#34;Dale&#34;</span>
<span class="err">friends|#</span>                           <span class="mi">3</span>
<span class="err">friends.#</span>                           <span class="mi">3</span>
<span class="err">friends.#(last=</span><span class="s2">&#34;Murphy&#34;</span><span class="err">)#</span>           <span class="p">[{</span><span class="nt">&#34;first&#34;</span><span class="p">:</span> <span class="s2">&#34;Dale&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span><span class="p">:</span> <span class="s2">&#34;Murphy&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">44</span><span class="p">},{</span><span class="nt">&#34;first&#34;</span><span class="p">:</span> <span class="s2">&#34;Jane&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span><span class="p">:</span> <span class="s2">&#34;Murphy&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">47</span><span class="p">}]</span>
<span class="err">friends.#(last=</span><span class="s2">&#34;Murphy&#34;</span><span class="err">)#.first</span>     <span class="p">[</span><span class="s2">&#34;Dale&#34;</span><span class="p">,</span><span class="s2">&#34;Jane&#34;</span><span class="p">]</span>
<span class="err">friends.#(last=</span><span class="s2">&#34;Murphy&#34;</span><span class="err">)#|first</span>     <span class="err">&lt;non-existent&gt;</span>
<span class="err">friends.#(last=</span><span class="s2">&#34;Murphy&#34;</span><span class="err">)#.</span><span class="mi">0</span>         <span class="p">[]</span>
<span class="err">friends.#(last=</span><span class="s2">&#34;Murphy&#34;</span><span class="err">)#|</span><span class="mi">0</span>         <span class="p">{</span><span class="nt">&#34;first&#34;</span><span class="p">:</span> <span class="s2">&#34;Dale&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span><span class="p">:</span> <span class="s2">&#34;Murphy&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">44</span><span class="p">}</span>
<span class="err">friends.#(last=</span><span class="s2">&#34;Murphy&#34;</span><span class="err">)#.#</span>         <span class="p">[]</span>
<span class="err">friends.#(last=</span><span class="s2">&#34;Murphy&#34;</span><span class="err">)#|#</span>         <span class="mi">2</span>
</code></pre></td></tr></table>
</div>
</div><p>让我们分析其中的一些。</p>
<p>路径<code>friends.#(last=&quot;Murphy&quot;)#</code>导致</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">[{</span><span class="nt">&#34;first&#34;</span><span class="p">:</span> <span class="s2">&#34;Dale&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span><span class="p">:</span> <span class="s2">&#34;Murphy&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">44</span><span class="p">},{</span><span class="nt">&#34;first&#34;</span><span class="p">:</span> <span class="s2">&#34;Jane&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span><span class="p">:</span> <span class="s2">&#34;Murphy&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">47</span><span class="p">}]</span>
</code></pre></td></tr></table>
</div>
</div><p>所述.first后缀将处理first每个阵列元素上路径之前将结果返回。变成</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">[</span><span class="s2">&#34;Dale&#34;</span><span class="p">,</span><span class="s2">&#34;Jane&#34;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>但是<code>|first</code>后缀实际上是在前一个结果之后处理<code>first</code>路径。由于前一个结果是数组，而不是对象，因此无法处理，因为first不存在</p>
<p>后缀<code>|0</code>返回</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span><span class="nt">&#34;first&#34;</span><span class="p">:</span> <span class="s2">&#34;Dale&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span><span class="p">:</span> <span class="s2">&#34;Murphy&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">44</span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>因为0是先前结果的第一个索引。</p>
<h3 id="修饰符">修饰符<a hidden class="anchor" aria-hidden="true" href="#修饰符">#</a></h3>
<p>修饰符是对JSON执行自定义处理的路径组件。</p>
<p>例如，<code>@reverse</code>在上述JSON有效负载上使用内置修饰符将反转<code>children</code>数组：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="err">children.@reverse</span>                   <span class="p">[</span><span class="s2">&#34;Jack&#34;</span><span class="p">,</span><span class="s2">&#34;Alex&#34;</span><span class="p">,</span><span class="s2">&#34;Sara&#34;</span><span class="p">]</span>
<span class="err">children.@reverse.</span><span class="mi">0</span>                 <span class="s2">&#34;Jack&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>当前有三个内置修饰符：</p>
<ul>
<li>@reverse：反转数组或对象的成员。</li>
<li>@ugly：从JSON中删除所有空格。</li>
<li>@pretty：使JSON更具可读性。</li>
</ul>
<h4 id="修饰符参数">修饰符参数<a hidden class="anchor" aria-hidden="true" href="#修饰符参数">#</a></h4>
<p>修饰符可以接受可选参数。参数可以是有效的JSON有效负载，也可以只是字符。</p>
<p>例如，@pretty修饰符将json对象作为其参数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="err">@pretty:</span><span class="p">{</span><span class="nt">&#34;sortKeys&#34;</span><span class="p">:</span><span class="kc">true</span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这使得json很漂亮，并对其所有key进行排序。</p>
<p>使用此示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span><span class="nt">&#34;name&#34;</span><span class="p">:</span>  <span class="p">{</span><span class="nt">&#34;first&#34;</span><span class="p">:</span><span class="s2">&#34;Tom&#34;</span><span class="p">,</span><span class="nt">&#34;last&#34;</span><span class="p">:</span><span class="s2">&#34;Anderson&#34;</span><span class="p">},</span>  <span class="nt">&#34;age&#34;</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span>
<span class="nt">&#34;children&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;Sara&#34;</span><span class="p">,</span><span class="s2">&#34;Alex&#34;</span><span class="p">,</span><span class="s2">&#34;Jack&#34;</span><span class="p">],</span>
<span class="nt">&#34;fav.movie&#34;</span><span class="p">:</span> <span class="s2">&#34;Deer Hunter&#34;</span><span class="p">,</span> <span class="nt">&#34;friends&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="nt">&#34;first&#34;</span><span class="p">:</span> <span class="s2">&#34;Janet&#34;</span><span class="p">,</span> <span class="nt">&#34;last&#34;</span><span class="p">:</span> <span class="s2">&#34;Murphy&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">44</span><span class="p">}</span>
  <span class="p">]}</span>
</code></pre></td></tr></table>
</div>
</div><p>将json格式化为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;first&#34;</span><span class="p">:</span> <span class="s2">&#34;Tom&#34;</span><span class="p">,</span>
    <span class="nt">&#34;last&#34;</span><span class="p">:</span> <span class="s2">&#34;Anderson&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">37</span><span class="p">,</span>
  <span class="nt">&#34;children&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;Sara&#34;</span><span class="p">,</span> <span class="s2">&#34;Alex&#34;</span><span class="p">,</span> <span class="s2">&#34;Jack&#34;</span><span class="p">],</span>
  <span class="nt">&#34;fav.movie&#34;</span><span class="p">:</span> <span class="s2">&#34;Deer Hunter&#34;</span><span class="p">,</span>
  <span class="nt">&#34;friends&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;first&#34;</span><span class="p">:</span> <span class="s2">&#34;Janet&#34;</span><span class="p">,</span>
      <span class="nt">&#34;last&#34;</span><span class="p">:</span> <span class="s2">&#34;Murphy&#34;</span><span class="p">,</span>
      <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">44</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>@pretty选项的完整列表是<code>sortKeys</code>, <code>indent</code>, <code>prefix</code>和<code>width</code>。</p>
<h4 id="自定义修饰符">自定义修饰符<a hidden class="anchor" aria-hidden="true" href="#自定义修饰符">#</a></h4>
<p>您还可以添加自定义修饰符。</p>
<p>例如，在这里我们创建一个修饰符，使整个JSON有效负载变为大写或小写。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">gjson</span><span class="p">.</span><span class="nf">AddModifier</span><span class="p">(</span><span class="s">&#34;case&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">arg</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">arg</span> <span class="o">==</span> <span class="s">&#34;upper&#34;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">ToUpper</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="nx">arg</span> <span class="o">==</span> <span class="s">&#34;lower&#34;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">ToLower</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">json</span>
<span class="p">})</span>
<span class="s">&#34;children.@case:upper&#34;</span>             <span class="p">[</span><span class="s">&#34;SARA&#34;</span><span class="p">,</span><span class="s">&#34;ALEX&#34;</span><span class="p">,</span><span class="s">&#34;JACK&#34;</span><span class="p">]</span>
<span class="s">&#34;children.@case:lower.@reverse&#34;</span>    <span class="p">[</span><span class="s">&#34;jack&#34;</span><span class="p">,</span><span class="s">&#34;alex&#34;</span><span class="p">,</span><span class="s">&#34;sara&#34;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="多路径">多路径<a hidden class="anchor" aria-hidden="true" href="#多路径">#</a></h3>
<p>从v1.3.0开始，GJSON添加了将多个路径连接在一起以形成新文档的功能。在<code>{...}</code>或<code>[...]</code>之间包装用逗号分隔的路径将分别导致新的数组或对象。</p>
<p>例如，使用给定的多路径</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span><span class="err">name.first,age,</span><span class="nt">&#34;the_murphys&#34;</span><span class="p">:</span><span class="err">friends.#(last=</span><span class="s2">&#34;Murphy&#34;</span><span class="err">)#.first</span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在这里，我们为姓氏为“Murphy”的朋友选择了名字，年龄和名字。</p>
<p>您会注意到，可以提供可选key，在本例中为“the_murphys”，以强制将key分配给值。否则，将使用实际字段的名称，在这种情况下为“first”。如果无法确定名称，则使用“ _”。</p>
<p>这导致</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span><span class="nt">&#34;first&#34;</span><span class="p">:</span><span class="s2">&#34;Tom&#34;</span><span class="p">,</span><span class="nt">&#34;age&#34;</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span><span class="nt">&#34;the_murphys&#34;</span><span class="p">:[</span><span class="s2">&#34;Dale&#34;</span><span class="p">,</span><span class="s2">&#34;Jane&#34;</span><span class="p">]}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="结果类型">结果类型<a hidden class="anchor" aria-hidden="true" href="#结果类型">#</a></h1>
<p>GJSON支持JSON类型<code>string</code>，<code>number</code>，<code>bool</code>，和<code>null</code>。数组和对象作为其原始json类型返回。</p>
<p>该Result类型包含以下之一：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="err">bool,</span> <span class="err">for</span> <span class="err">JSON</span> <span class="err">booleans</span>
<span class="err">float</span><span class="mi">64</span><span class="err">,</span> <span class="err">for</span> <span class="err">JSON</span> <span class="err">numbers</span>
<span class="err">string,</span> <span class="err">for</span> <span class="err">JSON</span> <span class="err">string</span> <span class="err">literals</span>
<span class="err">nil,</span> <span class="err">for</span> <span class="err">JSON</span> <span class="kc">null</span>
</code></pre></td></tr></table>
</div>
</div><p>要直接访问该值：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">result</span><span class="p">.</span><span class="nx">Type</span>    <span class="c1">// can be String, Number, True, False, Null, or JSON
</span><span class="c1"></span><span class="nx">result</span><span class="p">.</span><span class="nx">Str</span>     <span class="c1">// holds the string
</span><span class="c1"></span><span class="nx">result</span><span class="p">.</span><span class="nx">Num</span>     <span class="c1">// holds the float64 number
</span><span class="c1"></span><span class="nx">result</span><span class="p">.</span><span class="nx">Raw</span>     <span class="c1">// holds the raw json
</span><span class="c1"></span><span class="nx">result</span><span class="p">.</span><span class="nx">Index</span>   <span class="c1">// index of raw value in original json, zero means index unknown
</span></code></pre></td></tr></table>
</div>
</div><p>有多种方便的功能可以处理结果：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">result</span><span class="p">.</span><span class="nf">Exists</span><span class="p">()</span> <span class="kt">bool</span>
<span class="nx">result</span><span class="p">.</span><span class="nf">Value</span><span class="p">()</span> <span class="kd">interface</span><span class="p">{}</span>
<span class="nx">result</span><span class="p">.</span><span class="nf">Int</span><span class="p">()</span> <span class="kt">int64</span>
<span class="nx">result</span><span class="p">.</span><span class="nf">Uint</span><span class="p">()</span> <span class="kt">uint64</span>
<span class="nx">result</span><span class="p">.</span><span class="nf">Float</span><span class="p">()</span> <span class="kt">float64</span>
<span class="nx">result</span><span class="p">.</span><span class="nf">String</span><span class="p">()</span> <span class="kt">string</span>
<span class="nx">result</span><span class="p">.</span><span class="nf">Bool</span><span class="p">()</span> <span class="kt">bool</span>
<span class="nx">result</span><span class="p">.</span><span class="nf">Time</span><span class="p">()</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
<span class="nx">result</span><span class="p">.</span><span class="nf">Array</span><span class="p">()</span> <span class="p">[]</span><span class="nx">gjson</span><span class="p">.</span><span class="nx">Result</span>
<span class="nx">result</span><span class="p">.</span><span class="nf">Map</span><span class="p">()</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">gjson</span><span class="p">.</span><span class="nx">Result</span>
<span class="nx">result</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">path</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">Result</span>
<span class="nx">result</span><span class="p">.</span><span class="nf">ForEach</span><span class="p">(</span><span class="nx">iterator</span> <span class="kd">func</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="nx">Result</span><span class="p">)</span> <span class="kt">bool</span><span class="p">)</span>
<span class="nx">result</span><span class="p">.</span><span class="nf">Less</span><span class="p">(</span><span class="nx">token</span> <span class="nx">Result</span><span class="p">,</span> <span class="nx">caseSensitive</span> <span class="kt">bool</span><span class="p">)</span> <span class="kt">bool</span>
</code></pre></td></tr></table>
</div>
</div><p><code>result.Value()</code>函数返回一个<code>interface{}</code>.并且是以下Go类型之一：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="err">boolean</span> <span class="err">&gt;&gt;</span> <span class="err">bool</span>
<span class="err">number</span>  <span class="err">&gt;&gt;</span> <span class="err">float</span><span class="mi">64</span>
<span class="err">string</span>  <span class="err">&gt;&gt;</span> <span class="err">string</span>
<span class="kc">null</span>    <span class="err">&gt;&gt;</span> <span class="err">nil</span>
<span class="err">array</span>   <span class="err">&gt;&gt;</span> <span class="p">[]</span><span class="err">interface</span><span class="p">{}</span>
<span class="err">object</span>  <span class="err">&gt;&gt;</span> <span class="err">map</span><span class="p">[</span><span class="err">string</span><span class="p">]</span><span class="err">interface</span><span class="p">{}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>result.Array()</code>函数返回一个值数组。如果结果表示不存在的值，则将返回一个空数组。如果结果不是JSON数组，则返回值将是一个包含一个结果的数组。</p>
<h2 id="64位整数">64位整数<a hidden class="anchor" aria-hidden="true" href="#64位整数">#</a></h2>
<p>该<code>result.Int()</code>和<code>result.Uint()</code>是能够读取所有64位，允许大型JSON整数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">result</span><span class="p">.</span><span class="nf">Int</span><span class="p">()</span> <span class="kt">int64</span>    <span class="c1">// -9223372036854775808 to 9223372036854775807
</span><span class="c1"></span><span class="nx">result</span><span class="p">.</span><span class="nf">Uint</span><span class="p">()</span> <span class="kt">int64</span>   <span class="c1">// 0 to 18446744073709551615
</span></code></pre></td></tr></table>
</div>
</div><h1 id="json行">JSON行<a hidden class="anchor" aria-hidden="true" href="#json行">#</a></h1>
<p>支持使用前缀的JSON行，<code>..</code>前缀将多行文档视为数组。</p>
<p>例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span><span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Gilbert&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">61</span><span class="p">}</span>
<span class="p">{</span><span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Alexa&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">34</span><span class="p">}</span>
<span class="p">{</span><span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;May&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">57</span><span class="p">}</span>
<span class="p">{</span><span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Deloise&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">44</span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="err">..#</span>                   <span class="err">&gt;&gt;</span> <span class="mi">4</span>
<span class="err">..</span><span class="mi">1</span>                   <span class="err">&gt;&gt;</span> <span class="p">{</span><span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Alexa&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">34</span><span class="p">}</span>
<span class="err">..</span><span class="mi">3</span>                   <span class="err">&gt;&gt;</span> <span class="p">{</span><span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Deloise&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">44</span><span class="p">}</span>
<span class="err">..#.name</span>              <span class="err">&gt;&gt;</span> <span class="p">[</span><span class="s2">&#34;Gilbert&#34;</span><span class="p">,</span><span class="s2">&#34;Alexa&#34;</span><span class="p">,</span><span class="s2">&#34;May&#34;</span><span class="p">,</span><span class="s2">&#34;Deloise&#34;</span><span class="p">]</span>
<span class="err">..#(name=</span><span class="s2">&#34;May&#34;</span><span class="err">).age</span>   <span class="err">&gt;&gt;</span> <span class="mi">57</span>
</code></pre></td></tr></table>
</div>
</div><p><code>ForEachLines</code>函数将遍历JSON行。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">gjson</span><span class="p">.</span><span class="nf">ForEachLine</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">line</span> <span class="nx">gjson</span><span class="p">.</span><span class="nx">Result</span><span class="p">)</span> <span class="kt">bool</span><span class="p">{</span>
    <span class="nb">println</span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="获取嵌套数组值">获取嵌套数组值<a hidden class="anchor" aria-hidden="true" href="#获取嵌套数组值">#</a></h1>
<p>假设您想要来自以下json的所有姓氏：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;programmers&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;firstName&#34;</span><span class="p">:</span> <span class="s2">&#34;Janet&#34;</span><span class="p">,</span> 
      <span class="nt">&#34;lastName&#34;</span><span class="p">:</span> <span class="s2">&#34;McLaughlin&#34;</span><span class="p">,</span> 
    <span class="p">},</span> <span class="p">{</span>
      <span class="nt">&#34;firstName&#34;</span><span class="p">:</span> <span class="s2">&#34;Elliotte&#34;</span><span class="p">,</span> 
      <span class="nt">&#34;lastName&#34;</span><span class="p">:</span> <span class="s2">&#34;Hunter&#34;</span><span class="p">,</span> 
    <span class="p">},</span> <span class="p">{</span>
      <span class="nt">&#34;firstName&#34;</span><span class="p">:</span> <span class="s2">&#34;Jason&#34;</span><span class="p">,</span> 
      <span class="nt">&#34;lastName&#34;</span><span class="p">:</span> <span class="s2">&#34;Harold&#34;</span><span class="p">,</span> 
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>您将使用如下路径：<code>&quot;programmers.#.lastName&quot;</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">result</span> <span class="o">:=</span> <span class="nx">gjson</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="s">&#34;programmers.#.lastName&#34;</span><span class="p">)</span>
<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">result</span><span class="p">.</span><span class="nf">Array</span><span class="p">()</span> <span class="p">{</span>
	<span class="nb">println</span><span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>您还可以查询数组内的对象：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">name</span> <span class="o">:=</span> <span class="nx">gjson</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="s">`programmers.#(lastName=&#34;Hunter&#34;).firstName`</span><span class="p">)</span>
<span class="nb">println</span><span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>  <span class="c1">// prints &#34;Elliotte&#34;
</span></code></pre></td></tr></table>
</div>
</div><h1 id="遍历对象或数组">遍历对象或数组<a hidden class="anchor" aria-hidden="true" href="#遍历对象或数组">#</a></h1>
<p><code>ForEach</code>函数允许快速遍历对象或数组。key和value将传递给对象的迭代器函数。仅将值传递给数组。false从迭代器返回将停止迭代。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">result</span> <span class="o">:=</span> <span class="nx">gjson</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="s">&#34;programmers&#34;</span><span class="p">)</span>
<span class="nx">result</span><span class="p">.</span><span class="nf">ForEach</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="nx">gjson</span><span class="p">.</span><span class="nx">Result</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
	<span class="nb">println</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span> 
	<span class="k">return</span> <span class="kc">true</span> <span class="c1">// keep iterating
</span><span class="c1"></span><span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="简单解析和获取">简单解析和获取<a hidden class="anchor" aria-hidden="true" href="#简单解析和获取">#</a></h1>
<p><code>Parse(json)</code>函数可以进行简单的解析，<code>result.Get(path)</code>可以搜索结果。</p>
<p>例如，所有这些将返回相同的结果：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">gjson</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="nx">json</span><span class="p">).</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">).</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;last&#34;</span><span class="p">)</span>
<span class="nx">gjson</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="s">&#34;name&#34;</span><span class="p">).</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;last&#34;</span><span class="p">)</span>
<span class="nx">gjson</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="s">&#34;name.last&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="检查值是否存在">检查值是否存在<a hidden class="anchor" aria-hidden="true" href="#检查值是否存在">#</a></h1>
<p>有时您只想知道值是否存在。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">value</span> <span class="o">:=</span> <span class="nx">gjson</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="s">&#34;name.last&#34;</span><span class="p">)</span>
<span class="k">if</span> <span class="p">!</span><span class="nx">value</span><span class="p">.</span><span class="nf">Exists</span><span class="p">()</span> <span class="p">{</span>
	<span class="nb">println</span><span class="p">(</span><span class="s">&#34;no last name&#34;</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="nb">println</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1">// Or as one step
</span><span class="c1"></span><span class="k">if</span> <span class="nx">gjson</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="s">&#34;name.last&#34;</span><span class="p">).</span><span class="nf">Exists</span><span class="p">()</span> <span class="p">{</span>
	<span class="nb">println</span><span class="p">(</span><span class="s">&#34;has a last name&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="验证json">验证JSON<a hidden class="anchor" aria-hidden="true" href="#验证json">#</a></h1>
<p><code>Get*</code>和<code>Parse*</code>功能预计，JSON是良好的。错误的json不会panic，但它可能会返回意外结果。</p>
<p>如果您从不可预测的来源使用JSON，则可能需要在使用GJSON之前进行验证。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="k">if</span> <span class="p">!</span><span class="nx">gjson</span><span class="p">.</span><span class="nf">Valid</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;invalid json&#34;</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">value</span> <span class="o">:=</span> <span class="nx">gjson</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="s">&#34;name.last&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="解码map">解码map<a hidden class="anchor" aria-hidden="true" href="#解码map">#</a></h1>
<p>解码<code>map[string]interface{}</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">m</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">gjson</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="nx">json</span><span class="p">).</span><span class="nf">Value</span><span class="p">().(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{})</span>
<span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
	<span class="c1">// not a map
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="使用bytes">使用Bytes<a hidden class="anchor" aria-hidden="true" href="#使用bytes">#</a></h1>
<p>如果您的JSON包含在<code>[]byte</code>切片中，则有GetBytes函数。这优先于<code>Get(string(data), path)</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">json</span> <span class="p">[]</span><span class="kt">byte</span> <span class="p">=</span> <span class="o">...</span>
<span class="nx">result</span> <span class="o">:=</span> <span class="nx">gjson</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">path</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>如果您使用的是<code>gjson.GetBytes(json, path)</code>函数，并且希望避免转换<code>result.Raw</code>为<code>[]byte</code>，则可以使用以下模式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">json</span> <span class="p">[]</span><span class="kt">byte</span> <span class="p">=</span> <span class="o">...</span>
<span class="nx">result</span> <span class="o">:=</span> <span class="nx">gjson</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">path</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">raw</span> <span class="p">[]</span><span class="kt">byte</span>
<span class="k">if</span> <span class="nx">result</span><span class="p">.</span><span class="nx">Index</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="nx">raw</span> <span class="p">=</span> <span class="nx">json</span><span class="p">[</span><span class="nx">result</span><span class="p">.</span><span class="nx">Index</span><span class="p">:</span><span class="nx">result</span><span class="p">.</span><span class="nx">Index</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">Raw</span><span class="p">)]</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">raw</span> <span class="p">=</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">Raw</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这是原始json的尽力而为的不分配子切片。此方法利用<code>result.Index</code>字段，即原始json中原始数据的位置。<code>result.Index</code>的值可能等于零，在这种情况下，<code>result.Raw</code>会转换为<code>[]byte</code>。</p>
<h1 id="一次获取多个值">一次获取多个值<a hidden class="anchor" aria-hidden="true" href="#一次获取多个值">#</a></h1>
<p><code>GetMany</code>函数可用于同时获取多个值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">results</span> <span class="o">:=</span> <span class="nx">gjson</span><span class="p">.</span><span class="nf">GetMany</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="s">&#34;name.first&#34;</span><span class="p">,</span> <span class="s">&#34;name.last&#34;</span><span class="p">,</span> <span class="s">&#34;age&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>返回值为<code>[]Result</code>，它将始终包含与输入路径完全相同数量的项目。</p>
<p>性能</p>
<p>GJSON与encoding / json， ffjson， EasyJSON， jsonparser和json-iterator的Benchmarks</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">BenchmarkGJSONGet-8                  3000000        372 ns/op          0 B/op         0 allocs/op
BenchmarkGJSONUnmarshalMap-8          900000       4154 ns/op       1920 B/op        26 allocs/op
BenchmarkJSONUnmarshalMap-8           600000       9019 ns/op       3048 B/op        69 allocs/op
BenchmarkJSONDecoder-8                300000      14120 ns/op       4224 B/op       184 allocs/op
BenchmarkFFJSONLexer-8               1500000       3111 ns/op        896 B/op         8 allocs/op
BenchmarkEasyJSONLexer-8             3000000        887 ns/op        613 B/op         6 allocs/op
BenchmarkJSONParserGet-8             3000000        499 ns/op         21 B/op         0 allocs/op
BenchmarkJSONIterator-8              3000000        812 ns/op        544 B/op         9 allocs/op
</code></pre></td></tr></table>
</div>
</div><p>使用的JSON文档：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;widget&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;debug&#34;</span><span class="p">:</span> <span class="s2">&#34;on&#34;</span><span class="p">,</span>
    <span class="nt">&#34;window&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;Sample Konfabulator Widget&#34;</span><span class="p">,</span>
      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;main_window&#34;</span><span class="p">,</span>
      <span class="nt">&#34;width&#34;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
      <span class="nt">&#34;height&#34;</span><span class="p">:</span> <span class="mi">500</span>
    <span class="p">},</span>
    <span class="nt">&#34;image&#34;</span><span class="p">:</span> <span class="p">{</span> 
      <span class="nt">&#34;src&#34;</span><span class="p">:</span> <span class="s2">&#34;Images/Sun.png&#34;</span><span class="p">,</span>
      <span class="nt">&#34;hOffset&#34;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
      <span class="nt">&#34;vOffset&#34;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
      <span class="nt">&#34;alignment&#34;</span><span class="p">:</span> <span class="s2">&#34;center&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="s2">&#34;Click Here&#34;</span><span class="p">,</span>
      <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">36</span><span class="p">,</span>
      <span class="nt">&#34;style&#34;</span><span class="p">:</span> <span class="s2">&#34;bold&#34;</span><span class="p">,</span>
      <span class="nt">&#34;vOffset&#34;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
      <span class="nt">&#34;alignment&#34;</span><span class="p">:</span> <span class="s2">&#34;center&#34;</span><span class="p">,</span>
      <span class="nt">&#34;onMouseUp&#34;</span><span class="p">:</span> <span class="s2">&#34;sun1.opacity = (sun1.opacity / 100) * 90;&#34;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>    
</code></pre></td></tr></table>
</div>
</div><p>每个操作都通过以下搜索路径之一进行轮换：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">widget.window.name
widget.image.hOffset
widget.text.onMouseUp
</code></pre></td></tr></table>
</div>
</div><p>这些基准测试是在使用Go 1.8的MacBook Pro 15“ 2.8 GHz Intel Core i7上运行的.</p>
<p>参考:<a href="https://github.com/tidwall/gjson">https://github.com/tidwall/gjson</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="/tags/gjson/">gjson</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2021 <a href="/">Forz Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
