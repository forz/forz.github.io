<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>视图详解 - Forz Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Forz" /><meta name="description" content="简介 视图是从一个或几个基本表（或视图）导出的表。它与基本表不同，是一个虚表。数据库中只存放视图的定义，而不存放视图对应的数据，这些数据仍存放" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.91.2 with theme even" />


<link rel="canonical" href="/post/%E8%A7%86%E5%9B%BE%E8%AF%A6%E8%A7%A3/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.98f8e47918247c097fa26317cbb567fe9f05503485bf08d8547f5579543303b1.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="视图详解" />
<meta property="og:description" content="简介 视图是从一个或几个基本表（或视图）导出的表。它与基本表不同，是一个虚表。数据库中只存放视图的定义，而不存放视图对应的数据，这些数据仍存放" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/%E8%A7%86%E5%9B%BE%E8%AF%A6%E8%A7%A3/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2017-08-15T13:44:26+00:00" />
<meta property="article:modified_time" content="2017-08-15T13:44:26+00:00" />

<meta itemprop="name" content="视图详解">
<meta itemprop="description" content="简介 视图是从一个或几个基本表（或视图）导出的表。它与基本表不同，是一个虚表。数据库中只存放视图的定义，而不存放视图对应的数据，这些数据仍存放"><meta itemprop="datePublished" content="2017-08-15T13:44:26+00:00" />
<meta itemprop="dateModified" content="2017-08-15T13:44:26+00:00" />
<meta itemprop="wordCount" content="3840">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="视图详解"/>
<meta name="twitter:description" content="简介 视图是从一个或几个基本表（或视图）导出的表。它与基本表不同，是一个虚表。数据库中只存放视图的定义，而不存放视图对应的数据，这些数据仍存放"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Forz Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Forz Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
      <a class="menu-item-link" href="/">Home</a>
    </li><li class="menu-item">
      <a class="menu-item-link" href="/post/">Archives</a>
    </li><li class="menu-item">
      <a class="menu-item-link" href="/tags/">Tags</a>
    </li><li class="menu-item">
      <a class="menu-item-link" href="/categories/">Categories</a>
    </li>
  </ul>
</nav><div class="docsearch-input__container">
  <input type="search" class="docsearch-input" placeholder="Search" />
</div>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">视图详解</h1>

      <div class="post-meta">
        <span class="post-time"> 2017-08-15 </span>
        <div class="post-category">
            <a href="/categories/mysql/"> MySQL </a>
            </div>
          <span class="more-meta"> 约 3840 字 </span>
          <span class="more-meta"> 预计阅读 8 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#建立视图">建立视图</a></li>
  </ul>

  <ul>
    <li><a href="#1视图能够简化用户的操作">1.	视图能够简化用户的操作</a></li>
    <li><a href="#2视图使用户能以多种角度看待同一数据">2.	视图使用户能以多种角度看待同一数据</a></li>
    <li><a href="#3视图对重构数据库提供了一定程度的逻辑独立性">3.	视图对重构数据库提供了一定程度的逻辑独立性</a></li>
    <li><a href="#4视图能够对机密数据提供安全保护">4.	视图能够对机密数据提供安全保护</a></li>
    <li><a href="#5适当利用视图可以更清晰地表达查询">5.	适当利用视图可以更清晰地表达查询</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h1 id="简介">简介</h1>
<p>视图是从一个或几个基本表（或视图）导出的表。它与基本表不同，是一个虚表。数据库中只存放视图的定义，而不存放视图对应的数据，这些数据仍存放在原来的基本表中。所以一旦基本表中的数据发生变化，从视图中查询出的数据也就随之改变了。从这个意义上讲，视图就像一个窗口，透过它可以看到数据库中自己感兴趣的数据及其变化。</p>
<p>视图一经定义，就可以和基本表一样被査询、被删除。也可以在一个视图之上再定义新的视图，但对视图的更新（增、删、改）操作则有一定的限制。</p>
<p>如果以后修改了基本表的结构，则表与视图的映像关系就会被破坏，该视图就不能正常工作了。为避免出现这类问题，最好在修改基本表之后删除由该基本表导出的视图，然后重建这个视图。</p>
<h1 id="定义视图">定义视图</h1>
<h2 id="建立视图">建立视图</h2>
<p>SQL语言用CREATE VIEW命令建立视图，其一般格式为</p>
<pre><code>CREATE VIEW &lt;视图名&gt;[(&lt;列名&gt; [,&lt;列名&gt;]…)]
AS&lt;子查询&gt;
[WITH CHECK OPTION];
</code></pre>
<p>其中，子查询可以是任意的SELECT语句，是否可以含有ORDER BY子句和DISTINCT短语，则取决于具体系统的实现。</p>
<p>WITH CHECK OPTION表示对视图进行UPDATE、INSERT和DELETE操作时要
保证更新、插入或删除的行满足视图定义中的谓词条件（即子查询中的条件表达式）。</p>
<p>组成视图的属性列名或者全部省略或者全部指定，没有第三种选择。如果省略了视图的各个属性列名，则隐含该视图由子查询中SELECT子句目标列中的诸字段组成。但在下列三种情况下必须明确指定组成视图的所有列名：</p>
<ol>
<li>某个目标列不是单纯的属性名，而是聚集函数或列表达式；</li>
<li>多表连接时选出了几个同名列作为视图的字段；</li>
<li>需要在视图中为某个列启用新的更合适的名字。</li>
</ol>
<p>例:建立信息系学生的视图，并要求进行修改和插入操作时仍需保证该视图只有信息系的学生。</p>
<pre><code>CREATE VIEW IS_Student
AS
SELECT Sno，Sname，Sage
FROM Student
WHERE Sdept='IS'
WITH CHECK OPTION;
</code></pre>
<p>本例中省略了视图IS_Student的列名，隐含了由子查询中SELECT子句中的三个列名组成。</p>
<p>关系数据库管理系统执行CREATE VIEW语句的结果只是把视图的定义存入数据字典，并不执行其中的SELECT语句。只是在对视图查询时，才按视图的定义从基本表中将数据查出。</p>
<p>由于在定义IS_Student视图时加上了 WITH CHECK OPTION子句，以后对该视图进行插入、修改和删除操作时，关系数据库管理系统会自动加上Sdept=&lsquo;IS’的条件。</p>
<p>若一个视图是从单个基本表导出的，并且只是去掉了基本表的某些行和某些列，但保留了主码，则称这类视图为行列子集视图。IS_Student视图就是一个行列子集视图。</p>
<p>视图不仅可以建立在单个基本表上，也可以建立在多个基本表上。</p>
<p>例:建立信息系选修了1号课程的学生的视图（包括学号、姓名、成绩）</p>
<pre><code>CREATE VIEW IS_S1(Sno,Sname,Grade)
AS
SELECT Student.Sno,Sname,Grade
FROM Student,SC
WHERE Sdept='IS' AND
		Student.Sno=SC.Sno AND
		SC.Cno='1';
</code></pre>
<p>由于视图IS_S1的属性列中包含了 Student表与SC表的同名列Sno,所以必须在视图名后面明确说明视图的各个属性列名。</p>
<p>视图不仅可以建立在一个或多个基本表上，也可以建立在一个或多个已定义好的视图上，或建立在基本表与视图上。</p>
<p>例:建立信息系选修了1号课程且成绩在90分以上的学生的视图。</p>
<pre><code>CREATE VIEW IS S2
AS
SELECT Sno,Sname,Grade
FROM IS一S1
WHERE Grade&gt;=90;
</code></pre>
<p>这里的视图IS_S2就是建立在视图IS_S1之上的。</p>
<p>定义基本表时，为了减少数据库中的冗余数据，表中只存放基本数据，由基本数据经过各种计算派生出的数据一般是不存储的。由于视图中的数据并不实际存储，所以定义视图时可以根据应用的需要设置一些派生属性列。这些派生属性由于在基本表中并不实际存在，也称它们为虚拟列。带虚拟列的视图也称为带表达式的视图。</p>
<p>例:定义一个反映学生出生年份的视图。</p>
<pre><code>CREATE VIEW BT_S(Sno,Sname,Sbirth)
AS
SELECT Sno,Sname,2014-Sage
FROM Student;
</code></pre>
<p>这里视图BT_S是一个带表达式的视图。视图中的出生年份值是通过计算得到的。</p>
<p>还可以用带有聚集函数和GROUP BY子句的查询来定义视图，这种视图称为分组视图。</p>
<p>将学生的学号及平均成绩定义为一个视图。</p>
<pre><code>CREATE VIEW S_G(Sno,Gavg)
AS
SELECT Sno，AVG(Grade)
FROM SC
GROUP BY Sno;
</code></pre>
<p>由于AS子句中SELECT语句的目标列平均成绩是通过作用聚集函数得到的，所以
CREATE VIEW中必须明确定义组成S_G视图的各个属性列名。S_G是一个分组视图。</p>
<h1 id="删除视图">删除视图</h1>
<p>该语句的格式为</p>
<pre><code>DROP VIEW &lt;视图名&gt; [CASCADE];
</code></pre>
<p>基本表删除后，由该基本表导出的所有视图均无法使用了，但是视图的定义没有从字典中清除。删除这些视图定义需要显式地使用DROP VIEW语句。</p>
<p>例:删除视图BT_S和视图IS_S1:</p>
<pre><code>DROP VIEW BT_S;	/*成功执行*/
DROP VIEW IS_S1;	/*拒绝执行*/
</code></pre>
<p>执行此语句时由于IS_S1视图上还导出了 IS_S2视图，所以该语句被拒绝执行。如果确定要删除，则使用级联删除语句：</p>
<pre><code>DROP VIEW IS_S1 CASCADE;	
</code></pre>
<h1 id="查询视图">查询视图</h1>
<p>视图定义后，用户就可以像对基本表一样对视图进行查询了。</p>
<p>关系数据库管理系统执行对视图的查询时，首先进行有效性检查，检查查询中涉及的表、视图等是否存在。如果存在，则从数据字典中取出视图的定义，把定义中的子查询和用户的査询结合起来，转换成等价的对基本表的查询，然后再执行修正了的查询。这一转换过程称为视图消解（view resolution)。</p>
<p>例:在信息系学生的视图中找出年龄小于20岁的学生。</p>
<pre><code>SELECT Sno,Sage
FROM IS_Student
WHERE Sage&lt;20;
</code></pre>
<p>本例转换后的查询语句为</p>
<pre><code>SELECT Sno，Sage
FROM Student
WHERE Sdept='IS' AND Sage&lt;20;
</code></pre>
<p>定义视图并查询视图与基于派生表的查询是有区别的。视图一旦定义，其定义将永久保存在数据字典中，之后的所有查询都可以直接引用该视图。而派生表只是在语句执行时临时定义，语句执行后该定义即被删除。</p>
<h1 id="更新视图">更新视图</h1>
<p>更新视图是指通过视图来插入（INSERT)、删除（DELETE)和修改（UPDATE)数据。</p>
<p>由于视图是不实际存储数据的虚表，因此对视图的更新最终要转换为对基本表的更新。像查询视图那样，对视图的更新操作也是通过视图消解，转换为对基本表的更新操作。为防止用户通过视图对数据进行增加、删除、修改时，有意无意地对不属于视图范围内的基本表数据进行操作，可在定义视图时加上WITH CHECK OPTION子句。这样在视图上增、删、改数据时，关系数据库管理系统会检查视图定义中的条件，若不满足条件则拒绝执行该操作。</p>
<p>例:将信息系学生视图IS_Student中学号为“201215122”的学生姓名改为“刘辰”。</p>
<pre><code>UPDATE IS_Student
SET Sname=•刘辰’
WHERE Sno=’201215122’；
</code></pre>
<p>转换后的更新语句为</p>
<pre><code>UPDATE Student
SET Sname='刘辰’
WHERE Sno=，201215122. AND Sdept='IS'；
</code></pre>
<p>在关系数据库中，并不是所有的视图都是可更新的，因为有些视图的更新不能唯一地有意义地转换成对相应基本表的更新。</p>
<p>例:视图S_G是由学号和平均成绩两个属性列组成的，其中平均成绩一项是由Student表中对元组分组后计算平均值得来的：</p>
<pre><code>CREATE VIEW S_G(Sno,Gavg)
AS
SELECT Sno,AVG(Grade)
FROM SC
GROUP BY Sno;
</code></pre>
<p>如果想把视图S_G中学号为“201215121”的学生的平均成绩改成90分，SQL语句如下：</p>
<pre><code>UPDATE S_G
SET Gavg=90
WHERE Sno='201215121';
</code></pre>
<p>但这个对视图的更新是无法转换成对基本表SC的更新的，因为系统无法修改各科成绩，以使平均成绩成为90。所以S_G视图是不可更新的。</p>
<h1 id="作用">作用</h1>
<p>视图最终是定义在基本表之上的，对视图的一切操作最终也要转换为对基本表的操作。而且对于非行列子集视图进行查询或更新时还有可能出现问题。既然如此，为什么还要定义视图呢？这是因为合理使用视图能够带来许多好处。</p>
<h2 id="1视图能够简化用户的操作">1.	视图能够简化用户的操作</h2>
<p>视图机制使用户可以将注意力集中在所关心的数据上。如果这些数据不是直接来自基本表，则可以通过定义视图使数据库看起来结构简单、清晰，并且可以简化用户的数据查询操作。</p>
<p>例如，那些定义了若干张表连接的视图就将表与表之间的连接操作对用户隐蔽起来了。换句话说，用户所做的只是对一个虚表的简单査询，而这个虚表是怎样得来的，用户无须了解。</p>
<h2 id="2视图使用户能以多种角度看待同一数据">2.	视图使用户能以多种角度看待同一数据</h2>
<p>视图机制能使不同的用户以不同的方式看待同一数据，当许多不同种类的用户共享同一个数据库时，这种灵活性是非常重要的。</p>
<h2 id="3视图对重构数据库提供了一定程度的逻辑独立性">3.	视图对重构数据库提供了一定程度的逻辑独立性</h2>
<p>在关系数据库中，数据库的重构往往是不可避免的。重构数据库最常见的是将一个基本表“垂直”地分成多个基本表。</p>
<p>例如：将学生关系Student(Sno，Sname，Ssex，Sage，Sdept)
分为 SX(Sno，Sname, Sage)和 SY(Sno，Ssex，Sdept)两个关系。</p>
<p>这时原表 Student 为 SX表和SY表自然连接的结果。如果建立一个视图Student:</p>
<pre><code>CREATE VIEW Student(Sno,Sname,Ssex,Sage,Sdept)
AS
SELECT SX.Sno,SX.Sname,SY.Ssex,SX.Sage,SY.Sdept
FROM SX,SY
WHERE SX.Sno=SY.Sno;
</code></pre>
<p>这样尽管数据库的逻辑结构改变了（变为SX和SY两个表），但应用程序不必修改，因为新建立的视图定义为用户原来的关系，使用户的外模式保持不变，用户的应用程序通过视图仍然能够查找数据。</p>
<p>当然，视图只能在一定程度上提供数据的逻辑独立性，比如由于对视图的更新是有条件的，因此应用程序中修改数据的语句可能仍会因基本表结构的改变而需要做相应修改。</p>
<h2 id="4视图能够对机密数据提供安全保护">4.	视图能够对机密数据提供安全保护</h2>
<p>有了视图机制，就可以在设计数据库应用系统时对不同的用户定义不同的视图，使机密数据不出现在不应看到这些数据的用户视图上。这样视图机制就自动提供了对机密数据的安全保护功能。</p>
<p>例如，Student表涉及全校15个院系的学生数据，可以在其上定义15个视图，每个视图只包含一个院系的学生数据，并只允许每个院系的主任查询和修改本院系的学生视图。</p>
<h2 id="5适当利用视图可以更清晰地表达查询">5.	适当利用视图可以更清晰地表达查询</h2>
<p>例如，经常需要执行这样的查询“对每个同学找出他获得最高成绩的课程号”。可以先定义一个视图，求出每个同学获得的最高成绩：</p>
<pre><code>CREATE VIEW VMGRADE
AS
SELECT Sno,MAX(Grade) Mgrade
FROM SC
GROUP BY Sno;
</code></pre>
<p>然后用如下的查询语句完成查询：</p>
<pre><code>SELECT SC.Sno,Cno
FROM SC, VMGRADE
WHERE SC.Sno=VMGRADE.Sno AND SC.Grade=VMGRADE.Mgrade;
</code></pre>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Forz</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2017-08-15
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%8C%E6%95%B4%E6%80%A7%E6%B5%85%E6%9E%90/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">数据库完整性浅析</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/sql%E8%AF%AD%E5%8F%A5-dml%E8%AF%AD%E5%8F%A5-%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/">
            <span class="next-text nav-default">SQL语句:DML语句-数据查询</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="forz/forzblog.talk"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span>Forz</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>






<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
docsearch({
    apiKey: "b4b9da2eba53aa6dabe4b8ac9e8676e1",
    indexName: "forz.forzvina.com",
    appId: "IAR2EF5L65",
    inputSelector: '.docsearch-input',
    debug: false,
});
</script>
</body>
</html>
